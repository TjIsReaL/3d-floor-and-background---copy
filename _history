{"entries":[{"timestamp":1748090390983,"editorVersion":"2.0.56","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":483,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\n"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":610,"length1":35,"diffs":[[1,"    \"preferredEditor\": \"tsprj\"\n"]]}]},{"type":"edited","filename":"tilemap.g.jres","patch":[{"start1":630,"length1":320,"diffs":[[1,"    \"level2\": {\n        \"id\": \"level2\",\n        \"mimeType\": \"application/mkcd-tilemap\",\n        \"data\": \"MTAxMDAwMTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA==\",\n        \"tileset\": [\n            \"myTiles.transparency16\"\n        ],\n        \"displayName\": \"level2\"\n"]]},{"start1":1886,"length1":327,"diffs":[[1,""]]},{"start1":1974,"length1":1060,"diffs":[[1,"        \"data\": \"MTAxMDAwMTAwMDAyMDIwMjAyMDIyMzIzMjIyMjIyMjIyMjIzMjMyMzIzMDEyNDI0MjQxNjE2MGEwYTA1MGEwNTBhMGEwNTBhMjMwMjA2MWMwNzE2MGExOTE1MTUxNTE1MWEwNjA3MGEyMzAxMDkwOTA5MWMwNzE0MTYwNTA1MDUxNDA5MDgwNTIyMDEwOTE5MTUxNTE1MWIxNjAxMDkwOTE0MGIwYTBhMjIwMTA5MTQyNDI0MWQxNDE2MDEwOTA5MTQwYjA1MDUyMjIzMDkxNDI0MTYxNjE0MTYwMTA5MDkxNDBiMDUwNTIzMjIwOTE3MTUxNTE1MWIwOTA5MDkwOTE3MTUxYTBhMjMyMjA5MDIxNjBhMTYxNDE2MDMwYzBjMGMwZDE0MGQyNTIyMDkwMTE2MTYxNjE0MTYwMzI0MjQyNDBjMTQwYzI2MDQwOTAxMTYxOTE1MTgxNjI0MjQyNDI0MGMxNDIxMjcwNDA5MDExNjE0MTYwOTE2MGQwYzBjMGMwYzE0MGMxZTA0MDkwMTAxMTQwOTA5MGUwZjEwMGMwYzBkMTQwZDFmMDQwOTA5MDkxNzE1MTUwNDA0MDQxNTE1MTUxODBjMjcwNDI0MDkwOTA5MDkwOTEyMTExMzBjMGMwZDBjMGMxZjIzMjMyMzIzMjMyMzIzMjMyMzIzMjMyMDFmMjcxZjFmMjIyMjIyMjIyMjIyMjIyMjIyMjIwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDIwMDAwMjAwMjIwMDIwMDAyMDAwMDIwMDIyMDAwMDAwMjAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAyMDAwMDAyMDAwMDIwMDIwMjAwMDAyMjIyMDAyMDAyMDIwMDAwMjIyMjAwMjAwMjAyMDAwMDAwMDAwMDIwMDIyMjAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAyMjAwMDAwMDAwMDAwMDIwMjIyMjIyMjIyMjIyMjIyMg==\",\n"]]},{"start1":3093,"length1":0,"diffs":[[1,"            \"sprites.dungeon.floorDark0\",\n            \"sprites.dungeon.floorDark2\",\n            \"sprites.dungeon.greenOuterNorth0\",\n            \"sprites.dungeon.stairWest\",\n            \"sprites.castle.tileGrass1\",\n            \"sprites.castle.tilePath1\",\n            \"sprites.castle.tilePath3\",\n            \"sprites.castle.tilePath9\",\n            \"sprites.castle.tilePath5\",\n            \"sprites.castle.tileGrass2\",\n            \"sprites.castle.tilePath6\",\n            \"sprites.castle.tileDarkGrass1\",\n            \"sprites.castle.tileDarkGrass2\",\n            \"sprites.builtin.forestTiles5\",\n            \"sprites.builtin.forestTiles6\",\n            \"sprites.builtin.forestTiles7\",\n            \"sprites.builtin.forestTiles10\",\n            \"sprites.builtin.forestTiles13\",\n            \"sprites.builtin.forestTiles15\",\n            \"sprites.vehicle.roadVertical\",\n            \"sprites.vehicle.roadHorizontal\",\n            \"sprites.castle.tileGrass3\",\n            \"sprites.vehicle.roadTurn3\",\n            \"sprites.vehicle.roadTurn4\",\n            \"sprites.vehicle.roadTurn1\",\n            \"sprites.vehicle.roadTurn2\",\n            \"sprites.vehicle.roadIntersection4\",\n            \"sprites.castle.tilePath2\",\n            \"sprites.castle.tilePath8\",\n            \"sprites.builtin.forestTiles21\",\n            \"sprites.builtin.forestTiles22\",\n            \"sprites.builtin.forestTiles23\",\n"]]},{"start1":4509,"length1":0,"diffs":[[1,"            \"sprites.dungeon.doorOpenNorth\",\n"]]},{"start1":4597,"length1":86,"diffs":[[1,"            \"sprites.builtin.forestTiles0\",\n            \"sprites.builtin.forestTiles1\",\n            \"sprites.builtin.forestTiles2\",\n            \"sprites.builtin.forestTiles4\"\n"]]}]},{"type":"edited","filename":"tilemap.g.ts","patch":[{"start1":270,"length1":204,"diffs":[[1,""]]},{"start1":379,"length1":0,"diffs":[[1,"            case \"level2\":\n            case \"level2\":return tiles.createTilemap(hex`1000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000`, img`\n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n`, [myTiles.transparency16], TileScale.Sixteen);\n"]]},{"start1":1594,"length1":585,"diffs":[[1,"            case \"level1\":return tiles.createTilemap(hex`10001000020202020223232222222222232323230124242416160a0a050a050a0a050a2302061c07160a19151515151a06070a23010909091c07141605050514090805220109191515151b16010909140b0a0a2201091424241d1416010909140b0505222309142416161416010909140b0505232209171515151b0909090917151a0a23220902160a161416030c0c0c0d140d252209011616161416032424240c140c260409011619151816242424240c14212704090116141609160d0c0c0c0c140c1e040901011409090e0f100c0c0d140d1f04090909171515040404151515180c27042409090909091211130c0c0d0c0c1f2323232323232323232323201f271f1f`, img`\n"]]},{"start1":2707,"length1":149,"diffs":[[1,"`, [myTiles.transparency16,sprites.dungeon.floorDark0,sprites.dungeon.floorDark2,sprites.dungeon.greenOuterNorth0,sprites.dungeon.stairWest,sprites.castle.tileGrass1,sprites.castle.tilePath1,sprites.castle.tilePath3,sprites.castle.tilePath9,sprites.castle.tilePath5,sprites.castle.tileGrass2,sprites.castle.tilePath6,sprites.castle.tileDarkGrass1,sprites.castle.tileDarkGrass2,sprites.builtin.forestTiles5,sprites.builtin.forestTiles6,sprites.builtin.forestTiles7,sprites.builtin.forestTiles10,sprites.builtin.forestTiles13,sprites.builtin.forestTiles15,sprites.vehicle.roadVertical,sprites.vehicle.roadHorizontal,sprites.castle.tileGrass3,sprites.vehicle.roadTurn3,sprites.vehicle.roadTurn4,sprites.vehicle.roadTurn1,sprites.vehicle.roadTurn2,sprites.vehicle.roadIntersection4,sprites.castle.tilePath2,sprites.castle.tilePath8,sprites.builtin.forestTiles21,sprites.builtin.forestTiles22,sprites.builtin.forestTiles23,sprites.castle.tileDarkGrass3,sprites.dungeon.doorOpenNorth,sprites.dungeon.floorLight0,sprites.builtin.forestTiles0,sprites.builtin.forestTiles1,sprites.builtin.forestTiles2,sprites.builtin.forestTiles4], TileScale.Sixteen);\n"]]},{"start1":4118,"length1":134,"diffs":[[1,""]]}]}]},{"timestamp":1763383892643,"editorVersion":"2.0.62","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":26040,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddd11111111111111111111111111111111111111111111111111111111111\n111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddddd1111111111111111111111111111111111111111111111111111111111\n11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddddddddd1111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111ddddddddddd1111111111111111111111111111111111111111111111111111111111\n11111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddddddddddddddd11111111111111111111111111ddd111ddd11111111111111111111111\n11111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddddddddddddddd1111111111111111111111111dddddddddd11111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111ddddd11ddddddddddddddddd111111111111111111111ddddddddddddd11111111111111111111111\n111111111111111111111111111111111111111111111111111111111111111111111111111111dddddd11ddddddddddddddddd111111111111111111111dddddddddddddd1111111111111111111111\n11111111111dddddddd111111111111111111111111111111111111111111111111111111ddddddddddd1dddddddddddddddddd111111ddd11111111111dddddddddddddddd1111111111ddd11111111\n1111111111dddddddddd11111111111111111111111111111111111111111111111111111dddddddddddddddddddddddddddddd11111ddddd1111111111dddddddddddddddddd1111111ddddd1111111\n111111ddddddddddddddd1111111111111111111111111111111111111111111111111111dddddddddddddddddddddddddddddd11111ddddd111111111ddddddddddddddddddddd11111ddddd1111111\n111111dddddddddddddddddddd11111111111111111111111111111111111111111111111dddddddddddddddddddddddddddddddd111ddddd111111111ddddddddddddddddddddd1111dddddd1111111\n111111ddddddddddddddddddddd11111111111111111111111dddddddd1111111111d111ddddddddddddddddddddddddddddddddd111dddddd11111111dddddddddddddddddddddd111ddddddd111111\n11111dddddddddddddddddddddddd1111111111111111ddddddddddddd1111111111ddddddddddddddddddddddddddddddddddddd11ddddddd1111111ddddddddddddddddddddddddddddddddd111111\n1dddddddddddddddddddddddddddddd1111111111111dddddddddddddddd11111111ddddddddddddddddddddddddddd6ddddddddd11ddddddd1111111ddddddddddddddddddddddddddddddddddd1111\n1ddddddddddddddddddddddddddddddd1111111111ddddddddddddddddddd111111ddddddddddddddddddddddddddd66dddddddddddddddddd1111111ddddddddddddddddddddddddddddddddddddd11\ndddddddddddddddddddddddddddddddddd1111111dddddddddddddd6dddddd11111ddddddddddddddddddddddddddd66dddddddddddddddddd1111ddddddddddddddddd6dddddddddddddddddddddddd\ndddddddddddddddddddddddddddddddddd11111ddddddddddddddd66dddddd11111dddddddddddddddddddddddddd6666ddddddddddddddddd11dddddddddddddddddd66dddddddddddddddddddddddd\nddddddddddddddddddddddddddddddddddd1dddddddddddddddddd66ddddddd1111dddddddddddddddddddddddd66666ddddddddddddddddddd1dddddddddddddddddd66dddddddddddddddddddddddd\nddddddddddddddddddddddddddddddddddddddddddddddddddddd6666dddddd1111dddddddddddddddddddddddddd666ddddddddddddddddddddddddddddddddddddd6666ddddddddddddddddddddddd\nddddddddddddddd6ddddddddddddddddddddddddddddddddddd66666dddddddddddddddddddddddddddddddddddd66666dddddddddddddddddddddddddddddddddd66666dddddddddddddddddddddddd\ndddddddddddddd66ddddddddddddddddddddddddddddddddddddd666dddddddddddddddddddddddddddddddddddd6666666dddddddddddddddddddddddddddddddddd666ddddddddddddddd9999999dd\ndddddddddddddd66dddddddddddddddddddddddddddddddddddd66666ddddddddddddddddddddd99d99dddddddd666666ddddddddddddddddd999ddddddddddddddd66666dddddddddddd99999999999\n9dddddddddddd6666ddddddddddddddddddddddddddddddddddd6666666ddddddddddddddddd99999999ddddd666666666ddddddd999dddddd999999dddddddddddd6666666ddddddddd999999999999\n999dddddddd66666dddddddddddddddddddddddddd9dddddddd666666ddddddddddddddddd99999999999dddddd66666666ddddd99999999dd9999999dddddddddd666666ddddddddd99999999999999\n9999ddddddddd666ddddddddddddddddd99999999999ddddd666666666dddddddddddddd99999999999999dd996666666dddddd999999999dd9999999dddddddd666666666ddddddd999999999999999\n99999ddddddd66666ddddddddddddddd9999999999999dddddd66666666ddddddddddd9999999999999999999999666666dddd996999999999999999999dddddddd66666666ddddd9999999999999999\n999999dddddd6666666dddddddddddd999999999999999dd996666666ddddddddddd9999999999999999999999666666666dd9996999999999999999999999dd996666666dddddd99999999999999999\n999999ddddd666666dddddddddddd99999999999999999999999666666dddd9969999999999999999999999996666666666699966999999999999999999999999999666666dddd996999999999999999\n999999ddd666666666ddddddd9999999999999999999999999666666666dd999699999999999999999999996666666666699999966999999999999999999999999666666666dd9996999999999999999\n999999ddddd66666666ddddd9999999999999999999999999666666666669996699999999999999999999999966666666699999669999999999999999999999996666666666699966999999999999999\n999999dd996666666dddddd99999999999999999999999966666666666999999669999999999999999999999966666669999996666999999999999999999999666666666669999996699999999999999\n999999999999666666dddd996999999999999999999999999666666666999996699999999999999999999999669666666669966666699999999999999999999996666666669999966999999999999999\n9999999999666666666dd9996999999999999999999999999666666699999966669999999999999999999999996666666666999669999999999999999999999996666666999999666699999999999999\n9999999996666666666699966999999999999999999999996696666666699666666999999999999999999999666666666669966666699999999999999999999966966666666996666669999999999999\n9999999666666666669999996699999999996999999999999966666666669996699999999999699999969996666666666669666666669999999969999999999999666666666699966999999999996999\n9999999996666666669999966999999999996999999999996666666666699666666999999999699999966999996666666666666666999999999969999999999966666666666996666669999999996999\n9996999996666666999999666699999999966699999699966666666666696666666699999996669999669999666666666666666666669999999666999996999666666666666966666666999999966699\n9996699966966666666996666669999999996699999669999966666666666666669999999999669999966996666666666666666666666999999966999996699999666666666666666699999999996699\n9966999999666666666699966999999999966999996699996666666666666666666699999996699999666666666666666666666666699999999669999966999966666666666666666666999999966999\n9996699966666666666996666669999999666699999669966666666666666666666669999966669999966666666666666666666666666999996666999996699666666666666666666666699999666699\n9966669666666666666966666666999999966669996666666666666666666666666999999996666999966666666666666666666666666699999666699966666666666666666666666669999999966669\n9996669999666666666666666699999999666699999666666666666666666666666669999966669999666666666666666666666666669999996666999996666666666666666666666666699999666699\n9996669966666666666666666666999996666669999666666666666666666666666666999666666996666666666666666666666666666699966666699996666666666666666666666666669996666669\n9966669666666666666666666666699999666699996666666666666666666666666699999966669999666666666666666666666666666669996666999966666666666666666666666666999999666699\n9666666666666666666666666669999966666669966666666666666666666666666666996666666999666666666666666666666666666699666666699666666666666666666666666666669966666669\n9966666666666666666666666666699996666666996666666666666666666666666666699666666696666666666666666666666666666669966666669966666666666666666666666666666996666666\n9966666666666666666666666666669966666666996666666666666666666666666666996666666696666666666666666666666666666666666666669966666666666666666666666666669966666666\n6666666666666666666666666666999966666666666666666666666666666666666666696666666666666666666666666666666666666666666666666666666666666666666666666666666966666666\n6666666666666666666666666666669666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666669666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value></block></next></block></statement></block><block type=\"keyonevent\" x=\"361\" y=\"0\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_toggleViewMode\"></block></statement></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":0,"length1":285,"diffs":[[1,""]]},{"start1":100,"length1":377,"diffs":[[1,""]]},{"start1":170,"length1":19800,"diffs":[[1,"    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddd11111111111111111111111111111111111111111111111111111111111\n    111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddddd1111111111111111111111111111111111111111111111111111111111\n    11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddddddddd1111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111ddddddddddd1111111111111111111111111111111111111111111111111111111111\n    11111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddddddddddddddd11111111111111111111111111ddd111ddd11111111111111111111111\n    11111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddddddddddddddd1111111111111111111111111dddddddddd11111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111ddddd11ddddddddddddddddd111111111111111111111ddddddddddddd11111111111111111111111\n    111111111111111111111111111111111111111111111111111111111111111111111111111111dddddd11ddddddddddddddddd111111111111111111111dddddddddddddd1111111111111111111111\n    11111111111dddddddd111111111111111111111111111111111111111111111111111111ddddddddddd1dddddddddddddddddd111111ddd11111111111dddddddddddddddd1111111111ddd11111111\n    1111111111dddddddddd11111111111111111111111111111111111111111111111111111dddddddddddddddddddddddddddddd11111ddddd1111111111dddddddddddddddddd1111111ddddd1111111\n    111111ddddddddddddddd1111111111111111111111111111111111111111111111111111dddddddddddddddddddddddddddddd11111ddddd111111111ddddddddddddddddddddd11111ddddd1111111\n    111111dddddddddddddddddddd11111111111111111111111111111111111111111111111dddddddddddddddddddddddddddddddd111ddddd111111111ddddddddddddddddddddd1111dddddd1111111\n    111111ddddddddddddddddddddd11111111111111111111111dddddddd1111111111d111ddddddddddddddddddddddddddddddddd111dddddd11111111dddddddddddddddddddddd111ddddddd111111\n    11111dddddddddddddddddddddddd1111111111111111ddddddddddddd1111111111ddddddddddddddddddddddddddddddddddddd11ddddddd1111111ddddddddddddddddddddddddddddddddd111111\n    1dddddddddddddddddddddddddddddd1111111111111dddddddddddddddd11111111ddddddddddddddddddddddddddd6ddddddddd11ddddddd1111111ddddddddddddddddddddddddddddddddddd1111\n    1ddddddddddddddddddddddddddddddd1111111111ddddddddddddddddddd111111ddddddddddddddddddddddddddd66dddddddddddddddddd1111111ddddddddddddddddddddddddddddddddddddd11\n    dddddddddddddddddddddddddddddddddd1111111dddddddddddddd6dddddd11111ddddddddddddddddddddddddddd66dddddddddddddddddd1111ddddddddddddddddd6dddddddddddddddddddddddd\n    dddddddddddddddddddddddddddddddddd11111ddddddddddddddd66dddddd11111dddddddddddddddddddddddddd6666ddddddddddddddddd11dddddddddddddddddd66dddddddddddddddddddddddd\n    ddddddddddddddddddddddddddddddddddd1dddddddddddddddddd66ddddddd1111dddddddddddddddddddddddd66666ddddddddddddddddddd1dddddddddddddddddd66dddddddddddddddddddddddd\n    ddddddddddddddddddddddddddddddddddddddddddddddddddddd6666dddddd1111dddddddddddddddddddddddddd666ddddddddddddddddddddddddddddddddddddd6666ddddddddddddddddddddddd\n    ddddddddddddddd6ddddddddddddddddddddddddddddddddddd66666dddddddddddddddddddddddddddddddddddd66666dddddddddddddddddddddddddddddddddd66666dddddddddddddddddddddddd\n    dddddddddddddd66ddddddddddddddddddddddddddddddddddddd666dddddddddddddddddddddddddddddddddddd6666666dddddddddddddddddddddddddddddddddd666ddddddddddddddd9999999dd\n    dddddddddddddd66dddddddddddddddddddddddddddddddddddd66666ddddddddddddddddddddd99d99dddddddd666666ddddddddddddddddd999ddddddddddddddd66666dddddddddddd99999999999\n    9dddddddddddd6666ddddddddddddddddddddddddddddddddddd6666666ddddddddddddddddd99999999ddddd666666666ddddddd999dddddd999999dddddddddddd6666666ddddddddd999999999999\n    999dddddddd66666dddddddddddddddddddddddddd9dddddddd666666ddddddddddddddddd99999999999dddddd66666666ddddd99999999dd9999999dddddddddd666666ddddddddd99999999999999\n    9999ddddddddd666ddddddddddddddddd99999999999ddddd666666666dddddddddddddd99999999999999dd996666666dddddd999999999dd9999999dddddddd666666666ddddddd999999999999999\n    99999ddddddd66666ddddddddddddddd9999999999999dddddd66666666ddddddddddd9999999999999999999999666666dddd996999999999999999999dddddddd66666666ddddd9999999999999999\n    999999dddddd6666666dddddddddddd999999999999999dd996666666ddddddddddd9999999999999999999999666666666dd9996999999999999999999999dd996666666dddddd99999999999999999\n    999999ddddd666666dddddddddddd99999999999999999999999666666dddd9969999999999999999999999996666666666699966999999999999999999999999999666666dddd996999999999999999\n    999999ddd666666666ddddddd9999999999999999999999999666666666dd999699999999999999999999996666666666699999966999999999999999999999999666666666dd9996999999999999999\n    999999ddddd66666666ddddd9999999999999999999999999666666666669996699999999999999999999999966666666699999669999999999999999999999996666666666699966999999999999999\n    999999dd996666666dddddd99999999999999999999999966666666666999999669999999999999999999999966666669999996666999999999999999999999666666666669999996699999999999999\n    999999999999666666dddd996999999999999999999999999666666666999996699999999999999999999999669666666669966666699999999999999999999996666666669999966999999999999999\n    9999999999666666666dd9996999999999999999999999999666666699999966669999999999999999999999996666666666999669999999999999999999999996666666999999666699999999999999\n    9999999996666666666699966999999999999999999999996696666666699666666999999999999999999999666666666669966666699999999999999999999966966666666996666669999999999999\n    9999999666666666669999996699999999996999999999999966666666669996699999999999699999969996666666666669666666669999999969999999999999666666666699966999999999996999\n    9999999996666666669999966999999999996999999999996666666666699666666999999999699999966999996666666666666666999999999969999999999966666666666996666669999999996999\n    9996999996666666999999666699999999966699999699966666666666696666666699999996669999669999666666666666666666669999999666999996999666666666666966666666999999966699\n    9996699966966666666996666669999999996699999669999966666666666666669999999999669999966996666666666666666666666999999966999996699999666666666666666699999999996699\n    9966999999666666666699966999999999966999996699996666666666666666666699999996699999666666666666666666666666699999999669999966999966666666666666666666999999966999\n    9996699966666666666996666669999999666699999669966666666666666666666669999966669999966666666666666666666666666999996666999996699666666666666666666666699999666699\n    9966669666666666666966666666999999966669996666666666666666666666666999999996666999966666666666666666666666666699999666699966666666666666666666666669999999966669\n    9996669999666666666666666699999999666699999666666666666666666666666669999966669999666666666666666666666666669999996666999996666666666666666666666666699999666699\n    9996669966666666666666666666999996666669999666666666666666666666666666999666666996666666666666666666666666666699966666699996666666666666666666666666669996666669\n    9966669666666666666666666666699999666699996666666666666666666666666699999966669999666666666666666666666666666669996666999966666666666666666666666666999999666699\n    9666666666666666666666666669999966666669966666666666666666666666666666996666666999666666666666666666666666666699666666699666666666666666666666666666669966666669\n    9966666666666666666666666666699996666666996666666666666666666666666666699666666696666666666666666666666666666669966666669966666666666666666666666666666996666666\n    9966666666666666666666666666669966666666996666666666666666666666666666996666666696666666666666666666666666666666666666669966666666666666666666666666669966666666\n    6666666666666666666666666666999966666666666666666666666666666666666666696666666666666666666666666666666666666666666666666666666666666666666666666666666966666666\n    6666666666666666666666666666669666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666669666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n"]]},{"start1":19977,"length1":712,"diffs":[[1,""]]}]},{"type":"edited","filename":"tilemap.g.jres","patch":[{"start1":1284,"length1":2947,"diffs":[[1,""]]},{"start1":1372,"length1":1060,"diffs":[[1,"        \"data\": \"MTAxMDAwMTAwMDAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMjAyMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAzMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDMwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDMwMzAzMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMzAzMDMwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAzMDMwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDMwMzAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDMwMzAzMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMzAzMDMwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMjIyMjIyMjIyMjIyMjIyMjIyMjIwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDIwMDAwMjAwMjIwMDIwMDAyMDAwMDIwMDIyMDAwMDAwMjAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAyMDAwMDAyMDAwMDIwMDIwMjAwMDAyMjIyMDAyMDAyMDIwMDAwMjIyMjAwMjAwMjAyMDAwMDAwMDAwMDIwMDIyMjAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAyMjAwMDAwMDAwMDAwMDIwMjIyMjIyMjIyMjIyMjIyMg==\",\n"]]},{"start1":2491,"length1":0,"diffs":[[1,"            \"sprites.castle.tileDarkGrass3\",\n"]]},{"start1":2579,"length1":201,"diffs":[[1,"            \"myTiles.tile1\",\n            \"myTiles.tile2\",\n            \"myTiles.tile3\"\n"]]}]},{"type":"edited","filename":"tilemap.g.ts","patch":[{"start1":474,"length1":921,"diffs":[[1,""]]},{"start1":609,"length1":585,"diffs":[[1,"            case \"level1\":return tiles.createTilemap(hex`1000100001010101010101010101010101010202010101010101010101010101010101010101010101010101010101010101010101010101010101010103010101010101010101010101010101030101010101010101010101010101030303010101010101010101010101010303030101010101010101010101010103030101010101010101010101010101030301010101010101010101010101030303010101010101010101010101010303030101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101`, img`\n"]]},{"start1":1227,"length1":165,"diffs":[[1,"2 2 2 2 . . . . . . . . . . . 2 \n"]]},{"start1":1326,"length1":0,"diffs":[[1,"2 . . . . . . . 2 . . . . . . 2 \n2 . . 2 2 . . . 2 . . . . . . 2 \n2 . . 2 . . . . 2 . . . . . . 2 \n"]]},{"start1":1458,"length1":0,"diffs":[[1,"2 . 2 . . . . . 2 . . . . . . 2 \n2 . 2 . . . . . 2 2 2 2 . . . 2 \n2 . 2 . . . . . 2 2 2 2 . . . 2 \n2 . 2 . . . . . . . . . . . . 2 \n2 . 2 2 . . . . . . . . . . . 2 \n"]]},{"start1":1656,"length1":165,"diffs":[[1,"2 2 . . . . . . . . . . . . . 2 \n"]]},{"start1":1722,"length1":189,"diffs":[[1,"`, [myTiles.transparency16,sprites.castle.tileDarkGrass3,sprites.dungeon.floorLight0,myTiles.tile1,myTiles.tile2,myTiles.tile3], TileScale.Sixteen);\n"]]},{"start1":2272,"length1":610,"diffs":[[1,""]]}]}]},{"timestamp":1763729248254,"editorVersion":"2.0.62","changes":[{"type":"edited","filename":"main.ts","patch":[{"start1":21351,"length1":807,"diffs":[[1,""]]}]}]},{"timestamp":1763729316805,"editorVersion":"2.0.62","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":4468,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable type=\"KIND_SpriteKind\" id=\"USZ`q|D]$0kk|,E!b7c6\">Player</variable><variable type=\"KIND_SpriteKind\" id=\"@8#W0|ESmtdS+3`?Z+:+\">Projectile</variable><variable type=\"KIND_SpriteKind\" id=\"h1jvB:JPL=NMGpJB=4/[\">Food</variable><variable type=\"KIND_SpriteKind\" id=\"(3Y]|wk94c4t/c`pc((X\">Enemy</variable><variable type=\"KIND_SpriteKind\" id=\"2B=HiFZ(Kz-^Ln6ox1L~\">Help</variable><variable id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</variable><variable id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</variable><variable id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</variable></variables><block type=\"keyonevent\" x=\"433\" y=\"-88\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_toggleViewMode\"></block></statement></block><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">You have been abandoned by your crew and trapped on the moon base</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Try and find a way out before the asteroid hits</field></shadow></value><next><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\n"]]},{"start1":21210,"length1":402,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n"]]},{"start1":22103,"length1":3260,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value></block></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"782\" y=\"-11\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile8`</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile10`</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></next></block></statement></block></statement></block><block type=\"spritesoverlap\" x=\"273\" y=\"415\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value><statement name=\"HANDLER\"><block type=\"variables_change\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><next><block type=\"spritedestroy2\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"effect\">effects.spray</field><value name=\"sprite\"><block type=\"argument_reporter_custom\"><mutation typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow></value><next><block type=\"hudsetScore\"><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></next></block></statement></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":69,"length1":179,"diffs":[[1,""]]},{"start1":276,"length1":142,"diffs":[[1,""]]},{"start1":21351,"length1":0,"diffs":[[1,"forever(function () {\n    let mySprite: Sprite = null\n    animation.runImageAnimation(\n    mySprite,\n    [img`\n        . . . . . . . . . . . . . . . . \n        . . . . . . . . . . . . . . . . \n        . . . . . . . . . . . . . . . . \n        . . . . . . . . . . . . . . . . \n        . . . . . . . . . . . . . . . . \n        . . . . . . . . . . . . . . . . \n        . . . . . . . . . . . . . . . . \n        . . . . . . . . . . . . . . . . \n        . . . . . . . . . . . . . . . . \n        . . . . . . . . . . . . . . . . \n        . . . . . . . . . . . . . . . . \n        . . . . . . . . . . . . . . . . \n        . . . . . . . . . . . . . . . . \n        . . . . . . . . . . . . . . . . \n        . . . . . . . . . . . . . . . . \n        . . . . . . . . . . . . . . . . \n        `],\n    500,\n    false\n    )\n})\n"]]}]}]},{"timestamp":1763729900424,"editorVersion":"2.0.62","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":9135,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable type=\"KIND_SpriteKind\" id=\"USZ`q|D]$0kk|,E!b7c6\">Player</variable><variable type=\"KIND_SpriteKind\" id=\"@8#W0|ESmtdS+3`?Z+:+\">Projectile</variable><variable type=\"KIND_SpriteKind\" id=\"h1jvB:JPL=NMGpJB=4/[\">Food</variable><variable type=\"KIND_SpriteKind\" id=\"(3Y]|wk94c4t/c`pc((X\">Enemy</variable><variable type=\"KIND_SpriteKind\" id=\"2B=HiFZ(Kz-^Ln6ox1L~\">Help</variable><variable id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</variable><variable id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</variable><variable id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</variable></variables><block type=\"spriteshittile\" x=\"1210\" y=\"-284\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile8`</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile10`</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"mapsetwallat\"><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">false</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorLight1</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value></block></next></block></next></block></next></block></statement></block></statement></block><block type=\"keyonevent\" x=\"393\" y=\"-141\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_toggleViewMode\"></block></statement></block><block type=\"pxt-on-start\" x=\"54\" y=\"25\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">You have been abandoned by your crew and trapped on the moon base</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Try and find a way out before the asteroid hits</field></shadow></value><next><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\n"]]},{"start1":24718,"length1":3382,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value></block></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"857\" y=\"248\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorLight1</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorLight0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></statement></block><block type=\"spritesoverlap\" x=\"688\" y=\"640\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value><statement name=\"HANDLER\"><block type=\"variables_change\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><next><block type=\"spritedestroy2\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"effect\">effects.spray</field><value name=\"sprite\"><block type=\"argument_reporter_custom\"><mutation typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow></value><next><block type=\"hudsetScore\"><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></next></block></statement></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":69,"length1":193,"diffs":[[1,"scene.onOverlapTile(SpriteKind.Player, sprites.dungeon.floorLight1, function (sprite, location) {\n    tiles.setTileAt(tiles.getTileLocation(6, 3), sprites.dungeon.floorLight0)\n"]]},{"start1":248,"length1":4253,"diffs":[[1,""]]},{"start1":515,"length1":81,"diffs":[[1,"        tiles.setTileAt(tiles.getTileLocation(6, 2), sprites.dungeon.floorLight1)\n"]]},{"start1":865,"length1":28,"diffs":[[1,""]]}]},{"type":"edited","filename":"tilemap.g.jres","patch":[{"start1":4319,"length1":1060,"diffs":[[1,"        \"data\": \"MTAxMDAwMTAwMDAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMjAyMDIwMTA0MDMwMTAxMDIwMjAyMDIwMjAxMDMwMzAyMDIwMjAxMDEwNTAxMDEwMjAyMDIwMjAyMDEwMzAzMDEwMjAyMDEwNzA2MDEwMTAyMDIwMjAyMDIwMTAzMDMwMzA0MDQwMTAxMDMwMTAxMDIwMjAyMDIwMjAxMDMwMzAzMDMwMzAzMDMwMzAxMDEwMjAyMDIwMjAyMDEwMzAzMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAzMDMwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDMwMzAxMDEwMTAxMDIwMjAyMDIwMjAxMDEwMTAxMDEwMzAzMDEwMTAxMDEwMjAyMDIwMjAyMDEwMjAyMDIwMjAzMDMwMTAxMDEwMTAyMDIwMjAyMDIwMTAyMDIwMjAyMDMwMzAyMDIwMTAxMDIwMjAyMDIwMjAxMDIwMjAyMDIwMzAzMDIwMjAxMDEwMjAyMDIwMjAyMDEwMjAyMDIwMjAzMDMwMjAyMDEwMTAxMDEwMTAxMDEwMTAyMDIwMjAyMDMwMzAyMDIwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMjIyMjIyMjIyMjIyMjIyMjAyMDAyMDAyMDAwMDAwMjAwMjAwMDAwMjAwMDAwMDIwMDIwMDAwMDIwMDAwMDAyMDIyMjIwMDAyMDAwMDAwMjAyMjIyMjIwMjAwMDAwMDIwMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMjIyMjIyMjIyMjIyMjIyMg==\",\n"]]}]},{"type":"edited","filename":"tilemap.g.ts","patch":[{"start1":1530,"length1":585,"diffs":[[1,"            case \"level1\":return tiles.createTilemap(hex`1000100003030303030303030303030303030303030202020104030101020202020201030302020201010501010202020202010303010202010706010102020202020103030304040101030101020202020201030303030303030301010202020202010303010101010101010101010101010103030101010101010101010101010101030301010101020202020201010101010303010101010202020202010202020203030101010102020202020102020202030302020101020202020201020202020303020201010202020202010202020203030202010101010101010102020202030302020101010101010101010101010303030303030303030303030303030303`, img`\n"]]},{"start1":2280,"length1":33,"diffs":[[1,"2 2 2 2 2 2 2 . . . . . . . . 2 \n"]]}]}]},{"timestamp":1763730499235,"editorVersion":"2.0.62","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":4554,"length1":5127,"diffs":[[1,"`]</field><data>{\"commentRefs\":[],\"fieldData\":{\"frames\":null}}</data></shadow></value><value name=\"frameInterval\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><value name=\"loop\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">14</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"1394\" y=\"-227\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile8`</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile10`</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"mapsetwallat\"><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">false</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value></block></next></block></next></block></next></block></statement></block></statement></block><block type=\"keyonevent\" x=\"393\" y=\"-141\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_toggleViewMode\"></block></statement></block><block type=\"pxt-on-start\" x=\"54\" y=\"25\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">You have been abandoned by your crew and trapped on the moon base</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Try and find a way out before the asteroid hits</field></shadow></value><next><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\n"]]},{"start1":29385,"length1":3258,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value></block></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"857\" y=\"248\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"function_call\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation></block></next></block></statement></block><block type=\"spritesoverlap\" x=\"688\" y=\"640\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value><statement name=\"HANDLER\"><block type=\"variables_change\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><next><block type=\"spritedestroy2\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"effect\">effects.spray</field><value name=\"sprite\"><block type=\"argument_reporter_custom\"><mutation typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow></value><next><block type=\"hudsetScore\"><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></next></block></statement></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":243,"length1":0,"diffs":[[1,"    Summon_alien()\n"]]},{"start1":4866,"length1":177,"diffs":[[1,""]]}]}]},{"timestamp":1763730722040,"editorVersion":"2.0.62","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":1094,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable type=\"KIND_SpriteKind\" id=\"USZ`q|D]$0kk|,E!b7c6\">Player</variable><variable type=\"KIND_SpriteKind\" id=\"@8#W0|ESmtdS+3`?Z+:+\">Projectile</variable><variable type=\"KIND_SpriteKind\" id=\"h1jvB:JPL=NMGpJB=4/[\">Food</variable><variable type=\"KIND_SpriteKind\" id=\"(3Y]|wk94c4t/c`pc((X\">Enemy</variable><variable type=\"KIND_SpriteKind\" id=\"2B=HiFZ(Kz-^Ln6ox1L~\">Help</variable><variable id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</variable><variable id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</variable><variable id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</variable></variables><block type=\"function_definition\" x=\"688\" y=\"-616\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation><field name=\"function_name\">Summon alien</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n"]]},{"start1":4554,"length1":5125,"diffs":[[1,"`]</field><data>{\"commentRefs\":[],\"fieldData\":{\"frames\":null}}</data></shadow></value><value name=\"frameInterval\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><value name=\"loop\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">14</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"1691\" y=\"-454\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile8`</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile10`</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"mapsetwallat\"><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">false</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Top</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Uh oh. An alien has breached the base.</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Bottom</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Press A to shoot.</field></shadow></value><next><block type=\"function_call\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block></statement></block><block type=\"keyonevent\" x=\"393\" y=\"-141\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_toggleViewMode\"></block></statement></block><block type=\"pxt-on-start\" x=\"54\" y=\"25\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">You have been abandoned by your crew and trapped on the moon base</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Try and find a way out before the asteroid hits</field></shadow></value><next><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\n"]]},{"start1":29931,"length1":3258,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value></block></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"857\" y=\"248\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></statement></block><block type=\"spritesoverlap\" x=\"688\" y=\"640\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value><statement name=\"HANDLER\"><block type=\"variables_change\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><next><block type=\"spritedestroy2\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"effect\">effects.spray</field><value name=\"sprite\"><block type=\"argument_reporter_custom\"><mutation typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow></value><next><block type=\"hudsetScore\"><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></next></block></statement></block></xml>"]]}]}]},{"timestamp":1763731486325,"editorVersion":"2.0.62","changes":[{"type":"edited","filename":"pxt.json","patch":[{"start1":86,"length1":53,"diffs":[[1,"        \"device\": \"*\"\n"]]}]}]},{"timestamp":1763731494421,"editorVersion":"2.0.62","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":1150,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable type=\"KIND_SpriteKind\" id=\"USZ`q|D]$0kk|,E!b7c6\">Player</variable><variable type=\"KIND_SpriteKind\" id=\"@8#W0|ESmtdS+3`?Z+:+\">Projectile</variable><variable type=\"KIND_SpriteKind\" id=\"h1jvB:JPL=NMGpJB=4/[\">Food</variable><variable type=\"KIND_SpriteKind\" id=\"(3Y]|wk94c4t/c`pc((X\">Enemy</variable><variable type=\"KIND_SpriteKind\" id=\"2B=HiFZ(Kz-^Ln6ox1L~\">Help</variable><variable id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</variable><variable id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</variable><variable id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</variable></variables><block type=\"function_definition\" x=\"634\" y=\"-641\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation><field name=\"function_name\">Summon alien</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n"]]},{"start1":4554,"length1":5127,"diffs":[[1,"`]</field><data>{\"commentRefs\":[],\"fieldData\":{\"frames\":null}}</data></shadow></value><value name=\"frameInterval\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><value name=\"loop\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">14</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"1637\" y=\"-479\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile8`</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile10`</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"mapsetwallat\"><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">false</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Top</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Uh oh. An alien has breached the base.</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Bottom</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Press A to shoot.</field></shadow></value><next><block type=\"function_call\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block></statement></block><block type=\"keyonevent\" x=\"339\" y=\"-166\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_toggleViewMode\"></block></statement></block><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">You have been abandoned by your crew and trapped on the moon base</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Try and find a way out before the asteroid hits</field></shadow></value><next><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\n"]]},{"start1":29929,"length1":4863,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value></block></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"803\" y=\"223\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></statement></block><block type=\"spritesoverlap\" x=\"634\" y=\"615\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value><statement name=\"HANDLER\"><block type=\"variables_change\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><next><block type=\"spritedestroy2\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"effect\">effects.spray</field><value name=\"sprite\"><block type=\"argument_reporter_custom\"><mutation typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow></value><next><block type=\"hudsetScore\"><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></next></block></statement></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":26127,"length1":740,"diffs":[[1,""]]}]}]},{"timestamp":1763731581894,"editorVersion":"2.0.62","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":1150,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable type=\"KIND_SpriteKind\" id=\"USZ`q|D]$0kk|,E!b7c6\">Player</variable><variable type=\"KIND_SpriteKind\" id=\"@8#W0|ESmtdS+3`?Z+:+\">Projectile</variable><variable type=\"KIND_SpriteKind\" id=\"h1jvB:JPL=NMGpJB=4/[\">Food</variable><variable type=\"KIND_SpriteKind\" id=\"(3Y]|wk94c4t/c`pc((X\">Enemy</variable><variable type=\"KIND_SpriteKind\" id=\"2B=HiFZ(Kz-^Ln6ox1L~\">Help</variable><variable id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</variable><variable id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</variable><variable id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</variable><variable id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</variable></variables><block type=\"function_definition\" x=\"634\" y=\"-641\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation><field name=\"function_name\">Summon alien</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n"]]},{"start1":4610,"length1":5125,"diffs":[[1,"`]</field><data>{\"commentRefs\":[],\"fieldData\":{\"frames\":null}}</data></shadow></value><value name=\"frameInterval\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><value name=\"loop\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">14</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"1637\" y=\"-479\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile8`</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile10`</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"mapsetwallat\"><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">false</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Top</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Uh oh. An alien has breached the base.</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Bottom</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Press A to shoot.</field></shadow></value><next><block type=\"function_call\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block></statement></block><block type=\"keyonevent\" x=\"339\" y=\"-166\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_toggleViewMode\"></block></statement></block><block type=\"pxt-on-start\" x=\"39\" y=\"49\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">You have been abandoned by your crew and trapped on the moon base</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Try and find a way out before the asteroid hits</field></shadow></value><next><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\n"]]},{"start1":31396,"length1":3454,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value></block></value><next><block type=\"sprite_scale_to_pixels_ex\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"direction\">ScaleDirection.Horizontally</field><field name=\"anchor\">ScaleAnchor.Middle</field><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</field></block></value><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">32</field></shadow></value><value name=\"proportional\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"803\" y=\"223\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></statement></block><block type=\"spritesoverlap\" x=\"634\" y=\"615\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value><statement name=\"HANDLER\"><block type=\"variables_change\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><next><block type=\"spritedestroy2\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"effect\">effects.spray</field><value name=\"sprite\"><block type=\"argument_reporter_custom\"><mutation typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow></value><next><block type=\"hudsetScore\"><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></next></block></statement></block></xml>"]]}]}]},{"timestamp":1763745317993,"editorVersion":"2.0.62","changes":[{"type":"edited","filename":"main.ts","patch":[{"start1":26163,"length1":259,"diffs":[[1,"    b . . . . . . . . . . . . . . b \n    . b . . . . . . . . . . . . b . \n    . . b . . . . . . . . . . b . . \n    . . . b . . . . . . . . b . . . \n    . . . . b . . . . . . b . . . . \n    . . . . . b . . . . b . . . . . \n"]]},{"start1":26459,"length1":259,"diffs":[[1,"    . . . . . . . . . . . . . . . . \n    . . . . . . . . . . . . . . . . \n    . . . . . b . . . . . . . . . . \n    . . . . b . . . . . . . . . . . \n    . . . b . . . . . . . . b . . . \n    . . b . . . . . . . . . . b . . \n    . b . . . . . . . . . . . . b . \n    b . . . . . . . . . . . . . . b \n"]]}]}]},{"timestamp":1763745438223,"editorVersion":"2.0.62","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":1150,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable type=\"KIND_SpriteKind\" id=\"USZ`q|D]$0kk|,E!b7c6\">Player</variable><variable type=\"KIND_SpriteKind\" id=\"@8#W0|ESmtdS+3`?Z+:+\">Projectile</variable><variable type=\"KIND_SpriteKind\" id=\"h1jvB:JPL=NMGpJB=4/[\">Food</variable><variable type=\"KIND_SpriteKind\" id=\"(3Y]|wk94c4t/c`pc((X\">Enemy</variable><variable type=\"KIND_SpriteKind\" id=\"2B=HiFZ(Kz-^Ln6ox1L~\">Help</variable><variable id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</variable><variable id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</variable><variable id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</variable><variable id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</variable></variables><block type=\"function_definition\" x=\"595\" y=\"-690\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation><field name=\"function_name\">Summon alien</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n"]]},{"start1":4610,"length1":5127,"diffs":[[1,"`]</field><data>{\"commentRefs\":[],\"fieldData\":{\"frames\":null}}</data></shadow></value><value name=\"frameInterval\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><value name=\"loop\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">14</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"1598\" y=\"-528\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile8`</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile10`</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"mapsetwallat\"><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">false</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Top</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Uh oh. An alien has breached the base.</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Bottom</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Press A to shoot.</field></shadow></value><next><block type=\"function_call\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block></statement></block><block type=\"keyonevent\" x=\"300\" y=\"-215\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_toggleViewMode\"></block></statement></block><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">You have been abandoned by your crew and trapped on the moon base</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Try and find a way out before the asteroid hits</field></shadow></value><next><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\n"]]},{"start1":29985,"length1":1060,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value></block></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreatenoset\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\nb . . . . . . . . . . . . . . b \n. b . . . . . . . . . . . . b . \n. . b . . . . . . . . . . b . . \n. . . b . . . . . . . . b . . . \n. . . . b . . . . . . b . . . . \n. . . . . b . . . . b . . . . . \n"]]},{"start1":31130,"length1":2991,"diffs":[[1,". . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . b . . . . . . . . . . \n. . . . b . . . . . . . . . . . \n. . . b . . . . . . . . b . . . \n. . b . . . . . . . . . . b . . \n. b . . . . . . . . . . . . b . \nb . . . . . . . . . . . . . . b \n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value></block></value><next><block type=\"sprite_scale_to_pixels_ex\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"direction\">ScaleDirection.Horizontally</field><field name=\"anchor\">ScaleAnchor.Middle</field><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</field></block></value><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">32</field></shadow></value><value name=\"proportional\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"764\" y=\"174\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></statement></block><block type=\"spritesoverlap\" x=\"595\" y=\"566\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value><statement name=\"HANDLER\"><block type=\"variables_change\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><next><block type=\"spritedestroy2\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"effect\">effects.spray</field><value name=\"sprite\"><block type=\"argument_reporter_custom\"><mutation typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow></value><next><block type=\"hudsetScore\"><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></next></block></statement></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":26127,"length1":21,"diffs":[[1,"let Crosshair = sprites.create(img`\n"]]},{"start1":26755,"length1":6,"diffs":[[1,"    `, SpriteKind.Player)\nscaling.scaleToPixels(Crosshair, 32, ScaleDirection.Horizontally, ScaleAnchor.Middle)\n"]]}]}]},{"timestamp":1763746032014,"editorVersion":"2.0.62","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":1206,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable type=\"KIND_SpriteKind\" id=\"USZ`q|D]$0kk|,E!b7c6\">Player</variable><variable type=\"KIND_SpriteKind\" id=\"@8#W0|ESmtdS+3`?Z+:+\">Projectile</variable><variable type=\"KIND_SpriteKind\" id=\"h1jvB:JPL=NMGpJB=4/[\">Food</variable><variable type=\"KIND_SpriteKind\" id=\"(3Y]|wk94c4t/c`pc((X\">Enemy</variable><variable type=\"KIND_SpriteKind\" id=\"2B=HiFZ(Kz-^Ln6ox1L~\">Help</variable><variable id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</variable><variable id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</variable><variable id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</variable><variable id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</variable></variables><block type=\"function_definition\" x=\"554\" y=\"-743\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation><field name=\"function_name\">Summon alien</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n"]]},{"start1":4610,"length1":6472,"diffs":[[1,"`]</field><data>{\"commentRefs\":[],\"fieldData\":{\"frames\":null}}</data></shadow></value><value name=\"frameInterval\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><value name=\"loop\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">14</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"1557\" y=\"-581\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile8`</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile10`</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"mapsetwallat\"><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">false</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Top</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Uh oh. An alien has breached the base.</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Bottom</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Press A to shoot.</field></shadow></value><next><block type=\"function_call\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block></statement></block><block type=\"keyonevent\" x=\"259\" y=\"-268\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_toggleViewMode\"></block></statement></block><block type=\"pxt-on-start\" x=\"39\" y=\"48\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">You have been abandoned by your crew and trapped on the moon base</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Try and find a way out before the asteroid hits</field></shadow></value><next><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\n"]]},{"start1":29987,"length1":1535,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value></block></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"screen_image_picker\"><field name=\"img\">img`\n"]]},{"start1":31344,"length1":2737,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></block></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"723\" y=\"121\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></statement></block><block type=\"spritesoverlap\" x=\"789\" y=\"608\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value><statement name=\"HANDLER\"><block type=\"variables_change\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><next><block type=\"spritedestroy2\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"effect\">effects.spray</field><value name=\"sprite\"><block type=\"argument_reporter_custom\"><mutation typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow></value><next><block type=\"hudsetScore\"><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></next></block></statement></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":69,"length1":127,"diffs":[[1,""]]},{"start1":5334,"length1":74,"diffs":[[1,""]]},{"start1":26127,"length1":36,"diffs":[[1,"let Crosshair = img`\n"]]},{"start1":26740,"length1":79,"diffs":[[1,"    `\n"]]}]}]},{"timestamp":1763746671609,"editorVersion":"2.0.62","changes":[{"type":"edited","filename":"main.ts","patch":[{"start1":5535,"length1":29,"diffs":[[1,""]]}]}]},{"timestamp":1763746677534,"editorVersion":"2.0.62","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":1371,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable type=\"KIND_SpriteKind\" id=\"USZ`q|D]$0kk|,E!b7c6\">Player</variable><variable type=\"KIND_SpriteKind\" id=\"@8#W0|ESmtdS+3`?Z+:+\">Projectile</variable><variable type=\"KIND_SpriteKind\" id=\"h1jvB:JPL=NMGpJB=4/[\">Food</variable><variable type=\"KIND_SpriteKind\" id=\"(3Y]|wk94c4t/c`pc((X\">Enemy</variable><variable type=\"KIND_SpriteKind\" id=\"2B=HiFZ(Kz-^Ln6ox1L~\">Help</variable><variable id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</variable><variable id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</variable><variable id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</variable><variable id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</variable><variable id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</variable></variables><block type=\"function_definition\" x=\"320\" y=\"-841\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation><field name=\"function_name\">Summon alien</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n"]]},{"start1":4666,"length1":9255,"diffs":[[1,"`]</field><data>{\"commentRefs\":[],\"fieldData\":{\"frames\":null}}</data></shadow></value><value name=\"frameInterval\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><value name=\"loop\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">14</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"1323\" y=\"-679\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile8`</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile10`</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"mapsetwallat\"><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">false</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Top</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Uh oh. An alien has breached the base.</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Bottom</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Press A to shoot.</field></shadow></value><next><block type=\"function_call\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block></statement></block><block type=\"keyonevent\" x=\"25\" y=\"-366\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_toggleViewMode\"></block></statement></block><block type=\"spriteshittile\" x=\"37\" y=\"32\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></statement></block><block type=\"pxt-on-start\" x=\"-323\" y=\"175\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"rcRender_getRenderSpriteVariable\"></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">You have been abandoned by your crew and trapped on the moon base</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Try and find a way out before the asteroid hits</field></shadow></value><next><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\n"]]},{"start1":33451,"length1":2752,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value></block></value><next><block type=\"spritesetsetflag\"><field name=\"flag\">SpriteFlag.RelativeToCamera</field><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</field></block></value><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spritesoverlap\" x=\"555\" y=\"510\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value><statement name=\"HANDLER\"><block type=\"variables_change\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><next><block type=\"spritedestroy2\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"effect\">effects.spray</field><value name=\"sprite\"><block type=\"argument_reporter_custom\"><mutation typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow></value><next><block type=\"hudsetScore\"><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></next></block></statement></block><block type=\"keyonevent\" x=\"-64\" y=\"869\"><field name=\"button\">controller.A</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_jumpWithHeightAndDuration\"><value name=\"spr\"><block type=\"variables_get\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field></block></value><value name=\"height\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"100\" label=\"Height\" precision=\"0\"></mutation><field name=\"SLIDER\">16</field></shadow></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">1000</field></shadow></value></block></statement></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":69,"length1":851,"diffs":[[1,""]]},{"start1":5447,"length1":30,"diffs":[[1,""]]},{"start1":5535,"length1":35,"diffs":[[1,"Render.moveWithController(2)\n"]]}]}]},{"timestamp":1763747276383,"editorVersion":"2.0.62","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":2476,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable type=\"KIND_SpriteKind\" id=\"USZ`q|D]$0kk|,E!b7c6\">Player</variable><variable type=\"KIND_SpriteKind\" id=\"@8#W0|ESmtdS+3`?Z+:+\">Projectile</variable><variable type=\"KIND_SpriteKind\" id=\"h1jvB:JPL=NMGpJB=4/[\">Food</variable><variable type=\"KIND_SpriteKind\" id=\"(3Y]|wk94c4t/c`pc((X\">Enemy</variable><variable type=\"KIND_SpriteKind\" id=\"2B=HiFZ(Kz-^Ln6ox1L~\">Help</variable><variable id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</variable><variable id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</variable><variable id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</variable><variable id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</variable><variable id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</variable><variable id=\"[a3#yOs:sosi5Zk_px6P\">mySprite3</variable><variable id=\"i:_MCpc`P;?/}W#x|ztg\">Shell</variable><variable id=\"a+nB2f%[4OGi;MHB]27Q\">projectile</variable></variables><block type=\"function_definition\" x=\"320\" y=\"-841\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation><field name=\"function_name\">Summon alien</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n"]]},{"start1":4831,"length1":4556,"diffs":[[1,"`]</field><data>{\"commentRefs\":[],\"fieldData\":{\"frames\":null}}</data></shadow></value><value name=\"frameInterval\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><value name=\"loop\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">14</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"1650\" y=\"-613\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile8`</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile10`</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"mapsetwallat\"><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">false</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Top</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Uh oh. An alien has breached the base.</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Bottom</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Press A to shoot.</field></shadow></value><next><block type=\"function_call\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block></statement></block><block type=\"keyonevent\" x=\"25\" y=\"-366\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_toggleViewMode\"></block></statement></block><block type=\"keyonevent\" x=\"559\" y=\"-239\"><field name=\"button\">controller.B</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"a+nB2f%[4OGi;MHB]27Q\">projectile</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreateprojectilefromsprite\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n"]]},{"start1":10240,"length1":132,"diffs":[[1,". . . . . . . b b . . . . . . . \n. . . . . . b 9 9 b . . . . . . \n. . . . . . b c 9 b . . . . . . \n. . . . . . . b b . . . . . . . \n"]]},{"start1":10570,"length1":6611,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></block></value><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field></block></value><value name=\"vx\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">50</field></shadow><block type=\"rcRender_getAttribute\"><field name=\"attribute\">Render.attribute.dirX</field></block></value><value name=\"vy\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">50</field></shadow></value></block></value></block></statement></block><block type=\"rcRender_getAttribute\" disabled-reasons=\"ORPHANED_BLOCK,MANUALLY_DISABLED\" x=\"1288\" y=\"-82\"><field name=\"attribute\">Render.attribute.dirX</field></block><block type=\"spriteshittile\" x=\"37\" y=\"32\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></statement></block><block type=\"pxt-on-start\" x=\"-323\" y=\"175\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"rcRender_getRenderSpriteVariable\"></block></value><next><block type=\"rcRender_moveWithController\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"2\" _input_init=\"true\"></mutation><value name=\"v\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">2</field></shadow></value><value name=\"va\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">3</field></shadow></value><value name=\"cameraSway\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">You have been abandoned by your crew and trapped on the moon base</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Try and find a way out before the asteroid hits</field></shadow></value><next><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\n"]]},{"start1":36399,"length1":2842,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value></block></value><next><block type=\"spritesetsetflag\"><field name=\"flag\">SpriteFlag.RelativeToCamera</field><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</field></block></value><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spritesoverlap\" x=\"555\" y=\"510\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value><statement name=\"HANDLER\"><block type=\"variables_change\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><next><block type=\"spritedestroy2\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"effect\">effects.spray</field><value name=\"sprite\"><block type=\"argument_reporter_custom\"><mutation typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow></value><next><block type=\"hudsetScore\"><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></next></block></statement></block><block type=\"keyonevent\" x=\"-64\" y=\"869\"><field name=\"button\">controller.A</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_jumpWithHeightAndDuration\"><value name=\"spr\"><block type=\"variables_get\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field></block></value><value name=\"height\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"100\" label=\"Height\" precision=\"0\"></mutation><field name=\"SLIDER\">16</field></shadow></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">1000</field></shadow></value></block></statement></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":438,"length1":164,"diffs":[[1,"        . . . . . . . b b . . . . . . . \n        . . . . . . b 9 9 b . . . . . . \n        . . . . . . b c 9 b . . . . . . \n        . . . . . . . b b . . . . . . . \n"]]},{"start1":848,"length1":120,"diffs":[[1,"        `, mySprite, Render.getAttribute(Render.attribute.dirX), 50)\n"]]},{"start1":5825,"length1":157,"diffs":[[1,"        game.showLongText(\"Uh oh. An alien has breached the base.\", DialogLayout.Top)\n        game.showLongText(\"Press A to shoot.\", DialogLayout.Bottom)\n"]]},{"start1":6270,"length1":97,"diffs":[[1,""]]},{"start1":6451,"length1":221,"diffs":[[1,""]]},{"start1":6461,"length1":0,"diffs":[[1,"game.showLongText(\"You have been abandoned by your crew and trapped on the moon base\", DialogLayout.Full)\ngame.showLongText(\"Try and find a way out before the asteroid hits\", DialogLayout.Full)\n"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":116,"length1":97,"diffs":[[1,"        \"sprite-scaling\": \"*\"\n"]]}]}]},{"timestamp":1763747873871,"editorVersion":"2.0.62","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":1941,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable type=\"KIND_SpriteKind\" id=\"USZ`q|D]$0kk|,E!b7c6\">Player</variable><variable type=\"KIND_SpriteKind\" id=\"@8#W0|ESmtdS+3`?Z+:+\">Projectile</variable><variable type=\"KIND_SpriteKind\" id=\"h1jvB:JPL=NMGpJB=4/[\">Food</variable><variable type=\"KIND_SpriteKind\" id=\"(3Y]|wk94c4t/c`pc((X\">Enemy</variable><variable type=\"KIND_SpriteKind\" id=\"2B=HiFZ(Kz-^Ln6ox1L~\">Help</variable><variable type=\"KIND_SpriteKind\" id=\"JWhoDx%e%9JIa%.pfAVv\">StatusBar</variable><variable id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</variable><variable id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</variable><variable id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</variable><variable id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</variable><variable id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</variable><variable id=\"[a3#yOs:sosi5Zk_px6P\">mySprite3</variable><variable id=\"i:_MCpc`P;?/}W#x|ztg\">Shell</variable><variable id=\"a+nB2f%[4OGi;MHB]27Q\">projectile</variable><variable id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</variable><variable type=\"KIND_StatusBarKind\" id=\"s%(2IG9YG[q#qn#zR$RL\">Health</variable><variable type=\"KIND_StatusBarKind\" id=\"INxD@r~~T0Wy@hJh=pGh\">Energy</variable><variable type=\"KIND_StatusBarKind\" id=\"z}t^*,Y7$$C-kcZG$91G\">Magic</variable><variable type=\"KIND_StatusBarKind\" id=\"|+h5Z!s*YkuLvDsM!-~j\">EnemyHealth</variable></variables><block type=\"spritesoverlap\" x=\"1853\" y=\"-1384\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Projectile</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Enemy</field></shadow></value></block><block type=\"function_definition\" x=\"283\" y=\"-873\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation><field name=\"function_name\">Summon alien</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n"]]},{"start1":5936,"length1":6876,"diffs":[[1,"`]</field><data>{\"commentRefs\":[],\"fieldData\":{\"frames\":null}}</data></shadow></value><value name=\"frameInterval\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><value name=\"loop\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">14</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"1845\" y=\"-931\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile8`</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile10`</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"mapsetwallat\"><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">false</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Center</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Uh oh. An alien has breached the base.</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Center</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Press A to shoot.</field></shadow></value><next><block type=\"function_call\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block></statement></block><block type=\"keyonevent\" x=\"-12\" y=\"-398\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_toggleViewMode\"></block></statement></block><block type=\"keyonevent\" x=\"522\" y=\"-271\"><field name=\"button\">controller.B</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"a+nB2f%[4OGi;MHB]27Q\">projectile</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreateprojectilefromsprite\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n"]]},{"start1":11679,"length1":5682,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></block></value><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field></block></value><value name=\"vx\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">50</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"NUM\">0</field></shadow><block type=\"rcRender_getAttribute\"><field name=\"attribute\">Render.attribute.dirX</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value></block></value><value name=\"vy\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">50</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"NUM\">0</field></shadow><block type=\"rcRender_getAttribute\"><field name=\"attribute\">Render.attribute.dirY</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value></block></value></block></value></block></statement></block><block type=\"keyonevent\" x=\"842\" y=\"-35\"><field name=\"button\">controller.A</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_jumpWithHeightAndDuration\"><value name=\"spr\"><block type=\"variables_get\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field></block></value><value name=\"height\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"100\" label=\"Height\" precision=\"0\"></mutation><field name=\"SLIDER\">16</field></shadow></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">1000</field></shadow></value></block></statement></block><block type=\"spriteshittile\" x=\"36\" y=\"38\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></statement></block><block type=\"pxt-on-start\" x=\"-360\" y=\"143\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"rcRender_getRenderSpriteVariable\"></block></value><next><block type=\"rcRender_moveWithController\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"2\" _input_init=\"true\"></mutation><value name=\"v\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">2</field></shadow></value><value name=\"va\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">3</field></shadow></value><value name=\"cameraSway\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"statusbars_create\"><value name=\"width\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value><value name=\"height\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"kind\"><shadow type=\"statusbars_kind\"><field name=\"MEMBER\">Health</field></shadow></value></block></value><next><block type=\"statusbars_setColor\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"fillColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">2</field></shadow></value><value name=\"bkgdColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">15</field></shadow></value><value name=\"drainColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">3</field></shadow></value><next><block type=\"StatusBarSprite_blockCombine_set\"><field name=\"property\">StatusBarSprite.value@set</field><value name=\"statusbar\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value><next><block type=\"statusbars_positionNextToSprite\"><field name=\"dir\">CollisionDirection.Top</field><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><next><block type=\"statusbar_setLabel\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"label\"><shadow type=\"text\"><field name=\"TEXT\">HP</field></shadow></value><value name=\"color\"><shadow type=\"colorindexpicker\"><field name=\"index\">1</field></shadow></value><next><block type=\"setPaddingOffset\"><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"padding\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"offset\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\n"]]},{"start1":38045,"length1":462,"diffs":[[1,"1 1 f f f f f f f f f f f f 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 f f f f f f f f f f f f 1 1 \n"]]},{"start1":40603,"length1":4575,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value></block></value><next><block type=\"spritesetsetflag\"><field name=\"flag\">SpriteFlag.RelativeToCamera</field><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</field></block></value><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spritesoverlap\" x=\"518\" y=\"478\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value><statement name=\"HANDLER\"><block type=\"variables_change\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><next><block type=\"spritedestroy2\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"effect\">effects.spray</field><value name=\"sprite\"><block type=\"argument_reporter_custom\"><mutation typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow></value><next><block type=\"hudsetScore\"><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></next></block></statement></block><block type=\"game_show_long_text\" disabled-reasons=\"ORPHANED_BLOCK,MANUALLY_DISABLED\" x=\"-316\" y=\"1235\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"TEXT\">You have been abandoned by your crew and trapped on the moon base</field></shadow></value><next><block type=\"game_show_long_text\" disabled-reasons=\"ORPHANED_BLOCK,MANUALLY_DISABLED\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"TEXT\">Try and find a way out before the asteroid hits</field></shadow></value></block></next></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":968,"length1":82,"diffs":[[1,""]]},{"start1":5526,"length1":216,"diffs":[[1,""]]},{"start1":5876,"length1":243,"diffs":[[1,"        game.showLongText(\"Uh oh. An alien has breached the base.\", DialogLayout.Center)\n        game.showLongText(\"Press A to shoot.\", DialogLayout.Center)\n        Summon_alien()\n"]]},{"start1":6324,"length1":39,"diffs":[[1,"sprites.onOverlap(SpriteKind.Projectile, SpriteKind.Enemy, function (sprite, otherSprite) {\n\t\n})\n"]]},{"start1":6493,"length1":38,"diffs":[[1,""]]},{"start1":6602,"length1":59,"diffs":[[1,"let statusbar = statusbars.create(50, 4, StatusBarKind.Health)\n"]]},{"start1":6790,"length1":33,"diffs":[[1,"statusbar.setOffsetPadding(0, 0)\n"]]},{"start1":26784,"length1":518,"diffs":[[1,"    1 1 f f f f f f f f f f f f 1 1 \n    1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n    1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n    1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n    1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n    1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n    1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n    1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n    1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n    1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n    1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n    1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n    1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n    1 1 f f f f f f f f f f f f 1 1 \n"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":147,"length1":125,"diffs":[[1,"        \"pxt-status-bar\": \"github:jwunderl/pxt-status-bar#v0.4.2\"\n"]]}]},{"type":"edited","filename":"tilemap.g.jres","patch":[{"start1":2265,"length1":0,"diffs":[[1,"    \"tile7\": {\n        \"data\": \"hwQQABAAAAAfERERERER8R8RERERERHx/xEREREREf//mZmZmZmZ//+qqqqqqqr//5mZmZmZmf//mZmZmZmZ//+Zn//5n5n//5mf//mfmf//mZmZmZmZ//+ZmZmZmZn//6qqqqqqqv//mZmZmZmZ//8RERERERH/HxEREREREfEfERERERER8Q==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile5\"\n    },\n"]]},{"start1":2919,"length1":0,"diffs":[[1,"    \"tile9\": {\n        \"data\": \"hwQQABAAAACxu//P/f+7G7G7+8u7v7sbEbv7y7u/uxERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERG7u8u7u7sRsbu7y7u7uxuxu7vLvbu7Gw==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile7\"\n    },\n"]]},{"start1":3902,"length1":654,"diffs":[[1,""]]},{"start1":3918,"length1":204,"diffs":[[1,"        \"data\": \"hwQQABAAAAAfEf8f/x8R8R8R8RHxERHx/xEREREREf//mZmZmZmZ//+qqqqqqqr//5mZmZmZmf//mZmZmZmZ//+Zn//5n5n//5mf//mfmf//mZmZmZmZ//+ZmZmZmZn//6qqqqqqqv//mZmZmZmZ//8RERERERH/HxEREREREfEfERERERER8Q==\",\n"]]},{"start1":5653,"length1":59,"diffs":[[1,"            \"myTiles.tile10\"\n"]]}]},{"type":"edited","filename":"tilemap.g.ts","patch":[{"start1":834,"length1":0,"diffs":[[1,"    export const tile7 = image.ofBuffer(hex``);\n    //% fixedInstance jres blockIdentity=images._tile\n"]]},{"start1":1038,"length1":0,"diffs":[[1,"    export const tile9 = image.ofBuffer(hex``);\n    //% fixedInstance jres blockIdentity=images._tile\n"]]},{"start1":1346,"length1":204,"diffs":[[1,""]]},{"start1":2643,"length1":204,"diffs":[[1,"`, [myTiles.transparency16,sprites.dungeon.floorLight0,sprites.dungeon.floorLight1,sprites.dungeon.floorDark0,myTiles.tile7,myTiles.tile4,myTiles.tile9,myTiles.tile10], TileScale.Sixteen);\n"]]},{"start1":3434,"length1":0,"diffs":[[1,"            case \"myTile5\":\n            case \"tile7\":return tile7;\n"]]},{"start1":3568,"length1":0,"diffs":[[1,"            case \"myTile7\":\n            case \"tile9\":return tile9;\n"]]},{"start1":3773,"length1":134,"diffs":[[1,""]]}]}]},{"timestamp":1763748461940,"editorVersion":"2.0.62","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":5401,"length1":6877,"diffs":[[1,"`]</field><data>{\"commentRefs\":[],\"fieldData\":{\"frames\":null}}</data></shadow></value><value name=\"frameInterval\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><value name=\"loop\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">14</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"statusbars_create\"><value name=\"width\"><shadow type=\"math_number\"><field name=\"NUM\">20</field></shadow></value><value name=\"height\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"kind\"><shadow type=\"statusbars_kind\"><field name=\"MEMBER\">EnemyHealth</field></shadow></value></block></value><next><block type=\"statusbars_setColor\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"fillColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">2</field></shadow></value><value name=\"bkgdColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">2</field></shadow></value><value name=\"drainColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">3</field></shadow></value><next><block type=\"statusbar_setLabel\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"label\"><shadow type=\"text\"><field name=\"TEXT\">Aien</field></shadow></value><value name=\"color\"><shadow type=\"colorindexpicker\"><field name=\"index\">1</field></shadow></value><next><block type=\"statusbars_positionNextToSprite\"><field name=\"dir\">CollisionDirection.Bottom</field><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><next><block type=\"StatusBarSprite_blockCombine_set\"><field name=\"property\">StatusBarSprite.value@set</field><value name=\"statusbar\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"1809\" y=\"-969\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile8`</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile10`</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"mapsetwallat\"><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">false</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"timer_after\"><value name=\"time\"><shadow type=\"math_number\"><field name=\"NUM\">5000</field></shadow></value><statement name=\"HANDLER\"><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Center</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Uh oh. An alien has breached the base.</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Center</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Press A to shoot.</field></shadow></value><next><block type=\"function_call\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation></block></next></block></next></block></statement></block></next></block></next></block></next></block></next></block></statement></block></statement></block><block type=\"keyonevent\" x=\"-48\" y=\"-436\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_toggleViewMode\"></block></statement></block><block type=\"keyonevent\" x=\"486\" y=\"-309\"><field name=\"button\">controller.B</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"a+nB2f%[4OGi;MHB]27Q\">projectile</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreateprojectilefromsprite\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n"]]},{"start1":13134,"length1":0,"diffs":[[1,". . . . . . . f f . . . . . . . \n. . . . . . f c b f . . . . . . \n. . . . . . f c c f . . . . . . \n. . . . . . . f f . . . . . . . \n"]]},{"start1":13365,"length1":33,"diffs":[[1,""]]},{"start1":13464,"length1":5749,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></block></value><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field></block></value><value name=\"vx\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">50</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"NUM\">0</field></shadow><block type=\"rcRender_getAttribute\"><field name=\"attribute\">Render.attribute.dirX</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value></block></value><value name=\"vy\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">50</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"NUM\">0</field></shadow><block type=\"rcRender_getAttribute\"><field name=\"attribute\">Render.attribute.dirY</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value></block></value></block></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"spriteoverlapswith\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"a+nB2f%[4OGi;MHB]27Q\">projectile</field></block></value><value name=\"other\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field></block></value></block></value><statement name=\"DO0\"><block type=\"StatusBarSprite_blockCombine_change\"><field name=\"property\">StatusBarSprite.value@set</field><value name=\"statusbar\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">25</field></shadow></value></block></statement></block></next></block></statement></block><block type=\"pxt-on-start\" x=\"-396\" y=\"105\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"rcRender_getRenderSpriteVariable\"></block></value><next><block type=\"rcRender_moveWithController\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"2\" _input_init=\"true\"></mutation><value name=\"v\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">2</field></shadow></value><value name=\"va\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">3</field></shadow></value><value name=\"cameraSway\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"statusbars_create\"><value name=\"width\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value><value name=\"height\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"kind\"><shadow type=\"statusbars_kind\"><field name=\"MEMBER\">Health</field></shadow></value></block></value><next><block type=\"statusbars_setColor\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"fillColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">2</field></shadow></value><value name=\"bkgdColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">15</field></shadow></value><value name=\"drainColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">3</field></shadow></value><next><block type=\"StatusBarSprite_blockCombine_set\"><field name=\"property\">StatusBarSprite.value@set</field><value name=\"statusbar\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value><next><block type=\"statusbars_positionNextToSprite\"><field name=\"dir\">CollisionDirection.Top</field><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><next><block type=\"statusbar_setLabel\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"label\"><shadow type=\"text\"><field name=\"TEXT\">HP</field></shadow></value><value name=\"color\"><shadow type=\"colorindexpicker\"><field name=\"index\">1</field></shadow></value><next><block type=\"setPaddingOffset\"><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"padding\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"offset\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\n"]]},{"start1":41459,"length1":4965,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value></block></value><next><block type=\"spritesetsetflag\"><field name=\"flag\">SpriteFlag.RelativeToCamera</field><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</field></block></value><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"39\" y=\"93\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></statement></block><block type=\"keyonevent\" x=\"1288\" y=\"69\"><field name=\"button\">controller.A</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_jumpWithHeightAndDuration\"><value name=\"spr\"><block type=\"variables_get\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field></block></value><value name=\"height\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"100\" label=\"Height\" precision=\"0\"></mutation><field name=\"SLIDER\">16</field></shadow></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">1000</field></shadow></value></block></statement></block><block type=\"spritesoverlap\" x=\"482\" y=\"440\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value><statement name=\"HANDLER\"><block type=\"variables_change\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><next><block type=\"spritedestroy2\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"effect\">effects.spray</field><value name=\"sprite\"><block type=\"argument_reporter_custom\"><mutation typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow></value><next><block type=\"hudsetScore\"><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></next></block></statement></block><block type=\"game_show_long_text\" disabled-reasons=\"ORPHANED_BLOCK,MANUALLY_DISABLED\" x=\"-352\" y=\"1197\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"TEXT\">You have been abandoned by your crew and trapped on the moon base</field></shadow></value><next><block type=\"game_show_long_text\" disabled-reasons=\"ORPHANED_BLOCK,MANUALLY_DISABLED\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"TEXT\">Try and find a way out before the asteroid hits</field></shadow></value></block></next></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":438,"length1":0,"diffs":[[1,"        . . . . . . . f f . . . . . . . \n        . . . . . . f c b f . . . . . . \n        . . . . . . f c c f . . . . . . \n        . . . . . . . f f . . . . . . . \n"]]},{"start1":725,"length1":41,"diffs":[[1,""]]},{"start1":848,"length1":123,"diffs":[[1,""]]},{"start1":968,"length1":59,"diffs":[[1,"    if (projectile.overlapsWith(mySprite)) {\n        statusbar2.value += 25\n    }\n"]]},{"start1":5799,"length1":26,"diffs":[[1,"    statusbar.value = 50\n"]]},{"start1":6685,"length1":123,"diffs":[[1,""]]},{"start1":6796,"length1":0,"diffs":[[1,"let statusbar: StatusBarSprite = null\n"]]},{"start1":6943,"length1":63,"diffs":[[1,"statusbar = statusbars.create(50, 4, StatusBarKind.Health)\n"]]},{"start1":7170,"length1":194,"diffs":[[1,""]]}]}]},{"timestamp":1763749049164,"editorVersion":"2.0.62","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":1942,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable type=\"KIND_SpriteKind\" id=\"USZ`q|D]$0kk|,E!b7c6\">Player</variable><variable type=\"KIND_SpriteKind\" id=\"@8#W0|ESmtdS+3`?Z+:+\">Projectile</variable><variable type=\"KIND_SpriteKind\" id=\"h1jvB:JPL=NMGpJB=4/[\">Food</variable><variable type=\"KIND_SpriteKind\" id=\"(3Y]|wk94c4t/c`pc((X\">Enemy</variable><variable type=\"KIND_SpriteKind\" id=\"2B=HiFZ(Kz-^Ln6ox1L~\">Help</variable><variable type=\"KIND_SpriteKind\" id=\"JWhoDx%e%9JIa%.pfAVv\">StatusBar</variable><variable type=\"KIND_StatusBarKind\" id=\"s%(2IG9YG[q#qn#zR$RL\">Health</variable><variable type=\"KIND_StatusBarKind\" id=\"INxD@r~~T0Wy@hJh=pGh\">Energy</variable><variable type=\"KIND_StatusBarKind\" id=\"z}t^*,Y7$$C-kcZG$91G\">Magic</variable><variable type=\"KIND_StatusBarKind\" id=\"|+h5Z!s*YkuLvDsM!-~j\">EnemyHealth</variable><variable id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</variable><variable id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</variable><variable id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</variable><variable id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</variable><variable id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</variable><variable id=\"[a3#yOs:sosi5Zk_px6P\">mySprite3</variable><variable id=\"i:_MCpc`P;?/}W#x|ztg\">Shell</variable><variable id=\"a+nB2f%[4OGi;MHB]27Q\">projectile</variable><variable id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</variable><variable id=\":9u@hfRXr7DucX:sce8;\">statusbar2</variable><variable id=\"prjF_cc1IE$ODI9J$|9|\">otherSprite</variable></variables><block type=\"function_definition\" x=\"407\" y=\"-987\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation><field name=\"function_name\">Summon alien</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n"]]},{"start1":5401,"length1":6877,"diffs":[[1,"`]</field><data>{\"commentRefs\":[],\"fieldData\":{\"frames\":null}}</data></shadow></value><value name=\"frameInterval\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><value name=\"loop\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">14</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"statusbars_create\"><value name=\"width\"><shadow type=\"math_number\"><field name=\"NUM\">20</field></shadow></value><value name=\"height\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"kind\"><shadow type=\"statusbars_kind\"><field name=\"MEMBER\">EnemyHealth</field></shadow></value></block></value><next><block type=\"statusbars_setColor\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"fillColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">2</field></shadow></value><value name=\"bkgdColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">2</field></shadow></value><value name=\"drainColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">3</field></shadow></value><next><block type=\"statusbar_setLabel\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"label\"><shadow type=\"text\"><field name=\"TEXT\">Aien</field></shadow></value><value name=\"color\"><shadow type=\"colorindexpicker\"><field name=\"index\">1</field></shadow></value><next><block type=\"statusbars_positionNextToSprite\"><field name=\"dir\">CollisionDirection.Bottom</field><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><next><block type=\"StatusBarSprite_blockCombine_set\"><field name=\"property\">StatusBarSprite.value@set</field><value name=\"statusbar\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"1809\" y=\"-969\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile8`</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile10`</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"mapsetwallat\"><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">false</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"timer_after\"><value name=\"time\"><shadow type=\"math_number\"><field name=\"NUM\">5000</field></shadow></value><statement name=\"HANDLER\"><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Center</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Uh oh. An alien has breached the base.</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Center</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Press A to shoot.</field></shadow></value><next><block type=\"function_call\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation></block></next></block></next></block></statement></block></next></block></next></block></next></block></next></block></statement></block></statement></block><block type=\"keyonevent\" x=\"-48\" y=\"-436\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_toggleViewMode\"></block></statement></block><block type=\"keyonevent\" x=\"486\" y=\"-309\"><field name=\"button\">controller.B</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"a+nB2f%[4OGi;MHB]27Q\">projectile</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreateprojectilefromsprite\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n"]]},{"start1":13465,"length1":5649,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></block></value><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field></block></value><value name=\"vx\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">50</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"NUM\">0</field></shadow><block type=\"rcRender_getAttribute\"><field name=\"attribute\">Render.attribute.dirX</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value></block></value><value name=\"vy\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">50</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"NUM\">0</field></shadow><block type=\"rcRender_getAttribute\"><field name=\"attribute\">Render.attribute.dirY</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value></block></value></block></value><next><block type=\"spritesetsetflag\"><field name=\"flag\">SpriteFlag.RelativeToCamera</field><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"a+nB2f%[4OGi;MHB]27Q\">projectile</field></block></value><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">false</field></shadow></value></block></next></block></statement></block><block type=\"pxt-on-start\" x=\"-396\" y=\"105\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"rcRender_getRenderSpriteVariable\"></block></value><next><block type=\"rcRender_moveWithController\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"2\" _input_init=\"true\"></mutation><value name=\"v\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">2</field></shadow></value><value name=\"va\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">3</field></shadow></value><value name=\"cameraSway\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"statusbars_create\"><value name=\"width\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value><value name=\"height\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"kind\"><shadow type=\"statusbars_kind\"><field name=\"MEMBER\">Health</field></shadow></value></block></value><next><block type=\"statusbars_setColor\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"fillColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">2</field></shadow></value><value name=\"bkgdColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">15</field></shadow></value><value name=\"drainColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">3</field></shadow></value><next><block type=\"StatusBarSprite_blockCombine_set\"><field name=\"property\">StatusBarSprite.value@set</field><value name=\"statusbar\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value><next><block type=\"statusbars_positionNextToSprite\"><field name=\"dir\">CollisionDirection.Top</field><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><next><block type=\"statusbar_setLabel\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"label\"><shadow type=\"text\"><field name=\"TEXT\">HP</field></shadow></value><value name=\"color\"><shadow type=\"colorindexpicker\"><field name=\"index\">1</field></shadow></value><next><block type=\"setPaddingOffset\"><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"padding\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"offset\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">You have been abandoned by your crew and trapped on the moon base</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Try and find a way out before the asteroid hits</field></shadow></value><next><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\n"]]},{"start1":41428,"length1":4965,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value></block></value><next><block type=\"spritesetsetflag\"><field name=\"flag\">SpriteFlag.RelativeToCamera</field><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</field></block></value><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"39\" y=\"93\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></statement></block><block type=\"spritesoverlap\" x=\"583\" y=\"68\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Projectile</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Enemy</field></shadow></value><statement name=\"HANDLER\"><block type=\"StatusBarSprite_blockCombine_change\"><field name=\"property\">StatusBarSprite.value@set</field><value name=\"statusbar\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">-25</field></shadow></value></block></statement></block><block type=\"keyonevent\" x=\"1288\" y=\"69\"><field name=\"button\">controller.A</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_jumpWithHeightAndDuration\"><value name=\"spr\"><block type=\"variables_get\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field></block></value><value name=\"height\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"100\" label=\"Height\" precision=\"0\"></mutation><field name=\"SLIDER\">16</field></shadow></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">1000</field></shadow></value></block></statement></block><block type=\"spritesoverlap\" x=\"482\" y=\"440\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value><statement name=\"HANDLER\"><block type=\"variables_change\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><next><block type=\"spritedestroy2\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"effect\">effects.spray</field><value name=\"sprite\"><block type=\"argument_reporter_custom\"><mutation typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow></value><next><block type=\"hudsetScore\"><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></next></block></statement></block></xml>"]]}]}]},{"timestamp":1763750812111,"editorVersion":"2.0.62","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":41428,"length1":5260,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value></block></value><next><block type=\"spritesetsetflag\"><field name=\"flag\">SpriteFlag.RelativeToCamera</field><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</field></block></value><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"0\" y=\"0\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></statement></block><block type=\"spritesoverlap\" x=\"544\" y=\"-25\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Projectile</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Enemy</field></shadow></value><statement name=\"HANDLER\"><block type=\"StatusBarSprite_blockCombine_change\"><field name=\"property\">StatusBarSprite.value@set</field><value name=\"statusbar\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">-25</field></shadow></value></block></statement></block><block type=\"keyonevent\" x=\"1249\" y=\"-24\"><field name=\"button\">controller.A</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_jumpWithHeightAndDuration\"><value name=\"spr\"><block type=\"variables_get\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field></block></value><value name=\"height\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"100\" label=\"Height\" precision=\"0\"></mutation><field name=\"SLIDER\">16</field></shadow></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">1000</field></shadow></value></block></statement></block><block type=\"spritesoverlap\" x=\"443\" y=\"347\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value><statement name=\"HANDLER\"><block type=\"variables_change\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><next><block type=\"spritedestroy2\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"effect\">effects.spray</field><value name=\"sprite\"><block type=\"argument_reporter_custom\"><mutation typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow></value><next><block type=\"hudsetScore\"><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></next></block></statement></block></xml>"]]}]}]},{"timestamp":1763750827307,"editorVersion":"2.0.62","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":1941,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable type=\"KIND_SpriteKind\" id=\"USZ`q|D]$0kk|,E!b7c6\">Player</variable><variable type=\"KIND_SpriteKind\" id=\"@8#W0|ESmtdS+3`?Z+:+\">Projectile</variable><variable type=\"KIND_SpriteKind\" id=\"h1jvB:JPL=NMGpJB=4/[\">Food</variable><variable type=\"KIND_SpriteKind\" id=\"(3Y]|wk94c4t/c`pc((X\">Enemy</variable><variable type=\"KIND_SpriteKind\" id=\"2B=HiFZ(Kz-^Ln6ox1L~\">Help</variable><variable type=\"KIND_SpriteKind\" id=\"JWhoDx%e%9JIa%.pfAVv\">StatusBar</variable><variable type=\"KIND_StatusBarKind\" id=\"s%(2IG9YG[q#qn#zR$RL\">Health</variable><variable type=\"KIND_StatusBarKind\" id=\"INxD@r~~T0Wy@hJh=pGh\">Energy</variable><variable type=\"KIND_StatusBarKind\" id=\"z}t^*,Y7$$C-kcZG$91G\">Magic</variable><variable type=\"KIND_StatusBarKind\" id=\"|+h5Z!s*YkuLvDsM!-~j\">EnemyHealth</variable><variable id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</variable><variable id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</variable><variable id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</variable><variable id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</variable><variable id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</variable><variable id=\"[a3#yOs:sosi5Zk_px6P\">mySprite3</variable><variable id=\"i:_MCpc`P;?/}W#x|ztg\">Shell</variable><variable id=\"a+nB2f%[4OGi;MHB]27Q\">projectile</variable><variable id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</variable><variable id=\":9u@hfRXr7DucX:sce8;\">statusbar2</variable><variable id=\"prjF_cc1IE$ODI9J$|9|\">otherSprite</variable></variables><block type=\"function_definition\" x=\"368\" y=\"-1080\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation><field name=\"function_name\">Summon alien</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n"]]},{"start1":5402,"length1":6878,"diffs":[[1,"`]</field><data>{\"commentRefs\":[],\"fieldData\":{\"frames\":null}}</data></shadow></value><value name=\"frameInterval\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><value name=\"loop\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">14</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"statusbars_create\"><value name=\"width\"><shadow type=\"math_number\"><field name=\"NUM\">20</field></shadow></value><value name=\"height\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"kind\"><shadow type=\"statusbars_kind\"><field name=\"MEMBER\">EnemyHealth</field></shadow></value></block></value><next><block type=\"statusbars_setColor\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"fillColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">2</field></shadow></value><value name=\"bkgdColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">2</field></shadow></value><value name=\"drainColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">3</field></shadow></value><next><block type=\"statusbar_setLabel\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"label\"><shadow type=\"text\"><field name=\"TEXT\">Aien</field></shadow></value><value name=\"color\"><shadow type=\"colorindexpicker\"><field name=\"index\">1</field></shadow></value><next><block type=\"statusbars_positionNextToSprite\"><field name=\"dir\">CollisionDirection.Bottom</field><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><next><block type=\"StatusBarSprite_blockCombine_set\"><field name=\"property\">StatusBarSprite.value@set</field><value name=\"statusbar\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"-390\" y=\"-765\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile8`</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile10`</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"mapsetwallat\"><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">false</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"timer_after\"><value name=\"time\"><shadow type=\"math_number\"><field name=\"NUM\">5000</field></shadow></value><statement name=\"HANDLER\"><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Center</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Uh oh. An alien has breached the base.</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Center</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Press A to shoot.</field></shadow></value><next><block type=\"function_call\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation></block></next></block></next></block></statement></block></next></block></next></block></next></block></next></block></statement></block></statement></block><block type=\"keyonevent\" x=\"-87\" y=\"-529\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_toggleViewMode\"></block></statement></block><block type=\"keyonevent\" x=\"447\" y=\"-402\"><field name=\"button\">controller.B</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"a+nB2f%[4OGi;MHB]27Q\">projectile</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreateprojectilefromsprite\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n"]]},{"start1":13466,"length1":6750,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></block></value><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field></block></value><value name=\"vx\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">50</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"NUM\">0</field></shadow><block type=\"rcRender_getAttribute\"><field name=\"attribute\">Render.attribute.dirX</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value></block></value><value name=\"vy\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">50</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"NUM\">0</field></shadow><block type=\"rcRender_getAttribute\"><field name=\"attribute\">Render.attribute.dirY</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value></block></value></block></value><next><block type=\"spritesetsetflag\"><field name=\"flag\">SpriteFlag.RelativeToCamera</field><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"a+nB2f%[4OGi;MHB]27Q\">projectile</field></block></value><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">false</field></shadow></value></block></next></block></statement></block><block type=\"pxt-on-start\" x=\"-435\" y=\"12\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"rcRender_getRenderSpriteVariable\"></block></value><next><block type=\"rcRender_moveWithController\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"2\" _input_init=\"true\"></mutation><value name=\"v\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">2</field></shadow></value><value name=\"va\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">3</field></shadow></value><value name=\"cameraSway\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"statusbars_create\"><value name=\"width\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value><value name=\"height\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"kind\"><shadow type=\"statusbars_kind\"><field name=\"MEMBER\">Health</field></shadow></value></block></value><next><block type=\"statusbars_setColor\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"fillColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">2</field></shadow></value><value name=\"bkgdColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">15</field></shadow></value><value name=\"drainColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">3</field></shadow></value><next><block type=\"StatusBarSprite_blockCombine_set\"><field name=\"property\">StatusBarSprite.value@set</field><value name=\"statusbar\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value><next><block type=\"statusbars_positionNextToSprite\"><field name=\"dir\">CollisionDirection.Top</field><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><next><block type=\"statusbar_setLabel\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"label\"><shadow type=\"text\"><field name=\"TEXT\">HP</field></shadow></value><value name=\"color\"><shadow type=\"colorindexpicker\"><field name=\"index\">1</field></shadow></value><next><block type=\"setPaddingOffset\"><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"padding\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"offset\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">You have been abandoned by your crew and trapped on the moon base</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Try and find a way out before the asteroid hits</field></shadow></value><next><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\n"]]},{"start1":41428,"length1":3863,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value></block></value><next><block type=\"spritesetsetflag\"><field name=\"flag\">SpriteFlag.RelativeToCamera</field><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</field></block></value><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spritesoverlap\" x=\"544\" y=\"-25\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Projectile</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Enemy</field></shadow></value><statement name=\"HANDLER\"><block type=\"StatusBarSprite_blockCombine_change\"><field name=\"property\">StatusBarSprite.value@set</field><value name=\"statusbar\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">-25</field></shadow></value></block></statement></block><block type=\"spriteshittile\" x=\"35\" y=\"37\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></statement></block><block type=\"keyonevent\" x=\"1249\" y=\"-24\"><field name=\"button\">controller.A</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_jumpWithHeightAndDuration\"><value name=\"spr\"><block type=\"variables_get\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field></block></value><value name=\"height\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"100\" label=\"Height\" precision=\"0\"></mutation><field name=\"SLIDER\">16</field></shadow></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">1000</field></shadow></value></block></statement></block><block type=\"rcRender_setAttribute\" disabled-reasons=\"ORPHANED_BLOCK,MANUALLY_DISABLED\" x=\"219\" y=\"315\"><field name=\"attribute\">Render.attribute.dirX</field><value name=\"value\"><shadow type=\"math_number\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"NUM\">0</field></shadow></value></block><block type=\"spritesoverlap\" x=\"443\" y=\"347\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value><statement name=\"HANDLER\"><block type=\"variables_change\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><next><block type=\"spritedestroy2\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"effect\">effects.spray</field><value name=\"sprite\"><block type=\"argument_reporter_custom\"><mutation typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow></value><next><block type=\"hudsetScore\"><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></next></block></statement></block></xml>"]]}]}]},{"timestamp":1763751191252,"editorVersion":"2.0.62","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":5401,"length1":6774,"diffs":[[1,"`]</field><data>{\"commentRefs\":[],\"fieldData\":{\"frames\":null}}</data></shadow></value><value name=\"frameInterval\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><value name=\"loop\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">14</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"statusbars_create\"><value name=\"width\"><shadow type=\"math_number\"><field name=\"NUM\">20</field></shadow></value><value name=\"height\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"kind\"><shadow type=\"statusbars_kind\"><field name=\"MEMBER\">EnemyHealth</field></shadow></value></block></value><next><block type=\"statusbars_setColor\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"fillColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">2</field></shadow></value><value name=\"bkgdColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">2</field></shadow></value><value name=\"drainColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">3</field></shadow></value><next><block type=\"statusbar_setLabel\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"label\"><shadow type=\"text\"><field name=\"TEXT\">Aien</field></shadow></value><value name=\"color\"><shadow type=\"colorindexpicker\"><field name=\"index\">1</field></shadow></value><next><block type=\"statusbars_positionNextToSprite\"><field name=\"dir\">CollisionDirection.Bottom</field><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><next><block type=\"StatusBarSprite_blockCombine_set\"><field name=\"property\">StatusBarSprite.value@set</field><value name=\"statusbar\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"-435\" y=\"-667\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile8`</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile10`</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"mapsetwallat\"><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">false</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"timer_after\"><value name=\"time\"><shadow type=\"math_number\"><field name=\"NUM\">5000</field></shadow></value><statement name=\"HANDLER\"><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Center</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Uh oh. An alien has breached the base.</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Center</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Press A to shoot.</field></shadow></value><next><block type=\"function_call\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation></block></next></block></next></block></statement></block></next></block></next></block></next></block></next></block></statement></block></statement></block><block type=\"keyonevent\" x=\"-132\" y=\"-431\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_toggleViewMode\"></block></statement></block><block type=\"keyonevent\" x=\"402\" y=\"-304\"><field name=\"button\">controller.B</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"a+nB2f%[4OGi;MHB]27Q\">projectile</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreateprojectilefromsprite\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n"]]},{"start1":12807,"length1":502,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow><block type=\"screen_image_picker\"><field name=\"img\">img`\n"]]},{"start1":13103,"length1":198,"diffs":[[1,""]]},{"start1":13235,"length1":0,"diffs":[[1,". . . . . . . f . . . . . . . . \n"]]},{"start1":13301,"length1":6963,"diffs":[[1,". . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></block></value><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field></block></value><value name=\"vx\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">50</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"NUM\">0</field></shadow><block type=\"rcRender_getAttribute\"><field name=\"attribute\">Render.attribute.dirX</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value></block></value><value name=\"vy\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">50</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"NUM\">0</field></shadow><block type=\"rcRender_getAttribute\"><field name=\"attribute\">Render.attribute.dirY</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value></block></value></block></value><next><block type=\"spritesetsetflag\"><field name=\"flag\">SpriteFlag.RelativeToCamera</field><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"a+nB2f%[4OGi;MHB]27Q\">projectile</field></block></value><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">false</field></shadow></value></block></next></block></statement></block><block type=\"spriteshittile\" x=\"0\" y=\"0\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></statement></block><block type=\"pxt-on-start\" x=\"-480\" y=\"110\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"rcRender_getRenderSpriteVariable\"></block></value><next><block type=\"rcRender_moveWithController\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"2\" _input_init=\"true\"></mutation><value name=\"v\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">2</field></shadow></value><value name=\"va\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">3</field></shadow></value><value name=\"cameraSway\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"statusbars_create\"><value name=\"width\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value><value name=\"height\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"kind\"><shadow type=\"statusbars_kind\"><field name=\"MEMBER\">Health</field></shadow></value></block></value><next><block type=\"statusbars_setColor\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"fillColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">2</field></shadow></value><value name=\"bkgdColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">15</field></shadow></value><value name=\"drainColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">3</field></shadow></value><next><block type=\"StatusBarSprite_blockCombine_set\"><field name=\"property\">StatusBarSprite.value@set</field><value name=\"statusbar\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value><next><block type=\"statusbars_positionNextToSprite\"><field name=\"dir\">CollisionDirection.Top</field><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><next><block type=\"statusbar_setLabel\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"label\"><shadow type=\"text\"><field name=\"TEXT\">HP</field></shadow></value><value name=\"color\"><shadow type=\"colorindexpicker\"><field name=\"index\">1</field></shadow></value><next><block type=\"setPaddingOffset\"><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"padding\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"offset\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">You have been abandoned by your crew and trapped on the moon base</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Try and find a way out before the asteroid hits</field></shadow></value><next><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\n"]]},{"start1":42529,"length1":3232,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value></block></value><next><block type=\"spritesetsetflag\"><field name=\"flag\">SpriteFlag.RelativeToCamera</field><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</field></block></value><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spritesoverlap\" x=\"499\" y=\"73\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Projectile</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Enemy</field></shadow></value><statement name=\"HANDLER\"><block type=\"StatusBarSprite_blockCombine_change\"><field name=\"property\">StatusBarSprite.value@set</field><value name=\"statusbar\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">-25</field></shadow></value></block></statement></block><block type=\"keyonevent\" x=\"1204\" y=\"74\"><field name=\"button\">controller.A</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_jumpWithHeightAndDuration\"><value name=\"spr\"><block type=\"variables_get\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field></block></value><value name=\"height\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"100\" label=\"Height\" precision=\"0\"></mutation><field name=\"SLIDER\">16</field></shadow></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">1000</field></shadow></value></block></statement></block><block type=\"spritesoverlap\" x=\"398\" y=\"445\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value><statement name=\"HANDLER\"><block type=\"variables_change\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><next><block type=\"spritedestroy2\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"effect\">effects.spray</field><value name=\"sprite\"><block type=\"argument_reporter_custom\"><mutation typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow></value><next><block type=\"hudsetScore\"><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></next></block></statement></block></xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":135,"length1":37,"diffs":[[1,"    projectile = sprites.createProjectileFromSprite(img`\n"]]},{"start1":561,"length1":0,"diffs":[[1,"        . . . . . . . f . . . . . . . . \n"]]},{"start1":848,"length1":933,"diffs":[[1,"        `, mySprite2, Render.getAttribute(Render.attribute.dirX) * 50, Render.getAttribute(Render.attribute.dirY) * 50)\n    projectile.setFlag(SpriteFlag.RelativeToCamera, false)\n"]]},{"start1":6473,"length1":2,"diffs":[[1,"    Render.toggleViewMode()\n"]]}]}]},{"timestamp":1763751942716,"editorVersion":"2.0.62","changes":[{"type":"edited","filename":"pxt.json","patch":[{"start1":214,"length1":174,"diffs":[[1,"        \"Timers\": \"github:microsoft/arcade-timers#v1.1.0\"\n"]]}]}]},{"timestamp":1763751949753,"editorVersion":"2.0.62","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":2072,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable type=\"KIND_SpriteKind\" id=\"USZ`q|D]$0kk|,E!b7c6\">Player</variable><variable type=\"KIND_SpriteKind\" id=\"@8#W0|ESmtdS+3`?Z+:+\">Projectile</variable><variable type=\"KIND_SpriteKind\" id=\"h1jvB:JPL=NMGpJB=4/[\">Food</variable><variable type=\"KIND_SpriteKind\" id=\"(3Y]|wk94c4t/c`pc((X\">Enemy</variable><variable type=\"KIND_SpriteKind\" id=\"2B=HiFZ(Kz-^Ln6ox1L~\">Help</variable><variable type=\"KIND_SpriteKind\" id=\"JWhoDx%e%9JIa%.pfAVv\">StatusBar</variable><variable type=\"KIND_StatusBarKind\" id=\"s%(2IG9YG[q#qn#zR$RL\">Health</variable><variable type=\"KIND_StatusBarKind\" id=\"INxD@r~~T0Wy@hJh=pGh\">Energy</variable><variable type=\"KIND_StatusBarKind\" id=\"z}t^*,Y7$$C-kcZG$91G\">Magic</variable><variable type=\"KIND_StatusBarKind\" id=\"|+h5Z!s*YkuLvDsM!-~j\">EnemyHealth</variable><variable id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</variable><variable id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</variable><variable id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</variable><variable id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</variable><variable id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</variable><variable id=\"[a3#yOs:sosi5Zk_px6P\">mySprite3</variable><variable id=\"i:_MCpc`P;?/}W#x|ztg\">Shell</variable><variable id=\"a+nB2f%[4OGi;MHB]27Q\">projectile</variable><variable id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</variable><variable id=\":9u@hfRXr7DucX:sce8;\">statusbar2</variable><variable id=\"prjF_cc1IE$ODI9J$|9|\">otherSprite</variable></variables><block type=\"function_definition\" x=\"323\" y=\"-982\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation><field name=\"function_name\">Summon alien</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n"]]},{"start1":2541,"length1":543,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Enemy</field></shadow></value></block></value><next><block type=\"run_image_animation\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field></block></value><value name=\"frames\"><shadow type=\"animation_editor\"><field name=\"frames\">[img`\n"]]},{"start1":5401,"length1":8542,"diffs":[[1,"`]</field><data>{\"commentRefs\":[],\"fieldData\":{\"frames\":null}}</data></shadow></value><value name=\"frameInterval\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><value name=\"loop\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">14</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"statusbars_create\"><value name=\"width\"><shadow type=\"math_number\"><field name=\"NUM\">20</field></shadow></value><value name=\"height\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"kind\"><shadow type=\"statusbars_kind\"><field name=\"MEMBER\">EnemyHealth</field></shadow></value></block></value><next><block type=\"statusbars_setColor\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"fillColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">2</field></shadow></value><value name=\"bkgdColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">2</field></shadow></value><value name=\"drainColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">3</field></shadow></value><next><block type=\"statusbar_setLabel\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"label\"><shadow type=\"text\"><field name=\"TEXT\">Aien</field></shadow></value><value name=\"color\"><shadow type=\"colorindexpicker\"><field name=\"index\">1</field></shadow></value><next><block type=\"statusbars_positionNextToSprite\"><field name=\"dir\">CollisionDirection.Bottom</field><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><next><block type=\"StatusBarSprite_blockCombine_set\"><field name=\"property\">StatusBarSprite.value@set</field><value name=\"statusbar\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"-435\" y=\"-667\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile8`</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile10`</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"mapsetwallat\"><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">false</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"timer_after\"><value name=\"time\"><shadow type=\"math_number\"><field name=\"NUM\">5000</field></shadow></value><statement name=\"HANDLER\"><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Center</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Uh oh. An alien has breached the base.</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Center</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Press A to shoot.</field></shadow></value><next><block type=\"function_call\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation></block></next></block></next></block></statement></block></next></block></next></block></next></block></next></block></statement></block></statement></block><block type=\"keyonevent\" x=\"-132\" y=\"-431\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field></block><block type=\"keyonevent\" x=\"402\" y=\"-304\"><field name=\"button\">controller.B</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"a+nB2f%[4OGi;MHB]27Q\">projectile</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n"]]},{"start1":12703,"length1":632,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Projectile</field></shadow></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"a+nB2f%[4OGi;MHB]27Q\">projectile</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreateprojectilefromsprite\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n"]]},{"start1":13733,"length1":7368,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"sprite\"><block type=\"rcRender_getRenderSpriteVariable\"></block></value><value name=\"vx\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">50</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"rcRender_getAttribute\"><field name=\"attribute\">Render.attribute.dirX</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">200</field></shadow></value></block></value><value name=\"vy\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">50</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"rcRender_getAttribute\"><field name=\"attribute\">Render.attribute.dirY</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">200</field></shadow></value></block></value></block></value></block></next></block></statement></block><block type=\"keyonevent\" x=\"1305\" y=\"-106\"><field name=\"button\">controller.A</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_jumpWithHeightAndDuration\"><value name=\"spr\"><block type=\"variables_get\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field></block></value><value name=\"height\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"100\" label=\"Height\" precision=\"0\"></mutation><field name=\"SLIDER\">16</field></shadow></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">1000</field></shadow></value></block></statement></block><block type=\"spriteshittile\" x=\"32\" y=\"53\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></statement></block><block type=\"pxt-on-start\" x=\"-480\" y=\"110\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"rcRender_getRenderSpriteVariable\"></block></value><next><block type=\"rcRender_moveWithController\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"2\" _input_init=\"true\"></mutation><value name=\"v\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">2</field></shadow></value><value name=\"va\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">3</field></shadow></value><value name=\"cameraSway\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"statusbars_create\"><value name=\"width\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value><value name=\"height\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"kind\"><shadow type=\"statusbars_kind\"><field name=\"MEMBER\">Health</field></shadow></value></block></value><next><block type=\"statusbars_setColor\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"fillColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">2</field></shadow></value><value name=\"bkgdColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">15</field></shadow></value><value name=\"drainColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">3</field></shadow></value><next><block type=\"StatusBarSprite_blockCombine_set\"><field name=\"property\">StatusBarSprite.value@set</field><value name=\"statusbar\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value><next><block type=\"statusbars_positionNextToSprite\"><field name=\"dir\">CollisionDirection.Top</field><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><next><block type=\"statusbar_setLabel\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"label\"><shadow type=\"text\"><field name=\"TEXT\">HP</field></shadow></value><value name=\"color\"><shadow type=\"colorindexpicker\"><field name=\"index\">1</field></shadow></value><next><block type=\"setPaddingOffset\"><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"padding\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"offset\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">You have been abandoned by your crew and trapped on the moon base</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Try and find a way out before the asteroid hits</field></shadow></value><next><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\n"]]},{"start1":40016,"length1":506,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</field><value name=\"VALUE\"><shadow type=\"math_number\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n"]]},{"start1":40946,"length1":1136,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value></block></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n"]]},{"start1":42350,"length1":157,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow><block type=\"screen_image_picker\"><field name=\"img\">img`\n"]]},{"start1":43009,"length1":5217,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value></block></value><next><block type=\"spritesetsetflag\"><field name=\"flag\">SpriteFlag.RelativeToCamera</field><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</field></block></value><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spritesoverlap\" x=\"598\" y=\"54\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Projectile</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Enemy</field></shadow></value><statement name=\"HANDLER\"><block type=\"StatusBarSprite_blockCombine_change\"><field name=\"property\">StatusBarSprite.value@set</field><value name=\"statusbar\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">-25</field></shadow></value></block></statement></block><block type=\"spritesoverlap\" x=\"398\" y=\"445\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value><statement name=\"HANDLER\"><block type=\"variables_change\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><next><block type=\"spritedestroy2\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"effect\">effects.spray</field><value name=\"sprite\"><block type=\"argument_reporter_custom\"><mutation typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow></value><next><block type=\"hudsetScore\"><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></next></block></statement></block></xml>"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":639,"length1":44,"diffs":[[1,""]]}]},{"type":"edited","filename":"tilemap.g.jres","patch":[{"start1":5761,"length1":1286,"diffs":[[1,""]]}]},{"type":"edited","filename":"tilemap.g.ts","patch":[{"start1":2847,"length1":1204,"diffs":[[1,""]]}]},{"type":"added","filename":"test.ts","value":"// tests go here; this will not be compiled when this package is used as an extension.\n"}]}],"snapshots":[{"timestamp":1748090390982,"editorVersion":"2.0.56","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddd11111111111111111111111111111111111111111111111111111111111\n111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddddd1111111111111111111111111111111111111111111111111111111111\n11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddddddddd1111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111ddddddddddd1111111111111111111111111111111111111111111111111111111111\n11111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddddddddddddddd11111111111111111111111111ddd111ddd11111111111111111111111\n11111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddddddddddddddd1111111111111111111111111dddddddddd11111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111ddddd11ddddddddddddddddd111111111111111111111ddddddddddddd11111111111111111111111\n111111111111111111111111111111111111111111111111111111111111111111111111111111dddddd11ddddddddddddddddd111111111111111111111dddddddddddddd1111111111111111111111\n11111111111dddddddd111111111111111111111111111111111111111111111111111111ddddddddddd1dddddddddddddddddd111111ddd11111111111dddddddddddddddd1111111111ddd11111111\n1111111111dddddddddd11111111111111111111111111111111111111111111111111111dddddddddddddddddddddddddddddd11111ddddd1111111111dddddddddddddddddd1111111ddddd1111111\n111111ddddddddddddddd1111111111111111111111111111111111111111111111111111dddddddddddddddddddddddddddddd11111ddddd111111111ddddddddddddddddddddd11111ddddd1111111\n111111dddddddddddddddddddd11111111111111111111111111111111111111111111111dddddddddddddddddddddddddddddddd111ddddd111111111ddddddddddddddddddddd1111dddddd1111111\n111111ddddddddddddddddddddd11111111111111111111111dddddddd1111111111d111ddddddddddddddddddddddddddddddddd111dddddd11111111dddddddddddddddddddddd111ddddddd111111\n11111dddddddddddddddddddddddd1111111111111111ddddddddddddd1111111111ddddddddddddddddddddddddddddddddddddd11ddddddd1111111ddddddddddddddddddddddddddddddddd111111\n1dddddddddddddddddddddddddddddd1111111111111dddddddddddddddd11111111ddddddddddddddddddddddddddd6ddddddddd11ddddddd1111111ddddddddddddddddddddddddddddddddddd1111\n1ddddddddddddddddddddddddddddddd1111111111ddddddddddddddddddd111111ddddddddddddddddddddddddddd66dddddddddddddddddd1111111ddddddddddddddddddddddddddddddddddddd11\ndddddddddddddddddddddddddddddddddd1111111dddddddddddddd6dddddd11111ddddddddddddddddddddddddddd66dddddddddddddddddd1111ddddddddddddddddd6dddddddddddddddddddddddd\ndddddddddddddddddddddddddddddddddd11111ddddddddddddddd66dddddd11111dddddddddddddddddddddddddd6666ddddddddddddddddd11dddddddddddddddddd66dddddddddddddddddddddddd\nddddddddddddddddddddddddddddddddddd1dddddddddddddddddd66ddddddd1111dddddddddddddddddddddddd66666ddddddddddddddddddd1dddddddddddddddddd66dddddddddddddddddddddddd\nddddddddddddddddddddddddddddddddddddddddddddddddddddd6666dddddd1111dddddddddddddddddddddddddd666ddddddddddddddddddddddddddddddddddddd6666ddddddddddddddddddddddd\nddddddddddddddd6ddddddddddddddddddddddddddddddddddd66666dddddddddddddddddddddddddddddddddddd66666dddddddddddddddddddddddddddddddddd66666dddddddddddddddddddddddd\ndddddddddddddd66ddddddddddddddddddddddddddddddddddddd666dddddddddddddddddddddddddddddddddddd6666666dddddddddddddddddddddddddddddddddd666ddddddddddddddd9999999dd\ndddddddddddddd66dddddddddddddddddddddddddddddddddddd66666ddddddddddddddddddddd99d99dddddddd666666ddddddddddddddddd999ddddddddddddddd66666dddddddddddd99999999999\n9dddddddddddd6666ddddddddddddddddddddddddddddddddddd6666666ddddddddddddddddd99999999ddddd666666666ddddddd999dddddd999999dddddddddddd6666666ddddddddd999999999999\n999dddddddd66666dddddddddddddddddddddddddd9dddddddd666666ddddddddddddddddd99999999999dddddd66666666ddddd99999999dd9999999dddddddddd666666ddddddddd99999999999999\n9999ddddddddd666ddddddddddddddddd99999999999ddddd666666666dddddddddddddd99999999999999dd996666666dddddd999999999dd9999999dddddddd666666666ddddddd999999999999999\n99999ddddddd66666ddddddddddddddd9999999999999dddddd66666666ddddddddddd9999999999999999999999666666dddd996999999999999999999dddddddd66666666ddddd9999999999999999\n999999dddddd6666666dddddddddddd999999999999999dd996666666ddddddddddd9999999999999999999999666666666dd9996999999999999999999999dd996666666dddddd99999999999999999\n999999ddddd666666dddddddddddd99999999999999999999999666666dddd9969999999999999999999999996666666666699966999999999999999999999999999666666dddd996999999999999999\n999999ddd666666666ddddddd9999999999999999999999999666666666dd999699999999999999999999996666666666699999966999999999999999999999999666666666dd9996999999999999999\n999999ddddd66666666ddddd9999999999999999999999999666666666669996699999999999999999999999966666666699999669999999999999999999999996666666666699966999999999999999\n999999dd996666666dddddd99999999999999999999999966666666666999999669999999999999999999999966666669999996666999999999999999999999666666666669999996699999999999999\n999999999999666666dddd996999999999999999999999999666666666999996699999999999999999999999669666666669966666699999999999999999999996666666669999966999999999999999\n9999999999666666666dd9996999999999999999999999999666666699999966669999999999999999999999996666666666999669999999999999999999999996666666999999666699999999999999\n9999999996666666666699966999999999999999999999996696666666699666666999999999999999999999666666666669966666699999999999999999999966966666666996666669999999999999\n9999999666666666669999996699999999996999999999999966666666669996699999999999699999969996666666666669666666669999999969999999999999666666666699966999999999996999\n9999999996666666669999966999999999996999999999996666666666699666666999999999699999966999996666666666666666999999999969999999999966666666666996666669999999996999\n9996999996666666999999666699999999966699999699966666666666696666666699999996669999669999666666666666666666669999999666999996999666666666666966666666999999966699\n9996699966966666666996666669999999996699999669999966666666666666669999999999669999966996666666666666666666666999999966999996699999666666666666666699999999996699\n9966999999666666666699966999999999966999996699996666666666666666666699999996699999666666666666666666666666699999999669999966999966666666666666666666999999966999\n9996699966666666666996666669999999666699999669966666666666666666666669999966669999966666666666666666666666666999996666999996699666666666666666666666699999666699\n9966669666666666666966666666999999966669996666666666666666666666666999999996666999966666666666666666666666666699999666699966666666666666666666666669999999966669\n9996669999666666666666666699999999666699999666666666666666666666666669999966669999666666666666666666666666669999996666999996666666666666666666666666699999666699\n9996669966666666666666666666999996666669999666666666666666666666666666999666666996666666666666666666666666666699966666699996666666666666666666666666669996666669\n9966669666666666666666666666699999666699996666666666666666666666666699999966669999666666666666666666666666666669996666999966666666666666666666666666999999666699\n9666666666666666666666666669999966666669966666666666666666666666666666996666666999666666666666666666666666666699666666699666666666666666666666666666669966666669\n9966666666666666666666666666699996666666996666666666666666666666666666699666666696666666666666666666666666666669966666669966666666666666666666666666666996666666\n9966666666666666666666666666669966666666996666666666666666666666666666996666666696666666666666666666666666666666666666669966666666666666666666666666669966666666\n6666666666666666666666666666999966666666666666666666666666666666666666696666666666666666666666666666666666666666666666666666666666666666666666666666666966666666\n6666666666666666666666666666669666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666669666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value></block></next></block></statement></block><block type=\"keyonevent\" x=\"361\" y=\"0\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_toggleViewMode\"></block></statement></block></xml>","main.ts":"controller.menu.onEvent(ControllerButtonEvent.Pressed, function () {\n    Render.toggleViewMode()\n})\ntiles.setCurrentTilemap(tilemap`level`)\nscene.setBackgroundImage(img`\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddd11111111111111111111111111111111111111111111111111111111111\n    111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddddd1111111111111111111111111111111111111111111111111111111111\n    11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddddddddd1111111111111111111111111111111111111111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111ddddddddddd1111111111111111111111111111111111111111111111111111111111\n    11111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddddddddddddddd11111111111111111111111111ddd111ddd11111111111111111111111\n    11111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddddddddddddddd1111111111111111111111111dddddddddd11111111111111111111111\n    1111111111111111111111111111111111111111111111111111111111111111111111111111111ddddd11ddddddddddddddddd111111111111111111111ddddddddddddd11111111111111111111111\n    111111111111111111111111111111111111111111111111111111111111111111111111111111dddddd11ddddddddddddddddd111111111111111111111dddddddddddddd1111111111111111111111\n    11111111111dddddddd111111111111111111111111111111111111111111111111111111ddddddddddd1dddddddddddddddddd111111ddd11111111111dddddddddddddddd1111111111ddd11111111\n    1111111111dddddddddd11111111111111111111111111111111111111111111111111111dddddddddddddddddddddddddddddd11111ddddd1111111111dddddddddddddddddd1111111ddddd1111111\n    111111ddddddddddddddd1111111111111111111111111111111111111111111111111111dddddddddddddddddddddddddddddd11111ddddd111111111ddddddddddddddddddddd11111ddddd1111111\n    111111dddddddddddddddddddd11111111111111111111111111111111111111111111111dddddddddddddddddddddddddddddddd111ddddd111111111ddddddddddddddddddddd1111dddddd1111111\n    111111ddddddddddddddddddddd11111111111111111111111dddddddd1111111111d111ddddddddddddddddddddddddddddddddd111dddddd11111111dddddddddddddddddddddd111ddddddd111111\n    11111dddddddddddddddddddddddd1111111111111111ddddddddddddd1111111111ddddddddddddddddddddddddddddddddddddd11ddddddd1111111ddddddddddddddddddddddddddddddddd111111\n    1dddddddddddddddddddddddddddddd1111111111111dddddddddddddddd11111111ddddddddddddddddddddddddddd6ddddddddd11ddddddd1111111ddddddddddddddddddddddddddddddddddd1111\n    1ddddddddddddddddddddddddddddddd1111111111ddddddddddddddddddd111111ddddddddddddddddddddddddddd66dddddddddddddddddd1111111ddddddddddddddddddddddddddddddddddddd11\n    dddddddddddddddddddddddddddddddddd1111111dddddddddddddd6dddddd11111ddddddddddddddddddddddddddd66dddddddddddddddddd1111ddddddddddddddddd6dddddddddddddddddddddddd\n    dddddddddddddddddddddddddddddddddd11111ddddddddddddddd66dddddd11111dddddddddddddddddddddddddd6666ddddddddddddddddd11dddddddddddddddddd66dddddddddddddddddddddddd\n    ddddddddddddddddddddddddddddddddddd1dddddddddddddddddd66ddddddd1111dddddddddddddddddddddddd66666ddddddddddddddddddd1dddddddddddddddddd66dddddddddddddddddddddddd\n    ddddddddddddddddddddddddddddddddddddddddddddddddddddd6666dddddd1111dddddddddddddddddddddddddd666ddddddddddddddddddddddddddddddddddddd6666ddddddddddddddddddddddd\n    ddddddddddddddd6ddddddddddddddddddddddddddddddddddd66666dddddddddddddddddddddddddddddddddddd66666dddddddddddddddddddddddddddddddddd66666dddddddddddddddddddddddd\n    dddddddddddddd66ddddddddddddddddddddddddddddddddddddd666dddddddddddddddddddddddddddddddddddd6666666dddddddddddddddddddddddddddddddddd666ddddddddddddddd9999999dd\n    dddddddddddddd66dddddddddddddddddddddddddddddddddddd66666ddddddddddddddddddddd99d99dddddddd666666ddddddddddddddddd999ddddddddddddddd66666dddddddddddd99999999999\n    9dddddddddddd6666ddddddddddddddddddddddddddddddddddd6666666ddddddddddddddddd99999999ddddd666666666ddddddd999dddddd999999dddddddddddd6666666ddddddddd999999999999\n    999dddddddd66666dddddddddddddddddddddddddd9dddddddd666666ddddddddddddddddd99999999999dddddd66666666ddddd99999999dd9999999dddddddddd666666ddddddddd99999999999999\n    9999ddddddddd666ddddddddddddddddd99999999999ddddd666666666dddddddddddddd99999999999999dd996666666dddddd999999999dd9999999dddddddd666666666ddddddd999999999999999\n    99999ddddddd66666ddddddddddddddd9999999999999dddddd66666666ddddddddddd9999999999999999999999666666dddd996999999999999999999dddddddd66666666ddddd9999999999999999\n    999999dddddd6666666dddddddddddd999999999999999dd996666666ddddddddddd9999999999999999999999666666666dd9996999999999999999999999dd996666666dddddd99999999999999999\n    999999ddddd666666dddddddddddd99999999999999999999999666666dddd9969999999999999999999999996666666666699966999999999999999999999999999666666dddd996999999999999999\n    999999ddd666666666ddddddd9999999999999999999999999666666666dd999699999999999999999999996666666666699999966999999999999999999999999666666666dd9996999999999999999\n    999999ddddd66666666ddddd9999999999999999999999999666666666669996699999999999999999999999966666666699999669999999999999999999999996666666666699966999999999999999\n    999999dd996666666dddddd99999999999999999999999966666666666999999669999999999999999999999966666669999996666999999999999999999999666666666669999996699999999999999\n    999999999999666666dddd996999999999999999999999999666666666999996699999999999999999999999669666666669966666699999999999999999999996666666669999966999999999999999\n    9999999999666666666dd9996999999999999999999999999666666699999966669999999999999999999999996666666666999669999999999999999999999996666666999999666699999999999999\n    9999999996666666666699966999999999999999999999996696666666699666666999999999999999999999666666666669966666699999999999999999999966966666666996666669999999999999\n    9999999666666666669999996699999999996999999999999966666666669996699999999999699999969996666666666669666666669999999969999999999999666666666699966999999999996999\n    9999999996666666669999966999999999996999999999996666666666699666666999999999699999966999996666666666666666999999999969999999999966666666666996666669999999996999\n    9996999996666666999999666699999999966699999699966666666666696666666699999996669999669999666666666666666666669999999666999996999666666666666966666666999999966699\n    9996699966966666666996666669999999996699999669999966666666666666669999999999669999966996666666666666666666666999999966999996699999666666666666666699999999996699\n    9966999999666666666699966999999999966999996699996666666666666666666699999996699999666666666666666666666666699999999669999966999966666666666666666666999999966999\n    9996699966666666666996666669999999666699999669966666666666666666666669999966669999966666666666666666666666666999996666999996699666666666666666666666699999666699\n    9966669666666666666966666666999999966669996666666666666666666666666999999996666999966666666666666666666666666699999666699966666666666666666666666669999999966669\n    9996669999666666666666666699999999666699999666666666666666666666666669999966669999666666666666666666666666669999996666999996666666666666666666666666699999666699\n    9996669966666666666666666666999996666669999666666666666666666666666666999666666996666666666666666666666666666699966666699996666666666666666666666666669996666669\n    9966669666666666666666666666699999666699996666666666666666666666666699999966669999666666666666666666666666666669996666999966666666666666666666666666999999666699\n    9666666666666666666666666669999966666669966666666666666666666666666666996666666999666666666666666666666666666699666666699666666666666666666666666666669966666669\n    9966666666666666666666666666699996666666996666666666666666666666666666699666666696666666666666666666666666666669966666669966666666666666666666666666666996666666\n    9966666666666666666666666666669966666666996666666666666666666666666666996666666696666666666666666666666666666666666666669966666666666666666666666666669966666666\n    6666666666666666666666666666999966666666666666666666666666666666666666696666666666666666666666666666666666666666666666666666666666666666666666666666666966666666\n    6666666666666666666666666666669666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666669666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n    `)\n","README.md":" ","assets.json":"","_animation.ts":"//////////////////////// animation.ts contents of previous version, just for test.ts here for convenience /////////////////////\n// file contents:\n// directional animations defines for enging_raycasting.ts\n// for convenience, constructed animations as below, which images are builtin in Arcade, \n// in order from easy to complex\n\n// each are 2D Image array, Image[][]: \n// 1st dimension is direction: \n//    length=1 to any, e.g. 1,2,3,4,...,8,..., engine can automatically arange them to 0~360 \n//    order: start from left, then folling with others in CW order\n//    e.g: \n//         2 directions should be [leftAni,RightAni], \n//         4-direction should be [leftAni, frontAni, rightAni, backAni], \n//         8-direction=[l,lf,f,fr,r,rb,b,lb], ...\n//    the reason that directions start from left, is almost all Arcade builtin one side images are facing left, so that would be convient for using.\n// 2nd dimension is animation Images\n//    length=1 to any, e.g. 1,2,3,4,..., engine will automatically loop them by aniInterval(set when create CompactSprite, or use default)\n\n\n//simplest, just one static image, looks the same in all angle of view\nconst texturesDonut = [[sprites.food.smallDonut]]\nconst texturesBigCake = [[sprites.food.bigCake]]\n\n//1-direction, with ani, looks the same Ani in all angle of view\nconst texturesCoin = [[sprites.builtin.coin0, sprites.builtin.coin1, sprites.builtin.coin2, sprites.builtin.coin3, sprites.builtin.coin4, sprites.builtin.coin5]]\n\nconst texturesDog = [[sprites.builtin.dog0, sprites.builtin.dog1, sprites.builtin.dog2]]\nconst texturesDuck = [[sprites.duck.duck1, sprites.duck.duck2, sprites.duck.duck3, sprites.duck.duck4, sprites.duck.duck5, sprites.duck.duck6]]\n\n//2-direction, with ani, looks difference from left or right side\nconst texturesPlane = [[sprites.vehicle.plane0, sprites.vehicle.plane1, sprites.vehicle.plane2, sprites.vehicle.plane3, sprites.vehicle.plane4, sprites.vehicle.plane5],\n[sprites.vehicle.plane0, sprites.vehicle.plane1, sprites.vehicle.plane2, sprites.vehicle.plane3, sprites.vehicle.plane4, sprites.vehicle.plane5]]\n//no right side ani images builtin, so make them from lefts, and then flipX\nimagesFlipX(texturesPlane[1])\n\nconst texturesFish = [[sprites.builtin.angelFish0, sprites.builtin.angelFish1, sprites.builtin.angelFish2, sprites.builtin.angelFish3],\n[sprites.builtin.angelFish0, sprites.builtin.angelFish1, sprites.builtin.angelFish2, sprites.builtin.angelFish3]]\nimagesFlipX(texturesFish[1])\n\n//4-direction\nconst texturesHero = [\n    [sprites.castle.heroWalkSideLeft1, sprites.castle.heroWalkSideLeft2, sprites.castle.heroWalkSideLeft3, sprites.castle.heroWalkSideLeft4],\n    [sprites.castle.heroWalkFront1, sprites.castle.heroWalkFront2, sprites.castle.heroWalkFront3, sprites.castle.heroWalkFront4],\n    [sprites.castle.heroWalkSideRight1, sprites.castle.heroWalkSideRight2, sprites.castle.heroWalkSideRight3, sprites.castle.heroWalkSideRight4],\n    [sprites.castle.heroWalkBack1, sprites.castle.heroWalkBack2, sprites.castle.heroWalkBack3, sprites.castle.heroWalkBack4],\n]\n\nconst texturesPrincess2 = [\n    [sprites.castle.princess2Left1, sprites.castle.princess2Left2],\n    [sprites.castle.princess2WalkFront1, sprites.castle.princess2WalkFront2, sprites.castle.princess2WalkFront3, sprites.castle.princess2WalkFront2],\n    [sprites.castle.princess2Right1, sprites.castle.princess2Right2],\n    [sprites.castle.princess2WalkBack1, sprites.castle.princess2WalkBack2, sprites.castle.princess2WalkBack3, sprites.castle.princess2WalkBack2],\n]\n\n//4-direction, but back side has only 1 image, so no ani when looking from back\nconst texturesSkelly = [\n    [sprites.castle.skellyWalkLeft1, sprites.castle.skellyWalkLeft2],\n    [sprites.castle.skellyWalkFront1, sprites.castle.skellyWalkFront2, sprites.castle.skellyWalkFront3],\n    [sprites.castle.skellyWalkRight1, sprites.castle.skellyWalkRight2],\n    [img`\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ..........ffff..........\n\t        ........ff1111ff........\n\t        .......fb111111bf.......\n\t        .......f11111111f.......\n\t        ......fd11111111df......\n\t        ......fd11111111df......\n\t        ......fd11111111df......\n\t        ......fb11111111bf......\n\t        ......fcd111111dcf......\n\t        .......fb111111bf.......\n\t        .....ffffdb1bdcfff......\n\t        ....fc111cfbfbc111cf....\n\t        ....f11111ffff11111f....\n\t        ....fbfbfbffffffbfbf....\n\t        .........ffffff.........\n\t        ..........fff...........\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ........................\n\t    `],\n]\n\nconst texturesPrincess = [\n    [sprites.castle.princessLeft0, sprites.castle.princessLeft1, sprites.castle.princessLeft0, sprites.castle.princessLeft2],\n    [sprites.castle.princessFront0, sprites.castle.princessFront1, sprites.castle.princessFront0, sprites.castle.princessFront2],\n    [],\n    [sprites.castle.princessBack0, sprites.castle.princessBack1, sprites.castle.princessBack0, sprites.castle.princessBack2],\n]\ntexturesPrincess[0].forEach((v, i) => {\n    texturesPrincess[2].push(v.clone())\n    texturesPrincess[2][i].flipX()\n}\n)\n\nfunction imagesFlipX(ani: Image[]) {\n    ani.forEach((img, i) => {\n        ani[i] = img.clone() //don't worry memery leak or waste, cause old images are still using by left\n        ani[i].flipX()\n    })\n}\n\n//////////////////////// end of animation.ts contents of previous version //////////////\n\n\n","_render_blocks.ts":"enum RCSpriteAttribute {\n    ZOffset,\n    ZPosition,\n    ZVelocity,\n    ZAcceleration\n}\n/**\n * A 2.5D Screen Render, using Raycasting algorithm\n **/\n//% color=#03AA74 weight=1 icon=\"\\uf1b2\" //cube f1b2 , fold f279\n//% groups='[\"Instance\",\"Basic\", \"Dimension Z\", \"Animate\", \"Advanced\"]'\n//% block=\"3D Render\"\nnamespace Render {\n    export enum attribute {\n        dirX,\n        dirY,\n        fov,\n        wallZScale,\n    }\n\n    export class Animations {\n        constructor(public frameInterval: number, public animations: Image[][]) {\n        }\n\n        msLast = 0\n        index = 0\n        iAnimation = 0\n        getFrameByDir(dir: number): Image {\n            if (control.millis() - this.msLast > this.frameInterval) {\n                this.msLast = control.millis()\n                this.index++\n                this.iAnimation = Math.round((dir * this.animations.length)) % this.animations.length\n                if (this.index >= this.animations[this.iAnimation].length)\n                    this.index = 0\n            }\n            return this.animations[this.iAnimation][this.index]\n        }\n    }\n\n    /**\n * Apply a directional image animations on a sprite\n * @param sprite the sprite to animate on\n * @param animations the directional animates\n */\n    //% blockId=set_animation\n    //% block=\"set $sprite=variables_get(mySprite) with animations$animations\"\n    //% animations.shadow=create_animation\n    //% group=\"Animate\"\n    //% weight=100\n    //% help=github:pxt-raycasting/docs/set-sprite-animations\n    export function setSpriteAnimations(sprite: Sprite, animations: Animations) {\n        raycastingRender.spriteAnimations[sprite.id] = animations\n    }\n\n    /**\n * Create a directional image animations, multi animations will applied to one round dirctions averagely, start from the left. \n * The reason that directions start from left, is almost all Arcade out-of-box 1 or 2-dirction images are facing left, so that would be convient for using.\n * @param frameInterval the time between changes, eg: 150\n * @param frames1 animation, if this is the first of multi animation it will be used as left, others will \n * @param frames2 optional, used for 2 or more dirctional\n * @param frames3 optional, used for 3 or more dirctional\n * @param frames4 optional, used for 4 or more dirctional\n */\n    //% blockId=create_animation\n    //% block=\"interval$frameInterval=timePicker animates:$frames1=animation_editor|| $frames2=animation_editor $frames3=animation_editor $frames4=animation_editor\"\n    //% inlineInputMode=inline\n    //% group=\"Animate\"\n    //% weight=100\n    //% help=github:pxt-raycasting/docs/create-animations\n    export function createAnimations(frameInterval: number, frames1: Image[], frames2?: Image[], frames3?: Image[], frames4?: Image[]): Animations {\n        const animationList = [frames1]\n        if (frames2) animationList.push(frames2)\n        if (frames3) animationList.push(frames3)\n        if (frames4) animationList.push(frames4)\n        return new Animations(frameInterval, animationList)\n    }\n\n    /**\n     * Get the Render\n     * @param img the image\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRCRenderInstance block=\"raycasting render\"\n    //% expandableArgumentMode=toggle\n    //% weight=100 \n    //% blockHidden=true\n    //% hidden=1\n    export function getRCRenderInstance(): RayCastingRender {\n        return raycastingRender\n    }\n\n    /**\n     * Get the render Sprite, which create automatically, for physical collisions, and holding the view point.\n     * You can consider it as \"myself\", and operate it like a usual sprite, eg.: position, speed, scale, collision, ...\n     * But properties relative 3D, eg. ZOffset, ZPosition, viewAngle, and etc. are not in the Sprite class.\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRenderSpriteVariable block=\"myself sprite\"\n    //% expandableArgumentMode=toggle\n    //% blockSetVariable=mySprite\n    //% weight=99\n    //% help=github:pxt-raycasting/get-render-sprite-variable\n    export function getRenderSpriteVariable(): Sprite {\n        return raycastingRender.sprSelf\n    }\n\n    /**\n     * Get the render Sprite, which create automatically, for physical collisions, and holding the view point.(but get/set view direction with dirX/dirY, which not in the Sprite class) \n     * You can consider it as \"myself\", and operate it like a usual sprite.\n     * eg: position, speed, scale, collision, ...\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRenderSpriteInstance block=\"myself sprite\"\n    //% expandableArgumentMode=toggle\n    //% weight=98\n    //% help=github:pxt-raycasting/docs/get-render-sprite-instance\n    export function getRenderSpriteInstance(): Sprite {\n        return raycastingRender.sprSelf\n    }\n\n    /**\n     * Toggle current view mode\n     */\n    //% blockId=rcRender_toggleViewMode block=\"toggle current view mode\"\n    //% group=\"Basic\"\n    //% weight=89\n    //% help=github:pxt-raycasting/docs/toggle-view-mode\n    export function toggleViewMode() {\n        raycastingRender.viewMode = raycastingRender.viewMode == ViewMode.tilemapView ? ViewMode.raycastingView : ViewMode.tilemapView\n    }\n\n    /**\n     * Current view mode is the specific one?\n     * @param viewMode\n     */\n    //% blockId=rcRender_isViewMode block=\"current is $viewMode\"\n    //% group=\"Basic\"\n    //% weight=88\n    //% help=github:pxt-raycasting/docs/is-view-mode\n    export function isViewMode(viewMode: ViewMode): boolean {\n        return viewMode == raycastingRender.viewMode\n    }\n\n    /**\n     * Set view mode\n     * @param viewMode\n     */\n    //% blockId=rcRender_setViewMode block=\"set view mode $viewMode\"\n    //% group=\"Basic\"\n    //% weight=87\n    //% help=github:pxt-raycasting/docs/set-view-mode\n    export function setViewMode(viewMode: ViewMode) {\n        raycastingRender.viewMode = viewMode\n    }\n\n    /**\n     * Get render arribute\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"get %attribute\" \n    //% blockId=rcRender_getAttribute\n    //% weight=83\n    //% help=github:pxt-raycasting/docs/get-attribute\n    export function getAttribute(attr: attribute): number {\n        switch (attr) {\n            case attribute.dirX:\n                return raycastingRender.dirX\n            case attribute.dirY:\n                return raycastingRender.dirY\n            case attribute.fov:\n                return raycastingRender.fov\n            case attribute.wallZScale:\n                return raycastingRender.wallZScale\n            default:\n                return 0\n        }\n    }\n\n    /**\n     * Set render arribute\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"set %attribute = %value\" \n    //% blockId=rcRender_setAttribute\n    //% weight=82\n    //% help=github:pxt-raycasting/docs/set-attribute\n    export function setAttribute(attr: attribute, value: number) {\n        switch (attr) {\n            case attribute.dirX:\n                raycastingRender.dirX = value\n                break\n            case attribute.dirY:\n                raycastingRender.dirY = value\n                break\n            case attribute.fov:\n                if (value < 0) value = 0\n                raycastingRender.fov = value\n                break\n            case attribute.wallZScale:\n                if (value < 0) value = 0\n                raycastingRender.wallZScale = value\n                break\n            default:\n        }\n    }\n\n    /**\n     * Get default FOV (field of view) value\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"defaultFov\"\n    //% blockId=rcRender_getDefaultFov\n    //% weight=81\n    //% help=github:pxt-raycasting/docs/get-default-fov\n    export function getDefaultFov(): number {\n        return defaultFov\n    }\n\n    /**\n     * Set view angle\n     * @param angle, unit: degree 0~360\n     */\n    //% blockId=rcRender_setViewAngleInDegree block=\"set view angle$angle\"\n    //% angle.min=0 angle.max=360 angle.defl=90\n    //% group=\"Basic\"\n    //% weight=80\n    //% help=github:pxt-raycasting/docs/set-view-angle-in-degree\n    export function setViewAngleInDegree(angle: number) {\n        raycastingRender.viewAngle = angle * Math.PI / 180\n    }\n\n    /**\n     * Set view angle by dirX and dirY\n     * @param dirX\n     * @param dirY\n     */\n    //% blockId=rcRender_setViewAngle block=\"set view angle by dirX%dirX and dirY%dirY\"\n    //% group=\"Basic\"\n    //% weight=79\n    //% help=github:pxt-raycasting/docs/set-view-angle\n    export function setViewAngle(dirX: number, dirY: number) {\n        raycastingRender.viewAngle = Math.atan2(dirY, dirX)\n    }\n\n    /**\n     * Set floating offset height for a sprite at Z direction\n     * @param sprite\n     * @param Zoffset Negative floats down, affirmative goes up\n     * @param duration moving time, 0 for immediately, unit: ms\n     */\n    //% blockId=rcRender_setZOffset block=\"set Sprite %spr=variables_get(mySprite) floating %offset pixels|| duration $duration=timePicker|ms \"\n    //% offset.min=-100 offset.max=100 offset.defl=8\n    //% duration.min=0 duration.max=5000 duration.defl=0\n    //% group=\"Dimension Z\"\n    //% weight=77\n    //% blockHidden\n    //% help=github:pxt-raycasting/docs/set-z-offset\n    export function setZOffset(sprite: Sprite, offset: number, duration?: number) {\n        raycastingRender.setZOffset(sprite, offset, duration)\n    }\n\n    /**\n     * Set arribute of a Sprite\n     * @param spr Sprite\n     * @param attr RCSpriteAttribute\n     */\n    //% group=\"Dimension Z\"\n    //% block=\"set Sprite %spr=variables_get(mySprite) %attribute = %value\"\n    //% blockId=rcRender_setSpriteAttribute\n    //% weight=75\n    //% help=github:pxt-raycasting/docs/set-sprite-attribute\n    export function setSpriteAttribute(spr: Sprite, attr: RCSpriteAttribute, value: number) {\n        switch (attr) {\n            case RCSpriteAttribute.ZOffset:\n                raycastingRender.getMotionZ(spr).offset = value\n                break\n            case RCSpriteAttribute.ZPosition:\n                raycastingRender.getMotionZ(spr).p = value\n                break\n            case RCSpriteAttribute.ZVelocity:\n                raycastingRender.getMotionZ(spr).v = value\n                break\n            case RCSpriteAttribute.ZAcceleration:\n                raycastingRender.getMotionZ(spr).a = value\n                break\n            default:\n        }\n    }\n\n    /**\n     * Get arribute of a Sprite\n     * @param spr Sprite\n     * @param attr RCSpriteAttribute\n     */\n    //% group=\"Dimension Z\"\n    //% block=\"get Sprite %spr=variables_get(mySprite) %attribute\"\n    //% blockId=rcRender_getSpriteAttribute\n    //% weight=74\n    //% help=github:pxt-raycasting/docs/get-sprite-attribute\n    export function getSpriteAttribute(spr: Sprite, attr: RCSpriteAttribute): number {\n        switch (attr) {\n            case RCSpriteAttribute.ZOffset:\n                return raycastingRender.getMotionZ(spr).offset\n            case RCSpriteAttribute.ZPosition:\n                return raycastingRender.getMotionZ(spr).p\n            case RCSpriteAttribute.ZVelocity:\n                return raycastingRender.getMotionZ(spr).v\n            case RCSpriteAttribute.ZAcceleration:\n                return raycastingRender.getMotionZ(spr).a\n            default:\n                return 0\n        }\n    }\n\n    /**\n     * Check if 2 sprites overlaps each another in Z dimension\n     * Best work together with sprites.onOverlap(kind1, kind2)\n     * @param sprite1\n     * @param sprite2\n     */\n    //% blockId=rcRender_isSpritesOverlapZ\n    //% block=\"is sprites $sprite1=variables_get(mySprite) and $sprite2=variables_get(mySprite2) overlaps in Z dimension\"\n    //% group=\"Dimension Z\"\n    //% weight=71\n    //% help=github:pxt-raycasting/docs/is-sprites-overlap-z\n    export function isSpritesOverlapZ(sprite1: Sprite, sprite2: Sprite): boolean {\n        return raycastingRender.isOverlapZ(sprite1, sprite2)\n    }\n\n    /**\n     * Make sprite jump, with specific height and duration\n     * Jump can only happened when sprite is standing, current height = its offset .\n     * @param sprite\n     * @param height jump height in pixel\n     * @param duration hover time span, unit: ms\n     */\n    //% blockId=rcRender_jumpWithHeightAndDuration block=\"Sprite %spr=variables_get(mySprite) jump, with height $height duration $duration=timePicker|ms \"\n    //% height.min=0 height.max=100 height.defl=16\n    //% duration.min=50 duration.max=5000 duration.defl=500\n    //% group=\"Dimension Z\"\n    //% weight=70\n    //% help=github:pxt-raycasting/docs/jump-with-height-and-duration\n    export function jumpWithHeightAndDuration(sprite: Sprite, height: number, duration: number) {\n        raycastingRender.jumpWithHeightAndDuration(sprite, height, duration)\n    }\n\n    /**\n     * Make sprite jump, with specific speed and acceleration\n     * Simular with Move block, but jump can only happened when sprite is standing, current height = its offset.\n     * @param sprite\n     * @param v vetical speed, unit: pixel/s\n     * @param a vetical acceleration, unit: pixel/s\n     */\n    //% blockId=rcRender_jump block=\"Sprite %spr=variables_get(mySprite) jump||, with speed $v=spriteSpeedPicker acceleration $a\"\n    //% v.min=-100 v.max=100 v.defl=60\n    //% a.min=-1000 a.max=1000 a.defl=-250\n    //% group=\"Dimension Z\"\n    //% weight=68\n    //% help=github:pxt-raycasting/docs/jump\n    export function jump(sprite: Sprite, v?: number, a?: number) {\n        raycastingRender.jump(sprite, v, a)\n    }\n\n    /**\n     * Make sprite jump, with specific speed and acceleration\n     * @param sprite\n     * @param v vetical speed, unit: pixel/s\n     * @param a vetical acceleration, unit: pixel/s\n     */\n    //% blockId=rcRender_move block=\"Sprite %spr=variables_get(mySprite) move, with speed $v=spriteSpeedPicker|| acceleration $a\"\n    //% v.min=-200 v.max=200 v.defl=60\n    //% a.min=-1000 a.max=1000 a.defl=-250\n    //% group=\"Dimension Z\"\n    //% weight=66\n    //% help=github:pxt-raycasting/docs/move\n    export function move(sprite: Sprite, v?: number, a?: number) {\n        raycastingRender.move(sprite, v, a)\n    }\n\n    /**\n     * Control the self sprite using the direction buttons from the controller. \n     * To stop controlling self sprite, pass 0 for v and va.\n     *\n     * @param v The velocity used for forward/backword movement when up/down is pressed, in pixel/s\n     * @param va The angle velocity used for turn view direction when left/right is pressed, in radian/s.\n     */\n    //% blockId=\"rcRender_moveWithController\" block=\"move with buttons velocity $v|| turn speed $va camera sway$cameraSway pixels\"\n    //% weight=60\n    //% expandableArgumentMode=\"toggle\"\n    //% v.defl=2 va.defl=3\n    //% group=\"Advanced\"\n    //% v.shadow=\"spriteSpeedPicker\"\n    //% va.shadow=\"spriteSpeedPicker\"\n    //% help=github:pxt-raycasting/docs/move-with-controller\n    export function moveWithController(v: number = 2, va: number = 3, cameraSway?: number) {\n        raycastingRender.velocity = v\n        raycastingRender.velocityAngle = va\n        if (cameraSway != undefined)\n            raycastingRender.cameraSway = cameraSway | 0\n    }\n\n    /**\n     * Render takeover all sprites in current scene\n     * Render will call this automatically, but maybe not in time enough.\n     * If you saw sprite draw at its tilemap position on screen, call this just after created the sprite.\n     */\n    //% blockId=rcRender_takeoverSceneSprites \n    //% block=\"takeover sprites in scene\"\n    //% group=\"Advanced\"\n    //% weight=49\n    //% help=github:pxt-raycasting/docs/takeover-scene-sprites\n    export function takeoverSceneSprites() {\n        raycastingRender.takeoverSceneSprites()\n    }\n\n    /**\n     * Run on sprite dirction updated, present view point to Sprite facing dirction, or which angle you see of the sprite.\n     * Just using with other animation extensions, to set proper Image for sprite.\n     * Not required, if you have used the set animations block provided.\n     * @param dir It is a float number, 0~1 corresponds to 0~360, suggest use Math.round(dir*dirAniTotalCount)%dirAniTotalCount to get index of direction\n     */\n    //% blockId=rcRender_registerOnSpriteDirectionUpdateHandler\n    //% block=\"run code when sprite $spr dirction updated to $dir\"\n    //% draggableParameters\n    //% group=\"Advanced\"\n    //% weight=48\n    //% help=github:pxt-raycasting/docs/register-on-sprite-direction-update-handler\n    export function registerOnSpriteDirectionUpdateHandler(handler: (spr: Sprite, dir: number) => void) {\n        raycastingRender.registerOnSpriteDirectionUpdate(handler)\n    }\n}\n","_render_raycasting.ts":"//% shim=pxt::updateScreen\nfunction updateScreen(img: Image) { }\n\nenum ViewMode {\n    //% block=\"TileMap Mode\"\n    tilemapView,\n    //% block=\"Raycasting Mode\"\n    raycastingView,\n}\n\nnamespace Render {\n    const SH = screen.height, SHHalf = SH / 2\n    const SW = screen.width, SWHalf = SW / 2\n    const fpx = 8\n    const fpx_scale = 2 ** fpx\n    function tofpx(n: number) { return (n * fpx_scale) | 0 }\n    const one = 1 << fpx\n    const one2 = 1 << (fpx + fpx)\n    const FPX_MAX = (1 << fpx) - 1\n\n    class MotionSet1D {\n        p: number\n        v: number = 0\n        a: number = 0\n        constructor(public offset: number) {\n            this.p = offset\n        }\n    }\n\n    export const defaultFov = SW / SH / 2  //Wall just fill screen height when standing 1 tile away\n\n    export class RayCastingRender {\n        private tempScreen: Image = image.create(SW, SH)\n\n        velocityAngle: number = 2\n        velocity: number = 3\n        protected _viewMode = ViewMode.raycastingView\n        protected dirXFpx: number\n        protected dirYFpx: number\n        protected planeX: number\n        protected planeY: number\n        protected _angle: number\n        protected _fov: number\n        protected _wallZScale: number = 1\n        cameraSway = 0\n        protected isWalking = false\n        protected cameraOffsetX = 0\n        protected cameraOffsetZ_fpx = 0\n\n        //sprites & accessories\n        sprSelf: Sprite\n        sprites: Sprite[] = []\n        sprites2D: Sprite[] = []\n        spriteParticles: particles.ParticleSource[] = []\n        spriteLikes: SpriteLike[] = []\n        spriteAnimations: Animations[] = []\n        protected spriteMotionZ: MotionSet1D[] = []\n        protected sayRederers: sprites.BaseSpriteSayRenderer[] = []\n        protected sayEndTimes: number[] = []\n\n        //reference\n        protected tilemapScaleSize = 1 << TileScale.Sixteen\n        map: tiles.TileMapData\n        bg: Image\n        textures: Image[]\n        protected oldRender: scene.Renderable\n        protected myRender: scene.Renderable\n\n        //render\n        protected wallHeightInView: number\n        protected wallWidthInView: number\n        protected dist: number[] = []\n        //render perf const\n        cameraRangeAngle: number\n        viewZPos: number\n        selfXFpx: number\n        selfYFpx: number\n\n        //for drawing sprites\n        protected invDet: number //required for correct matrix multiplication\n        camera: scene.Camera\n        tempSprite: Sprite = sprites.create(img`0`)\n        protected transformX: number[] = []\n        protected transformY: number[] = []\n        protected angleSelfToSpr: number[] = []\n\n        onSpriteDirectionUpdateHandler: (spr: Sprite, dir: number) => void\n\n        get xFpx(): number {\n            return Fx.add(this.sprSelf._x, Fx.div(this.sprSelf._width, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        // set xFpx(v: number) {\n        //     this.sprSelf._x = v * this.tilemapScaleSize as any as Fx8\n        // }\n\n        get yFpx(): number {\n            return Fx.add(this.sprSelf._y, Fx.div(this.sprSelf._height, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        // set yFpx(v: number) {\n        //     this.sprSelf._y = v * this.tilemapScaleSize as any as Fx8\n        // }\n\n        get dirX(): number {\n            return this.dirXFpx / fpx_scale\n        }\n\n        get dirY(): number {\n            return this.dirYFpx / fpx_scale\n        }\n\n        set dirX(v: number) {\n            this.dirXFpx = v * fpx_scale\n        }\n\n        set dirY(v: number) {\n            this.dirYFpx = v * fpx_scale\n        }\n\n        sprXFx8(spr: Sprite) {\n            return Fx.add(spr._x, Fx.div(spr._width, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        sprYFx8(spr: Sprite) {\n            return Fx.add(spr._y, Fx.div(spr._height, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        get fov(): number {\n            return this._fov\n        }\n\n        set fov(fov: number) {\n            this._fov = fov\n            this.wallHeightInView = (SW << (fpx - 1)) / this._fov\n            this.wallWidthInView = this.wallHeightInView >> fpx // not fpx  // wallSize / this.fov * 4 / 3 * 2\n            this.cameraRangeAngle = Math.atan(this.fov) + .1 //tolerance for spr center just out of camera\n\n            this.setVectors()\n        }\n\n        get viewAngle(): number {\n            return this._angle\n        }\n        set viewAngle(angle: number) {\n            this._angle = angle\n            this.setVectors()\n            this.updateSelfImage()\n        }\n\n        get wallZScale(): number {\n            return this._wallZScale\n        }\n        set wallZScale(v: number) {\n            this._wallZScale = v\n        }\n\n        getMotionZ(spr: Sprite, offsetZ: number = 0) {\n            let motionZ = this.spriteMotionZ[spr.id]\n            if (!motionZ) {\n                motionZ = new MotionSet1D(tofpx(offsetZ))\n                this.spriteMotionZ[spr.id] = motionZ\n            }\n            return motionZ\n        }\n\n        getZOffset(spr: Sprite) {\n            return this.getMotionZ(spr).offset / fpx_scale\n        }\n\n        setZOffset(spr: Sprite, offsetZ: number, duration: number = 500) {\n            const motionZ = this.getMotionZ(spr, offsetZ)\n\n            motionZ.offset = tofpx(offsetZ)\n            if (motionZ.p != motionZ.offset) {\n                if (duration === 0)\n                    motionZ.p = motionZ.offset\n                else if (motionZ.v == 0)\n                    this.move(spr, (motionZ.offset - motionZ.p) / fpx_scale * 1000 / duration, 0)\n            }\n        }\n\n        getMotionZPosition(spr: Sprite) {\n            return this.getMotionZ(spr).p / fpx_scale\n        }\n\n        //todo, use ZHeight(set from sprite.Height when takeover, then sprite.Height will be replace with width)\n        isOverlapZ(sprite1: Sprite, sprite2: Sprite): boolean {\n            const p1 = this.getMotionZPosition(sprite1)\n            const p2 = this.getMotionZPosition(sprite2)\n            if (p1 < p2) {\n                if (p1 + sprite1.height > p2) return true\n            } else {\n                if (p2 + sprite2.height > p1) return true\n            }\n            return false\n        }\n\n        move(spr: Sprite, v: number, a: number) {\n            const motionZ = this.getMotionZ(spr)\n\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        jump(spr: Sprite, v: number, a: number) {\n            const motionZ = this.getMotionZ(spr)\n            if (motionZ.p != motionZ.offset)\n                return\n\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        jumpWithHeightAndDuration(spr: Sprite, height: number, duration: number) {\n            const motionZ = this.getMotionZ(spr)\n            if (motionZ.p != motionZ.offset)\n                return\n\n            // height= -v*v/a/2\n            // duration = -v/a*2 *1000\n            const v = height * 4000 / duration\n            const a = -v * 2000 / duration\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        get viewMode(): ViewMode {\n            return this._viewMode\n        }\n\n        set viewMode(v: ViewMode) {\n            this._viewMode = v\n        }\n\n        updateViewZPos() {\n            this.viewZPos = this.spriteMotionZ[this.sprSelf.id].p + (this.sprSelf._height as any as number) - (2 << fpx)\n        }\n\n        takeoverSceneSprites() {\n            const sc_allSprites = game.currentScene().allSprites\n            for (let i = 0; i < sc_allSprites.length;) {\n                const spr = sc_allSprites[i]\n                if (spr instanceof Sprite) {\n                    const sprList = (spr.flags & sprites.Flag.RelativeToCamera) ? this.sprites2D : this.sprites\n                    if (sprList.indexOf(spr) < 0) {\n                        sprList.push(spr as Sprite)\n                        this.getMotionZ(spr, 0)\n                        spr.onDestroyed(() => {\n                            this.sprites.removeElement(spr as Sprite)   //can be in one of 2 lists\n                            this.sprites2D.removeElement(spr as Sprite) //can be in one of 2 lists\n                            const sayRenderer = this.sayRederers[spr.id]\n                            if (sayRenderer) {\n                                this.sayRederers.removeElement(sayRenderer)\n                                sayRenderer.destroy()\n                            }\n                        })\n                    }\n                } else if (spr instanceof particles.ParticleSource) {\n                    const particle = (spr as particles.ParticleSource)\n                    if (this.spriteParticles.indexOf(particle) < 0) {\n                        this.spriteParticles[(particle.anchor as Sprite).id] = particle\n                        particle.anchor = this.tempSprite\n                    }\n                } else {\n                    if (this.spriteLikes.indexOf(spr) < 0)\n                        this.spriteLikes.push(spr)\n                }\n                sc_allSprites.removeElement(spr)\n            }\n            this.sprites.forEach((spr) => {\n                if (spr)\n                    this.takeoverSayRenderOfSprite(spr)\n            })\n        }\n        takeoverSayRenderOfSprite(sprite: Sprite) {\n            const sprite_as_any = (sprite as any)\n            if (sprite_as_any.sayRenderer) {\n                this.sayRederers[sprite.id] = sprite_as_any.sayRenderer\n                this.sayEndTimes[sprite.id] = sprite_as_any.sayEndTime;\n                sprite_as_any.sayRenderer = undefined\n                sprite_as_any.sayEndTime = undefined\n            }\n        }\n\n        tilemapLoaded() {\n            const sc = game.currentScene()\n            this.map = sc.tileMap.data\n            this.textures = sc.tileMap.data.getTileset()\n            this.tilemapScaleSize = 1 << sc.tileMap.data.scale\n            this.oldRender = sc.tileMap.renderable\n            this.spriteLikes.removeElement(this.oldRender)\n            sc.allSprites.removeElement(this.oldRender)\n\n            let frameCallback_update = sc.eventContext.registerFrameHandler(scene.PRE_RENDER_UPDATE_PRIORITY + 1, () => {\n                const dt = sc.eventContext.deltaTime;\n                // sc.camera.update();  // already did in scene\n                for (const s of this.sprites)\n                    s.__update(sc.camera, dt);\n                this.sprSelf.__update(sc.camera, dt)\n            })\n\n            let frameCallback_draw = sc.eventContext.registerFrameHandler(scene.RENDER_SPRITES_PRIORITY + 1, () => {\n                if (this._viewMode == ViewMode.tilemapView) {\n                   // screen.drawImage(sc.background.image, 0, 0)\n                    this.oldRender.__drawCore(sc.camera)\n                    this.sprites.forEach(spr => spr.__draw(sc.camera))\n                    this.sprSelf.__draw(sc.camera)\n                } else {\n                 //   this.tempScreen.drawImage(sc.background.image, 0, 0)\n                    //debug\n                    // const ms=control.micros()\n                    this.render()\n                    // info.setScore(control.micros()-ms)\n                    screen.fill(0)\n                }\n                this.sprites2D.forEach(spr => spr.__draw(sc.camera))\n                this.spriteLikes.forEach(spr => spr.__draw(sc.camera))\n                if (this._viewMode == ViewMode.raycastingView)\n                    this.tempScreen.drawTransparentImage(screen, 0, 0)\n            })\n\n            sc.tileMap.addEventListener(tiles.TileMapEvent.Unloaded, data => {\n                sc.eventContext.unregisterFrameHandler(frameCallback_update)\n                sc.eventContext.unregisterFrameHandler(frameCallback_draw)\n            })\n\n            // this.myRender = scene.createRenderable(\n            //     scene.TILE_MAP_Z,\n            //     (t, c) => this.trace(t, c)\n            // )\n\n        }\n\n        constructor() {\n            this._angle = 0\n            this.fov = defaultFov\n            this.camera = new scene.Camera()\n\n            const sc = game.currentScene()\n            if (!sc.tileMap) {\n                sc.tileMap = new tiles.TileMap();\n            } else {\n                this.tilemapLoaded()\n            }\n            game.currentScene().tileMap.addEventListener(tiles.TileMapEvent.Loaded, data => this.tilemapLoaded())\n\n            //self sprite\n            this.sprSelf = sprites.create(image.create(this.tilemapScaleSize >> 1, this.tilemapScaleSize >> 1), SpriteKind.Player)\n            this.takeoverSceneSprites()\n            this.sprites.removeElement(this.sprSelf)\n            this.updateViewZPos()\n            scene.cameraFollowSprite(this.sprSelf)\n            this.updateSelfImage()\n\n            game.onUpdate(function () {\n                this.updateControls()\n            })\n\n            game.onUpdateInterval(400, () => {\n                for (let i = 0; i < this.sprites.length;) {\n                    const spr = this.sprites[i]\n                    if (spr.flags & sprites.Flag.RelativeToCamera) {\n                        this.sprites.removeElement(spr)\n                        this.sprites2D.push(spr)\n                    } else { i++ }\n                }\n                for (let i = 0; i < this.sprites2D.length;) {\n                    const spr = this.sprites2D[i]\n                    if (!(spr.flags & sprites.Flag.RelativeToCamera)) {\n                        this.sprites2D.removeElement(spr)\n                        this.sprites.push(spr)\n                    } else { i++ }\n                }\n                this.takeoverSceneSprites() // in case some one new\n            })\n\n\n            game.onUpdateInterval(25, () => {\n                if (this.cameraSway && this.isWalking) {\n                    this.cameraOffsetX = (Math.sin(control.millis() / 150) * this.cameraSway * 3) | 0\n                    this.cameraOffsetZ_fpx = tofpx(Math.cos(control.millis() / 75) * this.cameraSway) | 0\n                }\n            });\n            control.__screen.setupUpdate(() => {\n                if (this.viewMode == ViewMode.raycastingView)\n                    updateScreen(this.tempScreen)\n                else\n                    updateScreen(screen)\n            })\n\n            game.addScenePushHandler((oldScene) => {\n                control.__screen.setupUpdate(() => { updateScreen(screen) })\n            })\n            game.addScenePopHandler((oldScene) => {\n                control.__screen.setupUpdate(() => {\n                    if (this.viewMode == ViewMode.raycastingView)\n                        updateScreen(this.tempScreen)\n                    else\n                        updateScreen(screen)\n                })\n            })\n        }\n\n        private setVectors() {\n            const sin = Math.sin(this._angle)\n            const cos = Math.cos(this._angle)\n            this.dirXFpx = tofpx(cos)\n            this.dirYFpx = tofpx(sin)\n            this.planeX = tofpx(sin * this._fov)\n            this.planeY = tofpx(cos * -this._fov)\n        }\n\n        //todo, pre-drawn dirctional image\n        public updateSelfImage() {\n            const img = this.sprSelf.image\n            img.fill(6)\n            const arrowLength = img.width / 2\n            img.drawLine(arrowLength, arrowLength, arrowLength + this.dirX * arrowLength, arrowLength + this.dirY * arrowLength, 2)\n            img.fillRect(arrowLength - 1, arrowLength - 1, 2, 2, 2)\n        }\n\n        updateControls() {\n            if (this.velocityAngle !== 0) {\n                const dx = controller.dx(this.velocityAngle)\n                if (dx) {\n                    this.viewAngle += dx\n                }\n            }\n            if (this.velocity !== 0) {\n                this.isWalking = true\n                const dy = controller.dy(this.velocity)\n                if (dy) {\n                    const nx = this.xFpx - Math.round(this.dirXFpx * dy)\n                    const ny = this.yFpx - Math.round(this.dirYFpx * dy)\n                    this.sprSelf.setPosition((nx * this.tilemapScaleSize / fpx_scale), (ny * this.tilemapScaleSize / fpx_scale))\n                } else {\n                    this.isWalking = false\n                }\n            }\n\n            for (const spr of this.sprites) {\n                this.updateMotionZ(spr)\n            }\n            this.updateMotionZ(this.sprSelf)\n        }\n\n        updateMotionZ(spr: Sprite) {\n            const dt = game.eventContext().deltaTime\n            const motionZ = this.spriteMotionZ[spr.id]\n            //if (!motionZ) continue\n\n            if (motionZ.v != 0 || motionZ.p != motionZ.offset) {\n                motionZ.v += motionZ.a * dt, motionZ.p += motionZ.v * dt\n                //landing\n                if ((motionZ.a >= 0 && motionZ.v > 0 && motionZ.p > motionZ.offset) ||\n                    (motionZ.a <= 0 && motionZ.v < 0 && motionZ.p < motionZ.offset)) { motionZ.p = motionZ.offset, motionZ.v = 0 }\n                if (spr === this.sprSelf)\n                    this.updateViewZPos()\n            }\n\n        }\n\n\n        blitRowBreak(screenX: number, screenUp: number, screenDown: number, source: Image, sourceX: number, sourceYBreak: number) {\n\n            let stepY = (sourceYBreak) / (SHHalf - screenUp )\n            let sourceY = sourceYBreak - stepY\n            let y = SHHalf -1\n            if (screenUp < 0)\n                screenUp = 0\n            while (y  >= Math.ceil(screenUp)-1) {\n                if (sourceY < 0) \n                    sourceY = 0\n                const c = source.getPixel(sourceX, sourceY)\n                this.tempScreen.setPixel(screenX, y, c)\n                y--\n                sourceY -= stepY\n            }\n            // from screen half  going down\n            stepY = (source.height - sourceYBreak) / (screenDown - SHHalf)\n            sourceY = sourceYBreak \n            y = SHHalf\n            if (screenDown > SH)\n                screenDown = SH\n            while (y < Math.round(screenDown)) {\n                const c = source.getPixel(sourceX, sourceY)\n                this.tempScreen.setPixel(screenX, y, c)\n                y++\n                sourceY += stepY\n            }\n\n        }\n        \n        render() {\n            // based on https://lodev.org/cgtutor/raycasting.html\n            this.selfXFpx = this.xFpx\n            this.selfYFpx = this.yFpx\n\n            let drawStart = 0\n            let drawHeight = 0\n            let lastDist = -1, lastTexX = -1, lastMapX = -1, lastMapY = -1\n            this.viewZPos = this.spriteMotionZ[this.sprSelf.id].p + (this.sprSelf._height as any as number) - (2 << fpx) + this.cameraOffsetZ_fpx\n            let cameraRangeAngle = Math.atan(this.fov) + .1 //tolerance for spr center just out of camera\n            //debug\n            // const ms=control.millis()\n\n            \n\n\n            const tex = this.textures[1]\n            let rayDirX0 = this.dirXFpx / fpx_scale + (this.planeX / fpx_scale)\n            let rayDirY0 = this.dirYFpx / fpx_scale + (this.planeY / fpx_scale)\n            let rayDirX1 = this.dirXFpx / fpx_scale - (this.planeX / fpx_scale)\n            let rayDirY1 = this.dirYFpx / fpx_scale - (this.planeY / fpx_scale)\n            let fmapX = this.selfXFpx / fpx_scale\n            let fmapY = this.selfYFpx / fpx_scale\n\n            const sc = game.currentScene() \n           // background\n            const speed = 2 // 2: normal speed\n            let backgroundOffset = (this._angle / Math.PI * speed ) % 1  // range -1..1\n            if (backgroundOffset < 0) backgroundOffset++  // range 0..1\n            backgroundOffset *= SW    // range 0..screenwidth\n            \n            //floor\n            for (let y = 60; y < SH; y++) {\n                let p = y - SHHalf\n                let posZ = SH * this.viewZPos / this.tilemapScaleSize / fpx_scale\n                let rowDistance = posZ / p\n                let floorStepX = rowDistance * (rayDirX1 - rayDirX0) / SW\n                let floorStepY = rowDistance * (rayDirY1 - rayDirY0) / SW\n\n\n\n                let floorX = fmapX + rowDistance * rayDirX0\n                let floorY = fmapY + rowDistance * rayDirY0\n                for (let x = 0; x < SW; x++) {\n                      let cellX = Math.floor(floorX)\n                     let cellY = Math.floor(floorY)\n                    let tx =  (16 * (floorX - cellX)) & 15\n                      let ty = (16 * (floorY - cellY)) & (15)\n                    let mapX = Math.round(floorX - 0.5) % 16\n                    let mapY = Math.round(floorY - 0.5) % 16\n                    let tileType = this.map.getTile(mapX, mapY)\n                    let floorTex = this.textures[tileType]\n                    floorX += floorStepX\n                    floorY += floorStepY\n                    let c = floorTex.getPixel(tx, ty)\n                    this.tempScreen.setPixel(x, y, c)\n\n                }\n\n\n\n            }\n            // walls\n\n            for (let x = 0; x < SW; x++) {\n                const cameraX: number = one - Math.idiv(((x + this.cameraOffsetX) << fpx) << 1, SW)\n                let rayDirX = this.dirXFpx + (this.planeX * cameraX >> fpx)\n                let rayDirY = this.dirYFpx + (this.planeY * cameraX >> fpx)\n\n                // avoid division by zero\n                if (rayDirX == 0) rayDirX = 1\n                if (rayDirY == 0) rayDirY = 1\n\n                let mapX = this.selfXFpx >> fpx\n                let mapY = this.selfYFpx >> fpx\n\n                // length of ray from current position to next x or y-side\n                let sideDistX = 0, sideDistY = 0\n\n                // length of ray from one x or y-side to next x or y-side\n                const deltaDistX = Math.abs(Math.idiv(one2, rayDirX));\n                const deltaDistY = Math.abs(Math.idiv(one2, rayDirY));\n\n                let mapStepX = 0, mapStepY = 0\n\n                let sideWallHit = false;\n\n                //calculate step and initial sideDist\n                if (rayDirX < 0) {\n                    mapStepX = -1;\n                    sideDistX = ((this.selfXFpx - (mapX << fpx)) * deltaDistX) >> fpx;\n                } else {\n                    mapStepX = 1;\n                    sideDistX = (((mapX << fpx) + one - this.selfXFpx) * deltaDistX) >> fpx;\n                }\n                if (rayDirY < 0) {\n                    mapStepY = -1;\n                    sideDistY = ((this.selfYFpx - (mapY << fpx)) * deltaDistY) >> fpx;\n                } else {\n                    mapStepY = 1;\n                    sideDistY = (((mapY << fpx) + one - this.selfYFpx) * deltaDistY) >> fpx;\n                }\n\n                let color = 0\n\n                while (true) {\n                    //jump to next map square, OR in x-direction, OR in y-direction\n                    if (sideDistX < sideDistY) {\n                        sideDistX += deltaDistX;\n                        mapX += mapStepX;\n                        sideWallHit = false;\n                    } else {\n                        sideDistY += deltaDistY;\n                        mapY += mapStepY;\n                        sideWallHit = true;\n                    }\n\n                    if (this.map.isOutsideMap(mapX, mapY))\n                        break\n                    color = this.map.getTile(mapX, mapY)\n                    if  (this.map.isWall(mapX, mapY))\n                        break; // hit!\n                }\n\n                if (this.map.isOutsideMap(mapX, mapY))\n                    continue\n\n                let perpWallDist = 0\n                let wallX = 0\n                if (!sideWallHit) {\n                    perpWallDist = Math.idiv(((mapX << fpx) - this.selfXFpx + (1 - mapStepX << fpx - 1)) << fpx, rayDirX)\n                    wallX = this.selfYFpx + (perpWallDist * rayDirY >> fpx);\n                } else {\n                    perpWallDist = Math.idiv(((mapY << fpx) - this.selfYFpx + (1 - mapStepY << fpx - 1)) << fpx, rayDirY)\n                    wallX = this.selfXFpx + (perpWallDist * rayDirX >> fpx);\n                }\n                wallX &= FPX_MAX\n\n                // color = (color - 1) * 2\n                // if (sideWallHit) color++\n\n                const tex = this.textures[color]\n                if (!tex)\n                    continue\n\n                let texX = (wallX * tex.width) >> fpx;\n                // if ((!sideWallHit && rayDirX > 0) || (sideWallHit && rayDirY < 0))\n                //     texX = tex.width - texX - 1;\n\n                const lineHeight = (this.wallHeightInView / perpWallDist)\n                const drawEnd = lineHeight * this.viewZPos / this.tilemapScaleSize / fpx_scale;\n                const horizontBreak = 1 - this.viewZPos / this.tilemapScaleSize / fpx_scale;\n                if (perpWallDist !== lastDist && (texX !== lastTexX || mapX !== lastMapX || mapY !== lastMapY)) {//neighbor line of tex share same parameters\n                     \n                    drawStart = drawEnd - lineHeight * (this._wallZScale) ;\n                    drawHeight = (Math.ceil(drawEnd) - Math.ceil(drawStart) )\n                    drawStart += (SH >> 1)\n\n                    lastDist = perpWallDist\n                    lastTexX = texX\n                    lastMapX = mapX\n                    lastMapY = mapY\n                }\n                //fix start&end points to avoid regmatic between lines\n               \n\n                //if (x < SWHalf)\n                //    this.tempScreen.blitRow(x, drawStart, tex, texX, drawHeight)\n                //else\n                    this.blitRowBreak(x, SHHalf + drawEnd - lineHeight, SHHalf + drawEnd, tex, texX, tex.height * horizontBreak)\n\n                this.dist[x] = perpWallDist\n\n                // background \n                for (let y = 0; y < drawStart; y++ ){\n                    let backX = (backgroundOffset + x) % SW\n                    let c = sc.background.image.getPixel(backX,y)\n                    this.tempScreen.setPixel(x,y,c)\n                }\n            }\n            //debug\n            // info.setScore(control.millis()-ms)\n           // this.tempScreen.print(backgroundOffset.toString(), 0,0,7 )\n           // this.tempScreen.print([Math.roundWithPrecision(this._angle, 3)].join(), 20, 5)\n\n            this.drawSprites()\n        }\n\n        drawSprites() {\n            //debug\n            // let msSprs=control.millis()\n            /////////////////// sprites ///////////////////\n\n            //for sprite\n            const invDet = one2 / (this.planeX * this.dirYFpx - this.dirXFpx * this.planeY); //required for correct matrix multiplication\n\n            this.sprites\n                .filter((spr, i) => {\n                    const spriteX = this.sprXFx8(spr) - this.xFpx // this.selfXFpx\n                    const spriteY = this.sprYFx8(spr) - this.yFpx // this.selfYFpx\n                    this.angleSelfToSpr[spr.id] = Math.atan2(spriteX, spriteY)\n                    this.transformX[spr.id] = invDet * (this.dirYFpx * spriteX - this.dirXFpx * spriteY) >> fpx;\n                    this.transformY[spr.id] = invDet * (-this.planeY * spriteX + this.planeX * spriteY) >> fpx; //this is actually the depth inside the screen, that what Z is in 3D\n                    const angleInCamera = Math.atan2(this.transformX[spr.id] * this.fov, this.transformY[spr.id])\n                    return angleInCamera > -this.cameraRangeAngle && angleInCamera < this.cameraRangeAngle //(this.transformY[spr.id] > 0\n                }).sort((spr1, spr2) => {   // far to near\n                    return (this.transformY[spr2.id] - this.transformY[spr1.id])\n                }).forEach((spr, index) => {\n                    //debug\n                    // this.tempScreen.print([spr.id,Math.roundWithPrecision(angle[spr.id],3)].join(), 0, index * 10 + 10,9)\n                    this.drawSprite(spr, index, this.transformX[spr.id], this.transformY[spr.id], this.angleSelfToSpr[spr.id])\n                })\n\n            //debug\n            // info.setLife(control.millis() - msSprs+1)\n             //this.tempScreen.print([Math.roundWithPrecision(this._angle,3)].join(), 20,  0)\n\n        }\n\n        registerOnSpriteDirectionUpdate(handler: (spr: Sprite, dir: number) => void) {\n            this.onSpriteDirectionUpdateHandler = handler\n        }\n\n        drawSprite(spr: Sprite, index: number, transformX: number, transformY: number, myAngle: number) {\n            const spriteScreenX = Math.ceil((SWHalf) * (1 - transformX / transformY)) - this.cameraOffsetX;\n            const spriteScreenHalfWidth = Math.idiv((spr._width as any as number) / this.tilemapScaleSize / 2 * this.wallWidthInView, transformY)  //origin: (texSpr.width / 2 << fpx) / transformY / this.fov / 3 * 2 * 4\n            const spriteScreenLeft = spriteScreenX - spriteScreenHalfWidth\n            const spriteScreenRight = spriteScreenX + spriteScreenHalfWidth\n\n            //calculate drawing range in X direction\n            //assume there is one range only\n            let blitX = 0, blitWidth = 0\n            for (let sprX = 0; sprX < SW; sprX++) {\n                if (this.dist[sprX] > transformY) {\n                    if (blitWidth == 0)\n                        blitX = sprX\n                    blitWidth++\n                } else if (blitWidth > 0) {\n                    if (blitX <= spriteScreenRight && blitX + blitWidth >= spriteScreenLeft)\n                        break\n                    else\n                        blitX = 0, blitWidth = 0;\n                }\n            }\n            // this.tempScreen.print([this.getxFx8(spr), this.getyFx8(spr)].join(), 0,index*10+10)\n            const blitXSpr = Math.max(blitX, spriteScreenLeft)\n            const blitWidthSpr = Math.min(blitX + blitWidth, spriteScreenRight) - blitXSpr\n            if (blitWidthSpr <= 0)\n                return\n\n            const lineHeight = Math.idiv(this.wallHeightInView, transformY)\n            const drawStart = SHHalf + (lineHeight * ((this.viewZPos - this.spriteMotionZ[spr.id].p - (spr._height as any as number)) / this.tilemapScaleSize) >> fpx)\n\n            //for textures=image[][], abandoned\n            //    const texSpr = spr.getTexture(Math.floor(((Math.atan2(spr.vxFx8, spr.vyFx8) - myAngle) / Math.PI / 2 + 2-.25) * spr.textures.length +.5) % spr.textures.length)\n            //for deal in user code\n            if (this.onSpriteDirectionUpdateHandler)\n                this.onSpriteDirectionUpdateHandler(spr, ((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25))\n            //for CharacterAnimation ext.\n            //     const iTexture = Math.floor(((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25) * 4 + .5) % 4\n            //     const characterAniDirs = [Predicate.MovingLeft,Predicate.MovingDown, Predicate.MovingRight, Predicate.MovingUp]\n            //     character.setCharacterState(spr, character.rule(characterAniDirs[iTexture]))\n            //for this.spriteAnimations\n            const texSpr = !this.spriteAnimations[spr.id] ? spr.image : this.spriteAnimations[spr.id].getFrameByDir(((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25))\n\n            const sprTexRatio = texSpr.width / spriteScreenHalfWidth / 2\n            helpers.imageBlit(\n                this.tempScreen,\n                blitXSpr,\n                drawStart,\n                blitWidthSpr,\n                lineHeight * spr.height / this.tilemapScaleSize,\n                texSpr,\n                (blitXSpr - (spriteScreenX - spriteScreenHalfWidth)) * sprTexRatio\n                ,\n                0,\n                blitWidthSpr * sprTexRatio, texSpr.height, true, false)\n\n            screen.fill(0)\n            const fpx_div_transformy = Math.roundWithPrecision(transformY / 4 / fpx_scale, 2)\n            const height = (SH / fpx_div_transformy)\n            const blitXSaySrc = ((blitX - spriteScreenX) * fpx_div_transformy) + SWHalf\n            const blitWidthSaySrc = (blitWidth * fpx_div_transformy)\n\n            //sprite\n            // screen.drawImage(texSpr, SWHalf-texSpr.width/2, SHHalf)\n            //sayText\n            const sayRender = this.sayRederers[spr.id]\n            if (sayRender) {\n                if (this.sayEndTimes[spr.id] && control.millis() > this.sayEndTimes[spr.id]) {\n                    this.sayRederers[spr.id] = undefined\n                } else {\n                    this.tempSprite.x = SWHalf\n                    this.tempSprite.y = SHHalf + 2\n                    this.camera.drawOffsetX = 0\n                    this.camera.drawOffsetY = 0\n                    sayRender.draw(screen, this.camera, this.tempSprite)\n                }\n            }\n            //particle\n            const particle = this.spriteParticles[spr.id]\n            if (particle) {\n                if (particle.lifespan) {\n                    //debug\n                    // this.tempScreen.print([spr.id].join(), 0,index*10+10)\n                    this.tempSprite.x = SWHalf\n                    this.tempSprite.y = SHHalf + spr.height\n                    this.camera.drawOffsetX = 0//spr.x-SWHalf\n                    this.camera.drawOffsetY = 0//spr.y-SH\n                    particle.__draw(this.camera)\n                } else {\n                    this.spriteParticles[spr.id] = undefined\n                }\n            }\n            //update screen for this spr\n            // const sayTransformY = \n            if (blitXSaySrc <= 0) { //imageBlit considers negative value as 0\n                helpers.imageBlit(\n                    this.tempScreen,\n                    spriteScreenX - SWHalf / fpx_div_transformy, drawStart - height / 2, (blitWidthSaySrc + blitXSaySrc) / fpx_div_transformy, height,\n                    screen,\n                    0, 0, blitWidthSaySrc + blitXSaySrc, SH, true, false)\n            } else {\n                helpers.imageBlit(\n                    this.tempScreen,\n                    // blitX, drawStart - height / 2 , blitWidth, height,\n                    blitX, drawStart - height / 2, blitWidth, height,\n                    screen,\n                    blitXSaySrc, 0, blitWidthSaySrc, SH,\n                    true, false)\n            }\n        }\n    }\n\n    //%fixedinstance\n    export const raycastingRender = new Render.RayCastingRender()\n}\n\n","tilemap.g.jres":"{\n    \"transparency16\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true\n    },\n    \"tile1\": {\n        \"data\": \"hwQQABAAAABBbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfQ==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile\"\n    },\n    \"level2\": {\n        \"id\": \"level2\",\n        \"mimeType\": \"application/mkcd-tilemap\",\n        \"data\": \"MTAxMDAwMTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA==\",\n        \"tileset\": [\n            \"myTiles.transparency16\"\n        ],\n        \"displayName\": \"level2\"\n    },\n    \"level1\": {\n        \"id\": \"level1\",\n        \"mimeType\": \"application/mkcd-tilemap\",\n        \"data\": \"MTAxMDAwMTAwMDAyMDIwMjAyMDIyMzIzMjIyMjIyMjIyMjIzMjMyMzIzMDEyNDI0MjQxNjE2MGEwYTA1MGEwNTBhMGEwNTBhMjMwMjA2MWMwNzE2MGExOTE1MTUxNTE1MWEwNjA3MGEyMzAxMDkwOTA5MWMwNzE0MTYwNTA1MDUxNDA5MDgwNTIyMDEwOTE5MTUxNTE1MWIxNjAxMDkwOTE0MGIwYTBhMjIwMTA5MTQyNDI0MWQxNDE2MDEwOTA5MTQwYjA1MDUyMjIzMDkxNDI0MTYxNjE0MTYwMTA5MDkxNDBiMDUwNTIzMjIwOTE3MTUxNTE1MWIwOTA5MDkwOTE3MTUxYTBhMjMyMjA5MDIxNjBhMTYxNDE2MDMwYzBjMGMwZDE0MGQyNTIyMDkwMTE2MTYxNjE0MTYwMzI0MjQyNDBjMTQwYzI2MDQwOTAxMTYxOTE1MTgxNjI0MjQyNDI0MGMxNDIxMjcwNDA5MDExNjE0MTYwOTE2MGQwYzBjMGMwYzE0MGMxZTA0MDkwMTAxMTQwOTA5MGUwZjEwMGMwYzBkMTQwZDFmMDQwOTA5MDkxNzE1MTUwNDA0MDQxNTE1MTUxODBjMjcwNDI0MDkwOTA5MDkwOTEyMTExMzBjMGMwZDBjMGMxZjIzMjMyMzIzMjMyMzIzMjMyMzIzMjMyMDFmMjcxZjFmMjIyMjIyMjIyMjIyMjIyMjIyMjIwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDIwMDAwMjAwMjIwMDIwMDAyMDAwMDIwMDIyMDAwMDAwMjAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAyMDAwMDAyMDAwMDIwMDIwMjAwMDAyMjIyMDAyMDAyMDIwMDAwMjIyMjAwMjAwMjAyMDAwMDAwMDAwMDIwMDIyMjAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAyMjAwMDAwMDAwMDAwMDIwMjIyMjIyMjIyMjIyMjIyMg==\",\n        \"tileset\": [\n            \"myTiles.transparency16\",\n            \"sprites.dungeon.floorDark0\",\n            \"sprites.dungeon.floorDark2\",\n            \"sprites.dungeon.greenOuterNorth0\",\n            \"sprites.dungeon.stairWest\",\n            \"sprites.castle.tileGrass1\",\n            \"sprites.castle.tilePath1\",\n            \"sprites.castle.tilePath3\",\n            \"sprites.castle.tilePath9\",\n            \"sprites.castle.tilePath5\",\n            \"sprites.castle.tileGrass2\",\n            \"sprites.castle.tilePath6\",\n            \"sprites.castle.tileDarkGrass1\",\n            \"sprites.castle.tileDarkGrass2\",\n            \"sprites.builtin.forestTiles5\",\n            \"sprites.builtin.forestTiles6\",\n            \"sprites.builtin.forestTiles7\",\n            \"sprites.builtin.forestTiles10\",\n            \"sprites.builtin.forestTiles13\",\n            \"sprites.builtin.forestTiles15\",\n            \"sprites.vehicle.roadVertical\",\n            \"sprites.vehicle.roadHorizontal\",\n            \"sprites.castle.tileGrass3\",\n            \"sprites.vehicle.roadTurn3\",\n            \"sprites.vehicle.roadTurn4\",\n            \"sprites.vehicle.roadTurn1\",\n            \"sprites.vehicle.roadTurn2\",\n            \"sprites.vehicle.roadIntersection4\",\n            \"sprites.castle.tilePath2\",\n            \"sprites.castle.tilePath8\",\n            \"sprites.builtin.forestTiles21\",\n            \"sprites.builtin.forestTiles22\",\n            \"sprites.builtin.forestTiles23\",\n            \"sprites.castle.tileDarkGrass3\",\n            \"sprites.dungeon.doorOpenNorth\",\n            \"sprites.dungeon.floorLight0\",\n            \"sprites.builtin.forestTiles0\",\n            \"sprites.builtin.forestTiles1\",\n            \"sprites.builtin.forestTiles2\",\n            \"sprites.builtin.forestTiles4\"\n        ],\n        \"displayName\": \"level\"\n    },\n    \"*\": {\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"dataEncoding\": \"base64\",\n        \"namespace\": \"myTiles\"\n    }\n}","tilemap.g.ts":"","pxt.json":"{\n    \"name\": \"3d floor and background\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"device\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"assets.json\",\n        \"_animation.ts\",\n        \"_render_blocks.ts\",\n        \"_render_raycasting.ts\",\n        \"tilemap.g.jres\",\n        \"tilemap.g.ts\"\n    ],\n    \"targetVersions\": {\n        \"branch\": \"v1.10.36\",\n        \"tag\": \"v1.10.36\",\n        \"commits\": \"https://github.com/microsoft/pxt-arcade/commits/3a5a7e13703edf0412c17bdb9b1469e282a5b31b\",\n        \"target\": \"1.10.36\",\n        \"pxt\": \"8.3.9\"\n    },\n    \"preferredEditor\": \"tsprj\"\n}\n"}},{"timestamp":1748094098436,"editorVersion":"2.0.56","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddd11111111111111111111111111111111111111111111111111111111111\n111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddddd1111111111111111111111111111111111111111111111111111111111\n11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddddddddd1111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111ddddddddddd1111111111111111111111111111111111111111111111111111111111\n11111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddddddddddddddd11111111111111111111111111ddd111ddd11111111111111111111111\n11111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddddddddddddddd1111111111111111111111111dddddddddd11111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111ddddd11ddddddddddddddddd111111111111111111111ddddddddddddd11111111111111111111111\n111111111111111111111111111111111111111111111111111111111111111111111111111111dddddd11ddddddddddddddddd111111111111111111111dddddddddddddd1111111111111111111111\n11111111111dddddddd111111111111111111111111111111111111111111111111111111ddddddddddd1dddddddddddddddddd111111ddd11111111111dddddddddddddddd1111111111ddd11111111\n1111111111dddddddddd11111111111111111111111111111111111111111111111111111dddddddddddddddddddddddddddddd11111ddddd1111111111dddddddddddddddddd1111111ddddd1111111\n111111ddddddddddddddd1111111111111111111111111111111111111111111111111111dddddddddddddddddddddddddddddd11111ddddd111111111ddddddddddddddddddddd11111ddddd1111111\n111111dddddddddddddddddddd11111111111111111111111111111111111111111111111dddddddddddddddddddddddddddddddd111ddddd111111111ddddddddddddddddddddd1111dddddd1111111\n111111ddddddddddddddddddddd11111111111111111111111dddddddd1111111111d111ddddddddddddddddddddddddddddddddd111dddddd11111111dddddddddddddddddddddd111ddddddd111111\n11111dddddddddddddddddddddddd1111111111111111ddddddddddddd1111111111ddddddddddddddddddddddddddddddddddddd11ddddddd1111111ddddddddddddddddddddddddddddddddd111111\n1dddddddddddddddddddddddddddddd1111111111111dddddddddddddddd11111111ddddddddddddddddddddddddddd6ddddddddd11ddddddd1111111ddddddddddddddddddddddddddddddddddd1111\n1ddddddddddddddddddddddddddddddd1111111111ddddddddddddddddddd111111ddddddddddddddddddddddddddd66dddddddddddddddddd1111111ddddddddddddddddddddddddddddddddddddd11\ndddddddddddddddddddddddddddddddddd1111111dddddddddddddd6dddddd11111ddddddddddddddddddddddddddd66dddddddddddddddddd1111ddddddddddddddddd6dddddddddddddddddddddddd\ndddddddddddddddddddddddddddddddddd11111ddddddddddddddd66dddddd11111dddddddddddddddddddddddddd6666ddddddddddddddddd11dddddddddddddddddd66dddddddddddddddddddddddd\nddddddddddddddddddddddddddddddddddd1dddddddddddddddddd66ddddddd1111dddddddddddddddddddddddd66666ddddddddddddddddddd1dddddddddddddddddd66dddddddddddddddddddddddd\nddddddddddddddddddddddddddddddddddddddddddddddddddddd6666dddddd1111dddddddddddddddddddddddddd666ddddddddddddddddddddddddddddddddddddd6666ddddddddddddddddddddddd\nddddddddddddddd6ddddddddddddddddddddddddddddddddddd66666dddddddddddddddddddddddddddddddddddd66666dddddddddddddddddddddddddddddddddd66666dddddddddddddddddddddddd\ndddddddddddddd66ddddddddddddddddddddddddddddddddddddd666dddddddddddddddddddddddddddddddddddd6666666dddddddddddddddddddddddddddddddddd666ddddddddddddddd9999999dd\ndddddddddddddd66dddddddddddddddddddddddddddddddddddd66666ddddddddddddddddddddd99d99dddddddd666666ddddddddddddddddd999ddddddddddddddd66666dddddddddddd99999999999\n9dddddddddddd6666ddddddddddddddddddddddddddddddddddd6666666ddddddddddddddddd99999999ddddd666666666ddddddd999dddddd999999dddddddddddd6666666ddddddddd999999999999\n999dddddddd66666dddddddddddddddddddddddddd9dddddddd666666ddddddddddddddddd99999999999dddddd66666666ddddd99999999dd9999999dddddddddd666666ddddddddd99999999999999\n9999ddddddddd666ddddddddddddddddd99999999999ddddd666666666dddddddddddddd99999999999999dd996666666dddddd999999999dd9999999dddddddd666666666ddddddd999999999999999\n99999ddddddd66666ddddddddddddddd9999999999999dddddd66666666ddddddddddd9999999999999999999999666666dddd996999999999999999999dddddddd66666666ddddd9999999999999999\n999999dddddd6666666dddddddddddd999999999999999dd996666666ddddddddddd9999999999999999999999666666666dd9996999999999999999999999dd996666666dddddd99999999999999999\n999999ddddd666666dddddddddddd99999999999999999999999666666dddd9969999999999999999999999996666666666699966999999999999999999999999999666666dddd996999999999999999\n999999ddd666666666ddddddd9999999999999999999999999666666666dd999699999999999999999999996666666666699999966999999999999999999999999666666666dd9996999999999999999\n999999ddddd66666666ddddd9999999999999999999999999666666666669996699999999999999999999999966666666699999669999999999999999999999996666666666699966999999999999999\n999999dd996666666dddddd99999999999999999999999966666666666999999669999999999999999999999966666669999996666999999999999999999999666666666669999996699999999999999\n999999999999666666dddd996999999999999999999999999666666666999996699999999999999999999999669666666669966666699999999999999999999996666666669999966999999999999999\n9999999999666666666dd9996999999999999999999999999666666699999966669999999999999999999999996666666666999669999999999999999999999996666666999999666699999999999999\n9999999996666666666699966999999999999999999999996696666666699666666999999999999999999999666666666669966666699999999999999999999966966666666996666669999999999999\n9999999666666666669999996699999999996999999999999966666666669996699999999999699999969996666666666669666666669999999969999999999999666666666699966999999999996999\n9999999996666666669999966999999999996999999999996666666666699666666999999999699999966999996666666666666666999999999969999999999966666666666996666669999999996999\n9996999996666666999999666699999999966699999699966666666666696666666699999996669999669999666666666666666666669999999666999996999666666666666966666666999999966699\n9996699966966666666996666669999999996699999669999966666666666666669999999999669999966996666666666666666666666999999966999996699999666666666666666699999999996699\n9966999999666666666699966999999999966999996699996666666666666666666699999996699999666666666666666666666666699999999669999966999966666666666666666666999999966999\n9996699966666666666996666669999999666699999669966666666666666666666669999966669999966666666666666666666666666999996666999996699666666666666666666666699999666699\n9966669666666666666966666666999999966669996666666666666666666666666999999996666999966666666666666666666666666699999666699966666666666666666666666669999999966669\n9996669999666666666666666699999999666699999666666666666666666666666669999966669999666666666666666666666666669999996666999996666666666666666666666666699999666699\n9996669966666666666666666666999996666669999666666666666666666666666666999666666996666666666666666666666666666699966666699996666666666666666666666666669996666669\n9966669666666666666666666666699999666699996666666666666666666666666699999966669999666666666666666666666666666669996666999966666666666666666666666666999999666699\n9666666666666666666666666669999966666669966666666666666666666666666666996666666999666666666666666666666666666699666666699666666666666666666666666666669966666669\n9966666666666666666666666666699996666666996666666666666666666666666666699666666696666666666666666666666666666669966666669966666666666666666666666666666996666666\n9966666666666666666666666666669966666666996666666666666666666666666666996666666696666666666666666666666666666666666666669966666666666666666666666666669966666666\n6666666666666666666666666666999966666666666666666666666666666666666666696666666666666666666666666666666666666666666666666666666666666666666666666666666966666666\n6666666666666666666666666666669666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666669666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value></block></next></block></statement></block><block type=\"keyonevent\" x=\"361\" y=\"0\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_toggleViewMode\"></block></statement></block></xml>","main.ts":"","README.md":" ","assets.json":"","_animation.ts":"//////////////////////// animation.ts contents of previous version, just for test.ts here for convenience /////////////////////\n// file contents:\n// directional animations defines for enging_raycasting.ts\n// for convenience, constructed animations as below, which images are builtin in Arcade, \n// in order from easy to complex\n\n// each are 2D Image array, Image[][]: \n// 1st dimension is direction: \n//    length=1 to any, e.g. 1,2,3,4,...,8,..., engine can automatically arange them to 0~360 \n//    order: start from left, then folling with others in CW order\n//    e.g: \n//         2 directions should be [leftAni,RightAni], \n//         4-direction should be [leftAni, frontAni, rightAni, backAni], \n//         8-direction=[l,lf,f,fr,r,rb,b,lb], ...\n//    the reason that directions start from left, is almost all Arcade builtin one side images are facing left, so that would be convient for using.\n// 2nd dimension is animation Images\n//    length=1 to any, e.g. 1,2,3,4,..., engine will automatically loop them by aniInterval(set when create CompactSprite, or use default)\n\n\n//simplest, just one static image, looks the same in all angle of view\nconst texturesDonut = [[sprites.food.smallDonut]]\nconst texturesBigCake = [[sprites.food.bigCake]]\n\n//1-direction, with ani, looks the same Ani in all angle of view\nconst texturesCoin = [[sprites.builtin.coin0, sprites.builtin.coin1, sprites.builtin.coin2, sprites.builtin.coin3, sprites.builtin.coin4, sprites.builtin.coin5]]\n\nconst texturesDog = [[sprites.builtin.dog0, sprites.builtin.dog1, sprites.builtin.dog2]]\nconst texturesDuck = [[sprites.duck.duck1, sprites.duck.duck2, sprites.duck.duck3, sprites.duck.duck4, sprites.duck.duck5, sprites.duck.duck6]]\n\n//2-direction, with ani, looks difference from left or right side\nconst texturesPlane = [[sprites.vehicle.plane0, sprites.vehicle.plane1, sprites.vehicle.plane2, sprites.vehicle.plane3, sprites.vehicle.plane4, sprites.vehicle.plane5],\n[sprites.vehicle.plane0, sprites.vehicle.plane1, sprites.vehicle.plane2, sprites.vehicle.plane3, sprites.vehicle.plane4, sprites.vehicle.plane5]]\n//no right side ani images builtin, so make them from lefts, and then flipX\nimagesFlipX(texturesPlane[1])\n\nconst texturesFish = [[sprites.builtin.angelFish0, sprites.builtin.angelFish1, sprites.builtin.angelFish2, sprites.builtin.angelFish3],\n[sprites.builtin.angelFish0, sprites.builtin.angelFish1, sprites.builtin.angelFish2, sprites.builtin.angelFish3]]\nimagesFlipX(texturesFish[1])\n\n//4-direction\nconst texturesHero = [\n    [sprites.castle.heroWalkSideLeft1, sprites.castle.heroWalkSideLeft2, sprites.castle.heroWalkSideLeft3, sprites.castle.heroWalkSideLeft4],\n    [sprites.castle.heroWalkFront1, sprites.castle.heroWalkFront2, sprites.castle.heroWalkFront3, sprites.castle.heroWalkFront4],\n    [sprites.castle.heroWalkSideRight1, sprites.castle.heroWalkSideRight2, sprites.castle.heroWalkSideRight3, sprites.castle.heroWalkSideRight4],\n    [sprites.castle.heroWalkBack1, sprites.castle.heroWalkBack2, sprites.castle.heroWalkBack3, sprites.castle.heroWalkBack4],\n]\n\nconst texturesPrincess2 = [\n    [sprites.castle.princess2Left1, sprites.castle.princess2Left2],\n    [sprites.castle.princess2WalkFront1, sprites.castle.princess2WalkFront2, sprites.castle.princess2WalkFront3, sprites.castle.princess2WalkFront2],\n    [sprites.castle.princess2Right1, sprites.castle.princess2Right2],\n    [sprites.castle.princess2WalkBack1, sprites.castle.princess2WalkBack2, sprites.castle.princess2WalkBack3, sprites.castle.princess2WalkBack2],\n]\n\n//4-direction, but back side has only 1 image, so no ani when looking from back\nconst texturesSkelly = [\n    [sprites.castle.skellyWalkLeft1, sprites.castle.skellyWalkLeft2],\n    [sprites.castle.skellyWalkFront1, sprites.castle.skellyWalkFront2, sprites.castle.skellyWalkFront3],\n    [sprites.castle.skellyWalkRight1, sprites.castle.skellyWalkRight2],\n    [img`\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ..........ffff..........\n\t        ........ff1111ff........\n\t        .......fb111111bf.......\n\t        .......f11111111f.......\n\t        ......fd11111111df......\n\t        ......fd11111111df......\n\t        ......fd11111111df......\n\t        ......fb11111111bf......\n\t        ......fcd111111dcf......\n\t        .......fb111111bf.......\n\t        .....ffffdb1bdcfff......\n\t        ....fc111cfbfbc111cf....\n\t        ....f11111ffff11111f....\n\t        ....fbfbfbffffffbfbf....\n\t        .........ffffff.........\n\t        ..........fff...........\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ........................\n\t    `],\n]\n\nconst texturesPrincess = [\n    [sprites.castle.princessLeft0, sprites.castle.princessLeft1, sprites.castle.princessLeft0, sprites.castle.princessLeft2],\n    [sprites.castle.princessFront0, sprites.castle.princessFront1, sprites.castle.princessFront0, sprites.castle.princessFront2],\n    [],\n    [sprites.castle.princessBack0, sprites.castle.princessBack1, sprites.castle.princessBack0, sprites.castle.princessBack2],\n]\ntexturesPrincess[0].forEach((v, i) => {\n    texturesPrincess[2].push(v.clone())\n    texturesPrincess[2][i].flipX()\n}\n)\n\nfunction imagesFlipX(ani: Image[]) {\n    ani.forEach((img, i) => {\n        ani[i] = img.clone() //don't worry memery leak or waste, cause old images are still using by left\n        ani[i].flipX()\n    })\n}\n\n//////////////////////// end of animation.ts contents of previous version //////////////\n\n\n","_render_blocks.ts":"enum RCSpriteAttribute {\n    ZOffset,\n    ZPosition,\n    ZVelocity,\n    ZAcceleration\n}\n/**\n * A 2.5D Screen Render, using Raycasting algorithm\n **/\n//% color=#03AA74 weight=1 icon=\"\\uf1b2\" //cube f1b2 , fold f279\n//% groups='[\"Instance\",\"Basic\", \"Dimension Z\", \"Animate\", \"Advanced\"]'\n//% block=\"3D Render\"\nnamespace Render {\n    export enum attribute {\n        dirX,\n        dirY,\n        fov,\n        wallZScale,\n    }\n\n    export class Animations {\n        constructor(public frameInterval: number, public animations: Image[][]) {\n        }\n\n        msLast = 0\n        index = 0\n        iAnimation = 0\n        getFrameByDir(dir: number): Image {\n            if (control.millis() - this.msLast > this.frameInterval) {\n                this.msLast = control.millis()\n                this.index++\n                this.iAnimation = Math.round((dir * this.animations.length)) % this.animations.length\n                if (this.index >= this.animations[this.iAnimation].length)\n                    this.index = 0\n            }\n            return this.animations[this.iAnimation][this.index]\n        }\n    }\n\n    /**\n * Apply a directional image animations on a sprite\n * @param sprite the sprite to animate on\n * @param animations the directional animates\n */\n    //% blockId=set_animation\n    //% block=\"set $sprite=variables_get(mySprite) with animations$animations\"\n    //% animations.shadow=create_animation\n    //% group=\"Animate\"\n    //% weight=100\n    //% help=github:pxt-raycasting/docs/set-sprite-animations\n    export function setSpriteAnimations(sprite: Sprite, animations: Animations) {\n        raycastingRender.spriteAnimations[sprite.id] = animations\n    }\n\n    /**\n * Create a directional image animations, multi animations will applied to one round dirctions averagely, start from the left. \n * The reason that directions start from left, is almost all Arcade out-of-box 1 or 2-dirction images are facing left, so that would be convient for using.\n * @param frameInterval the time between changes, eg: 150\n * @param frames1 animation, if this is the first of multi animation it will be used as left, others will \n * @param frames2 optional, used for 2 or more dirctional\n * @param frames3 optional, used for 3 or more dirctional\n * @param frames4 optional, used for 4 or more dirctional\n */\n    //% blockId=create_animation\n    //% block=\"interval$frameInterval=timePicker animates:$frames1=animation_editor|| $frames2=animation_editor $frames3=animation_editor $frames4=animation_editor\"\n    //% inlineInputMode=inline\n    //% group=\"Animate\"\n    //% weight=100\n    //% help=github:pxt-raycasting/docs/create-animations\n    export function createAnimations(frameInterval: number, frames1: Image[], frames2?: Image[], frames3?: Image[], frames4?: Image[]): Animations {\n        const animationList = [frames1]\n        if (frames2) animationList.push(frames2)\n        if (frames3) animationList.push(frames3)\n        if (frames4) animationList.push(frames4)\n        return new Animations(frameInterval, animationList)\n    }\n\n    /**\n     * Get the Render\n     * @param img the image\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRCRenderInstance block=\"raycasting render\"\n    //% expandableArgumentMode=toggle\n    //% weight=100 \n    //% blockHidden=true\n    //% hidden=1\n    export function getRCRenderInstance(): RayCastingRender {\n        return raycastingRender\n    }\n\n    /**\n     * Get the render Sprite, which create automatically, for physical collisions, and holding the view point.\n     * You can consider it as \"myself\", and operate it like a usual sprite, eg.: position, speed, scale, collision, ...\n     * But properties relative 3D, eg. ZOffset, ZPosition, viewAngle, and etc. are not in the Sprite class.\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRenderSpriteVariable block=\"myself sprite\"\n    //% expandableArgumentMode=toggle\n    //% blockSetVariable=mySprite\n    //% weight=99\n    //% help=github:pxt-raycasting/get-render-sprite-variable\n    export function getRenderSpriteVariable(): Sprite {\n        return raycastingRender.sprSelf\n    }\n\n    /**\n     * Get the render Sprite, which create automatically, for physical collisions, and holding the view point.(but get/set view direction with dirX/dirY, which not in the Sprite class) \n     * You can consider it as \"myself\", and operate it like a usual sprite.\n     * eg: position, speed, scale, collision, ...\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRenderSpriteInstance block=\"myself sprite\"\n    //% expandableArgumentMode=toggle\n    //% weight=98\n    //% help=github:pxt-raycasting/docs/get-render-sprite-instance\n    export function getRenderSpriteInstance(): Sprite {\n        return raycastingRender.sprSelf\n    }\n\n    /**\n     * Toggle current view mode\n     */\n    //% blockId=rcRender_toggleViewMode block=\"toggle current view mode\"\n    //% group=\"Basic\"\n    //% weight=89\n    //% help=github:pxt-raycasting/docs/toggle-view-mode\n    export function toggleViewMode() {\n        raycastingRender.viewMode = raycastingRender.viewMode == ViewMode.tilemapView ? ViewMode.raycastingView : ViewMode.tilemapView\n    }\n\n    /**\n     * Current view mode is the specific one?\n     * @param viewMode\n     */\n    //% blockId=rcRender_isViewMode block=\"current is $viewMode\"\n    //% group=\"Basic\"\n    //% weight=88\n    //% help=github:pxt-raycasting/docs/is-view-mode\n    export function isViewMode(viewMode: ViewMode): boolean {\n        return viewMode == raycastingRender.viewMode\n    }\n\n    /**\n     * Set view mode\n     * @param viewMode\n     */\n    //% blockId=rcRender_setViewMode block=\"set view mode $viewMode\"\n    //% group=\"Basic\"\n    //% weight=87\n    //% help=github:pxt-raycasting/docs/set-view-mode\n    export function setViewMode(viewMode: ViewMode) {\n        raycastingRender.viewMode = viewMode\n    }\n\n    /**\n     * Get render arribute\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"get %attribute\" \n    //% blockId=rcRender_getAttribute\n    //% weight=83\n    //% help=github:pxt-raycasting/docs/get-attribute\n    export function getAttribute(attr: attribute): number {\n        switch (attr) {\n            case attribute.dirX:\n                return raycastingRender.dirX\n            case attribute.dirY:\n                return raycastingRender.dirY\n            case attribute.fov:\n                return raycastingRender.fov\n            case attribute.wallZScale:\n                return raycastingRender.wallZScale\n            default:\n                return 0\n        }\n    }\n\n    /**\n     * Set render arribute\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"set %attribute = %value\" \n    //% blockId=rcRender_setAttribute\n    //% weight=82\n    //% help=github:pxt-raycasting/docs/set-attribute\n    export function setAttribute(attr: attribute, value: number) {\n        switch (attr) {\n            case attribute.dirX:\n                raycastingRender.dirX = value\n                break\n            case attribute.dirY:\n                raycastingRender.dirY = value\n                break\n            case attribute.fov:\n                if (value < 0) value = 0\n                raycastingRender.fov = value\n                break\n            case attribute.wallZScale:\n                if (value < 0) value = 0\n                raycastingRender.wallZScale = value\n                break\n            default:\n        }\n    }\n\n    /**\n     * Get default FOV (field of view) value\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"defaultFov\"\n    //% blockId=rcRender_getDefaultFov\n    //% weight=81\n    //% help=github:pxt-raycasting/docs/get-default-fov\n    export function getDefaultFov(): number {\n        return defaultFov\n    }\n\n    /**\n     * Set view angle\n     * @param angle, unit: degree 0~360\n     */\n    //% blockId=rcRender_setViewAngleInDegree block=\"set view angle$angle\"\n    //% angle.min=0 angle.max=360 angle.defl=90\n    //% group=\"Basic\"\n    //% weight=80\n    //% help=github:pxt-raycasting/docs/set-view-angle-in-degree\n    export function setViewAngleInDegree(angle: number) {\n        raycastingRender.viewAngle = angle * Math.PI / 180\n    }\n\n    /**\n     * Set view angle by dirX and dirY\n     * @param dirX\n     * @param dirY\n     */\n    //% blockId=rcRender_setViewAngle block=\"set view angle by dirX%dirX and dirY%dirY\"\n    //% group=\"Basic\"\n    //% weight=79\n    //% help=github:pxt-raycasting/docs/set-view-angle\n    export function setViewAngle(dirX: number, dirY: number) {\n        raycastingRender.viewAngle = Math.atan2(dirY, dirX)\n    }\n\n    /**\n     * Set floating offset height for a sprite at Z direction\n     * @param sprite\n     * @param Zoffset Negative floats down, affirmative goes up\n     * @param duration moving time, 0 for immediately, unit: ms\n     */\n    //% blockId=rcRender_setZOffset block=\"set Sprite %spr=variables_get(mySprite) floating %offset pixels|| duration $duration=timePicker|ms \"\n    //% offset.min=-100 offset.max=100 offset.defl=8\n    //% duration.min=0 duration.max=5000 duration.defl=0\n    //% group=\"Dimension Z\"\n    //% weight=77\n    //% blockHidden\n    //% help=github:pxt-raycasting/docs/set-z-offset\n    export function setZOffset(sprite: Sprite, offset: number, duration?: number) {\n        raycastingRender.setZOffset(sprite, offset, duration)\n    }\n\n    /**\n     * Set arribute of a Sprite\n     * @param spr Sprite\n     * @param attr RCSpriteAttribute\n     */\n    //% group=\"Dimension Z\"\n    //% block=\"set Sprite %spr=variables_get(mySprite) %attribute = %value\"\n    //% blockId=rcRender_setSpriteAttribute\n    //% weight=75\n    //% help=github:pxt-raycasting/docs/set-sprite-attribute\n    export function setSpriteAttribute(spr: Sprite, attr: RCSpriteAttribute, value: number) {\n        switch (attr) {\n            case RCSpriteAttribute.ZOffset:\n                raycastingRender.getMotionZ(spr).offset = value\n                break\n            case RCSpriteAttribute.ZPosition:\n                raycastingRender.getMotionZ(spr).p = value\n                break\n            case RCSpriteAttribute.ZVelocity:\n                raycastingRender.getMotionZ(spr).v = value\n                break\n            case RCSpriteAttribute.ZAcceleration:\n                raycastingRender.getMotionZ(spr).a = value\n                break\n            default:\n        }\n    }\n\n    /**\n     * Get arribute of a Sprite\n     * @param spr Sprite\n     * @param attr RCSpriteAttribute\n     */\n    //% group=\"Dimension Z\"\n    //% block=\"get Sprite %spr=variables_get(mySprite) %attribute\"\n    //% blockId=rcRender_getSpriteAttribute\n    //% weight=74\n    //% help=github:pxt-raycasting/docs/get-sprite-attribute\n    export function getSpriteAttribute(spr: Sprite, attr: RCSpriteAttribute): number {\n        switch (attr) {\n            case RCSpriteAttribute.ZOffset:\n                return raycastingRender.getMotionZ(spr).offset\n            case RCSpriteAttribute.ZPosition:\n                return raycastingRender.getMotionZ(spr).p\n            case RCSpriteAttribute.ZVelocity:\n                return raycastingRender.getMotionZ(spr).v\n            case RCSpriteAttribute.ZAcceleration:\n                return raycastingRender.getMotionZ(spr).a\n            default:\n                return 0\n        }\n    }\n\n    /**\n     * Check if 2 sprites overlaps each another in Z dimension\n     * Best work together with sprites.onOverlap(kind1, kind2)\n     * @param sprite1\n     * @param sprite2\n     */\n    //% blockId=rcRender_isSpritesOverlapZ\n    //% block=\"is sprites $sprite1=variables_get(mySprite) and $sprite2=variables_get(mySprite2) overlaps in Z dimension\"\n    //% group=\"Dimension Z\"\n    //% weight=71\n    //% help=github:pxt-raycasting/docs/is-sprites-overlap-z\n    export function isSpritesOverlapZ(sprite1: Sprite, sprite2: Sprite): boolean {\n        return raycastingRender.isOverlapZ(sprite1, sprite2)\n    }\n\n    /**\n     * Make sprite jump, with specific height and duration\n     * Jump can only happened when sprite is standing, current height = its offset .\n     * @param sprite\n     * @param height jump height in pixel\n     * @param duration hover time span, unit: ms\n     */\n    //% blockId=rcRender_jumpWithHeightAndDuration block=\"Sprite %spr=variables_get(mySprite) jump, with height $height duration $duration=timePicker|ms \"\n    //% height.min=0 height.max=100 height.defl=16\n    //% duration.min=50 duration.max=5000 duration.defl=500\n    //% group=\"Dimension Z\"\n    //% weight=70\n    //% help=github:pxt-raycasting/docs/jump-with-height-and-duration\n    export function jumpWithHeightAndDuration(sprite: Sprite, height: number, duration: number) {\n        raycastingRender.jumpWithHeightAndDuration(sprite, height, duration)\n    }\n\n    /**\n     * Make sprite jump, with specific speed and acceleration\n     * Simular with Move block, but jump can only happened when sprite is standing, current height = its offset.\n     * @param sprite\n     * @param v vetical speed, unit: pixel/s\n     * @param a vetical acceleration, unit: pixel/s\n     */\n    //% blockId=rcRender_jump block=\"Sprite %spr=variables_get(mySprite) jump||, with speed $v=spriteSpeedPicker acceleration $a\"\n    //% v.min=-100 v.max=100 v.defl=60\n    //% a.min=-1000 a.max=1000 a.defl=-250\n    //% group=\"Dimension Z\"\n    //% weight=68\n    //% help=github:pxt-raycasting/docs/jump\n    export function jump(sprite: Sprite, v?: number, a?: number) {\n        raycastingRender.jump(sprite, v, a)\n    }\n\n    /**\n     * Make sprite jump, with specific speed and acceleration\n     * @param sprite\n     * @param v vetical speed, unit: pixel/s\n     * @param a vetical acceleration, unit: pixel/s\n     */\n    //% blockId=rcRender_move block=\"Sprite %spr=variables_get(mySprite) move, with speed $v=spriteSpeedPicker|| acceleration $a\"\n    //% v.min=-200 v.max=200 v.defl=60\n    //% a.min=-1000 a.max=1000 a.defl=-250\n    //% group=\"Dimension Z\"\n    //% weight=66\n    //% help=github:pxt-raycasting/docs/move\n    export function move(sprite: Sprite, v?: number, a?: number) {\n        raycastingRender.move(sprite, v, a)\n    }\n\n    /**\n     * Control the self sprite using the direction buttons from the controller. \n     * To stop controlling self sprite, pass 0 for v and va.\n     *\n     * @param v The velocity used for forward/backword movement when up/down is pressed, in pixel/s\n     * @param va The angle velocity used for turn view direction when left/right is pressed, in radian/s.\n     */\n    //% blockId=\"rcRender_moveWithController\" block=\"move with buttons velocity $v|| turn speed $va camera sway$cameraSway pixels\"\n    //% weight=60\n    //% expandableArgumentMode=\"toggle\"\n    //% v.defl=2 va.defl=3\n    //% group=\"Advanced\"\n    //% v.shadow=\"spriteSpeedPicker\"\n    //% va.shadow=\"spriteSpeedPicker\"\n    //% help=github:pxt-raycasting/docs/move-with-controller\n    export function moveWithController(v: number = 2, va: number = 3, cameraSway?: number) {\n        raycastingRender.velocity = v\n        raycastingRender.velocityAngle = va\n        if (cameraSway != undefined)\n            raycastingRender.cameraSway = cameraSway | 0\n    }\n\n    /**\n     * Render takeover all sprites in current scene\n     * Render will call this automatically, but maybe not in time enough.\n     * If you saw sprite draw at its tilemap position on screen, call this just after created the sprite.\n     */\n    //% blockId=rcRender_takeoverSceneSprites \n    //% block=\"takeover sprites in scene\"\n    //% group=\"Advanced\"\n    //% weight=49\n    //% help=github:pxt-raycasting/docs/takeover-scene-sprites\n    export function takeoverSceneSprites() {\n        raycastingRender.takeoverSceneSprites()\n    }\n\n    /**\n     * Run on sprite dirction updated, present view point to Sprite facing dirction, or which angle you see of the sprite.\n     * Just using with other animation extensions, to set proper Image for sprite.\n     * Not required, if you have used the set animations block provided.\n     * @param dir It is a float number, 0~1 corresponds to 0~360, suggest use Math.round(dir*dirAniTotalCount)%dirAniTotalCount to get index of direction\n     */\n    //% blockId=rcRender_registerOnSpriteDirectionUpdateHandler\n    //% block=\"run code when sprite $spr dirction updated to $dir\"\n    //% draggableParameters\n    //% group=\"Advanced\"\n    //% weight=48\n    //% help=github:pxt-raycasting/docs/register-on-sprite-direction-update-handler\n    export function registerOnSpriteDirectionUpdateHandler(handler: (spr: Sprite, dir: number) => void) {\n        raycastingRender.registerOnSpriteDirectionUpdate(handler)\n    }\n}\n","_render_raycasting.ts":"//% shim=pxt::updateScreen\nfunction updateScreen(img: Image) { }\n\nenum ViewMode {\n    //% block=\"TileMap Mode\"\n    tilemapView,\n    //% block=\"Raycasting Mode\"\n    raycastingView,\n}\n\nnamespace Render {\n    const SH = screen.height, SHHalf = SH / 2\n    const SW = screen.width, SWHalf = SW / 2\n    const fpx = 8\n    const fpx_scale = 2 ** fpx\n    function tofpx(n: number) { return (n * fpx_scale) | 0 }\n    const one = 1 << fpx\n    const one2 = 1 << (fpx + fpx)\n    const FPX_MAX = (1 << fpx) - 1\n\n    class MotionSet1D {\n        p: number\n        v: number = 0\n        a: number = 0\n        constructor(public offset: number) {\n            this.p = offset\n        }\n    }\n\n    export const defaultFov = SW / SH / 2  //Wall just fill screen height when standing 1 tile away\n\n    export class RayCastingRender {\n        private tempScreen: Image = image.create(SW, SH)\n\n        velocityAngle: number = 2\n        velocity: number = 3\n        protected _viewMode = ViewMode.raycastingView\n        protected dirXFpx: number\n        protected dirYFpx: number\n        protected planeX: number\n        protected planeY: number\n        protected _angle: number\n        protected _fov: number\n        protected _wallZScale: number = 1\n        cameraSway = 0\n        protected isWalking = false\n        protected cameraOffsetX = 0\n        protected cameraOffsetZ_fpx = 0\n\n        //sprites & accessories\n        sprSelf: Sprite\n        sprites: Sprite[] = []\n        sprites2D: Sprite[] = []\n        spriteParticles: particles.ParticleSource[] = []\n        spriteLikes: SpriteLike[] = []\n        spriteAnimations: Animations[] = []\n        protected spriteMotionZ: MotionSet1D[] = []\n        protected sayRederers: sprites.BaseSpriteSayRenderer[] = []\n        protected sayEndTimes: number[] = []\n\n        //reference\n        protected tilemapScaleSize = 1 << TileScale.Sixteen\n        map: tiles.TileMapData\n        bg: Image\n        textures: Image[]\n        protected oldRender: scene.Renderable\n        protected myRender: scene.Renderable\n\n        //render\n        protected wallHeightInView: number\n        protected wallWidthInView: number\n        protected dist: number[] = []\n        //render perf const\n        cameraRangeAngle: number\n        viewZPos: number\n        selfXFpx: number\n        selfYFpx: number\n\n        //for drawing sprites\n        protected invDet: number //required for correct matrix multiplication\n        camera: scene.Camera\n        tempSprite: Sprite = sprites.create(img`0`)\n        protected transformX: number[] = []\n        protected transformY: number[] = []\n        protected angleSelfToSpr: number[] = []\n\n        onSpriteDirectionUpdateHandler: (spr: Sprite, dir: number) => void\n\n        get xFpx(): number {\n            return Fx.add(this.sprSelf._x, Fx.div(this.sprSelf._width, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        // set xFpx(v: number) {\n        //     this.sprSelf._x = v * this.tilemapScaleSize as any as Fx8\n        // }\n\n        get yFpx(): number {\n            return Fx.add(this.sprSelf._y, Fx.div(this.sprSelf._height, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        // set yFpx(v: number) {\n        //     this.sprSelf._y = v * this.tilemapScaleSize as any as Fx8\n        // }\n\n        get dirX(): number {\n            return this.dirXFpx / fpx_scale\n        }\n\n        get dirY(): number {\n            return this.dirYFpx / fpx_scale\n        }\n\n        set dirX(v: number) {\n            this.dirXFpx = v * fpx_scale\n        }\n\n        set dirY(v: number) {\n            this.dirYFpx = v * fpx_scale\n        }\n\n        sprXFx8(spr: Sprite) {\n            return Fx.add(spr._x, Fx.div(spr._width, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        sprYFx8(spr: Sprite) {\n            return Fx.add(spr._y, Fx.div(spr._height, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        get fov(): number {\n            return this._fov\n        }\n\n        set fov(fov: number) {\n            this._fov = fov\n            this.wallHeightInView = (SW << (fpx - 1)) / this._fov\n            this.wallWidthInView = this.wallHeightInView >> fpx // not fpx  // wallSize / this.fov * 4 / 3 * 2\n            this.cameraRangeAngle = Math.atan(this.fov) + .1 //tolerance for spr center just out of camera\n\n            this.setVectors()\n        }\n\n        get viewAngle(): number {\n            return this._angle\n        }\n        set viewAngle(angle: number) {\n            this._angle = angle\n            this.setVectors()\n            this.updateSelfImage()\n        }\n\n        get wallZScale(): number {\n            return this._wallZScale\n        }\n        set wallZScale(v: number) {\n            this._wallZScale = v\n        }\n\n        getMotionZ(spr: Sprite, offsetZ: number = 0) {\n            let motionZ = this.spriteMotionZ[spr.id]\n            if (!motionZ) {\n                motionZ = new MotionSet1D(tofpx(offsetZ))\n                this.spriteMotionZ[spr.id] = motionZ\n            }\n            return motionZ\n        }\n\n        getZOffset(spr: Sprite) {\n            return this.getMotionZ(spr).offset / fpx_scale\n        }\n\n        setZOffset(spr: Sprite, offsetZ: number, duration: number = 500) {\n            const motionZ = this.getMotionZ(spr, offsetZ)\n\n            motionZ.offset = tofpx(offsetZ)\n            if (motionZ.p != motionZ.offset) {\n                if (duration === 0)\n                    motionZ.p = motionZ.offset\n                else if (motionZ.v == 0)\n                    this.move(spr, (motionZ.offset - motionZ.p) / fpx_scale * 1000 / duration, 0)\n            }\n        }\n\n        getMotionZPosition(spr: Sprite) {\n            return this.getMotionZ(spr).p / fpx_scale\n        }\n\n        //todo, use ZHeight(set from sprite.Height when takeover, then sprite.Height will be replace with width)\n        isOverlapZ(sprite1: Sprite, sprite2: Sprite): boolean {\n            const p1 = this.getMotionZPosition(sprite1)\n            const p2 = this.getMotionZPosition(sprite2)\n            if (p1 < p2) {\n                if (p1 + sprite1.height > p2) return true\n            } else {\n                if (p2 + sprite2.height > p1) return true\n            }\n            return false\n        }\n\n        move(spr: Sprite, v: number, a: number) {\n            const motionZ = this.getMotionZ(spr)\n\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        jump(spr: Sprite, v: number, a: number) {\n            const motionZ = this.getMotionZ(spr)\n            if (motionZ.p != motionZ.offset)\n                return\n\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        jumpWithHeightAndDuration(spr: Sprite, height: number, duration: number) {\n            const motionZ = this.getMotionZ(spr)\n            if (motionZ.p != motionZ.offset)\n                return\n\n            // height= -v*v/a/2\n            // duration = -v/a*2 *1000\n            const v = height * 4000 / duration\n            const a = -v * 2000 / duration\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        get viewMode(): ViewMode {\n            return this._viewMode\n        }\n\n        set viewMode(v: ViewMode) {\n            this._viewMode = v\n        }\n\n        updateViewZPos() {\n            this.viewZPos = this.spriteMotionZ[this.sprSelf.id].p + (this.sprSelf._height as any as number) - (2 << fpx)\n        }\n\n        takeoverSceneSprites() {\n            const sc_allSprites = game.currentScene().allSprites\n            for (let i = 0; i < sc_allSprites.length;) {\n                const spr = sc_allSprites[i]\n                if (spr instanceof Sprite) {\n                    const sprList = (spr.flags & sprites.Flag.RelativeToCamera) ? this.sprites2D : this.sprites\n                    if (sprList.indexOf(spr) < 0) {\n                        sprList.push(spr as Sprite)\n                        this.getMotionZ(spr, 0)\n                        spr.onDestroyed(() => {\n                            this.sprites.removeElement(spr as Sprite)   //can be in one of 2 lists\n                            this.sprites2D.removeElement(spr as Sprite) //can be in one of 2 lists\n                            const sayRenderer = this.sayRederers[spr.id]\n                            if (sayRenderer) {\n                                this.sayRederers.removeElement(sayRenderer)\n                                sayRenderer.destroy()\n                            }\n                        })\n                    }\n                } else if (spr instanceof particles.ParticleSource) {\n                    const particle = (spr as particles.ParticleSource)\n                    if (this.spriteParticles.indexOf(particle) < 0) {\n                        this.spriteParticles[(particle.anchor as Sprite).id] = particle\n                        particle.anchor = this.tempSprite\n                    }\n                } else {\n                    if (this.spriteLikes.indexOf(spr) < 0)\n                        this.spriteLikes.push(spr)\n                }\n                sc_allSprites.removeElement(spr)\n            }\n            this.sprites.forEach((spr) => {\n                if (spr)\n                    this.takeoverSayRenderOfSprite(spr)\n            })\n        }\n        takeoverSayRenderOfSprite(sprite: Sprite) {\n            const sprite_as_any = (sprite as any)\n            if (sprite_as_any.sayRenderer) {\n                this.sayRederers[sprite.id] = sprite_as_any.sayRenderer\n                this.sayEndTimes[sprite.id] = sprite_as_any.sayEndTime;\n                sprite_as_any.sayRenderer = undefined\n                sprite_as_any.sayEndTime = undefined\n            }\n        }\n\n        tilemapLoaded() {\n            const sc = game.currentScene()\n            this.map = sc.tileMap.data\n            this.textures = sc.tileMap.data.getTileset()\n            this.tilemapScaleSize = 1 << sc.tileMap.data.scale\n            this.oldRender = sc.tileMap.renderable\n            this.spriteLikes.removeElement(this.oldRender)\n            sc.allSprites.removeElement(this.oldRender)\n\n            let frameCallback_update = sc.eventContext.registerFrameHandler(scene.PRE_RENDER_UPDATE_PRIORITY + 1, () => {\n                const dt = sc.eventContext.deltaTime;\n                // sc.camera.update();  // already did in scene\n                for (const s of this.sprites)\n                    s.__update(sc.camera, dt);\n                this.sprSelf.__update(sc.camera, dt)\n            })\n\n            let frameCallback_draw = sc.eventContext.registerFrameHandler(scene.RENDER_SPRITES_PRIORITY + 1, () => {\n                if (this._viewMode == ViewMode.tilemapView) {\n                   // screen.drawImage(sc.background.image, 0, 0)\n                    this.oldRender.__drawCore(sc.camera)\n                    this.sprites.forEach(spr => spr.__draw(sc.camera))\n                    this.sprSelf.__draw(sc.camera)\n                } else {\n                 //   this.tempScreen.drawImage(sc.background.image, 0, 0)\n                    //debug\n                    // const ms=control.micros()\n                    this.render()\n                    // info.setScore(control.micros()-ms)\n                    screen.fill(0)\n                }\n                this.sprites2D.forEach(spr => spr.__draw(sc.camera))\n                this.spriteLikes.forEach(spr => spr.__draw(sc.camera))\n                if (this._viewMode == ViewMode.raycastingView)\n                    this.tempScreen.drawTransparentImage(screen, 0, 0)\n            })\n\n            sc.tileMap.addEventListener(tiles.TileMapEvent.Unloaded, data => {\n                sc.eventContext.unregisterFrameHandler(frameCallback_update)\n                sc.eventContext.unregisterFrameHandler(frameCallback_draw)\n            })\n\n            // this.myRender = scene.createRenderable(\n            //     scene.TILE_MAP_Z,\n            //     (t, c) => this.trace(t, c)\n            // )\n\n        }\n\n        constructor() {\n            this._angle = 0\n            this.fov = defaultFov\n            this.camera = new scene.Camera()\n\n            const sc = game.currentScene()\n            if (!sc.tileMap) {\n                sc.tileMap = new tiles.TileMap();\n            } else {\n                this.tilemapLoaded()\n            }\n            game.currentScene().tileMap.addEventListener(tiles.TileMapEvent.Loaded, data => this.tilemapLoaded())\n\n            //self sprite\n            this.sprSelf = sprites.create(image.create(this.tilemapScaleSize >> 1, this.tilemapScaleSize >> 1), SpriteKind.Player)\n            this.takeoverSceneSprites()\n            this.sprites.removeElement(this.sprSelf)\n            this.updateViewZPos()\n            scene.cameraFollowSprite(this.sprSelf)\n            this.updateSelfImage()\n\n            game.onUpdate(function () {\n                this.updateControls()\n            })\n\n            game.onUpdateInterval(400, () => {\n                for (let i = 0; i < this.sprites.length;) {\n                    const spr = this.sprites[i]\n                    if (spr.flags & sprites.Flag.RelativeToCamera) {\n                        this.sprites.removeElement(spr)\n                        this.sprites2D.push(spr)\n                    } else { i++ }\n                }\n                for (let i = 0; i < this.sprites2D.length;) {\n                    const spr = this.sprites2D[i]\n                    if (!(spr.flags & sprites.Flag.RelativeToCamera)) {\n                        this.sprites2D.removeElement(spr)\n                        this.sprites.push(spr)\n                    } else { i++ }\n                }\n                this.takeoverSceneSprites() // in case some one new\n            })\n\n\n            game.onUpdateInterval(25, () => {\n                if (this.cameraSway && this.isWalking) {\n                    this.cameraOffsetX = (Math.sin(control.millis() / 150) * this.cameraSway * 3) | 0\n                    this.cameraOffsetZ_fpx = tofpx(Math.cos(control.millis() / 75) * this.cameraSway) | 0\n                }\n            });\n            control.__screen.setupUpdate(() => {\n                if (this.viewMode == ViewMode.raycastingView)\n                    updateScreen(this.tempScreen)\n                else\n                    updateScreen(screen)\n            })\n\n            game.addScenePushHandler((oldScene) => {\n                control.__screen.setupUpdate(() => { updateScreen(screen) })\n            })\n            game.addScenePopHandler((oldScene) => {\n                control.__screen.setupUpdate(() => {\n                    if (this.viewMode == ViewMode.raycastingView)\n                        updateScreen(this.tempScreen)\n                    else\n                        updateScreen(screen)\n                })\n            })\n        }\n\n        private setVectors() {\n            const sin = Math.sin(this._angle)\n            const cos = Math.cos(this._angle)\n            this.dirXFpx = tofpx(cos)\n            this.dirYFpx = tofpx(sin)\n            this.planeX = tofpx(sin * this._fov)\n            this.planeY = tofpx(cos * -this._fov)\n        }\n\n        //todo, pre-drawn dirctional image\n        public updateSelfImage() {\n            const img = this.sprSelf.image\n            img.fill(6)\n            const arrowLength = img.width / 2\n            img.drawLine(arrowLength, arrowLength, arrowLength + this.dirX * arrowLength, arrowLength + this.dirY * arrowLength, 2)\n            img.fillRect(arrowLength - 1, arrowLength - 1, 2, 2, 2)\n        }\n\n        updateControls() {\n            if (this.velocityAngle !== 0) {\n                const dx = controller.dx(this.velocityAngle)\n                if (dx) {\n                    this.viewAngle += dx\n                }\n            }\n            if (this.velocity !== 0) {\n                this.isWalking = true\n                const dy = controller.dy(this.velocity)\n                if (dy) {\n                    const nx = this.xFpx - Math.round(this.dirXFpx * dy)\n                    const ny = this.yFpx - Math.round(this.dirYFpx * dy)\n                    this.sprSelf.setPosition((nx * this.tilemapScaleSize / fpx_scale), (ny * this.tilemapScaleSize / fpx_scale))\n                } else {\n                    this.isWalking = false\n                }\n            }\n\n            for (const spr of this.sprites) {\n                this.updateMotionZ(spr)\n            }\n            this.updateMotionZ(this.sprSelf)\n        }\n\n        updateMotionZ(spr: Sprite) {\n            const dt = game.eventContext().deltaTime\n            const motionZ = this.spriteMotionZ[spr.id]\n            //if (!motionZ) continue\n\n            if (motionZ.v != 0 || motionZ.p != motionZ.offset) {\n                motionZ.v += motionZ.a * dt, motionZ.p += motionZ.v * dt\n                //landing\n                if ((motionZ.a >= 0 && motionZ.v > 0 && motionZ.p > motionZ.offset) ||\n                    (motionZ.a <= 0 && motionZ.v < 0 && motionZ.p < motionZ.offset)) { motionZ.p = motionZ.offset, motionZ.v = 0 }\n                if (spr === this.sprSelf)\n                    this.updateViewZPos()\n            }\n\n        }\n\n\n        blitRowBreak(screenX: number, screenUp: number, screenDown: number, source: Image, sourceX: number, sourceYBreak: number) {\n\n            let stepY = (sourceYBreak) / (SHHalf - screenUp )\n            let sourceY = sourceYBreak - stepY\n            let y = SHHalf -1\n            if (screenUp < 0)\n                screenUp = 0\n            while (y  >= Math.ceil(screenUp)-1) {\n                if (sourceY < 0) \n                    sourceY = 0\n                const c = source.getPixel(sourceX, sourceY)\n                this.tempScreen.setPixel(screenX, y, c)\n                y--\n                sourceY -= stepY\n            }\n            // from screen half  going down\n            stepY = (source.height - sourceYBreak) / (screenDown - SHHalf)\n            sourceY = sourceYBreak \n            y = SHHalf\n            if (screenDown > SH)\n                screenDown = SH\n            while (y < Math.round(screenDown)) {\n                const c = source.getPixel(sourceX, sourceY)\n                this.tempScreen.setPixel(screenX, y, c)\n                y++\n                sourceY += stepY\n            }\n\n        }\n        \n        render() {\n            // based on https://lodev.org/cgtutor/raycasting.html\n            this.selfXFpx = this.xFpx\n            this.selfYFpx = this.yFpx\n\n            let drawStart = 0\n            let drawHeight = 0\n            let lastDist = -1, lastTexX = -1, lastMapX = -1, lastMapY = -1\n            this.viewZPos = this.spriteMotionZ[this.sprSelf.id].p + (this.sprSelf._height as any as number) - (2 << fpx) + this.cameraOffsetZ_fpx\n            let cameraRangeAngle = Math.atan(this.fov) + .1 //tolerance for spr center just out of camera\n            //debug\n            // const ms=control.millis()\n\n            \n\n\n            const tex = this.textures[1]\n            let rayDirX0 = this.dirXFpx / fpx_scale + (this.planeX / fpx_scale)\n            let rayDirY0 = this.dirYFpx / fpx_scale + (this.planeY / fpx_scale)\n            let rayDirX1 = this.dirXFpx / fpx_scale - (this.planeX / fpx_scale)\n            let rayDirY1 = this.dirYFpx / fpx_scale - (this.planeY / fpx_scale)\n            let fmapX = this.selfXFpx / fpx_scale\n            let fmapY = this.selfYFpx / fpx_scale\n\n            const sc = game.currentScene() \n           // background\n            const speed = 2 // 2: normal speed\n            let backgroundOffset = (this._angle / Math.PI * speed ) % 1  // range -1..1\n            if (backgroundOffset < 0) backgroundOffset++  // range 0..1\n            backgroundOffset *= SW    // range 0..screenwidth\n            \n            //floor\n            for (let y = 60; y < SH; y++) {\n                let p = y - SHHalf\n                let posZ = SH * this.viewZPos / this.tilemapScaleSize / fpx_scale\n                let rowDistance = posZ / p\n                let floorStepX = rowDistance * (rayDirX1 - rayDirX0) / SW\n                let floorStepY = rowDistance * (rayDirY1 - rayDirY0) / SW\n\n\n\n                let floorX = fmapX + rowDistance * rayDirX0\n                let floorY = fmapY + rowDistance * rayDirY0\n                for (let x = 0; x < SW; x++) {\n                      let cellX = Math.floor(floorX)\n                     let cellY = Math.floor(floorY)\n                    let tx =  (16 * (floorX - cellX)) & 15\n                      let ty = (16 * (floorY - cellY)) & (15)\n                    let mapX = Math.round(floorX - 0.5) % 16\n                    let mapY = Math.round(floorY - 0.5) % 16\n                    let tileType = this.map.getTile(mapX, mapY)\n                    let floorTex = this.textures[tileType]\n                    floorX += floorStepX\n                    floorY += floorStepY\n                    let c = floorTex.getPixel(tx, ty)\n                    this.tempScreen.setPixel(x, y, c)\n\n                }\n\n\n\n            }\n            // walls\n\n            for (let x = 0; x < SW; x++) {\n                const cameraX: number = one - Math.idiv(((x + this.cameraOffsetX) << fpx) << 1, SW)\n                let rayDirX = this.dirXFpx + (this.planeX * cameraX >> fpx)\n                let rayDirY = this.dirYFpx + (this.planeY * cameraX >> fpx)\n\n                // avoid division by zero\n                if (rayDirX == 0) rayDirX = 1\n                if (rayDirY == 0) rayDirY = 1\n\n                let mapX = this.selfXFpx >> fpx\n                let mapY = this.selfYFpx >> fpx\n\n                // length of ray from current position to next x or y-side\n                let sideDistX = 0, sideDistY = 0\n\n                // length of ray from one x or y-side to next x or y-side\n                const deltaDistX = Math.abs(Math.idiv(one2, rayDirX));\n                const deltaDistY = Math.abs(Math.idiv(one2, rayDirY));\n\n                let mapStepX = 0, mapStepY = 0\n\n                let sideWallHit = false;\n\n                //calculate step and initial sideDist\n                if (rayDirX < 0) {\n                    mapStepX = -1;\n                    sideDistX = ((this.selfXFpx - (mapX << fpx)) * deltaDistX) >> fpx;\n                } else {\n                    mapStepX = 1;\n                    sideDistX = (((mapX << fpx) + one - this.selfXFpx) * deltaDistX) >> fpx;\n                }\n                if (rayDirY < 0) {\n                    mapStepY = -1;\n                    sideDistY = ((this.selfYFpx - (mapY << fpx)) * deltaDistY) >> fpx;\n                } else {\n                    mapStepY = 1;\n                    sideDistY = (((mapY << fpx) + one - this.selfYFpx) * deltaDistY) >> fpx;\n                }\n\n                let color = 0\n\n                while (true) {\n                    //jump to next map square, OR in x-direction, OR in y-direction\n                    if (sideDistX < sideDistY) {\n                        sideDistX += deltaDistX;\n                        mapX += mapStepX;\n                        sideWallHit = false;\n                    } else {\n                        sideDistY += deltaDistY;\n                        mapY += mapStepY;\n                        sideWallHit = true;\n                    }\n\n                    if (this.map.isOutsideMap(mapX, mapY))\n                        break\n                    color = this.map.getTile(mapX, mapY)\n                    if  (this.map.isWall(mapX, mapY))\n                        break; // hit!\n                }\n\n                if (this.map.isOutsideMap(mapX, mapY))\n                    continue\n\n                let perpWallDist = 0\n                let wallX = 0\n                if (!sideWallHit) {\n                    perpWallDist = Math.idiv(((mapX << fpx) - this.selfXFpx + (1 - mapStepX << fpx - 1)) << fpx, rayDirX)\n                    wallX = this.selfYFpx + (perpWallDist * rayDirY >> fpx);\n                } else {\n                    perpWallDist = Math.idiv(((mapY << fpx) - this.selfYFpx + (1 - mapStepY << fpx - 1)) << fpx, rayDirY)\n                    wallX = this.selfXFpx + (perpWallDist * rayDirX >> fpx);\n                }\n                wallX &= FPX_MAX\n\n                // color = (color - 1) * 2\n                // if (sideWallHit) color++\n\n                const tex = this.textures[color]\n                if (!tex)\n                    continue\n\n                let texX = (wallX * tex.width) >> fpx;\n                // if ((!sideWallHit && rayDirX > 0) || (sideWallHit && rayDirY < 0))\n                //     texX = tex.width - texX - 1;\n\n                const lineHeight = (this.wallHeightInView / perpWallDist)\n                const drawEnd = lineHeight * this.viewZPos / this.tilemapScaleSize / fpx_scale;\n                const horizontBreak = 1 - this.viewZPos / this.tilemapScaleSize / fpx_scale;\n                if (perpWallDist !== lastDist && (texX !== lastTexX || mapX !== lastMapX || mapY !== lastMapY)) {//neighbor line of tex share same parameters\n                     \n                    drawStart = drawEnd - lineHeight * (this._wallZScale) ;\n                    drawHeight = (Math.ceil(drawEnd) - Math.ceil(drawStart) )\n                    drawStart += (SH >> 1)\n\n                    lastDist = perpWallDist\n                    lastTexX = texX\n                    lastMapX = mapX\n                    lastMapY = mapY\n                }\n                //fix start&end points to avoid regmatic between lines\n               \n\n                //if (x < SWHalf)\n                //    this.tempScreen.blitRow(x, drawStart, tex, texX, drawHeight)\n                //else\n                    this.blitRowBreak(x, SHHalf + drawEnd - lineHeight, SHHalf + drawEnd, tex, texX, tex.height * horizontBreak)\n\n                this.dist[x] = perpWallDist\n\n                // background \n                for (let y = 0; y < drawStart; y++ ){\n                    let backX = (backgroundOffset + x) % SW\n                    let c = sc.background.image.getPixel(backX,y)\n                    this.tempScreen.setPixel(x,y,c)\n                }\n            }\n            //debug\n            // info.setScore(control.millis()-ms)\n           // this.tempScreen.print(backgroundOffset.toString(), 0,0,7 )\n           // this.tempScreen.print([Math.roundWithPrecision(this._angle, 3)].join(), 20, 5)\n\n            this.drawSprites()\n        }\n\n        drawSprites() {\n            //debug\n            // let msSprs=control.millis()\n            /////////////////// sprites ///////////////////\n\n            //for sprite\n            const invDet = one2 / (this.planeX * this.dirYFpx - this.dirXFpx * this.planeY); //required for correct matrix multiplication\n\n            this.sprites\n                .filter((spr, i) => {\n                    const spriteX = this.sprXFx8(spr) - this.xFpx // this.selfXFpx\n                    const spriteY = this.sprYFx8(spr) - this.yFpx // this.selfYFpx\n                    this.angleSelfToSpr[spr.id] = Math.atan2(spriteX, spriteY)\n                    this.transformX[spr.id] = invDet * (this.dirYFpx * spriteX - this.dirXFpx * spriteY) >> fpx;\n                    this.transformY[spr.id] = invDet * (-this.planeY * spriteX + this.planeX * spriteY) >> fpx; //this is actually the depth inside the screen, that what Z is in 3D\n                    const angleInCamera = Math.atan2(this.transformX[spr.id] * this.fov, this.transformY[spr.id])\n                    return angleInCamera > -this.cameraRangeAngle && angleInCamera < this.cameraRangeAngle //(this.transformY[spr.id] > 0\n                }).sort((spr1, spr2) => {   // far to near\n                    return (this.transformY[spr2.id] - this.transformY[spr1.id])\n                }).forEach((spr, index) => {\n                    //debug\n                    // this.tempScreen.print([spr.id,Math.roundWithPrecision(angle[spr.id],3)].join(), 0, index * 10 + 10,9)\n                    this.drawSprite(spr, index, this.transformX[spr.id], this.transformY[spr.id], this.angleSelfToSpr[spr.id])\n                })\n\n            //debug\n            // info.setLife(control.millis() - msSprs+1)\n             //this.tempScreen.print([Math.roundWithPrecision(this._angle,3)].join(), 20,  0)\n\n        }\n\n        registerOnSpriteDirectionUpdate(handler: (spr: Sprite, dir: number) => void) {\n            this.onSpriteDirectionUpdateHandler = handler\n        }\n\n        drawSprite(spr: Sprite, index: number, transformX: number, transformY: number, myAngle: number) {\n            const spriteScreenX = Math.ceil((SWHalf) * (1 - transformX / transformY)) - this.cameraOffsetX;\n            const spriteScreenHalfWidth = Math.idiv((spr._width as any as number) / this.tilemapScaleSize / 2 * this.wallWidthInView, transformY)  //origin: (texSpr.width / 2 << fpx) / transformY / this.fov / 3 * 2 * 4\n            const spriteScreenLeft = spriteScreenX - spriteScreenHalfWidth\n            const spriteScreenRight = spriteScreenX + spriteScreenHalfWidth\n\n            //calculate drawing range in X direction\n            //assume there is one range only\n            let blitX = 0, blitWidth = 0\n            for (let sprX = 0; sprX < SW; sprX++) {\n                if (this.dist[sprX] > transformY) {\n                    if (blitWidth == 0)\n                        blitX = sprX\n                    blitWidth++\n                } else if (blitWidth > 0) {\n                    if (blitX <= spriteScreenRight && blitX + blitWidth >= spriteScreenLeft)\n                        break\n                    else\n                        blitX = 0, blitWidth = 0;\n                }\n            }\n            // this.tempScreen.print([this.getxFx8(spr), this.getyFx8(spr)].join(), 0,index*10+10)\n            const blitXSpr = Math.max(blitX, spriteScreenLeft)\n            const blitWidthSpr = Math.min(blitX + blitWidth, spriteScreenRight) - blitXSpr\n            if (blitWidthSpr <= 0)\n                return\n\n            const lineHeight = Math.idiv(this.wallHeightInView, transformY)\n            const drawStart = SHHalf + (lineHeight * ((this.viewZPos - this.spriteMotionZ[spr.id].p - (spr._height as any as number)) / this.tilemapScaleSize) >> fpx)\n\n            //for textures=image[][], abandoned\n            //    const texSpr = spr.getTexture(Math.floor(((Math.atan2(spr.vxFx8, spr.vyFx8) - myAngle) / Math.PI / 2 + 2-.25) * spr.textures.length +.5) % spr.textures.length)\n            //for deal in user code\n            if (this.onSpriteDirectionUpdateHandler)\n                this.onSpriteDirectionUpdateHandler(spr, ((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25))\n            //for CharacterAnimation ext.\n            //     const iTexture = Math.floor(((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25) * 4 + .5) % 4\n            //     const characterAniDirs = [Predicate.MovingLeft,Predicate.MovingDown, Predicate.MovingRight, Predicate.MovingUp]\n            //     character.setCharacterState(spr, character.rule(characterAniDirs[iTexture]))\n            //for this.spriteAnimations\n            const texSpr = !this.spriteAnimations[spr.id] ? spr.image : this.spriteAnimations[spr.id].getFrameByDir(((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25))\n\n            const sprTexRatio = texSpr.width / spriteScreenHalfWidth / 2\n            helpers.imageBlit(\n                this.tempScreen,\n                blitXSpr,\n                drawStart,\n                blitWidthSpr,\n                lineHeight * spr.height / this.tilemapScaleSize,\n                texSpr,\n                (blitXSpr - (spriteScreenX - spriteScreenHalfWidth)) * sprTexRatio\n                ,\n                0,\n                blitWidthSpr * sprTexRatio, texSpr.height, true, false)\n\n            screen.fill(0)\n            const fpx_div_transformy = Math.roundWithPrecision(transformY / 4 / fpx_scale, 2)\n            const height = (SH / fpx_div_transformy)\n            const blitXSaySrc = ((blitX - spriteScreenX) * fpx_div_transformy) + SWHalf\n            const blitWidthSaySrc = (blitWidth * fpx_div_transformy)\n\n            //sprite\n            // screen.drawImage(texSpr, SWHalf-texSpr.width/2, SHHalf)\n            //sayText\n            const sayRender = this.sayRederers[spr.id]\n            if (sayRender) {\n                if (this.sayEndTimes[spr.id] && control.millis() > this.sayEndTimes[spr.id]) {\n                    this.sayRederers[spr.id] = undefined\n                } else {\n                    this.tempSprite.x = SWHalf\n                    this.tempSprite.y = SHHalf + 2\n                    this.camera.drawOffsetX = 0\n                    this.camera.drawOffsetY = 0\n                    sayRender.draw(screen, this.camera, this.tempSprite)\n                }\n            }\n            //particle\n            const particle = this.spriteParticles[spr.id]\n            if (particle) {\n                if (particle.lifespan) {\n                    //debug\n                    // this.tempScreen.print([spr.id].join(), 0,index*10+10)\n                    this.tempSprite.x = SWHalf\n                    this.tempSprite.y = SHHalf + spr.height\n                    this.camera.drawOffsetX = 0//spr.x-SWHalf\n                    this.camera.drawOffsetY = 0//spr.y-SH\n                    particle.__draw(this.camera)\n                } else {\n                    this.spriteParticles[spr.id] = undefined\n                }\n            }\n            //update screen for this spr\n            // const sayTransformY = \n            if (blitXSaySrc <= 0) { //imageBlit considers negative value as 0\n                helpers.imageBlit(\n                    this.tempScreen,\n                    spriteScreenX - SWHalf / fpx_div_transformy, drawStart - height / 2, (blitWidthSaySrc + blitXSaySrc) / fpx_div_transformy, height,\n                    screen,\n                    0, 0, blitWidthSaySrc + blitXSaySrc, SH, true, false)\n            } else {\n                helpers.imageBlit(\n                    this.tempScreen,\n                    // blitX, drawStart - height / 2 , blitWidth, height,\n                    blitX, drawStart - height / 2, blitWidth, height,\n                    screen,\n                    blitXSaySrc, 0, blitWidthSaySrc, SH,\n                    true, false)\n            }\n        }\n    }\n\n    //%fixedinstance\n    export const raycastingRender = new Render.RayCastingRender()\n}\n\n","tilemap.g.jres":"{\n    \"transparency16\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true\n    },\n    \"tile1\": {\n        \"data\": \"hwQQABAAAABBbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfQ==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile\"\n    },\n    \"level1\": {\n        \"id\": \"level1\",\n        \"mimeType\": \"application/mkcd-tilemap\",\n        \"data\": \"MTAxMDAwMTAwMDAyMDIwMjAyMDIyMDIwMWYxZjFmMWYxZjIwMjAyMDIwMDEyMTIxMjExNjE2MGEwYTA1MGEwNTBhMGEwNTBhMjAwMjA2MTkwNzE2MGEwNTA1MDUwNTA1MDUwNjA3MGEyMDAxMDkwOTA5MTkwNzA1MTYwNTA1MDUwNTA5MDgwNTFmMDEwOTE4MTUxNTE1MDUxNjAxMDkwOTA1MGIwYTBhMWYwMTA5MTQyMTIxMWEwNTE2MDEwOTA5MDUwYjA1MDUxZjIwMDkxNDIxMTYxNjA1MTYwMTA5MDkwNTBiMDUwNTIwMWYwOTE3MTUxNTE1MDUwOTA5MDkwOTA1MDUwNTBhMjAxZjA5MDIxNjBhMTYwNTE2MDMwYzBjMGMwZDA1MGQyMjFmMDkwMTE2MTYxNjA1MTYwMzIxMjEyMTBjMDUwYzIzMDQwOTAxMTYwNTA1MDUxNjIxMjEyMTIxMGMwNTFlMjQwNDA5MDExNjA1MTYwOTE2MGQwYzBjMGMwYzA1MGMxYjA0MDkwMTAxMDUwOTA5MGUwZjEwMGMwYzBkMDUwZDFjMDQwOTA5MDkwNTA1MDUwNTA1MDUwNTA1MDUwNTBjMjQwNDIxMDkwOTA5MDkwOTEyMTExMzBjMGMwZDBjMGMxYzIwMjAyMDIwMjAyMDIwMjAyMDIwMjAxZDFjMjQxYzFjMjIyMjIyMjIyMjIyMjIyMjIyMjIwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDIwMDAwMjAwMjIwMDIwMDAyMDAwMDIwMDIyMDAwMDAwMjAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAyMDAwMDAyMDAwMDIwMDIwMjAwMDAyMjIyMDAyMDAyMDIwMDAwMjIyMjAwMjAwMjAyMDAwMDAwMDAwMDIwMDIyMjAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAyMjAwMDAwMDAwMDAwMDIwMjIyMjIyMjIyMjIyMjIyMg==\",\n        \"tileset\": [\n            \"myTiles.transparency16\",\n            \"sprites.dungeon.floorDark0\",\n            \"sprites.dungeon.floorDark2\",\n            \"sprites.dungeon.greenOuterNorth0\",\n            \"sprites.dungeon.stairWest\",\n            \"sprites.castle.tileGrass1\",\n            \"sprites.castle.tilePath1\",\n            \"sprites.castle.tilePath3\",\n            \"sprites.castle.tilePath9\",\n            \"sprites.castle.tilePath5\",\n            \"sprites.castle.tileGrass2\",\n            \"sprites.castle.tilePath6\",\n            \"sprites.castle.tileDarkGrass1\",\n            \"sprites.castle.tileDarkGrass2\",\n            \"sprites.builtin.forestTiles5\",\n            \"sprites.builtin.forestTiles6\",\n            \"sprites.builtin.forestTiles7\",\n            \"sprites.builtin.forestTiles10\",\n            \"sprites.builtin.forestTiles13\",\n            \"sprites.builtin.forestTiles15\",\n            \"sprites.vehicle.roadVertical\",\n            \"sprites.vehicle.roadHorizontal\",\n            \"sprites.castle.tileGrass3\",\n            \"sprites.vehicle.roadTurn3\",\n            \"sprites.vehicle.roadTurn1\",\n            \"sprites.castle.tilePath2\",\n            \"sprites.castle.tilePath8\",\n            \"sprites.builtin.forestTiles21\",\n            \"sprites.builtin.forestTiles22\",\n            \"sprites.builtin.forestTiles23\",\n            \"sprites.castle.tileDarkGrass3\",\n            \"sprites.dungeon.doorOpenNorth\",\n            \"sprites.dungeon.floorLight0\",\n            \"sprites.builtin.forestTiles0\",\n            \"sprites.builtin.forestTiles1\",\n            \"sprites.builtin.forestTiles2\",\n            \"sprites.builtin.forestTiles4\"\n        ],\n        \"displayName\": \"level\"\n    },\n    \"*\": {\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"dataEncoding\": \"base64\",\n        \"namespace\": \"myTiles\"\n    }\n}","tilemap.g.ts":"","pxt.json":"{\n    \"name\": \"3d floor and background\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"device\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"assets.json\",\n        \"_animation.ts\",\n        \"_render_blocks.ts\",\n        \"_render_raycasting.ts\",\n        \"tilemap.g.jres\",\n        \"tilemap.g.ts\"\n    ],\n    \"targetVersions\": {\n        \"branch\": \"v1.10.36\",\n        \"tag\": \"v1.10.36\",\n        \"commits\": \"https://github.com/microsoft/pxt-arcade/commits/3a5a7e13703edf0412c17bdb9b1469e282a5b31b\",\n        \"target\": \"1.10.36\",\n        \"pxt\": \"8.3.9\"\n    },\n    \"preferredEditor\": \"blocksprj\"\n}\n"}},{"timestamp":1748196209204,"editorVersion":"2.0.56","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddd11111111111111111111111111111111111111111111111111111111111\n111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddddd1111111111111111111111111111111111111111111111111111111111\n11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddddddddd1111111111111111111111111111111111111111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111ddddddddddd1111111111111111111111111111111111111111111111111111111111\n11111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddddddddddddddd11111111111111111111111111ddd111ddd11111111111111111111111\n11111111111111111111111111111111111111111111111111111111111111111111111111111111111111dddddddddddddddd1111111111111111111111111dddddddddd11111111111111111111111\n1111111111111111111111111111111111111111111111111111111111111111111111111111111ddddd11ddddddddddddddddd111111111111111111111ddddddddddddd11111111111111111111111\n111111111111111111111111111111111111111111111111111111111111111111111111111111dddddd11ddddddddddddddddd111111111111111111111dddddddddddddd1111111111111111111111\n11111111111dddddddd111111111111111111111111111111111111111111111111111111ddddddddddd1dddddddddddddddddd111111ddd11111111111dddddddddddddddd1111111111ddd11111111\n1111111111dddddddddd11111111111111111111111111111111111111111111111111111dddddddddddddddddddddddddddddd11111ddddd1111111111dddddddddddddddddd1111111ddddd1111111\n111111ddddddddddddddd1111111111111111111111111111111111111111111111111111dddddddddddddddddddddddddddddd11111ddddd111111111ddddddddddddddddddddd11111ddddd1111111\n111111dddddddddddddddddddd11111111111111111111111111111111111111111111111dddddddddddddddddddddddddddddddd111ddddd111111111ddddddddddddddddddddd1111dddddd1111111\n111111ddddddddddddddddddddd11111111111111111111111dddddddd1111111111d111ddddddddddddddddddddddddddddddddd111dddddd11111111dddddddddddddddddddddd111ddddddd111111\n11111dddddddddddddddddddddddd1111111111111111ddddddddddddd1111111111ddddddddddddddddddddddddddddddddddddd11ddddddd1111111ddddddddddddddddddddddddddddddddd111111\n1dddddddddddddddddddddddddddddd1111111111111dddddddddddddddd11111111ddddddddddddddddddddddddddd6ddddddddd11ddddddd1111111ddddddddddddddddddddddddddddddddddd1111\n1ddddddddddddddddddddddddddddddd1111111111ddddddddddddddddddd111111ddddddddddddddddddddddddddd66dddddddddddddddddd1111111ddddddddddddddddddddddddddddddddddddd11\ndddddddddddddddddddddddddddddddddd1111111dddddddddddddd6dddddd11111ddddddddddddddddddddddddddd66dddddddddddddddddd1111ddddddddddddddddd6dddddddddddddddddddddddd\ndddddddddddddddddddddddddddddddddd11111ddddddddddddddd66dddddd11111dddddddddddddddddddddddddd6666ddddddddddddddddd11dddddddddddddddddd66dddddddddddddddddddddddd\nddddddddddddddddddddddddddddddddddd1dddddddddddddddddd66ddddddd1111dddddddddddddddddddddddd66666ddddddddddddddddddd1dddddddddddddddddd66dddddddddddddddddddddddd\nddddddddddddddddddddddddddddddddddddddddddddddddddddd6666dddddd1111dddddddddddddddddddddddddd666ddddddddddddddddddddddddddddddddddddd6666ddddddddddddddddddddddd\nddddddddddddddd6ddddddddddddddddddddddddddddddddddd66666dddddddddddddddddddddddddddddddddddd66666dddddddddddddddddddddddddddddddddd66666dddddddddddddddddddddddd\ndddddddddddddd66ddddddddddddddddddddddddddddddddddddd666dddddddddddddddddddddddddddddddddddd6666666dddddddddddddddddddddddddddddddddd666ddddddddddddddd9999999dd\ndddddddddddddd66dddddddddddddddddddddddddddddddddddd66666ddddddddddddddddddddd99d99dddddddd666666ddddddddddddddddd999ddddddddddddddd66666dddddddddddd99999999999\n9dddddddddddd6666ddddddddddddddddddddddddddddddddddd6666666ddddddddddddddddd99999999ddddd666666666ddddddd999dddddd999999dddddddddddd6666666ddddddddd999999999999\n999dddddddd66666dddddddddddddddddddddddddd9dddddddd666666ddddddddddddddddd99999999999dddddd66666666ddddd99999999dd9999999dddddddddd666666ddddddddd99999999999999\n9999ddddddddd666ddddddddddddddddd99999999999ddddd666666666dddddddddddddd99999999999999dd996666666dddddd999999999dd9999999dddddddd666666666ddddddd999999999999999\n99999ddddddd66666ddddddddddddddd9999999999999dddddd66666666ddddddddddd9999999999999999999999666666dddd996999999999999999999dddddddd66666666ddddd9999999999999999\n999999dddddd6666666dddddddddddd999999999999999dd996666666ddddddddddd9999999999999999999999666666666dd9996999999999999999999999dd996666666dddddd99999999999999999\n999999ddddd666666dddddddddddd99999999999999999999999666666dddd9969999999999999999999999996666666666699966999999999999999999999999999666666dddd996999999999999999\n999999ddd666666666ddddddd9999999999999999999999999666666666dd999699999999999999999999996666666666699999966999999999999999999999999666666666dd9996999999999999999\n999999ddddd66666666ddddd9999999999999999999999999666666666669996699999999999999999999999966666666699999669999999999999999999999996666666666699966999999999999999\n999999dd996666666dddddd99999999999999999999999966666666666999999669999999999999999999999966666669999996666999999999999999999999666666666669999996699999999999999\n999999999999666666dddd996999999999999999999999999666666666999996699999999999999999999999669666666669966666699999999999999999999996666666669999966999999999999999\n9999999999666666666dd9996999999999999999999999999666666699999966669999999999999999999999996666666666999669999999999999999999999996666666999999666699999999999999\n9999999996666666666699966999999999999999999999996696666666699666666999999999999999999999666666666669966666699999999999999999999966966666666996666669999999999999\n9999999666666666669999996699999999996999999999999966666666669996699999999999699999969996666666666669666666669999999969999999999999666666666699966999999999996999\n9999999996666666669999966999999999996999999999996666666666699666666999999999699999966999996666666666666666999999999969999999999966666666666996666669999999996999\n9996999996666666999999666699999999966699999699966666666666696666666699999996669999669999666666666666666666669999999666999996999666666666666966666666999999966699\n9996699966966666666996666669999999996699999669999966666666666666669999999999669999966996666666666666666666666999999966999996699999666666666666666699999999996699\n9966999999666666666699966999999999966999996699996666666666666666666699999996699999666666666666666666666666699999999669999966999966666666666666666666999999966999\n9996699966666666666996666669999999666699999669966666666666666666666669999966669999966666666666666666666666666999996666999996699666666666666666666666699999666699\n9966669666666666666966666666999999966669996666666666666666666666666999999996666999966666666666666666666666666699999666699966666666666666666666666669999999966669\n9996669999666666666666666699999999666699999666666666666666666666666669999966669999666666666666666666666666669999996666999996666666666666666666666666699999666699\n9996669966666666666666666666999996666669999666666666666666666666666666999666666996666666666666666666666666666699966666699996666666666666666666666666669996666669\n9966669666666666666666666666699999666699996666666666666666666666666699999966669999666666666666666666666666666669996666999966666666666666666666666666999999666699\n9666666666666666666666666669999966666669966666666666666666666666666666996666666999666666666666666666666666666699666666699666666666666666666666666666669966666669\n9966666666666666666666666666699996666666996666666666666666666666666666699666666696666666666666666666666666666669966666669966666666666666666666666666666996666666\n9966666666666666666666666666669966666666996666666666666666666666666666996666666696666666666666666666666666666666666666669966666666666666666666666666669966666666\n6666666666666666666666666666999966666666666666666666666666666666666666696666666666666666666666666666666666666666666666666666666666666666666666666666666966666666\n6666666666666666666666666666669666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666669666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666\n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value></block></next></block></statement></block><block type=\"keyonevent\" x=\"361\" y=\"0\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_toggleViewMode\"></block></statement></block></xml>","main.ts":"","README.md":" ","assets.json":"","_animation.ts":"//////////////////////// animation.ts contents of previous version, just for test.ts here for convenience /////////////////////\n// file contents:\n// directional animations defines for enging_raycasting.ts\n// for convenience, constructed animations as below, which images are builtin in Arcade, \n// in order from easy to complex\n\n// each are 2D Image array, Image[][]: \n// 1st dimension is direction: \n//    length=1 to any, e.g. 1,2,3,4,...,8,..., engine can automatically arange them to 0~360 \n//    order: start from left, then folling with others in CW order\n//    e.g: \n//         2 directions should be [leftAni,RightAni], \n//         4-direction should be [leftAni, frontAni, rightAni, backAni], \n//         8-direction=[l,lf,f,fr,r,rb,b,lb], ...\n//    the reason that directions start from left, is almost all Arcade builtin one side images are facing left, so that would be convient for using.\n// 2nd dimension is animation Images\n//    length=1 to any, e.g. 1,2,3,4,..., engine will automatically loop them by aniInterval(set when create CompactSprite, or use default)\n\n\n//simplest, just one static image, looks the same in all angle of view\nconst texturesDonut = [[sprites.food.smallDonut]]\nconst texturesBigCake = [[sprites.food.bigCake]]\n\n//1-direction, with ani, looks the same Ani in all angle of view\nconst texturesCoin = [[sprites.builtin.coin0, sprites.builtin.coin1, sprites.builtin.coin2, sprites.builtin.coin3, sprites.builtin.coin4, sprites.builtin.coin5]]\n\nconst texturesDog = [[sprites.builtin.dog0, sprites.builtin.dog1, sprites.builtin.dog2]]\nconst texturesDuck = [[sprites.duck.duck1, sprites.duck.duck2, sprites.duck.duck3, sprites.duck.duck4, sprites.duck.duck5, sprites.duck.duck6]]\n\n//2-direction, with ani, looks difference from left or right side\nconst texturesPlane = [[sprites.vehicle.plane0, sprites.vehicle.plane1, sprites.vehicle.plane2, sprites.vehicle.plane3, sprites.vehicle.plane4, sprites.vehicle.plane5],\n[sprites.vehicle.plane0, sprites.vehicle.plane1, sprites.vehicle.plane2, sprites.vehicle.plane3, sprites.vehicle.plane4, sprites.vehicle.plane5]]\n//no right side ani images builtin, so make them from lefts, and then flipX\nimagesFlipX(texturesPlane[1])\n\nconst texturesFish = [[sprites.builtin.angelFish0, sprites.builtin.angelFish1, sprites.builtin.angelFish2, sprites.builtin.angelFish3],\n[sprites.builtin.angelFish0, sprites.builtin.angelFish1, sprites.builtin.angelFish2, sprites.builtin.angelFish3]]\nimagesFlipX(texturesFish[1])\n\n//4-direction\nconst texturesHero = [\n    [sprites.castle.heroWalkSideLeft1, sprites.castle.heroWalkSideLeft2, sprites.castle.heroWalkSideLeft3, sprites.castle.heroWalkSideLeft4],\n    [sprites.castle.heroWalkFront1, sprites.castle.heroWalkFront2, sprites.castle.heroWalkFront3, sprites.castle.heroWalkFront4],\n    [sprites.castle.heroWalkSideRight1, sprites.castle.heroWalkSideRight2, sprites.castle.heroWalkSideRight3, sprites.castle.heroWalkSideRight4],\n    [sprites.castle.heroWalkBack1, sprites.castle.heroWalkBack2, sprites.castle.heroWalkBack3, sprites.castle.heroWalkBack4],\n]\n\nconst texturesPrincess2 = [\n    [sprites.castle.princess2Left1, sprites.castle.princess2Left2],\n    [sprites.castle.princess2WalkFront1, sprites.castle.princess2WalkFront2, sprites.castle.princess2WalkFront3, sprites.castle.princess2WalkFront2],\n    [sprites.castle.princess2Right1, sprites.castle.princess2Right2],\n    [sprites.castle.princess2WalkBack1, sprites.castle.princess2WalkBack2, sprites.castle.princess2WalkBack3, sprites.castle.princess2WalkBack2],\n]\n\n//4-direction, but back side has only 1 image, so no ani when looking from back\nconst texturesSkelly = [\n    [sprites.castle.skellyWalkLeft1, sprites.castle.skellyWalkLeft2],\n    [sprites.castle.skellyWalkFront1, sprites.castle.skellyWalkFront2, sprites.castle.skellyWalkFront3],\n    [sprites.castle.skellyWalkRight1, sprites.castle.skellyWalkRight2],\n    [img`\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ..........ffff..........\n\t        ........ff1111ff........\n\t        .......fb111111bf.......\n\t        .......f11111111f.......\n\t        ......fd11111111df......\n\t        ......fd11111111df......\n\t        ......fd11111111df......\n\t        ......fb11111111bf......\n\t        ......fcd111111dcf......\n\t        .......fb111111bf.......\n\t        .....ffffdb1bdcfff......\n\t        ....fc111cfbfbc111cf....\n\t        ....f11111ffff11111f....\n\t        ....fbfbfbffffffbfbf....\n\t        .........ffffff.........\n\t        ..........fff...........\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ........................\n\t    `],\n]\n\nconst texturesPrincess = [\n    [sprites.castle.princessLeft0, sprites.castle.princessLeft1, sprites.castle.princessLeft0, sprites.castle.princessLeft2],\n    [sprites.castle.princessFront0, sprites.castle.princessFront1, sprites.castle.princessFront0, sprites.castle.princessFront2],\n    [],\n    [sprites.castle.princessBack0, sprites.castle.princessBack1, sprites.castle.princessBack0, sprites.castle.princessBack2],\n]\ntexturesPrincess[0].forEach((v, i) => {\n    texturesPrincess[2].push(v.clone())\n    texturesPrincess[2][i].flipX()\n}\n)\n\nfunction imagesFlipX(ani: Image[]) {\n    ani.forEach((img, i) => {\n        ani[i] = img.clone() //don't worry memery leak or waste, cause old images are still using by left\n        ani[i].flipX()\n    })\n}\n\n//////////////////////// end of animation.ts contents of previous version //////////////\n\n\n","_render_blocks.ts":"enum RCSpriteAttribute {\n    ZOffset,\n    ZPosition,\n    ZVelocity,\n    ZAcceleration\n}\n/**\n * A 2.5D Screen Render, using Raycasting algorithm\n **/\n//% color=#03AA74 weight=1 icon=\"\\uf1b2\" //cube f1b2 , fold f279\n//% groups='[\"Instance\",\"Basic\", \"Dimension Z\", \"Animate\", \"Advanced\"]'\n//% block=\"3D Render\"\nnamespace Render {\n    export enum attribute {\n        dirX,\n        dirY,\n        fov,\n        wallZScale,\n    }\n\n    export class Animations {\n        constructor(public frameInterval: number, public animations: Image[][]) {\n        }\n\n        msLast = 0\n        index = 0\n        iAnimation = 0\n        getFrameByDir(dir: number): Image {\n            if (control.millis() - this.msLast > this.frameInterval) {\n                this.msLast = control.millis()\n                this.index++\n                this.iAnimation = Math.round((dir * this.animations.length)) % this.animations.length\n                if (this.index >= this.animations[this.iAnimation].length)\n                    this.index = 0\n            }\n            return this.animations[this.iAnimation][this.index]\n        }\n    }\n\n    /**\n * Apply a directional image animations on a sprite\n * @param sprite the sprite to animate on\n * @param animations the directional animates\n */\n    //% blockId=set_animation\n    //% block=\"set $sprite=variables_get(mySprite) with animations$animations\"\n    //% animations.shadow=create_animation\n    //% group=\"Animate\"\n    //% weight=100\n    //% help=github:pxt-raycasting/docs/set-sprite-animations\n    export function setSpriteAnimations(sprite: Sprite, animations: Animations) {\n        raycastingRender.spriteAnimations[sprite.id] = animations\n    }\n\n    /**\n * Create a directional image animations, multi animations will applied to one round dirctions averagely, start from the left. \n * The reason that directions start from left, is almost all Arcade out-of-box 1 or 2-dirction images are facing left, so that would be convient for using.\n * @param frameInterval the time between changes, eg: 150\n * @param frames1 animation, if this is the first of multi animation it will be used as left, others will \n * @param frames2 optional, used for 2 or more dirctional\n * @param frames3 optional, used for 3 or more dirctional\n * @param frames4 optional, used for 4 or more dirctional\n */\n    //% blockId=create_animation\n    //% block=\"interval$frameInterval=timePicker animates:$frames1=animation_editor|| $frames2=animation_editor $frames3=animation_editor $frames4=animation_editor\"\n    //% inlineInputMode=inline\n    //% group=\"Animate\"\n    //% weight=100\n    //% help=github:pxt-raycasting/docs/create-animations\n    export function createAnimations(frameInterval: number, frames1: Image[], frames2?: Image[], frames3?: Image[], frames4?: Image[]): Animations {\n        const animationList = [frames1]\n        if (frames2) animationList.push(frames2)\n        if (frames3) animationList.push(frames3)\n        if (frames4) animationList.push(frames4)\n        return new Animations(frameInterval, animationList)\n    }\n\n    /**\n     * Get the Render\n     * @param img the image\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRCRenderInstance block=\"raycasting render\"\n    //% expandableArgumentMode=toggle\n    //% weight=100 \n    //% blockHidden=true\n    //% hidden=1\n    export function getRCRenderInstance(): RayCastingRender {\n        return raycastingRender\n    }\n\n    /**\n     * Get the render Sprite, which create automatically, for physical collisions, and holding the view point.\n     * You can consider it as \"myself\", and operate it like a usual sprite, eg.: position, speed, scale, collision, ...\n     * But properties relative 3D, eg. ZOffset, ZPosition, viewAngle, and etc. are not in the Sprite class.\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRenderSpriteVariable block=\"myself sprite\"\n    //% expandableArgumentMode=toggle\n    //% blockSetVariable=mySprite\n    //% weight=99\n    //% help=github:pxt-raycasting/get-render-sprite-variable\n    export function getRenderSpriteVariable(): Sprite {\n        return raycastingRender.sprSelf\n    }\n\n    /**\n     * Get the render Sprite, which create automatically, for physical collisions, and holding the view point.(but get/set view direction with dirX/dirY, which not in the Sprite class) \n     * You can consider it as \"myself\", and operate it like a usual sprite.\n     * eg: position, speed, scale, collision, ...\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRenderSpriteInstance block=\"myself sprite\"\n    //% expandableArgumentMode=toggle\n    //% weight=98\n    //% help=github:pxt-raycasting/docs/get-render-sprite-instance\n    export function getRenderSpriteInstance(): Sprite {\n        return raycastingRender.sprSelf\n    }\n\n    /**\n     * Toggle current view mode\n     */\n    //% blockId=rcRender_toggleViewMode block=\"toggle current view mode\"\n    //% group=\"Basic\"\n    //% weight=89\n    //% help=github:pxt-raycasting/docs/toggle-view-mode\n    export function toggleViewMode() {\n        raycastingRender.viewMode = raycastingRender.viewMode == ViewMode.tilemapView ? ViewMode.raycastingView : ViewMode.tilemapView\n    }\n\n    /**\n     * Current view mode is the specific one?\n     * @param viewMode\n     */\n    //% blockId=rcRender_isViewMode block=\"current is $viewMode\"\n    //% group=\"Basic\"\n    //% weight=88\n    //% help=github:pxt-raycasting/docs/is-view-mode\n    export function isViewMode(viewMode: ViewMode): boolean {\n        return viewMode == raycastingRender.viewMode\n    }\n\n    /**\n     * Set view mode\n     * @param viewMode\n     */\n    //% blockId=rcRender_setViewMode block=\"set view mode $viewMode\"\n    //% group=\"Basic\"\n    //% weight=87\n    //% help=github:pxt-raycasting/docs/set-view-mode\n    export function setViewMode(viewMode: ViewMode) {\n        raycastingRender.viewMode = viewMode\n    }\n\n    /**\n     * Get render arribute\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"get %attribute\" \n    //% blockId=rcRender_getAttribute\n    //% weight=83\n    //% help=github:pxt-raycasting/docs/get-attribute\n    export function getAttribute(attr: attribute): number {\n        switch (attr) {\n            case attribute.dirX:\n                return raycastingRender.dirX\n            case attribute.dirY:\n                return raycastingRender.dirY\n            case attribute.fov:\n                return raycastingRender.fov\n            case attribute.wallZScale:\n                return raycastingRender.wallZScale\n            default:\n                return 0\n        }\n    }\n\n    /**\n     * Set render arribute\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"set %attribute = %value\" \n    //% blockId=rcRender_setAttribute\n    //% weight=82\n    //% help=github:pxt-raycasting/docs/set-attribute\n    export function setAttribute(attr: attribute, value: number) {\n        switch (attr) {\n            case attribute.dirX:\n                raycastingRender.dirX = value\n                break\n            case attribute.dirY:\n                raycastingRender.dirY = value\n                break\n            case attribute.fov:\n                if (value < 0) value = 0\n                raycastingRender.fov = value\n                break\n            case attribute.wallZScale:\n                if (value < 0) value = 0\n                raycastingRender.wallZScale = value\n                break\n            default:\n        }\n    }\n\n    /**\n     * Get default FOV (field of view) value\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"defaultFov\"\n    //% blockId=rcRender_getDefaultFov\n    //% weight=81\n    //% help=github:pxt-raycasting/docs/get-default-fov\n    export function getDefaultFov(): number {\n        return defaultFov\n    }\n\n    /**\n     * Set view angle\n     * @param angle, unit: degree 0~360\n     */\n    //% blockId=rcRender_setViewAngleInDegree block=\"set view angle$angle\"\n    //% angle.min=0 angle.max=360 angle.defl=90\n    //% group=\"Basic\"\n    //% weight=80\n    //% help=github:pxt-raycasting/docs/set-view-angle-in-degree\n    export function setViewAngleInDegree(angle: number) {\n        raycastingRender.viewAngle = angle * Math.PI / 180\n    }\n\n    /**\n     * Set view angle by dirX and dirY\n     * @param dirX\n     * @param dirY\n     */\n    //% blockId=rcRender_setViewAngle block=\"set view angle by dirX%dirX and dirY%dirY\"\n    //% group=\"Basic\"\n    //% weight=79\n    //% help=github:pxt-raycasting/docs/set-view-angle\n    export function setViewAngle(dirX: number, dirY: number) {\n        raycastingRender.viewAngle = Math.atan2(dirY, dirX)\n    }\n\n    /**\n     * Set floating offset height for a sprite at Z direction\n     * @param sprite\n     * @param Zoffset Negative floats down, affirmative goes up\n     * @param duration moving time, 0 for immediately, unit: ms\n     */\n    //% blockId=rcRender_setZOffset block=\"set Sprite %spr=variables_get(mySprite) floating %offset pixels|| duration $duration=timePicker|ms \"\n    //% offset.min=-100 offset.max=100 offset.defl=8\n    //% duration.min=0 duration.max=5000 duration.defl=0\n    //% group=\"Dimension Z\"\n    //% weight=77\n    //% blockHidden\n    //% help=github:pxt-raycasting/docs/set-z-offset\n    export function setZOffset(sprite: Sprite, offset: number, duration?: number) {\n        raycastingRender.setZOffset(sprite, offset, duration)\n    }\n\n    /**\n     * Set arribute of a Sprite\n     * @param spr Sprite\n     * @param attr RCSpriteAttribute\n     */\n    //% group=\"Dimension Z\"\n    //% block=\"set Sprite %spr=variables_get(mySprite) %attribute = %value\"\n    //% blockId=rcRender_setSpriteAttribute\n    //% weight=75\n    //% help=github:pxt-raycasting/docs/set-sprite-attribute\n    export function setSpriteAttribute(spr: Sprite, attr: RCSpriteAttribute, value: number) {\n        switch (attr) {\n            case RCSpriteAttribute.ZOffset:\n                raycastingRender.getMotionZ(spr).offset = value\n                break\n            case RCSpriteAttribute.ZPosition:\n                raycastingRender.getMotionZ(spr).p = value\n                break\n            case RCSpriteAttribute.ZVelocity:\n                raycastingRender.getMotionZ(spr).v = value\n                break\n            case RCSpriteAttribute.ZAcceleration:\n                raycastingRender.getMotionZ(spr).a = value\n                break\n            default:\n        }\n    }\n\n    /**\n     * Get arribute of a Sprite\n     * @param spr Sprite\n     * @param attr RCSpriteAttribute\n     */\n    //% group=\"Dimension Z\"\n    //% block=\"get Sprite %spr=variables_get(mySprite) %attribute\"\n    //% blockId=rcRender_getSpriteAttribute\n    //% weight=74\n    //% help=github:pxt-raycasting/docs/get-sprite-attribute\n    export function getSpriteAttribute(spr: Sprite, attr: RCSpriteAttribute): number {\n        switch (attr) {\n            case RCSpriteAttribute.ZOffset:\n                return raycastingRender.getMotionZ(spr).offset\n            case RCSpriteAttribute.ZPosition:\n                return raycastingRender.getMotionZ(spr).p\n            case RCSpriteAttribute.ZVelocity:\n                return raycastingRender.getMotionZ(spr).v\n            case RCSpriteAttribute.ZAcceleration:\n                return raycastingRender.getMotionZ(spr).a\n            default:\n                return 0\n        }\n    }\n\n    /**\n     * Check if 2 sprites overlaps each another in Z dimension\n     * Best work together with sprites.onOverlap(kind1, kind2)\n     * @param sprite1\n     * @param sprite2\n     */\n    //% blockId=rcRender_isSpritesOverlapZ\n    //% block=\"is sprites $sprite1=variables_get(mySprite) and $sprite2=variables_get(mySprite2) overlaps in Z dimension\"\n    //% group=\"Dimension Z\"\n    //% weight=71\n    //% help=github:pxt-raycasting/docs/is-sprites-overlap-z\n    export function isSpritesOverlapZ(sprite1: Sprite, sprite2: Sprite): boolean {\n        return raycastingRender.isOverlapZ(sprite1, sprite2)\n    }\n\n    /**\n     * Make sprite jump, with specific height and duration\n     * Jump can only happened when sprite is standing, current height = its offset .\n     * @param sprite\n     * @param height jump height in pixel\n     * @param duration hover time span, unit: ms\n     */\n    //% blockId=rcRender_jumpWithHeightAndDuration block=\"Sprite %spr=variables_get(mySprite) jump, with height $height duration $duration=timePicker|ms \"\n    //% height.min=0 height.max=100 height.defl=16\n    //% duration.min=50 duration.max=5000 duration.defl=500\n    //% group=\"Dimension Z\"\n    //% weight=70\n    //% help=github:pxt-raycasting/docs/jump-with-height-and-duration\n    export function jumpWithHeightAndDuration(sprite: Sprite, height: number, duration: number) {\n        raycastingRender.jumpWithHeightAndDuration(sprite, height, duration)\n    }\n\n    /**\n     * Make sprite jump, with specific speed and acceleration\n     * Simular with Move block, but jump can only happened when sprite is standing, current height = its offset.\n     * @param sprite\n     * @param v vetical speed, unit: pixel/s\n     * @param a vetical acceleration, unit: pixel/s\n     */\n    //% blockId=rcRender_jump block=\"Sprite %spr=variables_get(mySprite) jump||, with speed $v=spriteSpeedPicker acceleration $a\"\n    //% v.min=-100 v.max=100 v.defl=60\n    //% a.min=-1000 a.max=1000 a.defl=-250\n    //% group=\"Dimension Z\"\n    //% weight=68\n    //% help=github:pxt-raycasting/docs/jump\n    export function jump(sprite: Sprite, v?: number, a?: number) {\n        raycastingRender.jump(sprite, v, a)\n    }\n\n    /**\n     * Make sprite jump, with specific speed and acceleration\n     * @param sprite\n     * @param v vetical speed, unit: pixel/s\n     * @param a vetical acceleration, unit: pixel/s\n     */\n    //% blockId=rcRender_move block=\"Sprite %spr=variables_get(mySprite) move, with speed $v=spriteSpeedPicker|| acceleration $a\"\n    //% v.min=-200 v.max=200 v.defl=60\n    //% a.min=-1000 a.max=1000 a.defl=-250\n    //% group=\"Dimension Z\"\n    //% weight=66\n    //% help=github:pxt-raycasting/docs/move\n    export function move(sprite: Sprite, v?: number, a?: number) {\n        raycastingRender.move(sprite, v, a)\n    }\n\n    /**\n     * Control the self sprite using the direction buttons from the controller. \n     * To stop controlling self sprite, pass 0 for v and va.\n     *\n     * @param v The velocity used for forward/backword movement when up/down is pressed, in pixel/s\n     * @param va The angle velocity used for turn view direction when left/right is pressed, in radian/s.\n     */\n    //% blockId=\"rcRender_moveWithController\" block=\"move with buttons velocity $v|| turn speed $va camera sway$cameraSway pixels\"\n    //% weight=60\n    //% expandableArgumentMode=\"toggle\"\n    //% v.defl=2 va.defl=3\n    //% group=\"Advanced\"\n    //% v.shadow=\"spriteSpeedPicker\"\n    //% va.shadow=\"spriteSpeedPicker\"\n    //% help=github:pxt-raycasting/docs/move-with-controller\n    export function moveWithController(v: number = 2, va: number = 3, cameraSway?: number) {\n        raycastingRender.velocity = v\n        raycastingRender.velocityAngle = va\n        if (cameraSway != undefined)\n            raycastingRender.cameraSway = cameraSway | 0\n    }\n\n    /**\n     * Render takeover all sprites in current scene\n     * Render will call this automatically, but maybe not in time enough.\n     * If you saw sprite draw at its tilemap position on screen, call this just after created the sprite.\n     */\n    //% blockId=rcRender_takeoverSceneSprites \n    //% block=\"takeover sprites in scene\"\n    //% group=\"Advanced\"\n    //% weight=49\n    //% help=github:pxt-raycasting/docs/takeover-scene-sprites\n    export function takeoverSceneSprites() {\n        raycastingRender.takeoverSceneSprites()\n    }\n\n    /**\n     * Run on sprite dirction updated, present view point to Sprite facing dirction, or which angle you see of the sprite.\n     * Just using with other animation extensions, to set proper Image for sprite.\n     * Not required, if you have used the set animations block provided.\n     * @param dir It is a float number, 0~1 corresponds to 0~360, suggest use Math.round(dir*dirAniTotalCount)%dirAniTotalCount to get index of direction\n     */\n    //% blockId=rcRender_registerOnSpriteDirectionUpdateHandler\n    //% block=\"run code when sprite $spr dirction updated to $dir\"\n    //% draggableParameters\n    //% group=\"Advanced\"\n    //% weight=48\n    //% help=github:pxt-raycasting/docs/register-on-sprite-direction-update-handler\n    export function registerOnSpriteDirectionUpdateHandler(handler: (spr: Sprite, dir: number) => void) {\n        raycastingRender.registerOnSpriteDirectionUpdate(handler)\n    }\n}\n","_render_raycasting.ts":"//% shim=pxt::updateScreen\nfunction updateScreen(img: Image) { }\n\nenum ViewMode {\n    //% block=\"TileMap Mode\"\n    tilemapView,\n    //% block=\"Raycasting Mode\"\n    raycastingView,\n}\n\nnamespace Render {\n    const SH = screen.height, SHHalf = SH / 2\n    const SW = screen.width, SWHalf = SW / 2\n    const fpx = 8\n    const fpx_scale = 2 ** fpx\n    function tofpx(n: number) { return (n * fpx_scale) | 0 }\n    const one = 1 << fpx\n    const one2 = 1 << (fpx + fpx)\n    const FPX_MAX = (1 << fpx) - 1\n\n    class MotionSet1D {\n        p: number\n        v: number = 0\n        a: number = 0\n        constructor(public offset: number) {\n            this.p = offset\n        }\n    }\n\n    export const defaultFov = SW / SH / 2  //Wall just fill screen height when standing 1 tile away\n\n    export class RayCastingRender {\n        private tempScreen: Image = image.create(SW, SH)\n\n        velocityAngle: number = 2\n        velocity: number = 3\n        protected _viewMode = ViewMode.raycastingView\n        protected dirXFpx: number\n        protected dirYFpx: number\n        protected planeX: number\n        protected planeY: number\n        protected _angle: number\n        protected _fov: number\n        protected _wallZScale: number = 1\n        cameraSway = 0\n        protected isWalking = false\n        protected cameraOffsetX = 0\n        protected cameraOffsetZ_fpx = 0\n\n        //sprites & accessories\n        sprSelf: Sprite\n        sprites: Sprite[] = []\n        sprites2D: Sprite[] = []\n        spriteParticles: particles.ParticleSource[] = []\n        spriteLikes: SpriteLike[] = []\n        spriteAnimations: Animations[] = []\n        protected spriteMotionZ: MotionSet1D[] = []\n        protected sayRederers: sprites.BaseSpriteSayRenderer[] = []\n        protected sayEndTimes: number[] = []\n\n        //reference\n        protected tilemapScaleSize = 1 << TileScale.Sixteen\n        map: tiles.TileMapData\n        bg: Image\n        textures: Image[]\n        protected oldRender: scene.Renderable\n        protected myRender: scene.Renderable\n\n        //render\n        protected wallHeightInView: number\n        protected wallWidthInView: number\n        protected dist: number[] = []\n        //render perf const\n        cameraRangeAngle: number\n        viewZPos: number\n        selfXFpx: number\n        selfYFpx: number\n\n        //for drawing sprites\n        protected invDet: number //required for correct matrix multiplication\n        camera: scene.Camera\n        tempSprite: Sprite = sprites.create(img`0`)\n        protected transformX: number[] = []\n        protected transformY: number[] = []\n        protected angleSelfToSpr: number[] = []\n\n        onSpriteDirectionUpdateHandler: (spr: Sprite, dir: number) => void\n\n        get xFpx(): number {\n            return Fx.add(this.sprSelf._x, Fx.div(this.sprSelf._width, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        // set xFpx(v: number) {\n        //     this.sprSelf._x = v * this.tilemapScaleSize as any as Fx8\n        // }\n\n        get yFpx(): number {\n            return Fx.add(this.sprSelf._y, Fx.div(this.sprSelf._height, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        // set yFpx(v: number) {\n        //     this.sprSelf._y = v * this.tilemapScaleSize as any as Fx8\n        // }\n\n        get dirX(): number {\n            return this.dirXFpx / fpx_scale\n        }\n\n        get dirY(): number {\n            return this.dirYFpx / fpx_scale\n        }\n\n        set dirX(v: number) {\n            this.dirXFpx = v * fpx_scale\n        }\n\n        set dirY(v: number) {\n            this.dirYFpx = v * fpx_scale\n        }\n\n        sprXFx8(spr: Sprite) {\n            return Fx.add(spr._x, Fx.div(spr._width, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        sprYFx8(spr: Sprite) {\n            return Fx.add(spr._y, Fx.div(spr._height, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        get fov(): number {\n            return this._fov\n        }\n\n        set fov(fov: number) {\n            this._fov = fov\n            this.wallHeightInView = (SW << (fpx - 1)) / this._fov\n            this.wallWidthInView = this.wallHeightInView >> fpx // not fpx  // wallSize / this.fov * 4 / 3 * 2\n            this.cameraRangeAngle = Math.atan(this.fov) + .1 //tolerance for spr center just out of camera\n\n            this.setVectors()\n        }\n\n        get viewAngle(): number {\n            return this._angle\n        }\n        set viewAngle(angle: number) {\n            this._angle = angle\n            this.setVectors()\n            this.updateSelfImage()\n        }\n\n        get wallZScale(): number {\n            return this._wallZScale\n        }\n        set wallZScale(v: number) {\n            this._wallZScale = v\n        }\n\n        getMotionZ(spr: Sprite, offsetZ: number = 0) {\n            let motionZ = this.spriteMotionZ[spr.id]\n            if (!motionZ) {\n                motionZ = new MotionSet1D(tofpx(offsetZ))\n                this.spriteMotionZ[spr.id] = motionZ\n            }\n            return motionZ\n        }\n\n        getZOffset(spr: Sprite) {\n            return this.getMotionZ(spr).offset / fpx_scale\n        }\n\n        setZOffset(spr: Sprite, offsetZ: number, duration: number = 500) {\n            const motionZ = this.getMotionZ(spr, offsetZ)\n\n            motionZ.offset = tofpx(offsetZ)\n            if (motionZ.p != motionZ.offset) {\n                if (duration === 0)\n                    motionZ.p = motionZ.offset\n                else if (motionZ.v == 0)\n                    this.move(spr, (motionZ.offset - motionZ.p) / fpx_scale * 1000 / duration, 0)\n            }\n        }\n\n        getMotionZPosition(spr: Sprite) {\n            return this.getMotionZ(spr).p / fpx_scale\n        }\n\n        //todo, use ZHeight(set from sprite.Height when takeover, then sprite.Height will be replace with width)\n        isOverlapZ(sprite1: Sprite, sprite2: Sprite): boolean {\n            const p1 = this.getMotionZPosition(sprite1)\n            const p2 = this.getMotionZPosition(sprite2)\n            if (p1 < p2) {\n                if (p1 + sprite1.height > p2) return true\n            } else {\n                if (p2 + sprite2.height > p1) return true\n            }\n            return false\n        }\n\n        move(spr: Sprite, v: number, a: number) {\n            const motionZ = this.getMotionZ(spr)\n\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        jump(spr: Sprite, v: number, a: number) {\n            const motionZ = this.getMotionZ(spr)\n            if (motionZ.p != motionZ.offset)\n                return\n\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        jumpWithHeightAndDuration(spr: Sprite, height: number, duration: number) {\n            const motionZ = this.getMotionZ(spr)\n            if (motionZ.p != motionZ.offset)\n                return\n\n            // height= -v*v/a/2\n            // duration = -v/a*2 *1000\n            const v = height * 4000 / duration\n            const a = -v * 2000 / duration\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        get viewMode(): ViewMode {\n            return this._viewMode\n        }\n\n        set viewMode(v: ViewMode) {\n            this._viewMode = v\n        }\n\n        updateViewZPos() {\n            this.viewZPos = this.spriteMotionZ[this.sprSelf.id].p + (this.sprSelf._height as any as number) - (2 << fpx)\n        }\n\n        takeoverSceneSprites() {\n            const sc_allSprites = game.currentScene().allSprites\n            for (let i = 0; i < sc_allSprites.length;) {\n                const spr = sc_allSprites[i]\n                if (spr instanceof Sprite) {\n                    const sprList = (spr.flags & sprites.Flag.RelativeToCamera) ? this.sprites2D : this.sprites\n                    if (sprList.indexOf(spr) < 0) {\n                        sprList.push(spr as Sprite)\n                        this.getMotionZ(spr, 0)\n                        spr.onDestroyed(() => {\n                            this.sprites.removeElement(spr as Sprite)   //can be in one of 2 lists\n                            this.sprites2D.removeElement(spr as Sprite) //can be in one of 2 lists\n                            const sayRenderer = this.sayRederers[spr.id]\n                            if (sayRenderer) {\n                                this.sayRederers.removeElement(sayRenderer)\n                                sayRenderer.destroy()\n                            }\n                        })\n                    }\n                } else if (spr instanceof particles.ParticleSource) {\n                    const particle = (spr as particles.ParticleSource)\n                    if (this.spriteParticles.indexOf(particle) < 0) {\n                        this.spriteParticles[(particle.anchor as Sprite).id] = particle\n                        particle.anchor = this.tempSprite\n                    }\n                } else {\n                    if (this.spriteLikes.indexOf(spr) < 0)\n                        this.spriteLikes.push(spr)\n                }\n                sc_allSprites.removeElement(spr)\n            }\n            this.sprites.forEach((spr) => {\n                if (spr)\n                    this.takeoverSayRenderOfSprite(spr)\n            })\n        }\n        takeoverSayRenderOfSprite(sprite: Sprite) {\n            const sprite_as_any = (sprite as any)\n            if (sprite_as_any.sayRenderer) {\n                this.sayRederers[sprite.id] = sprite_as_any.sayRenderer\n                this.sayEndTimes[sprite.id] = sprite_as_any.sayEndTime;\n                sprite_as_any.sayRenderer = undefined\n                sprite_as_any.sayEndTime = undefined\n            }\n        }\n\n        tilemapLoaded() {\n            const sc = game.currentScene()\n            this.map = sc.tileMap.data\n            this.textures = sc.tileMap.data.getTileset()\n            this.tilemapScaleSize = 1 << sc.tileMap.data.scale\n            this.oldRender = sc.tileMap.renderable\n            this.spriteLikes.removeElement(this.oldRender)\n            sc.allSprites.removeElement(this.oldRender)\n\n            let frameCallback_update = sc.eventContext.registerFrameHandler(scene.PRE_RENDER_UPDATE_PRIORITY + 1, () => {\n                const dt = sc.eventContext.deltaTime;\n                // sc.camera.update();  // already did in scene\n                for (const s of this.sprites)\n                    s.__update(sc.camera, dt);\n                this.sprSelf.__update(sc.camera, dt)\n            })\n\n            let frameCallback_draw = sc.eventContext.registerFrameHandler(scene.RENDER_SPRITES_PRIORITY + 1, () => {\n                if (this._viewMode == ViewMode.tilemapView) {\n                   // screen.drawImage(sc.background.image, 0, 0)\n                    this.oldRender.__drawCore(sc.camera)\n                    this.sprites.forEach(spr => spr.__draw(sc.camera))\n                    this.sprSelf.__draw(sc.camera)\n                } else {\n                 //   this.tempScreen.drawImage(sc.background.image, 0, 0)\n                    //debug\n                    // const ms=control.micros()\n                    this.render()\n                    // info.setScore(control.micros()-ms)\n                    screen.fill(0)\n                }\n                this.sprites2D.forEach(spr => spr.__draw(sc.camera))\n                this.spriteLikes.forEach(spr => spr.__draw(sc.camera))\n                if (this._viewMode == ViewMode.raycastingView)\n                    this.tempScreen.drawTransparentImage(screen, 0, 0)\n            })\n\n            sc.tileMap.addEventListener(tiles.TileMapEvent.Unloaded, data => {\n                sc.eventContext.unregisterFrameHandler(frameCallback_update)\n                sc.eventContext.unregisterFrameHandler(frameCallback_draw)\n            })\n\n            // this.myRender = scene.createRenderable(\n            //     scene.TILE_MAP_Z,\n            //     (t, c) => this.trace(t, c)\n            // )\n\n        }\n\n        constructor() {\n            this._angle = 0\n            this.fov = defaultFov\n            this.camera = new scene.Camera()\n\n            const sc = game.currentScene()\n            if (!sc.tileMap) {\n                sc.tileMap = new tiles.TileMap();\n            } else {\n                this.tilemapLoaded()\n            }\n            game.currentScene().tileMap.addEventListener(tiles.TileMapEvent.Loaded, data => this.tilemapLoaded())\n\n            //self sprite\n            this.sprSelf = sprites.create(image.create(this.tilemapScaleSize >> 1, this.tilemapScaleSize >> 1), SpriteKind.Player)\n            this.takeoverSceneSprites()\n            this.sprites.removeElement(this.sprSelf)\n            this.updateViewZPos()\n            scene.cameraFollowSprite(this.sprSelf)\n            this.updateSelfImage()\n\n            game.onUpdate(function () {\n                this.updateControls()\n            })\n\n            game.onUpdateInterval(400, () => {\n                for (let i = 0; i < this.sprites.length;) {\n                    const spr = this.sprites[i]\n                    if (spr.flags & sprites.Flag.RelativeToCamera) {\n                        this.sprites.removeElement(spr)\n                        this.sprites2D.push(spr)\n                    } else { i++ }\n                }\n                for (let i = 0; i < this.sprites2D.length;) {\n                    const spr = this.sprites2D[i]\n                    if (!(spr.flags & sprites.Flag.RelativeToCamera)) {\n                        this.sprites2D.removeElement(spr)\n                        this.sprites.push(spr)\n                    } else { i++ }\n                }\n                this.takeoverSceneSprites() // in case some one new\n            })\n\n\n            game.onUpdateInterval(25, () => {\n                if (this.cameraSway && this.isWalking) {\n                    this.cameraOffsetX = (Math.sin(control.millis() / 150) * this.cameraSway * 3) | 0\n                    this.cameraOffsetZ_fpx = tofpx(Math.cos(control.millis() / 75) * this.cameraSway) | 0\n                }\n            });\n            control.__screen.setupUpdate(() => {\n                if (this.viewMode == ViewMode.raycastingView)\n                    updateScreen(this.tempScreen)\n                else\n                    updateScreen(screen)\n            })\n\n            game.addScenePushHandler((oldScene) => {\n                control.__screen.setupUpdate(() => { updateScreen(screen) })\n            })\n            game.addScenePopHandler((oldScene) => {\n                control.__screen.setupUpdate(() => {\n                    if (this.viewMode == ViewMode.raycastingView)\n                        updateScreen(this.tempScreen)\n                    else\n                        updateScreen(screen)\n                })\n            })\n        }\n\n        private setVectors() {\n            const sin = Math.sin(this._angle)\n            const cos = Math.cos(this._angle)\n            this.dirXFpx = tofpx(cos)\n            this.dirYFpx = tofpx(sin)\n            this.planeX = tofpx(sin * this._fov)\n            this.planeY = tofpx(cos * -this._fov)\n        }\n\n        //todo, pre-drawn dirctional image\n        public updateSelfImage() {\n            const img = this.sprSelf.image\n            img.fill(6)\n            const arrowLength = img.width / 2\n            img.drawLine(arrowLength, arrowLength, arrowLength + this.dirX * arrowLength, arrowLength + this.dirY * arrowLength, 2)\n            img.fillRect(arrowLength - 1, arrowLength - 1, 2, 2, 2)\n        }\n\n        updateControls() {\n            if (this.velocityAngle !== 0) {\n                const dx = controller.dx(this.velocityAngle)\n                if (dx) {\n                    this.viewAngle += dx\n                }\n            }\n            if (this.velocity !== 0) {\n                this.isWalking = true\n                const dy = controller.dy(this.velocity)\n                if (dy) {\n                    const nx = this.xFpx - Math.round(this.dirXFpx * dy)\n                    const ny = this.yFpx - Math.round(this.dirYFpx * dy)\n                    this.sprSelf.setPosition((nx * this.tilemapScaleSize / fpx_scale), (ny * this.tilemapScaleSize / fpx_scale))\n                } else {\n                    this.isWalking = false\n                }\n            }\n\n            for (const spr of this.sprites) {\n                this.updateMotionZ(spr)\n            }\n            this.updateMotionZ(this.sprSelf)\n        }\n\n        updateMotionZ(spr: Sprite) {\n            const dt = game.eventContext().deltaTime\n            const motionZ = this.spriteMotionZ[spr.id]\n            //if (!motionZ) continue\n\n            if (motionZ.v != 0 || motionZ.p != motionZ.offset) {\n                motionZ.v += motionZ.a * dt, motionZ.p += motionZ.v * dt\n                //landing\n                if ((motionZ.a >= 0 && motionZ.v > 0 && motionZ.p > motionZ.offset) ||\n                    (motionZ.a <= 0 && motionZ.v < 0 && motionZ.p < motionZ.offset)) { motionZ.p = motionZ.offset, motionZ.v = 0 }\n                if (spr === this.sprSelf)\n                    this.updateViewZPos()\n            }\n\n        }\n\n\n        blitRowBreak(screenX: number, screenUp: number, screenDown: number, source: Image, sourceX: number, sourceYBreak: number) {\n\n            let stepY = (sourceYBreak) / (SHHalf - screenUp )\n            let sourceY = sourceYBreak - stepY\n            let y = SHHalf -1\n            if (screenUp < 0)\n                screenUp = 0\n            while (y  >= Math.ceil(screenUp)-1) {\n                if (sourceY < 0) \n                    sourceY = 0\n                const c = source.getPixel(sourceX, sourceY)\n                this.tempScreen.setPixel(screenX, y, c)\n                y--\n                sourceY -= stepY\n            }\n            // from screen half  going down\n            stepY = (source.height - sourceYBreak) / (screenDown - SHHalf)\n            sourceY = sourceYBreak \n            y = SHHalf\n            if (screenDown > SH)\n                screenDown = SH\n            while (y < Math.round(screenDown)) {\n                const c = source.getPixel(sourceX, sourceY)\n                this.tempScreen.setPixel(screenX, y, c)\n                y++\n                sourceY += stepY\n            }\n\n        }\n        \n        render() {\n            // based on https://lodev.org/cgtutor/raycasting.html\n            this.selfXFpx = this.xFpx\n            this.selfYFpx = this.yFpx\n\n            let drawStart = 0\n            let drawHeight = 0\n            let lastDist = -1, lastTexX = -1, lastMapX = -1, lastMapY = -1\n            this.viewZPos = this.spriteMotionZ[this.sprSelf.id].p + (this.sprSelf._height as any as number) - (2 << fpx) + this.cameraOffsetZ_fpx\n            let cameraRangeAngle = Math.atan(this.fov) + .1 //tolerance for spr center just out of camera\n            //debug\n            // const ms=control.millis()\n\n            \n\n\n            const tex = this.textures[1]\n            let rayDirX0 = this.dirXFpx / fpx_scale + (this.planeX / fpx_scale)\n            let rayDirY0 = this.dirYFpx / fpx_scale + (this.planeY / fpx_scale)\n            let rayDirX1 = this.dirXFpx / fpx_scale - (this.planeX / fpx_scale)\n            let rayDirY1 = this.dirYFpx / fpx_scale - (this.planeY / fpx_scale)\n            let fmapX = this.selfXFpx / fpx_scale\n            let fmapY = this.selfYFpx / fpx_scale\n\n            const sc = game.currentScene() \n           // background\n            const speed = 2 // 2: normal speed\n            let backgroundOffset = (this._angle / Math.PI * speed ) % 1  // range -1..1\n            if (backgroundOffset < 0) backgroundOffset++  // range 0..1\n            backgroundOffset *= SW    // range 0..screenwidth\n            \n            //floor\n            for (let y = 60; y < SH; y++) {\n                let p = y - SHHalf\n                let posZ = SH * this.viewZPos / this.tilemapScaleSize / fpx_scale\n                let rowDistance = posZ / p\n                let floorStepX = rowDistance * (rayDirX1 - rayDirX0) / SW\n                let floorStepY = rowDistance * (rayDirY1 - rayDirY0) / SW\n\n\n\n                let floorX = fmapX + rowDistance * rayDirX0\n                let floorY = fmapY + rowDistance * rayDirY0\n                for (let x = 0; x < SW; x++) {\n                      let cellX = Math.floor(floorX)\n                     let cellY = Math.floor(floorY)\n                    let tx =  (16 * (floorX - cellX)) & 15\n                      let ty = (16 * (floorY - cellY)) & (15)\n                    let mapX = Math.round(floorX - 0.5) % 16\n                    let mapY = Math.round(floorY - 0.5) % 16\n                    let tileType = this.map.getTile(mapX, mapY)\n                    let floorTex = this.textures[tileType]\n                    floorX += floorStepX\n                    floorY += floorStepY\n                    let c = floorTex.getPixel(tx, ty)\n                    this.tempScreen.setPixel(x, y, c)\n\n                }\n\n\n\n            }\n            // walls\n\n            for (let x = 0; x < SW; x++) {\n                const cameraX: number = one - Math.idiv(((x + this.cameraOffsetX) << fpx) << 1, SW)\n                let rayDirX = this.dirXFpx + (this.planeX * cameraX >> fpx)\n                let rayDirY = this.dirYFpx + (this.planeY * cameraX >> fpx)\n\n                // avoid division by zero\n                if (rayDirX == 0) rayDirX = 1\n                if (rayDirY == 0) rayDirY = 1\n\n                let mapX = this.selfXFpx >> fpx\n                let mapY = this.selfYFpx >> fpx\n\n                // length of ray from current position to next x or y-side\n                let sideDistX = 0, sideDistY = 0\n\n                // length of ray from one x or y-side to next x or y-side\n                const deltaDistX = Math.abs(Math.idiv(one2, rayDirX));\n                const deltaDistY = Math.abs(Math.idiv(one2, rayDirY));\n\n                let mapStepX = 0, mapStepY = 0\n\n                let sideWallHit = false;\n\n                //calculate step and initial sideDist\n                if (rayDirX < 0) {\n                    mapStepX = -1;\n                    sideDistX = ((this.selfXFpx - (mapX << fpx)) * deltaDistX) >> fpx;\n                } else {\n                    mapStepX = 1;\n                    sideDistX = (((mapX << fpx) + one - this.selfXFpx) * deltaDistX) >> fpx;\n                }\n                if (rayDirY < 0) {\n                    mapStepY = -1;\n                    sideDistY = ((this.selfYFpx - (mapY << fpx)) * deltaDistY) >> fpx;\n                } else {\n                    mapStepY = 1;\n                    sideDistY = (((mapY << fpx) + one - this.selfYFpx) * deltaDistY) >> fpx;\n                }\n\n                let color = 0\n\n                while (true) {\n                    //jump to next map square, OR in x-direction, OR in y-direction\n                    if (sideDistX < sideDistY) {\n                        sideDistX += deltaDistX;\n                        mapX += mapStepX;\n                        sideWallHit = false;\n                    } else {\n                        sideDistY += deltaDistY;\n                        mapY += mapStepY;\n                        sideWallHit = true;\n                    }\n\n                    if (this.map.isOutsideMap(mapX, mapY))\n                        break\n                    color = this.map.getTile(mapX, mapY)\n                    if  (this.map.isWall(mapX, mapY))\n                        break; // hit!\n                }\n\n                if (this.map.isOutsideMap(mapX, mapY))\n                    continue\n\n                let perpWallDist = 0\n                let wallX = 0\n                if (!sideWallHit) {\n                    perpWallDist = Math.idiv(((mapX << fpx) - this.selfXFpx + (1 - mapStepX << fpx - 1)) << fpx, rayDirX)\n                    wallX = this.selfYFpx + (perpWallDist * rayDirY >> fpx);\n                } else {\n                    perpWallDist = Math.idiv(((mapY << fpx) - this.selfYFpx + (1 - mapStepY << fpx - 1)) << fpx, rayDirY)\n                    wallX = this.selfXFpx + (perpWallDist * rayDirX >> fpx);\n                }\n                wallX &= FPX_MAX\n\n                // color = (color - 1) * 2\n                // if (sideWallHit) color++\n\n                const tex = this.textures[color]\n                if (!tex)\n                    continue\n\n                let texX = (wallX * tex.width) >> fpx;\n                // if ((!sideWallHit && rayDirX > 0) || (sideWallHit && rayDirY < 0))\n                //     texX = tex.width - texX - 1;\n\n                const lineHeight = (this.wallHeightInView / perpWallDist)\n                const drawEnd = lineHeight * this.viewZPos / this.tilemapScaleSize / fpx_scale;\n                const horizontBreak = 1 - this.viewZPos / this.tilemapScaleSize / fpx_scale;\n                if (perpWallDist !== lastDist && (texX !== lastTexX || mapX !== lastMapX || mapY !== lastMapY)) {//neighbor line of tex share same parameters\n                     \n                    drawStart = drawEnd - lineHeight * (this._wallZScale) ;\n                    drawHeight = (Math.ceil(drawEnd) - Math.ceil(drawStart) )\n                    drawStart += (SH >> 1)\n\n                    lastDist = perpWallDist\n                    lastTexX = texX\n                    lastMapX = mapX\n                    lastMapY = mapY\n                }\n                //fix start&end points to avoid regmatic between lines\n               \n\n                //if (x < SWHalf)\n                //    this.tempScreen.blitRow(x, drawStart, tex, texX, drawHeight)\n                //else\n                    this.blitRowBreak(x, SHHalf + drawEnd - lineHeight, SHHalf + drawEnd, tex, texX, tex.height * horizontBreak)\n\n                this.dist[x] = perpWallDist\n\n                // background \n                for (let y = 0; y < drawStart; y++ ){\n                    let backX = (backgroundOffset + x) % SW\n                    let c = sc.background.image.getPixel(backX,y)\n                    this.tempScreen.setPixel(x,y,c)\n                }\n            }\n            //debug\n            // info.setScore(control.millis()-ms)\n           // this.tempScreen.print(backgroundOffset.toString(), 0,0,7 )\n           // this.tempScreen.print([Math.roundWithPrecision(this._angle, 3)].join(), 20, 5)\n\n            this.drawSprites()\n        }\n\n        drawSprites() {\n            //debug\n            // let msSprs=control.millis()\n            /////////////////// sprites ///////////////////\n\n            //for sprite\n            const invDet = one2 / (this.planeX * this.dirYFpx - this.dirXFpx * this.planeY); //required for correct matrix multiplication\n\n            this.sprites\n                .filter((spr, i) => {\n                    const spriteX = this.sprXFx8(spr) - this.xFpx // this.selfXFpx\n                    const spriteY = this.sprYFx8(spr) - this.yFpx // this.selfYFpx\n                    this.angleSelfToSpr[spr.id] = Math.atan2(spriteX, spriteY)\n                    this.transformX[spr.id] = invDet * (this.dirYFpx * spriteX - this.dirXFpx * spriteY) >> fpx;\n                    this.transformY[spr.id] = invDet * (-this.planeY * spriteX + this.planeX * spriteY) >> fpx; //this is actually the depth inside the screen, that what Z is in 3D\n                    const angleInCamera = Math.atan2(this.transformX[spr.id] * this.fov, this.transformY[spr.id])\n                    return angleInCamera > -this.cameraRangeAngle && angleInCamera < this.cameraRangeAngle //(this.transformY[spr.id] > 0\n                }).sort((spr1, spr2) => {   // far to near\n                    return (this.transformY[spr2.id] - this.transformY[spr1.id])\n                }).forEach((spr, index) => {\n                    //debug\n                    // this.tempScreen.print([spr.id,Math.roundWithPrecision(angle[spr.id],3)].join(), 0, index * 10 + 10,9)\n                    this.drawSprite(spr, index, this.transformX[spr.id], this.transformY[spr.id], this.angleSelfToSpr[spr.id])\n                })\n\n            //debug\n            // info.setLife(control.millis() - msSprs+1)\n             //this.tempScreen.print([Math.roundWithPrecision(this._angle,3)].join(), 20,  0)\n\n        }\n\n        registerOnSpriteDirectionUpdate(handler: (spr: Sprite, dir: number) => void) {\n            this.onSpriteDirectionUpdateHandler = handler\n        }\n\n        drawSprite(spr: Sprite, index: number, transformX: number, transformY: number, myAngle: number) {\n            const spriteScreenX = Math.ceil((SWHalf) * (1 - transformX / transformY)) - this.cameraOffsetX;\n            const spriteScreenHalfWidth = Math.idiv((spr._width as any as number) / this.tilemapScaleSize / 2 * this.wallWidthInView, transformY)  //origin: (texSpr.width / 2 << fpx) / transformY / this.fov / 3 * 2 * 4\n            const spriteScreenLeft = spriteScreenX - spriteScreenHalfWidth\n            const spriteScreenRight = spriteScreenX + spriteScreenHalfWidth\n\n            //calculate drawing range in X direction\n            //assume there is one range only\n            let blitX = 0, blitWidth = 0\n            for (let sprX = 0; sprX < SW; sprX++) {\n                if (this.dist[sprX] > transformY) {\n                    if (blitWidth == 0)\n                        blitX = sprX\n                    blitWidth++\n                } else if (blitWidth > 0) {\n                    if (blitX <= spriteScreenRight && blitX + blitWidth >= spriteScreenLeft)\n                        break\n                    else\n                        blitX = 0, blitWidth = 0;\n                }\n            }\n            // this.tempScreen.print([this.getxFx8(spr), this.getyFx8(spr)].join(), 0,index*10+10)\n            const blitXSpr = Math.max(blitX, spriteScreenLeft)\n            const blitWidthSpr = Math.min(blitX + blitWidth, spriteScreenRight) - blitXSpr\n            if (blitWidthSpr <= 0)\n                return\n\n            const lineHeight = Math.idiv(this.wallHeightInView, transformY)\n            const drawStart = SHHalf + (lineHeight * ((this.viewZPos - this.spriteMotionZ[spr.id].p - (spr._height as any as number)) / this.tilemapScaleSize) >> fpx)\n\n            //for textures=image[][], abandoned\n            //    const texSpr = spr.getTexture(Math.floor(((Math.atan2(spr.vxFx8, spr.vyFx8) - myAngle) / Math.PI / 2 + 2-.25) * spr.textures.length +.5) % spr.textures.length)\n            //for deal in user code\n            if (this.onSpriteDirectionUpdateHandler)\n                this.onSpriteDirectionUpdateHandler(spr, ((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25))\n            //for CharacterAnimation ext.\n            //     const iTexture = Math.floor(((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25) * 4 + .5) % 4\n            //     const characterAniDirs = [Predicate.MovingLeft,Predicate.MovingDown, Predicate.MovingRight, Predicate.MovingUp]\n            //     character.setCharacterState(spr, character.rule(characterAniDirs[iTexture]))\n            //for this.spriteAnimations\n            const texSpr = !this.spriteAnimations[spr.id] ? spr.image : this.spriteAnimations[spr.id].getFrameByDir(((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25))\n\n            const sprTexRatio = texSpr.width / spriteScreenHalfWidth / 2\n            helpers.imageBlit(\n                this.tempScreen,\n                blitXSpr,\n                drawStart,\n                blitWidthSpr,\n                lineHeight * spr.height / this.tilemapScaleSize,\n                texSpr,\n                (blitXSpr - (spriteScreenX - spriteScreenHalfWidth)) * sprTexRatio\n                ,\n                0,\n                blitWidthSpr * sprTexRatio, texSpr.height, true, false)\n\n            screen.fill(0)\n            const fpx_div_transformy = Math.roundWithPrecision(transformY / 4 / fpx_scale, 2)\n            const height = (SH / fpx_div_transformy)\n            const blitXSaySrc = ((blitX - spriteScreenX) * fpx_div_transformy) + SWHalf\n            const blitWidthSaySrc = (blitWidth * fpx_div_transformy)\n\n            //sprite\n            // screen.drawImage(texSpr, SWHalf-texSpr.width/2, SHHalf)\n            //sayText\n            const sayRender = this.sayRederers[spr.id]\n            if (sayRender) {\n                if (this.sayEndTimes[spr.id] && control.millis() > this.sayEndTimes[spr.id]) {\n                    this.sayRederers[spr.id] = undefined\n                } else {\n                    this.tempSprite.x = SWHalf\n                    this.tempSprite.y = SHHalf + 2\n                    this.camera.drawOffsetX = 0\n                    this.camera.drawOffsetY = 0\n                    sayRender.draw(screen, this.camera, this.tempSprite)\n                }\n            }\n            //particle\n            const particle = this.spriteParticles[spr.id]\n            if (particle) {\n                if (particle.lifespan) {\n                    //debug\n                    // this.tempScreen.print([spr.id].join(), 0,index*10+10)\n                    this.tempSprite.x = SWHalf\n                    this.tempSprite.y = SHHalf + spr.height\n                    this.camera.drawOffsetX = 0//spr.x-SWHalf\n                    this.camera.drawOffsetY = 0//spr.y-SH\n                    particle.__draw(this.camera)\n                } else {\n                    this.spriteParticles[spr.id] = undefined\n                }\n            }\n            //update screen for this spr\n            // const sayTransformY = \n            if (blitXSaySrc <= 0) { //imageBlit considers negative value as 0\n                helpers.imageBlit(\n                    this.tempScreen,\n                    spriteScreenX - SWHalf / fpx_div_transformy, drawStart - height / 2, (blitWidthSaySrc + blitXSaySrc) / fpx_div_transformy, height,\n                    screen,\n                    0, 0, blitWidthSaySrc + blitXSaySrc, SH, true, false)\n            } else {\n                helpers.imageBlit(\n                    this.tempScreen,\n                    // blitX, drawStart - height / 2 , blitWidth, height,\n                    blitX, drawStart - height / 2, blitWidth, height,\n                    screen,\n                    blitXSaySrc, 0, blitWidthSaySrc, SH,\n                    true, false)\n            }\n        }\n    }\n\n    //%fixedinstance\n    export const raycastingRender = new Render.RayCastingRender()\n}\n\n","tilemap.g.jres":"{\n    \"transparency16\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true\n    },\n    \"tile1\": {\n        \"data\": \"hwQQABAAAABBbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfQ==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile\"\n    },\n    \"level1\": {\n        \"id\": \"level1\",\n        \"mimeType\": \"application/mkcd-tilemap\",\n        \"data\": \"MTAxMDAwMTAwMDAyMDIwMjAyMDIyMDIwMWYxZjFmMWYxZjIwMjAyMDIwMDEyMTIxMjExNjE2MGEwYTA1MGEwNTBhMGEwNTBhMjAwMjA2MTkwNzE2MGEwNTA1MDUwNTA1MDUwNjA3MGEyMDAxMDkwOTA5MTkwNzA1MTYwNTA1MDUwNTA5MDgwNTFmMDEwOTE4MTUxNTE1MDUxNjAxMDkwOTA1MGIwYTBhMWYwMTA5MTQyMTIxMWEwNTE2MDEwOTA5MDUwYjA1MDUxZjIwMDkxNDIxMTYxNjA1MTYwMTA5MDkwNTBiMDUwNTIwMWYwOTE3MTUxNTE1MDUwOTA5MDkwOTA1MDUwNTBhMjAxZjA5MDIxNjBhMTYwNTE2MDMwYzBjMGMwZDA1MGQyMjFmMDkwMTE2MTYxNjA1MTYwMzIxMjEyMTBjMDUwYzIzMDQwOTAxMTYwNTA1MDUxNjIxMjEyMTIxMGMwNTFlMjQwNDA5MDExNjA1MTYwOTE2MGQwYzBjMGMwYzA1MGMxYjA0MDkwMTAxMDUwOTA5MGUwZjEwMGMwYzBkMDUwZDFjMDQwOTA5MDkwNTA1MDUwNTA1MDUwNTA1MDUwNTBjMjQwNDIxMDkwOTA5MDkwOTEyMTExMzBjMGMwZDBjMGMxYzIwMjAyMDIwMjAyMDIwMjAyMDIwMjAxZDFjMjQxYzFjMjIyMjIyMjIyMjIyMjIyMjIyMjIwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDIwMDAwMjAwMjIwMDIwMDAyMDAwMDIwMDIyMDAwMDAwMjAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAyMDAwMDAyMDAwMDIwMDIwMjAwMDAyMjIyMDAyMDAyMDIwMDAwMjIyMjAwMjAwMjAyMDAwMDAwMDAwMDIwMDIyMjAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAyMjAwMDAwMDAwMDAwMDIwMjIyMjIyMjIyMjIyMjIyMg==\",\n        \"tileset\": [\n            \"myTiles.transparency16\",\n            \"sprites.dungeon.floorDark0\",\n            \"sprites.dungeon.floorDark2\",\n            \"sprites.dungeon.greenOuterNorth0\",\n            \"sprites.dungeon.stairWest\",\n            \"sprites.castle.tileGrass1\",\n            \"sprites.castle.tilePath1\",\n            \"sprites.castle.tilePath3\",\n            \"sprites.castle.tilePath9\",\n            \"sprites.castle.tilePath5\",\n            \"sprites.castle.tileGrass2\",\n            \"sprites.castle.tilePath6\",\n            \"sprites.castle.tileDarkGrass1\",\n            \"sprites.castle.tileDarkGrass2\",\n            \"sprites.builtin.forestTiles5\",\n            \"sprites.builtin.forestTiles6\",\n            \"sprites.builtin.forestTiles7\",\n            \"sprites.builtin.forestTiles10\",\n            \"sprites.builtin.forestTiles13\",\n            \"sprites.builtin.forestTiles15\",\n            \"sprites.vehicle.roadVertical\",\n            \"sprites.vehicle.roadHorizontal\",\n            \"sprites.castle.tileGrass3\",\n            \"sprites.vehicle.roadTurn3\",\n            \"sprites.vehicle.roadTurn1\",\n            \"sprites.castle.tilePath2\",\n            \"sprites.castle.tilePath8\",\n            \"sprites.builtin.forestTiles21\",\n            \"sprites.builtin.forestTiles22\",\n            \"sprites.builtin.forestTiles23\",\n            \"sprites.castle.tileDarkGrass3\",\n            \"sprites.dungeon.doorOpenNorth\",\n            \"sprites.dungeon.floorLight0\",\n            \"sprites.builtin.forestTiles0\",\n            \"sprites.builtin.forestTiles1\",\n            \"sprites.builtin.forestTiles2\",\n            \"sprites.builtin.forestTiles4\"\n        ],\n        \"displayName\": \"level\"\n    },\n    \"*\": {\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"dataEncoding\": \"base64\",\n        \"namespace\": \"myTiles\"\n    }\n}","tilemap.g.ts":"","pxt.json":"{\n    \"name\": \"3d floor and background\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"device\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"assets.json\",\n        \"_animation.ts\",\n        \"_render_blocks.ts\",\n        \"_render_raycasting.ts\",\n        \"tilemap.g.jres\",\n        \"tilemap.g.ts\"\n    ],\n    \"targetVersions\": {\n        \"branch\": \"v1.10.36\",\n        \"tag\": \"v1.10.36\",\n        \"commits\": \"https://github.com/microsoft/pxt-arcade/commits/3a5a7e13703edf0412c17bdb9b1469e282a5b31b\",\n        \"target\": \"1.10.36\",\n        \"pxt\": \"8.3.9\"\n    },\n    \"preferredEditor\": \"blocksprj\"\n}\n"}},{"timestamp":1763395859822,"editorVersion":"2.0.62","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</variable><variable type=\"KIND_SpriteKind\" id=\"USZ`q|D]$0kk|,E!b7c6\">Player</variable><variable type=\"KIND_SpriteKind\" id=\"@8#W0|ESmtdS+3`?Z+:+\">Projectile</variable><variable type=\"KIND_SpriteKind\" id=\"h1jvB:JPL=NMGpJB=4/[\">Food</variable><variable type=\"KIND_SpriteKind\" id=\"(3Y]|wk94c4t/c`pc((X\">Enemy</variable><variable type=\"KIND_SpriteKind\" id=\"2B=HiFZ(Kz-^Ln6ox1L~\">Help</variable></variables><block type=\"pxt-on-start\" x=\"-102\" y=\"7\"><statement name=\"HANDLER\"><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff99d99bbbbbcfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff99ddbdd66168bcccccc9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff999ddbbbd66888111ccccccb99fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9966ddbbbb6688811818ccccccbbc99fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdd69dddbbb66618881888818818cccccbe9fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffddd96dd6b6dbd68888888888888888cccccc99fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffdbbd9666666dbb668886888888cccccccccccccc9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffdbbb99666966d68866888888cccccccccccccccccc69ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffdbbb999669666666888888888ccccbbbcc8bcccccccccc9fffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffdbbb999666666666888888888cbbcbe8bbbcbcccccbbcccb9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffff9bbb999666666666688888888bccb888888bbbbb88888bcccccfffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffdbbb999669666666866888868bbbbb8888888ccc888b88bbc8cccffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffdbbb9d99ddd666668868888688bbcb888888888bc888bcc8bc886c9fffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffbbbbbbddd966666888688888888888888b88888888888cc8ccc886c9ffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffdbbbbbbdd6966666666868888888888bbdbbebb8888888888bcc8c86c9fffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffff9bbdbddd6666666666888688868888ddddddddde8888888888bccbbccccfffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffff9dbb9dd666666666668868888888bddddddbdbbddcccccd88b8ebccbbbbc9ffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffdd99999666666666668868888888bdddddbbbbbdbbbccccccb8bbbccc8bbb9fffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffff9dd99996696966666666668888bbbdddddbbbddbbbbbbbbbcccc8bcccbb8bbcfffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffff9d999996666966666668688888bbdddbbbbdbbbbbbbbbbbcccccc8bbccc88bc9ffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff99999999666996696668868868bbdddddbbbdbbbbbbbbbbbbcbccc88bcccc88c6ffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff999996696669666966d8868666bddbbbddbbdbbbbbbbbbbbbcccccc88bbccc8869fffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff9999996699669666666d6688668bddbbdbbbbbbbbbbbbbbbbbccccccc88bcccc866fffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff9dd999669966666666666688668bdddbbbbbbbbbbbbbbbbbbbccccccc888bbccc669ffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff999999669d69666666666688868bddbbbdbbbbbbbbbbbbbbbbcccccccc888bbcc869ffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99999996ddd69666666688888868ddbddbbbbbbbbbbbbbbbbbbccccccccc888888866ffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff999999969ddd6669666688688888bbbbbbbbbbbbbbbbbbbbbbbbccbccccc8888888869fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99999966ddddd669666688888888bbbbbbbbbbbbbbbbbbbbbbbcbccccccccc88888869fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff999bb99666dddd6666666668886888bbbbbbbbbbbbbbbbbbbbbbcccccccccccc8888889fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbbb966696666666666888886888bbbbbbbbbbbbbbbbbbbbbbcbccccccccccc888886fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbdbb666969666666668888868888bbbbbbbbbbbbbbbbbbbbccbccccccccccc8888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99dbbbbb6696966666666668886868888bbbbeb888bbbbbbbbbcccccccccccccc8888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbbbbbe6969666666666888888888888888888888bbbbbbbbccccccccccccc88888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbccbc66966666666688888688888888888d888ebbbbbbbcccccccccccbb88888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbbcc69996666688668886888888dd88dbbd88bbbbbbbccccccccccceb88888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbbccc999966668868888888888ddddbbbbd88cbbbbbbbbccccccccc8888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9ebbbbcccccccc9966666688888888888888ddbbbb888bbbbbbbbccccccccc8888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbccccccccc666666888866888888888dddddbdd88bbbbbbccccccccc88888888bb9ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffbbbbbbcccccccccc6666688888888888888888d8888888bbbbbbccccccccc88888888bb9ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9dbbbbccbbccccccb666688868888888888888888888888bbbbbccccccccc888888888b9ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9dbbbbbbbbcccccbb66666688888888888888888888888bbbbccccccccccc88888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbcccccccb666666688888888888888888888888bbbbcccccccccc888888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbccccccbb666666688888888888888888888888bbbbcccccccccc88888888886fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbbbbbbbccccb6666668888888888888888888888888bbbbcbcccccccc88888888886fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99dbbbcbbccccb6666668888888888888888888888888bbbbbccccccccc888cc888869fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99dbbbcccccccc6666668688688888888888888888888bbbbccccccccc8888cc888869fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff999bbbbbccccbc6666666688688888888888888888888bbbbcccccccc88888dd88886ffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff969bbbbbbcccc69666666668688868888888888888888bbbbccccccc88888bd888886ffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff99bbbbcccccc696bb668888888868888888888888888bbbcccccccc8888bbd888869ffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff9999bbbcccc9666dbbb8888888888888888888888888ccbcccccccc8888bc888886fffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff699bbbbccc966966bbb8888888888888888888888888bbbbccccc88888bcc88869fffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff9999bbcccc666666dbbdd88888888688888888888888bbcccccc88888888888669fffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff9699dbcccc66666666bb6d8888888688888888888888bbcccccc8888888888869ffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffff9696bbbcc66666666dbbd6886868888888888888888bbcbccc8888888888d669ffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffff999ebbccc666666666dbb8868888688888888888888bbbccc8888888889b69fffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffff969ccbcc66996666666bbb868888888888888888888bbbc888888888888b6ffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffff96ccccc966966666666bb8688666888888888888888b8888888888888699ffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffff99ccbc996666666666dbb6888668888888888888888888888888888869fffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffff969ccb9666666666666dbb88866888888888888888888888888888869ffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffff969ccc6696666666666dd8888668888888888888888888888888866fffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffff969cc9669666966d66dd8888868888888888888888888bb8888669fffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffff96ccc66699669dddd888868888888888888888888888be888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffff96c66669966666dd88886666668888888888888888dd888669fffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffff96966669966ddd686886868888888888888888888d888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffff969666696666666688686888888888888888888888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffff9966966966666666886888888888888886888888669fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9699996666666888888888888888888118888699ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff969996666668888881188888888881888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff996999666688881818888888881886669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9961161186618811188886116699ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff99161111611118111666699fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9999661166669999ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff999999999fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value></block></value></block></next></block></next></block></statement></block><block type=\"keyonevent\" x=\"361\" y=\"0\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_toggleViewMode\"></block></statement></block></xml>","main.ts":"","README.md":" ","assets.json":"","_animation.ts":"//////////////////////// animation.ts contents of previous version, just for test.ts here for convenience /////////////////////\n// file contents:\n// directional animations defines for enging_raycasting.ts\n// for convenience, constructed animations as below, which images are builtin in Arcade, \n// in order from easy to complex\n\n// each are 2D Image array, Image[][]: \n// 1st dimension is direction: \n//    length=1 to any, e.g. 1,2,3,4,...,8,..., engine can automatically arange them to 0~360 \n//    order: start from left, then folling with others in CW order\n//    e.g: \n//         2 directions should be [leftAni,RightAni], \n//         4-direction should be [leftAni, frontAni, rightAni, backAni], \n//         8-direction=[l,lf,f,fr,r,rb,b,lb], ...\n//    the reason that directions start from left, is almost all Arcade builtin one side images are facing left, so that would be convient for using.\n// 2nd dimension is animation Images\n//    length=1 to any, e.g. 1,2,3,4,..., engine will automatically loop them by aniInterval(set when create CompactSprite, or use default)\n\n\n//simplest, just one static image, looks the same in all angle of view\nconst texturesDonut = [[sprites.food.smallDonut]]\nconst texturesBigCake = [[sprites.food.bigCake]]\n\n//1-direction, with ani, looks the same Ani in all angle of view\nconst texturesCoin = [[sprites.builtin.coin0, sprites.builtin.coin1, sprites.builtin.coin2, sprites.builtin.coin3, sprites.builtin.coin4, sprites.builtin.coin5]]\n\nconst texturesDog = [[sprites.builtin.dog0, sprites.builtin.dog1, sprites.builtin.dog2]]\nconst texturesDuck = [[sprites.duck.duck1, sprites.duck.duck2, sprites.duck.duck3, sprites.duck.duck4, sprites.duck.duck5, sprites.duck.duck6]]\n\n//2-direction, with ani, looks difference from left or right side\nconst texturesPlane = [[sprites.vehicle.plane0, sprites.vehicle.plane1, sprites.vehicle.plane2, sprites.vehicle.plane3, sprites.vehicle.plane4, sprites.vehicle.plane5],\n[sprites.vehicle.plane0, sprites.vehicle.plane1, sprites.vehicle.plane2, sprites.vehicle.plane3, sprites.vehicle.plane4, sprites.vehicle.plane5]]\n//no right side ani images builtin, so make them from lefts, and then flipX\nimagesFlipX(texturesPlane[1])\n\nconst texturesFish = [[sprites.builtin.angelFish0, sprites.builtin.angelFish1, sprites.builtin.angelFish2, sprites.builtin.angelFish3],\n[sprites.builtin.angelFish0, sprites.builtin.angelFish1, sprites.builtin.angelFish2, sprites.builtin.angelFish3]]\nimagesFlipX(texturesFish[1])\n\n//4-direction\nconst texturesHero = [\n    [sprites.castle.heroWalkSideLeft1, sprites.castle.heroWalkSideLeft2, sprites.castle.heroWalkSideLeft3, sprites.castle.heroWalkSideLeft4],\n    [sprites.castle.heroWalkFront1, sprites.castle.heroWalkFront2, sprites.castle.heroWalkFront3, sprites.castle.heroWalkFront4],\n    [sprites.castle.heroWalkSideRight1, sprites.castle.heroWalkSideRight2, sprites.castle.heroWalkSideRight3, sprites.castle.heroWalkSideRight4],\n    [sprites.castle.heroWalkBack1, sprites.castle.heroWalkBack2, sprites.castle.heroWalkBack3, sprites.castle.heroWalkBack4],\n]\n\nconst texturesPrincess2 = [\n    [sprites.castle.princess2Left1, sprites.castle.princess2Left2],\n    [sprites.castle.princess2WalkFront1, sprites.castle.princess2WalkFront2, sprites.castle.princess2WalkFront3, sprites.castle.princess2WalkFront2],\n    [sprites.castle.princess2Right1, sprites.castle.princess2Right2],\n    [sprites.castle.princess2WalkBack1, sprites.castle.princess2WalkBack2, sprites.castle.princess2WalkBack3, sprites.castle.princess2WalkBack2],\n]\n\n//4-direction, but back side has only 1 image, so no ani when looking from back\nconst texturesSkelly = [\n    [sprites.castle.skellyWalkLeft1, sprites.castle.skellyWalkLeft2],\n    [sprites.castle.skellyWalkFront1, sprites.castle.skellyWalkFront2, sprites.castle.skellyWalkFront3],\n    [sprites.castle.skellyWalkRight1, sprites.castle.skellyWalkRight2],\n    [img`\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ..........ffff..........\n\t        ........ff1111ff........\n\t        .......fb111111bf.......\n\t        .......f11111111f.......\n\t        ......fd11111111df......\n\t        ......fd11111111df......\n\t        ......fd11111111df......\n\t        ......fb11111111bf......\n\t        ......fcd111111dcf......\n\t        .......fb111111bf.......\n\t        .....ffffdb1bdcfff......\n\t        ....fc111cfbfbc111cf....\n\t        ....f11111ffff11111f....\n\t        ....fbfbfbffffffbfbf....\n\t        .........ffffff.........\n\t        ..........fff...........\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ........................\n\t    `],\n]\n\nconst texturesPrincess = [\n    [sprites.castle.princessLeft0, sprites.castle.princessLeft1, sprites.castle.princessLeft0, sprites.castle.princessLeft2],\n    [sprites.castle.princessFront0, sprites.castle.princessFront1, sprites.castle.princessFront0, sprites.castle.princessFront2],\n    [],\n    [sprites.castle.princessBack0, sprites.castle.princessBack1, sprites.castle.princessBack0, sprites.castle.princessBack2],\n]\ntexturesPrincess[0].forEach((v, i) => {\n    texturesPrincess[2].push(v.clone())\n    texturesPrincess[2][i].flipX()\n}\n)\n\nfunction imagesFlipX(ani: Image[]) {\n    ani.forEach((img, i) => {\n        ani[i] = img.clone() //don't worry memery leak or waste, cause old images are still using by left\n        ani[i].flipX()\n    })\n}\n\n//////////////////////// end of animation.ts contents of previous version //////////////\n\n\n","_render_blocks.ts":"enum RCSpriteAttribute {\n    ZOffset,\n    ZPosition,\n    ZVelocity,\n    ZAcceleration\n}\n/**\n * A 2.5D Screen Render, using Raycasting algorithm\n **/\n//% color=#03AA74 weight=1 icon=\"\\uf1b2\" //cube f1b2 , fold f279\n//% groups='[\"Instance\",\"Basic\", \"Dimension Z\", \"Animate\", \"Advanced\"]'\n//% block=\"3D Render\"\nnamespace Render {\n    export enum attribute {\n        dirX,\n        dirY,\n        fov,\n        wallZScale,\n    }\n\n    export class Animations {\n        constructor(public frameInterval: number, public animations: Image[][]) {\n        }\n\n        msLast = 0\n        index = 0\n        iAnimation = 0\n        getFrameByDir(dir: number): Image {\n            if (control.millis() - this.msLast > this.frameInterval) {\n                this.msLast = control.millis()\n                this.index++\n                this.iAnimation = Math.round((dir * this.animations.length)) % this.animations.length\n                if (this.index >= this.animations[this.iAnimation].length)\n                    this.index = 0\n            }\n            return this.animations[this.iAnimation][this.index]\n        }\n    }\n\n    /**\n * Apply a directional image animations on a sprite\n * @param sprite the sprite to animate on\n * @param animations the directional animates\n */\n    //% blockId=set_animation\n    //% block=\"set $sprite=variables_get(mySprite) with animations$animations\"\n    //% animations.shadow=create_animation\n    //% group=\"Animate\"\n    //% weight=100\n    //% help=github:pxt-raycasting/docs/set-sprite-animations\n    export function setSpriteAnimations(sprite: Sprite, animations: Animations) {\n        raycastingRender.spriteAnimations[sprite.id] = animations\n    }\n\n    /**\n * Create a directional image animations, multi animations will applied to one round dirctions averagely, start from the left. \n * The reason that directions start from left, is almost all Arcade out-of-box 1 or 2-dirction images are facing left, so that would be convient for using.\n * @param frameInterval the time between changes, eg: 150\n * @param frames1 animation, if this is the first of multi animation it will be used as left, others will \n * @param frames2 optional, used for 2 or more dirctional\n * @param frames3 optional, used for 3 or more dirctional\n * @param frames4 optional, used for 4 or more dirctional\n */\n    //% blockId=create_animation\n    //% block=\"interval$frameInterval=timePicker animates:$frames1=animation_editor|| $frames2=animation_editor $frames3=animation_editor $frames4=animation_editor\"\n    //% inlineInputMode=inline\n    //% group=\"Animate\"\n    //% weight=100\n    //% help=github:pxt-raycasting/docs/create-animations\n    export function createAnimations(frameInterval: number, frames1: Image[], frames2?: Image[], frames3?: Image[], frames4?: Image[]): Animations {\n        const animationList = [frames1]\n        if (frames2) animationList.push(frames2)\n        if (frames3) animationList.push(frames3)\n        if (frames4) animationList.push(frames4)\n        return new Animations(frameInterval, animationList)\n    }\n\n    /**\n     * Get the Render\n     * @param img the image\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRCRenderInstance block=\"raycasting render\"\n    //% expandableArgumentMode=toggle\n    //% weight=100 \n    //% blockHidden=true\n    //% hidden=1\n    export function getRCRenderInstance(): RayCastingRender {\n        return raycastingRender\n    }\n\n    /**\n     * Get the render Sprite, which create automatically, for physical collisions, and holding the view point.\n     * You can consider it as \"myself\", and operate it like a usual sprite, eg.: position, speed, scale, collision, ...\n     * But properties relative 3D, eg. ZOffset, ZPosition, viewAngle, and etc. are not in the Sprite class.\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRenderSpriteVariable block=\"myself sprite\"\n    //% expandableArgumentMode=toggle\n    //% blockSetVariable=mySprite\n    //% weight=99\n    //% help=github:pxt-raycasting/get-render-sprite-variable\n    export function getRenderSpriteVariable(): Sprite {\n        return raycastingRender.sprSelf\n    }\n\n    /**\n     * Get the render Sprite, which create automatically, for physical collisions, and holding the view point.(but get/set view direction with dirX/dirY, which not in the Sprite class) \n     * You can consider it as \"myself\", and operate it like a usual sprite.\n     * eg: position, speed, scale, collision, ...\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRenderSpriteInstance block=\"myself sprite\"\n    //% expandableArgumentMode=toggle\n    //% weight=98\n    //% help=github:pxt-raycasting/docs/get-render-sprite-instance\n    export function getRenderSpriteInstance(): Sprite {\n        return raycastingRender.sprSelf\n    }\n\n    /**\n     * Toggle current view mode\n     */\n    //% blockId=rcRender_toggleViewMode block=\"toggle current view mode\"\n    //% group=\"Basic\"\n    //% weight=89\n    //% help=github:pxt-raycasting/docs/toggle-view-mode\n    export function toggleViewMode() {\n        raycastingRender.viewMode = raycastingRender.viewMode == ViewMode.tilemapView ? ViewMode.raycastingView : ViewMode.tilemapView\n    }\n\n    /**\n     * Current view mode is the specific one?\n     * @param viewMode\n     */\n    //% blockId=rcRender_isViewMode block=\"current is $viewMode\"\n    //% group=\"Basic\"\n    //% weight=88\n    //% help=github:pxt-raycasting/docs/is-view-mode\n    export function isViewMode(viewMode: ViewMode): boolean {\n        return viewMode == raycastingRender.viewMode\n    }\n\n    /**\n     * Set view mode\n     * @param viewMode\n     */\n    //% blockId=rcRender_setViewMode block=\"set view mode $viewMode\"\n    //% group=\"Basic\"\n    //% weight=87\n    //% help=github:pxt-raycasting/docs/set-view-mode\n    export function setViewMode(viewMode: ViewMode) {\n        raycastingRender.viewMode = viewMode\n    }\n\n    /**\n     * Get render arribute\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"get %attribute\" \n    //% blockId=rcRender_getAttribute\n    //% weight=83\n    //% help=github:pxt-raycasting/docs/get-attribute\n    export function getAttribute(attr: attribute): number {\n        switch (attr) {\n            case attribute.dirX:\n                return raycastingRender.dirX\n            case attribute.dirY:\n                return raycastingRender.dirY\n            case attribute.fov:\n                return raycastingRender.fov\n            case attribute.wallZScale:\n                return raycastingRender.wallZScale\n            default:\n                return 0\n        }\n    }\n\n    /**\n     * Set render arribute\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"set %attribute = %value\" \n    //% blockId=rcRender_setAttribute\n    //% weight=82\n    //% help=github:pxt-raycasting/docs/set-attribute\n    export function setAttribute(attr: attribute, value: number) {\n        switch (attr) {\n            case attribute.dirX:\n                raycastingRender.dirX = value\n                break\n            case attribute.dirY:\n                raycastingRender.dirY = value\n                break\n            case attribute.fov:\n                if (value < 0) value = 0\n                raycastingRender.fov = value\n                break\n            case attribute.wallZScale:\n                if (value < 0) value = 0\n                raycastingRender.wallZScale = value\n                break\n            default:\n        }\n    }\n\n    /**\n     * Get default FOV (field of view) value\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"defaultFov\"\n    //% blockId=rcRender_getDefaultFov\n    //% weight=81\n    //% help=github:pxt-raycasting/docs/get-default-fov\n    export function getDefaultFov(): number {\n        return defaultFov\n    }\n\n    /**\n     * Set view angle\n     * @param angle, unit: degree 0~360\n     */\n    //% blockId=rcRender_setViewAngleInDegree block=\"set view angle$angle\"\n    //% angle.min=0 angle.max=360 angle.defl=90\n    //% group=\"Basic\"\n    //% weight=80\n    //% help=github:pxt-raycasting/docs/set-view-angle-in-degree\n    export function setViewAngleInDegree(angle: number) {\n        raycastingRender.viewAngle = angle * Math.PI / 180\n    }\n\n    /**\n     * Set view angle by dirX and dirY\n     * @param dirX\n     * @param dirY\n     */\n    //% blockId=rcRender_setViewAngle block=\"set view angle by dirX%dirX and dirY%dirY\"\n    //% group=\"Basic\"\n    //% weight=79\n    //% help=github:pxt-raycasting/docs/set-view-angle\n    export function setViewAngle(dirX: number, dirY: number) {\n        raycastingRender.viewAngle = Math.atan2(dirY, dirX)\n    }\n\n    /**\n     * Set floating offset height for a sprite at Z direction\n     * @param sprite\n     * @param Zoffset Negative floats down, affirmative goes up\n     * @param duration moving time, 0 for immediately, unit: ms\n     */\n    //% blockId=rcRender_setZOffset block=\"set Sprite %spr=variables_get(mySprite) floating %offset pixels|| duration $duration=timePicker|ms \"\n    //% offset.min=-100 offset.max=100 offset.defl=8\n    //% duration.min=0 duration.max=5000 duration.defl=0\n    //% group=\"Dimension Z\"\n    //% weight=77\n    //% blockHidden\n    //% help=github:pxt-raycasting/docs/set-z-offset\n    export function setZOffset(sprite: Sprite, offset: number, duration?: number) {\n        raycastingRender.setZOffset(sprite, offset, duration)\n    }\n\n    /**\n     * Set arribute of a Sprite\n     * @param spr Sprite\n     * @param attr RCSpriteAttribute\n     */\n    //% group=\"Dimension Z\"\n    //% block=\"set Sprite %spr=variables_get(mySprite) %attribute = %value\"\n    //% blockId=rcRender_setSpriteAttribute\n    //% weight=75\n    //% help=github:pxt-raycasting/docs/set-sprite-attribute\n    export function setSpriteAttribute(spr: Sprite, attr: RCSpriteAttribute, value: number) {\n        switch (attr) {\n            case RCSpriteAttribute.ZOffset:\n                raycastingRender.getMotionZ(spr).offset = value\n                break\n            case RCSpriteAttribute.ZPosition:\n                raycastingRender.getMotionZ(spr).p = value\n                break\n            case RCSpriteAttribute.ZVelocity:\n                raycastingRender.getMotionZ(spr).v = value\n                break\n            case RCSpriteAttribute.ZAcceleration:\n                raycastingRender.getMotionZ(spr).a = value\n                break\n            default:\n        }\n    }\n\n    /**\n     * Get arribute of a Sprite\n     * @param spr Sprite\n     * @param attr RCSpriteAttribute\n     */\n    //% group=\"Dimension Z\"\n    //% block=\"get Sprite %spr=variables_get(mySprite) %attribute\"\n    //% blockId=rcRender_getSpriteAttribute\n    //% weight=74\n    //% help=github:pxt-raycasting/docs/get-sprite-attribute\n    export function getSpriteAttribute(spr: Sprite, attr: RCSpriteAttribute): number {\n        switch (attr) {\n            case RCSpriteAttribute.ZOffset:\n                return raycastingRender.getMotionZ(spr).offset\n            case RCSpriteAttribute.ZPosition:\n                return raycastingRender.getMotionZ(spr).p\n            case RCSpriteAttribute.ZVelocity:\n                return raycastingRender.getMotionZ(spr).v\n            case RCSpriteAttribute.ZAcceleration:\n                return raycastingRender.getMotionZ(spr).a\n            default:\n                return 0\n        }\n    }\n\n    /**\n     * Check if 2 sprites overlaps each another in Z dimension\n     * Best work together with sprites.onOverlap(kind1, kind2)\n     * @param sprite1\n     * @param sprite2\n     */\n    //% blockId=rcRender_isSpritesOverlapZ\n    //% block=\"is sprites $sprite1=variables_get(mySprite) and $sprite2=variables_get(mySprite2) overlaps in Z dimension\"\n    //% group=\"Dimension Z\"\n    //% weight=71\n    //% help=github:pxt-raycasting/docs/is-sprites-overlap-z\n    export function isSpritesOverlapZ(sprite1: Sprite, sprite2: Sprite): boolean {\n        return raycastingRender.isOverlapZ(sprite1, sprite2)\n    }\n\n    /**\n     * Make sprite jump, with specific height and duration\n     * Jump can only happened when sprite is standing, current height = its offset .\n     * @param sprite\n     * @param height jump height in pixel\n     * @param duration hover time span, unit: ms\n     */\n    //% blockId=rcRender_jumpWithHeightAndDuration block=\"Sprite %spr=variables_get(mySprite) jump, with height $height duration $duration=timePicker|ms \"\n    //% height.min=0 height.max=100 height.defl=16\n    //% duration.min=50 duration.max=5000 duration.defl=500\n    //% group=\"Dimension Z\"\n    //% weight=70\n    //% help=github:pxt-raycasting/docs/jump-with-height-and-duration\n    export function jumpWithHeightAndDuration(sprite: Sprite, height: number, duration: number) {\n        raycastingRender.jumpWithHeightAndDuration(sprite, height, duration)\n    }\n\n    /**\n     * Make sprite jump, with specific speed and acceleration\n     * Simular with Move block, but jump can only happened when sprite is standing, current height = its offset.\n     * @param sprite\n     * @param v vetical speed, unit: pixel/s\n     * @param a vetical acceleration, unit: pixel/s\n     */\n    //% blockId=rcRender_jump block=\"Sprite %spr=variables_get(mySprite) jump||, with speed $v=spriteSpeedPicker acceleration $a\"\n    //% v.min=-100 v.max=100 v.defl=60\n    //% a.min=-1000 a.max=1000 a.defl=-250\n    //% group=\"Dimension Z\"\n    //% weight=68\n    //% help=github:pxt-raycasting/docs/jump\n    export function jump(sprite: Sprite, v?: number, a?: number) {\n        raycastingRender.jump(sprite, v, a)\n    }\n\n    /**\n     * Make sprite jump, with specific speed and acceleration\n     * @param sprite\n     * @param v vetical speed, unit: pixel/s\n     * @param a vetical acceleration, unit: pixel/s\n     */\n    //% blockId=rcRender_move block=\"Sprite %spr=variables_get(mySprite) move, with speed $v=spriteSpeedPicker|| acceleration $a\"\n    //% v.min=-200 v.max=200 v.defl=60\n    //% a.min=-1000 a.max=1000 a.defl=-250\n    //% group=\"Dimension Z\"\n    //% weight=66\n    //% help=github:pxt-raycasting/docs/move\n    export function move(sprite: Sprite, v?: number, a?: number) {\n        raycastingRender.move(sprite, v, a)\n    }\n\n    /**\n     * Control the self sprite using the direction buttons from the controller. \n     * To stop controlling self sprite, pass 0 for v and va.\n     *\n     * @param v The velocity used for forward/backword movement when up/down is pressed, in pixel/s\n     * @param va The angle velocity used for turn view direction when left/right is pressed, in radian/s.\n     */\n    //% blockId=\"rcRender_moveWithController\" block=\"move with buttons velocity $v|| turn speed $va camera sway$cameraSway pixels\"\n    //% weight=60\n    //% expandableArgumentMode=\"toggle\"\n    //% v.defl=2 va.defl=3\n    //% group=\"Advanced\"\n    //% v.shadow=\"spriteSpeedPicker\"\n    //% va.shadow=\"spriteSpeedPicker\"\n    //% help=github:pxt-raycasting/docs/move-with-controller\n    export function moveWithController(v: number = 2, va: number = 3, cameraSway?: number) {\n        raycastingRender.velocity = v\n        raycastingRender.velocityAngle = va\n        if (cameraSway != undefined)\n            raycastingRender.cameraSway = cameraSway | 0\n    }\n\n    /**\n     * Render takeover all sprites in current scene\n     * Render will call this automatically, but maybe not in time enough.\n     * If you saw sprite draw at its tilemap position on screen, call this just after created the sprite.\n     */\n    //% blockId=rcRender_takeoverSceneSprites \n    //% block=\"takeover sprites in scene\"\n    //% group=\"Advanced\"\n    //% weight=49\n    //% help=github:pxt-raycasting/docs/takeover-scene-sprites\n    export function takeoverSceneSprites() {\n        raycastingRender.takeoverSceneSprites()\n    }\n\n    /**\n     * Run on sprite dirction updated, present view point to Sprite facing dirction, or which angle you see of the sprite.\n     * Just using with other animation extensions, to set proper Image for sprite.\n     * Not required, if you have used the set animations block provided.\n     * @param dir It is a float number, 0~1 corresponds to 0~360, suggest use Math.round(dir*dirAniTotalCount)%dirAniTotalCount to get index of direction\n     */\n    //% blockId=rcRender_registerOnSpriteDirectionUpdateHandler\n    //% block=\"run code when sprite $spr dirction updated to $dir\"\n    //% draggableParameters\n    //% group=\"Advanced\"\n    //% weight=48\n    //% help=github:pxt-raycasting/docs/register-on-sprite-direction-update-handler\n    export function registerOnSpriteDirectionUpdateHandler(handler: (spr: Sprite, dir: number) => void) {\n        raycastingRender.registerOnSpriteDirectionUpdate(handler)\n    }\n}\n","_render_raycasting.ts":"//% shim=pxt::updateScreen\nfunction updateScreen(img: Image) { }\n\nenum ViewMode {\n    //% block=\"TileMap Mode\"\n    tilemapView,\n    //% block=\"Raycasting Mode\"\n    raycastingView,\n}\n\nnamespace Render {\n    const SH = screen.height, SHHalf = SH / 2\n    const SW = screen.width, SWHalf = SW / 2\n    const fpx = 8\n    const fpx_scale = 2 ** fpx\n    function tofpx(n: number) { return (n * fpx_scale) | 0 }\n    const one = 1 << fpx\n    const one2 = 1 << (fpx + fpx)\n    const FPX_MAX = (1 << fpx) - 1\n\n    class MotionSet1D {\n        p: number\n        v: number = 0\n        a: number = 0\n        constructor(public offset: number) {\n            this.p = offset\n        }\n    }\n\n    export const defaultFov = SW / SH / 2  //Wall just fill screen height when standing 1 tile away\n\n    export class RayCastingRender {\n        private tempScreen: Image = image.create(SW, SH)\n\n        velocityAngle: number = 2\n        velocity: number = 3\n        protected _viewMode = ViewMode.raycastingView\n        protected dirXFpx: number\n        protected dirYFpx: number\n        protected planeX: number\n        protected planeY: number\n        protected _angle: number\n        protected _fov: number\n        protected _wallZScale: number = 1\n        cameraSway = 0\n        protected isWalking = false\n        protected cameraOffsetX = 0\n        protected cameraOffsetZ_fpx = 0\n\n        //sprites & accessories\n        sprSelf: Sprite\n        sprites: Sprite[] = []\n        sprites2D: Sprite[] = []\n        spriteParticles: particles.ParticleSource[] = []\n        spriteLikes: SpriteLike[] = []\n        spriteAnimations: Animations[] = []\n        protected spriteMotionZ: MotionSet1D[] = []\n        protected sayRederers: sprites.BaseSpriteSayRenderer[] = []\n        protected sayEndTimes: number[] = []\n\n        //reference\n        protected tilemapScaleSize = 1 << TileScale.Sixteen\n        map: tiles.TileMapData\n        bg: Image\n        textures: Image[]\n        protected oldRender: scene.Renderable\n        protected myRender: scene.Renderable\n\n        //render\n        protected wallHeightInView: number\n        protected wallWidthInView: number\n        protected dist: number[] = []\n        //render perf const\n        cameraRangeAngle: number\n        viewZPos: number\n        selfXFpx: number\n        selfYFpx: number\n\n        //for drawing sprites\n        protected invDet: number //required for correct matrix multiplication\n        camera: scene.Camera\n        tempSprite: Sprite = sprites.create(img`0`)\n        protected transformX: number[] = []\n        protected transformY: number[] = []\n        protected angleSelfToSpr: number[] = []\n\n        onSpriteDirectionUpdateHandler: (spr: Sprite, dir: number) => void\n\n        get xFpx(): number {\n            return Fx.add(this.sprSelf._x, Fx.div(this.sprSelf._width, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        // set xFpx(v: number) {\n        //     this.sprSelf._x = v * this.tilemapScaleSize as any as Fx8\n        // }\n\n        get yFpx(): number {\n            return Fx.add(this.sprSelf._y, Fx.div(this.sprSelf._height, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        // set yFpx(v: number) {\n        //     this.sprSelf._y = v * this.tilemapScaleSize as any as Fx8\n        // }\n\n        get dirX(): number {\n            return this.dirXFpx / fpx_scale\n        }\n\n        get dirY(): number {\n            return this.dirYFpx / fpx_scale\n        }\n\n        set dirX(v: number) {\n            this.dirXFpx = v * fpx_scale\n        }\n\n        set dirY(v: number) {\n            this.dirYFpx = v * fpx_scale\n        }\n\n        sprXFx8(spr: Sprite) {\n            return Fx.add(spr._x, Fx.div(spr._width, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        sprYFx8(spr: Sprite) {\n            return Fx.add(spr._y, Fx.div(spr._height, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        get fov(): number {\n            return this._fov\n        }\n\n        set fov(fov: number) {\n            this._fov = fov\n            this.wallHeightInView = (SW << (fpx - 1)) / this._fov\n            this.wallWidthInView = this.wallHeightInView >> fpx // not fpx  // wallSize / this.fov * 4 / 3 * 2\n            this.cameraRangeAngle = Math.atan(this.fov) + .1 //tolerance for spr center just out of camera\n\n            this.setVectors()\n        }\n\n        get viewAngle(): number {\n            return this._angle\n        }\n        set viewAngle(angle: number) {\n            this._angle = angle\n            this.setVectors()\n            this.updateSelfImage()\n        }\n\n        get wallZScale(): number {\n            return this._wallZScale\n        }\n        set wallZScale(v: number) {\n            this._wallZScale = v\n        }\n\n        getMotionZ(spr: Sprite, offsetZ: number = 0) {\n            let motionZ = this.spriteMotionZ[spr.id]\n            if (!motionZ) {\n                motionZ = new MotionSet1D(tofpx(offsetZ))\n                this.spriteMotionZ[spr.id] = motionZ\n            }\n            return motionZ\n        }\n\n        getZOffset(spr: Sprite) {\n            return this.getMotionZ(spr).offset / fpx_scale\n        }\n\n        setZOffset(spr: Sprite, offsetZ: number, duration: number = 500) {\n            const motionZ = this.getMotionZ(spr, offsetZ)\n\n            motionZ.offset = tofpx(offsetZ)\n            if (motionZ.p != motionZ.offset) {\n                if (duration === 0)\n                    motionZ.p = motionZ.offset\n                else if (motionZ.v == 0)\n                    this.move(spr, (motionZ.offset - motionZ.p) / fpx_scale * 1000 / duration, 0)\n            }\n        }\n\n        getMotionZPosition(spr: Sprite) {\n            return this.getMotionZ(spr).p / fpx_scale\n        }\n\n        //todo, use ZHeight(set from sprite.Height when takeover, then sprite.Height will be replace with width)\n        isOverlapZ(sprite1: Sprite, sprite2: Sprite): boolean {\n            const p1 = this.getMotionZPosition(sprite1)\n            const p2 = this.getMotionZPosition(sprite2)\n            if (p1 < p2) {\n                if (p1 + sprite1.height > p2) return true\n            } else {\n                if (p2 + sprite2.height > p1) return true\n            }\n            return false\n        }\n\n        move(spr: Sprite, v: number, a: number) {\n            const motionZ = this.getMotionZ(spr)\n\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        jump(spr: Sprite, v: number, a: number) {\n            const motionZ = this.getMotionZ(spr)\n            if (motionZ.p != motionZ.offset)\n                return\n\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        jumpWithHeightAndDuration(spr: Sprite, height: number, duration: number) {\n            const motionZ = this.getMotionZ(spr)\n            if (motionZ.p != motionZ.offset)\n                return\n\n            // height= -v*v/a/2\n            // duration = -v/a*2 *1000\n            const v = height * 4000 / duration\n            const a = -v * 2000 / duration\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        get viewMode(): ViewMode {\n            return this._viewMode\n        }\n\n        set viewMode(v: ViewMode) {\n            this._viewMode = v\n        }\n\n        updateViewZPos() {\n            this.viewZPos = this.spriteMotionZ[this.sprSelf.id].p + (this.sprSelf._height as any as number) - (2 << fpx)\n        }\n\n        takeoverSceneSprites() {\n            const sc_allSprites = game.currentScene().allSprites\n            for (let i = 0; i < sc_allSprites.length;) {\n                const spr = sc_allSprites[i]\n                if (spr instanceof Sprite) {\n                    const sprList = (spr.flags & sprites.Flag.RelativeToCamera) ? this.sprites2D : this.sprites\n                    if (sprList.indexOf(spr) < 0) {\n                        sprList.push(spr as Sprite)\n                        this.getMotionZ(spr, 0)\n                        spr.onDestroyed(() => {\n                            this.sprites.removeElement(spr as Sprite)   //can be in one of 2 lists\n                            this.sprites2D.removeElement(spr as Sprite) //can be in one of 2 lists\n                            const sayRenderer = this.sayRederers[spr.id]\n                            if (sayRenderer) {\n                                this.sayRederers.removeElement(sayRenderer)\n                                sayRenderer.destroy()\n                            }\n                        })\n                    }\n                } else if (spr instanceof particles.ParticleSource) {\n                    const particle = (spr as particles.ParticleSource)\n                    if (this.spriteParticles.indexOf(particle) < 0) {\n                        this.spriteParticles[(particle.anchor as Sprite).id] = particle\n                        particle.anchor = this.tempSprite\n                    }\n                } else {\n                    if (this.spriteLikes.indexOf(spr) < 0)\n                        this.spriteLikes.push(spr)\n                }\n                sc_allSprites.removeElement(spr)\n            }\n            this.sprites.forEach((spr) => {\n                if (spr)\n                    this.takeoverSayRenderOfSprite(spr)\n            })\n        }\n        takeoverSayRenderOfSprite(sprite: Sprite) {\n            const sprite_as_any = (sprite as any)\n            if (sprite_as_any.sayRenderer) {\n                this.sayRederers[sprite.id] = sprite_as_any.sayRenderer\n                this.sayEndTimes[sprite.id] = sprite_as_any.sayEndTime;\n                sprite_as_any.sayRenderer = undefined\n                sprite_as_any.sayEndTime = undefined\n            }\n        }\n\n        tilemapLoaded() {\n            const sc = game.currentScene()\n            this.map = sc.tileMap.data\n            this.textures = sc.tileMap.data.getTileset()\n            this.tilemapScaleSize = 1 << sc.tileMap.data.scale\n            this.oldRender = sc.tileMap.renderable\n            this.spriteLikes.removeElement(this.oldRender)\n            sc.allSprites.removeElement(this.oldRender)\n\n            let frameCallback_update = sc.eventContext.registerFrameHandler(scene.PRE_RENDER_UPDATE_PRIORITY + 1, () => {\n                const dt = sc.eventContext.deltaTime;\n                // sc.camera.update();  // already did in scene\n                for (const s of this.sprites)\n                    s.__update(sc.camera, dt);\n                this.sprSelf.__update(sc.camera, dt)\n            })\n\n            let frameCallback_draw = sc.eventContext.registerFrameHandler(scene.RENDER_SPRITES_PRIORITY + 1, () => {\n                if (this._viewMode == ViewMode.tilemapView) {\n                   // screen.drawImage(sc.background.image, 0, 0)\n                    this.oldRender.__drawCore(sc.camera)\n                    this.sprites.forEach(spr => spr.__draw(sc.camera))\n                    this.sprSelf.__draw(sc.camera)\n                } else {\n                 //   this.tempScreen.drawImage(sc.background.image, 0, 0)\n                    //debug\n                    // const ms=control.micros()\n                    this.render()\n                    // info.setScore(control.micros()-ms)\n                    screen.fill(0)\n                }\n                this.sprites2D.forEach(spr => spr.__draw(sc.camera))\n                this.spriteLikes.forEach(spr => spr.__draw(sc.camera))\n                if (this._viewMode == ViewMode.raycastingView)\n                    this.tempScreen.drawTransparentImage(screen, 0, 0)\n            })\n\n            sc.tileMap.addEventListener(tiles.TileMapEvent.Unloaded, data => {\n                sc.eventContext.unregisterFrameHandler(frameCallback_update)\n                sc.eventContext.unregisterFrameHandler(frameCallback_draw)\n            })\n\n            // this.myRender = scene.createRenderable(\n            //     scene.TILE_MAP_Z,\n            //     (t, c) => this.trace(t, c)\n            // )\n\n        }\n\n        constructor() {\n            this._angle = 0\n            this.fov = defaultFov\n            this.camera = new scene.Camera()\n\n            const sc = game.currentScene()\n            if (!sc.tileMap) {\n                sc.tileMap = new tiles.TileMap();\n            } else {\n                this.tilemapLoaded()\n            }\n            game.currentScene().tileMap.addEventListener(tiles.TileMapEvent.Loaded, data => this.tilemapLoaded())\n\n            //self sprite\n            this.sprSelf = sprites.create(image.create(this.tilemapScaleSize >> 1, this.tilemapScaleSize >> 1), SpriteKind.Player)\n            this.takeoverSceneSprites()\n            this.sprites.removeElement(this.sprSelf)\n            this.updateViewZPos()\n            scene.cameraFollowSprite(this.sprSelf)\n            this.updateSelfImage()\n\n            game.onUpdate(function () {\n                this.updateControls()\n            })\n\n            game.onUpdateInterval(400, () => {\n                for (let i = 0; i < this.sprites.length;) {\n                    const spr = this.sprites[i]\n                    if (spr.flags & sprites.Flag.RelativeToCamera) {\n                        this.sprites.removeElement(spr)\n                        this.sprites2D.push(spr)\n                    } else { i++ }\n                }\n                for (let i = 0; i < this.sprites2D.length;) {\n                    const spr = this.sprites2D[i]\n                    if (!(spr.flags & sprites.Flag.RelativeToCamera)) {\n                        this.sprites2D.removeElement(spr)\n                        this.sprites.push(spr)\n                    } else { i++ }\n                }\n                this.takeoverSceneSprites() // in case some one new\n            })\n\n\n            game.onUpdateInterval(25, () => {\n                if (this.cameraSway && this.isWalking) {\n                    this.cameraOffsetX = (Math.sin(control.millis() / 150) * this.cameraSway * 3) | 0\n                    this.cameraOffsetZ_fpx = tofpx(Math.cos(control.millis() / 75) * this.cameraSway) | 0\n                }\n            });\n            control.__screen.setupUpdate(() => {\n                if (this.viewMode == ViewMode.raycastingView)\n                    updateScreen(this.tempScreen)\n                else\n                    updateScreen(screen)\n            })\n\n            game.addScenePushHandler((oldScene) => {\n                control.__screen.setupUpdate(() => { updateScreen(screen) })\n            })\n            game.addScenePopHandler((oldScene) => {\n                control.__screen.setupUpdate(() => {\n                    if (this.viewMode == ViewMode.raycastingView)\n                        updateScreen(this.tempScreen)\n                    else\n                        updateScreen(screen)\n                })\n            })\n        }\n\n        private setVectors() {\n            const sin = Math.sin(this._angle)\n            const cos = Math.cos(this._angle)\n            this.dirXFpx = tofpx(cos)\n            this.dirYFpx = tofpx(sin)\n            this.planeX = tofpx(sin * this._fov)\n            this.planeY = tofpx(cos * -this._fov)\n        }\n\n        //todo, pre-drawn dirctional image\n        public updateSelfImage() {\n            const img = this.sprSelf.image\n            img.fill(6)\n            const arrowLength = img.width / 2\n            img.drawLine(arrowLength, arrowLength, arrowLength + this.dirX * arrowLength, arrowLength + this.dirY * arrowLength, 2)\n            img.fillRect(arrowLength - 1, arrowLength - 1, 2, 2, 2)\n        }\n\n        updateControls() {\n            if (this.velocityAngle !== 0) {\n                const dx = controller.dx(this.velocityAngle)\n                if (dx) {\n                    this.viewAngle += dx\n                }\n            }\n            if (this.velocity !== 0) {\n                this.isWalking = true\n                const dy = controller.dy(this.velocity)\n                if (dy) {\n                    const nx = this.xFpx - Math.round(this.dirXFpx * dy)\n                    const ny = this.yFpx - Math.round(this.dirYFpx * dy)\n                    this.sprSelf.setPosition((nx * this.tilemapScaleSize / fpx_scale), (ny * this.tilemapScaleSize / fpx_scale))\n                } else {\n                    this.isWalking = false\n                }\n            }\n\n            for (const spr of this.sprites) {\n                this.updateMotionZ(spr)\n            }\n            this.updateMotionZ(this.sprSelf)\n        }\n\n        updateMotionZ(spr: Sprite) {\n            const dt = game.eventContext().deltaTime\n            const motionZ = this.spriteMotionZ[spr.id]\n            //if (!motionZ) continue\n\n            if (motionZ.v != 0 || motionZ.p != motionZ.offset) {\n                motionZ.v += motionZ.a * dt, motionZ.p += motionZ.v * dt\n                //landing\n                if ((motionZ.a >= 0 && motionZ.v > 0 && motionZ.p > motionZ.offset) ||\n                    (motionZ.a <= 0 && motionZ.v < 0 && motionZ.p < motionZ.offset)) { motionZ.p = motionZ.offset, motionZ.v = 0 }\n                if (spr === this.sprSelf)\n                    this.updateViewZPos()\n            }\n\n        }\n\n\n        blitRowBreak(screenX: number, screenUp: number, screenDown: number, source: Image, sourceX: number, sourceYBreak: number) {\n\n            let stepY = (sourceYBreak) / (SHHalf - screenUp )\n            let sourceY = sourceYBreak - stepY\n            let y = SHHalf -1\n            if (screenUp < 0)\n                screenUp = 0\n            while (y  >= Math.ceil(screenUp)-1) {\n                if (sourceY < 0) \n                    sourceY = 0\n                const c = source.getPixel(sourceX, sourceY)\n                this.tempScreen.setPixel(screenX, y, c)\n                y--\n                sourceY -= stepY\n            }\n            // from screen half  going down\n            stepY = (source.height - sourceYBreak) / (screenDown - SHHalf)\n            sourceY = sourceYBreak \n            y = SHHalf\n            if (screenDown > SH)\n                screenDown = SH\n            while (y < Math.round(screenDown)) {\n                const c = source.getPixel(sourceX, sourceY)\n                this.tempScreen.setPixel(screenX, y, c)\n                y++\n                sourceY += stepY\n            }\n\n        }\n        \n        render() {\n            // based on https://lodev.org/cgtutor/raycasting.html\n            this.selfXFpx = this.xFpx\n            this.selfYFpx = this.yFpx\n\n            let drawStart = 0\n            let drawHeight = 0\n            let lastDist = -1, lastTexX = -1, lastMapX = -1, lastMapY = -1\n            this.viewZPos = this.spriteMotionZ[this.sprSelf.id].p + (this.sprSelf._height as any as number) - (2 << fpx) + this.cameraOffsetZ_fpx\n            let cameraRangeAngle = Math.atan(this.fov) + .1 //tolerance for spr center just out of camera\n            //debug\n            // const ms=control.millis()\n\n            \n\n\n            const tex = this.textures[1]\n            let rayDirX0 = this.dirXFpx / fpx_scale + (this.planeX / fpx_scale)\n            let rayDirY0 = this.dirYFpx / fpx_scale + (this.planeY / fpx_scale)\n            let rayDirX1 = this.dirXFpx / fpx_scale - (this.planeX / fpx_scale)\n            let rayDirY1 = this.dirYFpx / fpx_scale - (this.planeY / fpx_scale)\n            let fmapX = this.selfXFpx / fpx_scale\n            let fmapY = this.selfYFpx / fpx_scale\n\n            const sc = game.currentScene() \n           // background\n            const speed = 2 // 2: normal speed\n            let backgroundOffset = (this._angle / Math.PI * speed ) % 1  // range -1..1\n            if (backgroundOffset < 0) backgroundOffset++  // range 0..1\n            backgroundOffset *= SW    // range 0..screenwidth\n            \n            //floor\n            for (let y = 60; y < SH; y++) {\n                let p = y - SHHalf\n                let posZ = SH * this.viewZPos / this.tilemapScaleSize / fpx_scale\n                let rowDistance = posZ / p\n                let floorStepX = rowDistance * (rayDirX1 - rayDirX0) / SW\n                let floorStepY = rowDistance * (rayDirY1 - rayDirY0) / SW\n\n\n\n                let floorX = fmapX + rowDistance * rayDirX0\n                let floorY = fmapY + rowDistance * rayDirY0\n                for (let x = 0; x < SW; x++) {\n                      let cellX = Math.floor(floorX)\n                     let cellY = Math.floor(floorY)\n                    let tx =  (16 * (floorX - cellX)) & 15\n                      let ty = (16 * (floorY - cellY)) & (15)\n                    let mapX = Math.round(floorX - 0.5) % 16\n                    let mapY = Math.round(floorY - 0.5) % 16\n                    let tileType = this.map.getTile(mapX, mapY)\n                    let floorTex = this.textures[tileType]\n                    floorX += floorStepX\n                    floorY += floorStepY\n                    let c = floorTex.getPixel(tx, ty)\n                    this.tempScreen.setPixel(x, y, c)\n\n                }\n\n\n\n            }\n            // walls\n\n            for (let x = 0; x < SW; x++) {\n                const cameraX: number = one - Math.idiv(((x + this.cameraOffsetX) << fpx) << 1, SW)\n                let rayDirX = this.dirXFpx + (this.planeX * cameraX >> fpx)\n                let rayDirY = this.dirYFpx + (this.planeY * cameraX >> fpx)\n\n                // avoid division by zero\n                if (rayDirX == 0) rayDirX = 1\n                if (rayDirY == 0) rayDirY = 1\n\n                let mapX = this.selfXFpx >> fpx\n                let mapY = this.selfYFpx >> fpx\n\n                // length of ray from current position to next x or y-side\n                let sideDistX = 0, sideDistY = 0\n\n                // length of ray from one x or y-side to next x or y-side\n                const deltaDistX = Math.abs(Math.idiv(one2, rayDirX));\n                const deltaDistY = Math.abs(Math.idiv(one2, rayDirY));\n\n                let mapStepX = 0, mapStepY = 0\n\n                let sideWallHit = false;\n\n                //calculate step and initial sideDist\n                if (rayDirX < 0) {\n                    mapStepX = -1;\n                    sideDistX = ((this.selfXFpx - (mapX << fpx)) * deltaDistX) >> fpx;\n                } else {\n                    mapStepX = 1;\n                    sideDistX = (((mapX << fpx) + one - this.selfXFpx) * deltaDistX) >> fpx;\n                }\n                if (rayDirY < 0) {\n                    mapStepY = -1;\n                    sideDistY = ((this.selfYFpx - (mapY << fpx)) * deltaDistY) >> fpx;\n                } else {\n                    mapStepY = 1;\n                    sideDistY = (((mapY << fpx) + one - this.selfYFpx) * deltaDistY) >> fpx;\n                }\n\n                let color = 0\n\n                while (true) {\n                    //jump to next map square, OR in x-direction, OR in y-direction\n                    if (sideDistX < sideDistY) {\n                        sideDistX += deltaDistX;\n                        mapX += mapStepX;\n                        sideWallHit = false;\n                    } else {\n                        sideDistY += deltaDistY;\n                        mapY += mapStepY;\n                        sideWallHit = true;\n                    }\n\n                    if (this.map.isOutsideMap(mapX, mapY))\n                        break\n                    color = this.map.getTile(mapX, mapY)\n                    if  (this.map.isWall(mapX, mapY))\n                        break; // hit!\n                }\n\n                if (this.map.isOutsideMap(mapX, mapY))\n                    continue\n\n                let perpWallDist = 0\n                let wallX = 0\n                if (!sideWallHit) {\n                    perpWallDist = Math.idiv(((mapX << fpx) - this.selfXFpx + (1 - mapStepX << fpx - 1)) << fpx, rayDirX)\n                    wallX = this.selfYFpx + (perpWallDist * rayDirY >> fpx);\n                } else {\n                    perpWallDist = Math.idiv(((mapY << fpx) - this.selfYFpx + (1 - mapStepY << fpx - 1)) << fpx, rayDirY)\n                    wallX = this.selfXFpx + (perpWallDist * rayDirX >> fpx);\n                }\n                wallX &= FPX_MAX\n\n                // color = (color - 1) * 2\n                // if (sideWallHit) color++\n\n                const tex = this.textures[color]\n                if (!tex)\n                    continue\n\n                let texX = (wallX * tex.width) >> fpx;\n                // if ((!sideWallHit && rayDirX > 0) || (sideWallHit && rayDirY < 0))\n                //     texX = tex.width - texX - 1;\n\n                const lineHeight = (this.wallHeightInView / perpWallDist)\n                const drawEnd = lineHeight * this.viewZPos / this.tilemapScaleSize / fpx_scale;\n                const horizontBreak = 1 - this.viewZPos / this.tilemapScaleSize / fpx_scale;\n                if (perpWallDist !== lastDist && (texX !== lastTexX || mapX !== lastMapX || mapY !== lastMapY)) {//neighbor line of tex share same parameters\n                     \n                    drawStart = drawEnd - lineHeight * (this._wallZScale) ;\n                    drawHeight = (Math.ceil(drawEnd) - Math.ceil(drawStart) )\n                    drawStart += (SH >> 1)\n\n                    lastDist = perpWallDist\n                    lastTexX = texX\n                    lastMapX = mapX\n                    lastMapY = mapY\n                }\n                //fix start&end points to avoid regmatic between lines\n               \n\n                //if (x < SWHalf)\n                //    this.tempScreen.blitRow(x, drawStart, tex, texX, drawHeight)\n                //else\n                    this.blitRowBreak(x, SHHalf + drawEnd - lineHeight, SHHalf + drawEnd, tex, texX, tex.height * horizontBreak)\n\n                this.dist[x] = perpWallDist\n\n                // background \n                for (let y = 0; y < drawStart; y++ ){\n                    let backX = (backgroundOffset + x) % SW\n                    let c = sc.background.image.getPixel(backX,y)\n                    this.tempScreen.setPixel(x,y,c)\n                }\n            }\n            //debug\n            // info.setScore(control.millis()-ms)\n           // this.tempScreen.print(backgroundOffset.toString(), 0,0,7 )\n           // this.tempScreen.print([Math.roundWithPrecision(this._angle, 3)].join(), 20, 5)\n\n            this.drawSprites()\n        }\n\n        drawSprites() {\n            //debug\n            // let msSprs=control.millis()\n            /////////////////// sprites ///////////////////\n\n            //for sprite\n            const invDet = one2 / (this.planeX * this.dirYFpx - this.dirXFpx * this.planeY); //required for correct matrix multiplication\n\n            this.sprites\n                .filter((spr, i) => {\n                    const spriteX = this.sprXFx8(spr) - this.xFpx // this.selfXFpx\n                    const spriteY = this.sprYFx8(spr) - this.yFpx // this.selfYFpx\n                    this.angleSelfToSpr[spr.id] = Math.atan2(spriteX, spriteY)\n                    this.transformX[spr.id] = invDet * (this.dirYFpx * spriteX - this.dirXFpx * spriteY) >> fpx;\n                    this.transformY[spr.id] = invDet * (-this.planeY * spriteX + this.planeX * spriteY) >> fpx; //this is actually the depth inside the screen, that what Z is in 3D\n                    const angleInCamera = Math.atan2(this.transformX[spr.id] * this.fov, this.transformY[spr.id])\n                    return angleInCamera > -this.cameraRangeAngle && angleInCamera < this.cameraRangeAngle //(this.transformY[spr.id] > 0\n                }).sort((spr1, spr2) => {   // far to near\n                    return (this.transformY[spr2.id] - this.transformY[spr1.id])\n                }).forEach((spr, index) => {\n                    //debug\n                    // this.tempScreen.print([spr.id,Math.roundWithPrecision(angle[spr.id],3)].join(), 0, index * 10 + 10,9)\n                    this.drawSprite(spr, index, this.transformX[spr.id], this.transformY[spr.id], this.angleSelfToSpr[spr.id])\n                })\n\n            //debug\n            // info.setLife(control.millis() - msSprs+1)\n             //this.tempScreen.print([Math.roundWithPrecision(this._angle,3)].join(), 20,  0)\n\n        }\n\n        registerOnSpriteDirectionUpdate(handler: (spr: Sprite, dir: number) => void) {\n            this.onSpriteDirectionUpdateHandler = handler\n        }\n\n        drawSprite(spr: Sprite, index: number, transformX: number, transformY: number, myAngle: number) {\n            const spriteScreenX = Math.ceil((SWHalf) * (1 - transformX / transformY)) - this.cameraOffsetX;\n            const spriteScreenHalfWidth = Math.idiv((spr._width as any as number) / this.tilemapScaleSize / 2 * this.wallWidthInView, transformY)  //origin: (texSpr.width / 2 << fpx) / transformY / this.fov / 3 * 2 * 4\n            const spriteScreenLeft = spriteScreenX - spriteScreenHalfWidth\n            const spriteScreenRight = spriteScreenX + spriteScreenHalfWidth\n\n            //calculate drawing range in X direction\n            //assume there is one range only\n            let blitX = 0, blitWidth = 0\n            for (let sprX = 0; sprX < SW; sprX++) {\n                if (this.dist[sprX] > transformY) {\n                    if (blitWidth == 0)\n                        blitX = sprX\n                    blitWidth++\n                } else if (blitWidth > 0) {\n                    if (blitX <= spriteScreenRight && blitX + blitWidth >= spriteScreenLeft)\n                        break\n                    else\n                        blitX = 0, blitWidth = 0;\n                }\n            }\n            // this.tempScreen.print([this.getxFx8(spr), this.getyFx8(spr)].join(), 0,index*10+10)\n            const blitXSpr = Math.max(blitX, spriteScreenLeft)\n            const blitWidthSpr = Math.min(blitX + blitWidth, spriteScreenRight) - blitXSpr\n            if (blitWidthSpr <= 0)\n                return\n\n            const lineHeight = Math.idiv(this.wallHeightInView, transformY)\n            const drawStart = SHHalf + (lineHeight * ((this.viewZPos - this.spriteMotionZ[spr.id].p - (spr._height as any as number)) / this.tilemapScaleSize) >> fpx)\n\n            //for textures=image[][], abandoned\n            //    const texSpr = spr.getTexture(Math.floor(((Math.atan2(spr.vxFx8, spr.vyFx8) - myAngle) / Math.PI / 2 + 2-.25) * spr.textures.length +.5) % spr.textures.length)\n            //for deal in user code\n            if (this.onSpriteDirectionUpdateHandler)\n                this.onSpriteDirectionUpdateHandler(spr, ((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25))\n            //for CharacterAnimation ext.\n            //     const iTexture = Math.floor(((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25) * 4 + .5) % 4\n            //     const characterAniDirs = [Predicate.MovingLeft,Predicate.MovingDown, Predicate.MovingRight, Predicate.MovingUp]\n            //     character.setCharacterState(spr, character.rule(characterAniDirs[iTexture]))\n            //for this.spriteAnimations\n            const texSpr = !this.spriteAnimations[spr.id] ? spr.image : this.spriteAnimations[spr.id].getFrameByDir(((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25))\n\n            const sprTexRatio = texSpr.width / spriteScreenHalfWidth / 2\n            helpers.imageBlit(\n                this.tempScreen,\n                blitXSpr,\n                drawStart,\n                blitWidthSpr,\n                lineHeight * spr.height / this.tilemapScaleSize,\n                texSpr,\n                (blitXSpr - (spriteScreenX - spriteScreenHalfWidth)) * sprTexRatio\n                ,\n                0,\n                blitWidthSpr * sprTexRatio, texSpr.height, true, false)\n\n            screen.fill(0)\n            const fpx_div_transformy = Math.roundWithPrecision(transformY / 4 / fpx_scale, 2)\n            const height = (SH / fpx_div_transformy)\n            const blitXSaySrc = ((blitX - spriteScreenX) * fpx_div_transformy) + SWHalf\n            const blitWidthSaySrc = (blitWidth * fpx_div_transformy)\n\n            //sprite\n            // screen.drawImage(texSpr, SWHalf-texSpr.width/2, SHHalf)\n            //sayText\n            const sayRender = this.sayRederers[spr.id]\n            if (sayRender) {\n                if (this.sayEndTimes[spr.id] && control.millis() > this.sayEndTimes[spr.id]) {\n                    this.sayRederers[spr.id] = undefined\n                } else {\n                    this.tempSprite.x = SWHalf\n                    this.tempSprite.y = SHHalf + 2\n                    this.camera.drawOffsetX = 0\n                    this.camera.drawOffsetY = 0\n                    sayRender.draw(screen, this.camera, this.tempSprite)\n                }\n            }\n            //particle\n            const particle = this.spriteParticles[spr.id]\n            if (particle) {\n                if (particle.lifespan) {\n                    //debug\n                    // this.tempScreen.print([spr.id].join(), 0,index*10+10)\n                    this.tempSprite.x = SWHalf\n                    this.tempSprite.y = SHHalf + spr.height\n                    this.camera.drawOffsetX = 0//spr.x-SWHalf\n                    this.camera.drawOffsetY = 0//spr.y-SH\n                    particle.__draw(this.camera)\n                } else {\n                    this.spriteParticles[spr.id] = undefined\n                }\n            }\n            //update screen for this spr\n            // const sayTransformY = \n            if (blitXSaySrc <= 0) { //imageBlit considers negative value as 0\n                helpers.imageBlit(\n                    this.tempScreen,\n                    spriteScreenX - SWHalf / fpx_div_transformy, drawStart - height / 2, (blitWidthSaySrc + blitXSaySrc) / fpx_div_transformy, height,\n                    screen,\n                    0, 0, blitWidthSaySrc + blitXSaySrc, SH, true, false)\n            } else {\n                helpers.imageBlit(\n                    this.tempScreen,\n                    // blitX, drawStart - height / 2 , blitWidth, height,\n                    blitX, drawStart - height / 2, blitWidth, height,\n                    screen,\n                    blitXSaySrc, 0, blitWidthSaySrc, SH,\n                    true, false)\n            }\n        }\n    }\n\n    //%fixedinstance\n    export const raycastingRender = new Render.RayCastingRender()\n}\n\n","tilemap.g.jres":"{\n    \"transparency16\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true\n    },\n    \"tile1\": {\n        \"data\": \"hwQQABAAAABBbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfQ==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile\"\n    },\n    \"tile2\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile0\"\n    },\n    \"tile3\": {\n        \"data\": \"hwQQABAAAAB34AAAAAAAAACeAAAAAAAAcOcAAAAAAAAA4AAAAAAAAHcHDgAAAAAA4O4AAAAAAAB34OAAAAAAAADu4AAAAAAAcAfuAAAAAAAH5w4AAAAAAHcADgAAAAAAB+fpAAAAAAB3DgAAAAAAAADgAAAAAAAAd+cOAAAAAAAHDgAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile1\"\n    },\n    \"tile5\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALsLAAAAAAAAuwsAAAAAAAC7CwAAAAAAALv7AAAAAAAAu/vd3d3dDQC7+wAAAAAAALsLAAAAAAAAuwsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile3\"\n    },\n    \"tile6\": {\n        \"data\": \"hwQQABAAAAAkL/QiJCIvJP8v8iQiJP//JE/y//8iT0JCL/IiIiRPIiQv8iIkIi8iIi8iIiJCLyQiL/T//yIvQv8vIi8kQv//Qi8i8iIkLyJCT/L//yIvRCIvIiIiQk8iJC/0QiIiLyRCL/IiQkIvQiQv8v//Ii8k/y/yIiJC//8iT/IiJCIvJA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile4\"\n    },\n    \"tile7\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile5\"\n    },\n    \"tile4\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile2\"\n    },\n    \"tile8\": {\n        \"data\": \"hwQQABAAAAAPAAAAAAAPAA/w//8AAA8A/w8AAP//AAAADwAA/wAAMAAPAAAPAAAAAA8AAA//AAAADwAADwAAAPDw//8AAAAADwAAAP////8PAAAA/////wDw//8AAAAAAA8AAA8AAAAADwAADwAAAAAPAAAPAAAAAA8AAA8AAAAA8P//AAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile6\"\n    },\n    \"level1\": {\n        \"id\": \"level1\",\n        \"mimeType\": \"application/mkcd-tilemap\",\n        \"data\": \"MTAxMDAwMTAwMDAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMjAyMDIwMTA1MDMwMTAxMDIwMjAyMDIwMjAxMDMwMzAyMDIwMjAxMDEwNDAxMDEwMjAyMDIwMjAyMDEwMzAzMDUwMjAyMDEwMTAzMDEwMTAyMDIwMjAyMDIwMTAzMDMwMzA1MDUwMTAxMDMwMTAxMDIwMjAyMDIwMjAxMDMwMzAzMDMwMzAzMDMwMzAxMDEwMjAyMDIwMjAyMDEwMzAzMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAzMDMwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDMwMzAxMDEwMTAxMDIwMjAyMDIwMjAxMDEwMTAxMDEwMzAzMDEwMTAxMDEwMjAyMDIwMjAyMDEwMjAyMDIwMjAzMDMwMTAxMDEwMTAyMDIwMjAyMDIwMTAyMDIwMjAyMDMwMzAyMDIwMTAxMDIwMjAyMDIwMjAxMDIwMjAyMDIwMzAzMDIwMjAxMDEwMjAyMDIwMjAyMDEwMjAyMDIwMjAzMDMwMjAyMDEwMTAxMDEwMTAxMDEwMTAyMDIwMjAyMDMwMzAyMDIwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMjIyMjIyMjIyMjIyMjIyMjAyMDAyMDAyMDAwMDAwMjAwMjAwMDAwMjAwMDAwMDIwMjIwMDAwMDIwMDAwMDAyMDIyMjIwMDAyMDAwMDAwMjAyMjIyMjIwMjAwMDAwMDIwMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMjIyMjIyMjIyMjIyMjIyMg==\",\n        \"tileset\": [\n            \"myTiles.transparency16\",\n            \"sprites.dungeon.floorLight0\",\n            \"sprites.dungeon.floorLight1\",\n            \"sprites.dungeon.floorDark0\",\n            \"sprites.dungeon.floorDark3\",\n            \"myTiles.tile6\"\n        ],\n        \"displayName\": \"level\"\n    },\n    \"*\": {\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"dataEncoding\": \"base64\",\n        \"namespace\": \"myTiles\"\n    }\n}","tilemap.g.ts":"","pxt.json":"{\n    \"name\": \"3d floor and background\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"device\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"assets.json\",\n        \"_animation.ts\",\n        \"_render_blocks.ts\",\n        \"_render_raycasting.ts\",\n        \"tilemap.g.jres\",\n        \"tilemap.g.ts\"\n    ],\n    \"targetVersions\": {\n        \"branch\": \"v1.10.36\",\n        \"tag\": \"v1.10.36\",\n        \"commits\": \"https://github.com/microsoft/pxt-arcade/commits/3a5a7e13703edf0412c17bdb9b1469e282a5b31b\",\n        \"target\": \"1.10.36\",\n        \"pxt\": \"8.3.9\"\n    },\n    \"preferredEditor\": \"blocksprj\"\n}\n"}},{"timestamp":1763633779379,"editorVersion":"2.0.62","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable type=\"KIND_SpriteKind\" id=\"USZ`q|D]$0kk|,E!b7c6\">Player</variable><variable type=\"KIND_SpriteKind\" id=\"@8#W0|ESmtdS+3`?Z+:+\">Projectile</variable><variable type=\"KIND_SpriteKind\" id=\"h1jvB:JPL=NMGpJB=4/[\">Food</variable><variable type=\"KIND_SpriteKind\" id=\"(3Y]|wk94c4t/c`pc((X\">Enemy</variable><variable type=\"KIND_SpriteKind\" id=\"2B=HiFZ(Kz-^Ln6ox1L~\">Help</variable><variable id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</variable><variable id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</variable></variables><block type=\"keyonevent\" x=\"463\" y=\"-7\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_toggleViewMode\"></block></statement></block><block type=\"pxt-on-start\" x=\"34\" y=\"52\"><statement name=\"HANDLER\"><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff99d99bbbbbcfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff99ddbdd66168bcccccc9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff999ddbbbd66888111ccccccb99fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9966ddbbbb6688811818ccccccbbc99fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdd69dddbbb66618881888818818cccccbe9fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffddd96dd6b6dbd68888888888888888cccccc99fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffdbbd9666666dbb668886888888cccccccccccccc9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffdbbb99666966d68866888888cccccccccccccccccc69ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffdbbb999669666666888888888ccccbbbcc8bcccccccccc9fffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffdbbb999666666666888888888cbbcbe8bbbcbcccccbbcccb9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffff9bbb999666666666688888888bccb888888bbbbb88888bcccccfffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffdbbb999669666666866888868bbbbb8888888ccc888b88bbc8cccffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffdbbb9d99ddd666668868888688bbcb888888888bc888bcc8bc886c9fffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffbbbbbbddd966666888688888888888888b88888888888cc8ccc886c9ffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffdbbbbbbdd6966666666868888888888bbdbbebb8888888888bcc8c86c9fffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffff9bbdbddd6666666666888688868888ddddddddde8888888888bccbbccccfffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffff9dbb9dd666666666668868888888bddddddbdbbddcccccd88b8ebccbbbbc9ffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffdd99999666666666668868888888bdddddbbbbbdbbbccccccb8bbbccc8bbb9fffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffff9dd99996696966666666668888bbbdddddbbbddbbbbbbbbbcccc8bcccbb8bbcfffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffff9d999996666966666668688888bbdddbbbbdbbbbbbbbbbbcccccc8bbccc88bc9ffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff99999999666996696668868868bbdddddbbbdbbbbbbbbbbbbcbccc88bcccc88c6ffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff999996696669666966d8868666bddbbbddbbdbbbbbbbbbbbbcccccc88bbccc8869fffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff9999996699669666666d6688668bddbbdbbbbbbbbbbbbbbbbbccccccc88bcccc866fffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff9dd999669966666666666688668bdddbbbbbbbbbbbbbbbbbbbccccccc888bbccc669ffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff999999669d69666666666688868bddbbbdbbbbbbbbbbbbbbbbcccccccc888bbcc869ffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99999996ddd69666666688888868ddbddbbbbbbbbbbbbbbbbbbccccccccc888888866ffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff999999969ddd6669666688688888bbbbbbbbbbbbbbbbbbbbbbbbccbccccc8888888869fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99999966ddddd669666688888888bbbbbbbbbbbbbbbbbbbbbbbcbccccccccc88888869fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff999bb99666dddd6666666668886888bbbbbbbbbbbbbbbbbbbbbbcccccccccccc8888889fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbbb966696666666666888886888bbbbbbbbbbbbbbbbbbbbbbcbccccccccccc888886fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbdbb666969666666668888868888bbbbbbbbbbbbbbbbbbbbccbccccccccccc8888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99dbbbbb6696966666666668886868888bbbbeb888bbbbbbbbbcccccccccccccc8888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbbbbbe6969666666666888888888888888888888bbbbbbbbccccccccccccc88888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbccbc66966666666688888688888888888d888ebbbbbbbcccccccccccbb88888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbbcc69996666688668886888888dd88dbbd88bbbbbbbccccccccccceb88888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbbccc999966668868888888888ddddbbbbd88cbbbbbbbbccccccccc8888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9ebbbbcccccccc9966666688888888888888ddbbbb888bbbbbbbbccccccccc8888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbccccccccc666666888866888888888dddddbdd88bbbbbbccccccccc88888888bb9ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffbbbbbbcccccccccc6666688888888888888888d8888888bbbbbbccccccccc88888888bb9ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9dbbbbccbbccccccb666688868888888888888888888888bbbbbccccccccc888888888b9ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9dbbbbbbbbcccccbb66666688888888888888888888888bbbbccccccccccc88888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbcccccccb666666688888888888888888888888bbbbcccccccccc888888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbccccccbb666666688888888888888888888888bbbbcccccccccc88888888886fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbbbbbbbccccb6666668888888888888888888888888bbbbcbcccccccc88888888886fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99dbbbcbbccccb6666668888888888888888888888888bbbbbccccccccc888cc888869fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99dbbbcccccccc6666668688688888888888888888888bbbbccccccccc8888cc888869fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff999bbbbbccccbc6666666688688888888888888888888bbbbcccccccc88888dd88886ffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff969bbbbbbcccc69666666668688868888888888888888bbbbccccccc88888bd888886ffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff99bbbbcccccc696bb668888888868888888888888888bbbcccccccc8888bbd888869ffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff9999bbbcccc9666dbbb8888888888888888888888888ccbcccccccc8888bc888886fffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff699bbbbccc966966bbb8888888888888888888888888bbbbccccc88888bcc88869fffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff9999bbcccc666666dbbdd88888888688888888888888bbcccccc88888888888669fffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff9699dbcccc66666666bb6d8888888688888888888888bbcccccc8888888888869ffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffff9696bbbcc66666666dbbd6886868888888888888888bbcbccc8888888888d669ffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffff999ebbccc666666666dbb8868888688888888888888bbbccc8888888889b69fffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffff969ccbcc66996666666bbb868888888888888888888bbbc888888888888b6ffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffff96ccccc966966666666bb8688666888888888888888b8888888888888699ffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffff99ccbc996666666666dbb6888668888888888888888888888888888869fffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffff969ccb9666666666666dbb88866888888888888888888888888888869ffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffff969ccc6696666666666dd8888668888888888888888888888888866fffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffff969cc9669666966d66dd8888868888888888888888888bb8888669fffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffff96ccc66699669dddd888868888888888888888888888be888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffff96c66669966666dd88886666668888888888888888dd888669fffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffff96966669966ddd686886868888888888888888888d888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffff969666696666666688686888888888888888888888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffff9966966966666666886888888888888886888888669fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9699996666666888888888888888888118888699ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff969996666668888881188888888881888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff996999666688881818888888881886669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9961161186618811188886116699ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff99161111611118111666699fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9999661166669999ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff999999999fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\nf f f f f f f f f f f f f f f f \n1 1 f f f f f f f f f f f f 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 f f f f f f f f f f f f 1 1 \nf f f f f f f f f f f f f f f f \n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value></block></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></next></block></next></block></next></block></statement></block></xml>","main.ts":"","README.md":" ","assets.json":"","_animation.ts":"//////////////////////// animation.ts contents of previous version, just for test.ts here for convenience /////////////////////\n// file contents:\n// directional animations defines for enging_raycasting.ts\n// for convenience, constructed animations as below, which images are builtin in Arcade, \n// in order from easy to complex\n\n// each are 2D Image array, Image[][]: \n// 1st dimension is direction: \n//    length=1 to any, e.g. 1,2,3,4,...,8,..., engine can automatically arange them to 0~360 \n//    order: start from left, then folling with others in CW order\n//    e.g: \n//         2 directions should be [leftAni,RightAni], \n//         4-direction should be [leftAni, frontAni, rightAni, backAni], \n//         8-direction=[l,lf,f,fr,r,rb,b,lb], ...\n//    the reason that directions start from left, is almost all Arcade builtin one side images are facing left, so that would be convient for using.\n// 2nd dimension is animation Images\n//    length=1 to any, e.g. 1,2,3,4,..., engine will automatically loop them by aniInterval(set when create CompactSprite, or use default)\n\n\n//simplest, just one static image, looks the same in all angle of view\nconst texturesDonut = [[sprites.food.smallDonut]]\nconst texturesBigCake = [[sprites.food.bigCake]]\n\n//1-direction, with ani, looks the same Ani in all angle of view\nconst texturesCoin = [[sprites.builtin.coin0, sprites.builtin.coin1, sprites.builtin.coin2, sprites.builtin.coin3, sprites.builtin.coin4, sprites.builtin.coin5]]\n\nconst texturesDog = [[sprites.builtin.dog0, sprites.builtin.dog1, sprites.builtin.dog2]]\nconst texturesDuck = [[sprites.duck.duck1, sprites.duck.duck2, sprites.duck.duck3, sprites.duck.duck4, sprites.duck.duck5, sprites.duck.duck6]]\n\n//2-direction, with ani, looks difference from left or right side\nconst texturesPlane = [[sprites.vehicle.plane0, sprites.vehicle.plane1, sprites.vehicle.plane2, sprites.vehicle.plane3, sprites.vehicle.plane4, sprites.vehicle.plane5],\n[sprites.vehicle.plane0, sprites.vehicle.plane1, sprites.vehicle.plane2, sprites.vehicle.plane3, sprites.vehicle.plane4, sprites.vehicle.plane5]]\n//no right side ani images builtin, so make them from lefts, and then flipX\nimagesFlipX(texturesPlane[1])\n\nconst texturesFish = [[sprites.builtin.angelFish0, sprites.builtin.angelFish1, sprites.builtin.angelFish2, sprites.builtin.angelFish3],\n[sprites.builtin.angelFish0, sprites.builtin.angelFish1, sprites.builtin.angelFish2, sprites.builtin.angelFish3]]\nimagesFlipX(texturesFish[1])\n\n//4-direction\nconst texturesHero = [\n    [sprites.castle.heroWalkSideLeft1, sprites.castle.heroWalkSideLeft2, sprites.castle.heroWalkSideLeft3, sprites.castle.heroWalkSideLeft4],\n    [sprites.castle.heroWalkFront1, sprites.castle.heroWalkFront2, sprites.castle.heroWalkFront3, sprites.castle.heroWalkFront4],\n    [sprites.castle.heroWalkSideRight1, sprites.castle.heroWalkSideRight2, sprites.castle.heroWalkSideRight3, sprites.castle.heroWalkSideRight4],\n    [sprites.castle.heroWalkBack1, sprites.castle.heroWalkBack2, sprites.castle.heroWalkBack3, sprites.castle.heroWalkBack4],\n]\n\nconst texturesPrincess2 = [\n    [sprites.castle.princess2Left1, sprites.castle.princess2Left2],\n    [sprites.castle.princess2WalkFront1, sprites.castle.princess2WalkFront2, sprites.castle.princess2WalkFront3, sprites.castle.princess2WalkFront2],\n    [sprites.castle.princess2Right1, sprites.castle.princess2Right2],\n    [sprites.castle.princess2WalkBack1, sprites.castle.princess2WalkBack2, sprites.castle.princess2WalkBack3, sprites.castle.princess2WalkBack2],\n]\n\n//4-direction, but back side has only 1 image, so no ani when looking from back\nconst texturesSkelly = [\n    [sprites.castle.skellyWalkLeft1, sprites.castle.skellyWalkLeft2],\n    [sprites.castle.skellyWalkFront1, sprites.castle.skellyWalkFront2, sprites.castle.skellyWalkFront3],\n    [sprites.castle.skellyWalkRight1, sprites.castle.skellyWalkRight2],\n    [img`\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ..........ffff..........\n\t        ........ff1111ff........\n\t        .......fb111111bf.......\n\t        .......f11111111f.......\n\t        ......fd11111111df......\n\t        ......fd11111111df......\n\t        ......fd11111111df......\n\t        ......fb11111111bf......\n\t        ......fcd111111dcf......\n\t        .......fb111111bf.......\n\t        .....ffffdb1bdcfff......\n\t        ....fc111cfbfbc111cf....\n\t        ....f11111ffff11111f....\n\t        ....fbfbfbffffffbfbf....\n\t        .........ffffff.........\n\t        ..........fff...........\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ........................\n\t    `],\n]\n\nconst texturesPrincess = [\n    [sprites.castle.princessLeft0, sprites.castle.princessLeft1, sprites.castle.princessLeft0, sprites.castle.princessLeft2],\n    [sprites.castle.princessFront0, sprites.castle.princessFront1, sprites.castle.princessFront0, sprites.castle.princessFront2],\n    [],\n    [sprites.castle.princessBack0, sprites.castle.princessBack1, sprites.castle.princessBack0, sprites.castle.princessBack2],\n]\ntexturesPrincess[0].forEach((v, i) => {\n    texturesPrincess[2].push(v.clone())\n    texturesPrincess[2][i].flipX()\n}\n)\n\nfunction imagesFlipX(ani: Image[]) {\n    ani.forEach((img, i) => {\n        ani[i] = img.clone() //don't worry memery leak or waste, cause old images are still using by left\n        ani[i].flipX()\n    })\n}\n\n//////////////////////// end of animation.ts contents of previous version //////////////\n\n\n","_render_blocks.ts":"enum RCSpriteAttribute {\n    ZOffset,\n    ZPosition,\n    ZVelocity,\n    ZAcceleration\n}\n/**\n * A 2.5D Screen Render, using Raycasting algorithm\n **/\n//% color=#03AA74 weight=1 icon=\"\\uf1b2\" //cube f1b2 , fold f279\n//% groups='[\"Instance\",\"Basic\", \"Dimension Z\", \"Animate\", \"Advanced\"]'\n//% block=\"3D Render\"\nnamespace Render {\n    export enum attribute {\n        dirX,\n        dirY,\n        fov,\n        wallZScale,\n    }\n\n    export class Animations {\n        constructor(public frameInterval: number, public animations: Image[][]) {\n        }\n\n        msLast = 0\n        index = 0\n        iAnimation = 0\n        getFrameByDir(dir: number): Image {\n            if (control.millis() - this.msLast > this.frameInterval) {\n                this.msLast = control.millis()\n                this.index++\n                this.iAnimation = Math.round((dir * this.animations.length)) % this.animations.length\n                if (this.index >= this.animations[this.iAnimation].length)\n                    this.index = 0\n            }\n            return this.animations[this.iAnimation][this.index]\n        }\n    }\n\n    /**\n * Apply a directional image animations on a sprite\n * @param sprite the sprite to animate on\n * @param animations the directional animates\n */\n    //% blockId=set_animation\n    //% block=\"set $sprite=variables_get(mySprite) with animations$animations\"\n    //% animations.shadow=create_animation\n    //% group=\"Animate\"\n    //% weight=100\n    //% help=github:pxt-raycasting/docs/set-sprite-animations\n    export function setSpriteAnimations(sprite: Sprite, animations: Animations) {\n        raycastingRender.spriteAnimations[sprite.id] = animations\n    }\n\n    /**\n * Create a directional image animations, multi animations will applied to one round dirctions averagely, start from the left. \n * The reason that directions start from left, is almost all Arcade out-of-box 1 or 2-dirction images are facing left, so that would be convient for using.\n * @param frameInterval the time between changes, eg: 150\n * @param frames1 animation, if this is the first of multi animation it will be used as left, others will \n * @param frames2 optional, used for 2 or more dirctional\n * @param frames3 optional, used for 3 or more dirctional\n * @param frames4 optional, used for 4 or more dirctional\n */\n    //% blockId=create_animation\n    //% block=\"interval$frameInterval=timePicker animates:$frames1=animation_editor|| $frames2=animation_editor $frames3=animation_editor $frames4=animation_editor\"\n    //% inlineInputMode=inline\n    //% group=\"Animate\"\n    //% weight=100\n    //% help=github:pxt-raycasting/docs/create-animations\n    export function createAnimations(frameInterval: number, frames1: Image[], frames2?: Image[], frames3?: Image[], frames4?: Image[]): Animations {\n        const animationList = [frames1]\n        if (frames2) animationList.push(frames2)\n        if (frames3) animationList.push(frames3)\n        if (frames4) animationList.push(frames4)\n        return new Animations(frameInterval, animationList)\n    }\n\n    /**\n     * Get the Render\n     * @param img the image\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRCRenderInstance block=\"raycasting render\"\n    //% expandableArgumentMode=toggle\n    //% weight=100 \n    //% blockHidden=true\n    //% hidden=1\n    export function getRCRenderInstance(): RayCastingRender {\n        return raycastingRender\n    }\n\n    /**\n     * Get the render Sprite, which create automatically, for physical collisions, and holding the view point.\n     * You can consider it as \"myself\", and operate it like a usual sprite, eg.: position, speed, scale, collision, ...\n     * But properties relative 3D, eg. ZOffset, ZPosition, viewAngle, and etc. are not in the Sprite class.\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRenderSpriteVariable block=\"myself sprite\"\n    //% expandableArgumentMode=toggle\n    //% blockSetVariable=mySprite\n    //% weight=99\n    //% help=github:pxt-raycasting/get-render-sprite-variable\n    export function getRenderSpriteVariable(): Sprite {\n        return raycastingRender.sprSelf\n    }\n\n    /**\n     * Get the render Sprite, which create automatically, for physical collisions, and holding the view point.(but get/set view direction with dirX/dirY, which not in the Sprite class) \n     * You can consider it as \"myself\", and operate it like a usual sprite.\n     * eg: position, speed, scale, collision, ...\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRenderSpriteInstance block=\"myself sprite\"\n    //% expandableArgumentMode=toggle\n    //% weight=98\n    //% help=github:pxt-raycasting/docs/get-render-sprite-instance\n    export function getRenderSpriteInstance(): Sprite {\n        return raycastingRender.sprSelf\n    }\n\n    /**\n     * Toggle current view mode\n     */\n    //% blockId=rcRender_toggleViewMode block=\"toggle current view mode\"\n    //% group=\"Basic\"\n    //% weight=89\n    //% help=github:pxt-raycasting/docs/toggle-view-mode\n    export function toggleViewMode() {\n        raycastingRender.viewMode = raycastingRender.viewMode == ViewMode.tilemapView ? ViewMode.raycastingView : ViewMode.tilemapView\n    }\n\n    /**\n     * Current view mode is the specific one?\n     * @param viewMode\n     */\n    //% blockId=rcRender_isViewMode block=\"current is $viewMode\"\n    //% group=\"Basic\"\n    //% weight=88\n    //% help=github:pxt-raycasting/docs/is-view-mode\n    export function isViewMode(viewMode: ViewMode): boolean {\n        return viewMode == raycastingRender.viewMode\n    }\n\n    /**\n     * Set view mode\n     * @param viewMode\n     */\n    //% blockId=rcRender_setViewMode block=\"set view mode $viewMode\"\n    //% group=\"Basic\"\n    //% weight=87\n    //% help=github:pxt-raycasting/docs/set-view-mode\n    export function setViewMode(viewMode: ViewMode) {\n        raycastingRender.viewMode = viewMode\n    }\n\n    /**\n     * Get render arribute\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"get %attribute\" \n    //% blockId=rcRender_getAttribute\n    //% weight=83\n    //% help=github:pxt-raycasting/docs/get-attribute\n    export function getAttribute(attr: attribute): number {\n        switch (attr) {\n            case attribute.dirX:\n                return raycastingRender.dirX\n            case attribute.dirY:\n                return raycastingRender.dirY\n            case attribute.fov:\n                return raycastingRender.fov\n            case attribute.wallZScale:\n                return raycastingRender.wallZScale\n            default:\n                return 0\n        }\n    }\n\n    /**\n     * Set render arribute\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"set %attribute = %value\" \n    //% blockId=rcRender_setAttribute\n    //% weight=82\n    //% help=github:pxt-raycasting/docs/set-attribute\n    export function setAttribute(attr: attribute, value: number) {\n        switch (attr) {\n            case attribute.dirX:\n                raycastingRender.dirX = value\n                break\n            case attribute.dirY:\n                raycastingRender.dirY = value\n                break\n            case attribute.fov:\n                if (value < 0) value = 0\n                raycastingRender.fov = value\n                break\n            case attribute.wallZScale:\n                if (value < 0) value = 0\n                raycastingRender.wallZScale = value\n                break\n            default:\n        }\n    }\n\n    /**\n     * Get default FOV (field of view) value\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"defaultFov\"\n    //% blockId=rcRender_getDefaultFov\n    //% weight=81\n    //% help=github:pxt-raycasting/docs/get-default-fov\n    export function getDefaultFov(): number {\n        return defaultFov\n    }\n\n    /**\n     * Set view angle\n     * @param angle, unit: degree 0~360\n     */\n    //% blockId=rcRender_setViewAngleInDegree block=\"set view angle$angle\"\n    //% angle.min=0 angle.max=360 angle.defl=90\n    //% group=\"Basic\"\n    //% weight=80\n    //% help=github:pxt-raycasting/docs/set-view-angle-in-degree\n    export function setViewAngleInDegree(angle: number) {\n        raycastingRender.viewAngle = angle * Math.PI / 180\n    }\n\n    /**\n     * Set view angle by dirX and dirY\n     * @param dirX\n     * @param dirY\n     */\n    //% blockId=rcRender_setViewAngle block=\"set view angle by dirX%dirX and dirY%dirY\"\n    //% group=\"Basic\"\n    //% weight=79\n    //% help=github:pxt-raycasting/docs/set-view-angle\n    export function setViewAngle(dirX: number, dirY: number) {\n        raycastingRender.viewAngle = Math.atan2(dirY, dirX)\n    }\n\n    /**\n     * Set floating offset height for a sprite at Z direction\n     * @param sprite\n     * @param Zoffset Negative floats down, affirmative goes up\n     * @param duration moving time, 0 for immediately, unit: ms\n     */\n    //% blockId=rcRender_setZOffset block=\"set Sprite %spr=variables_get(mySprite) floating %offset pixels|| duration $duration=timePicker|ms \"\n    //% offset.min=-100 offset.max=100 offset.defl=8\n    //% duration.min=0 duration.max=5000 duration.defl=0\n    //% group=\"Dimension Z\"\n    //% weight=77\n    //% blockHidden\n    //% help=github:pxt-raycasting/docs/set-z-offset\n    export function setZOffset(sprite: Sprite, offset: number, duration?: number) {\n        raycastingRender.setZOffset(sprite, offset, duration)\n    }\n\n    /**\n     * Set arribute of a Sprite\n     * @param spr Sprite\n     * @param attr RCSpriteAttribute\n     */\n    //% group=\"Dimension Z\"\n    //% block=\"set Sprite %spr=variables_get(mySprite) %attribute = %value\"\n    //% blockId=rcRender_setSpriteAttribute\n    //% weight=75\n    //% help=github:pxt-raycasting/docs/set-sprite-attribute\n    export function setSpriteAttribute(spr: Sprite, attr: RCSpriteAttribute, value: number) {\n        switch (attr) {\n            case RCSpriteAttribute.ZOffset:\n                raycastingRender.getMotionZ(spr).offset = value\n                break\n            case RCSpriteAttribute.ZPosition:\n                raycastingRender.getMotionZ(spr).p = value\n                break\n            case RCSpriteAttribute.ZVelocity:\n                raycastingRender.getMotionZ(spr).v = value\n                break\n            case RCSpriteAttribute.ZAcceleration:\n                raycastingRender.getMotionZ(spr).a = value\n                break\n            default:\n        }\n    }\n\n    /**\n     * Get arribute of a Sprite\n     * @param spr Sprite\n     * @param attr RCSpriteAttribute\n     */\n    //% group=\"Dimension Z\"\n    //% block=\"get Sprite %spr=variables_get(mySprite) %attribute\"\n    //% blockId=rcRender_getSpriteAttribute\n    //% weight=74\n    //% help=github:pxt-raycasting/docs/get-sprite-attribute\n    export function getSpriteAttribute(spr: Sprite, attr: RCSpriteAttribute): number {\n        switch (attr) {\n            case RCSpriteAttribute.ZOffset:\n                return raycastingRender.getMotionZ(spr).offset\n            case RCSpriteAttribute.ZPosition:\n                return raycastingRender.getMotionZ(spr).p\n            case RCSpriteAttribute.ZVelocity:\n                return raycastingRender.getMotionZ(spr).v\n            case RCSpriteAttribute.ZAcceleration:\n                return raycastingRender.getMotionZ(spr).a\n            default:\n                return 0\n        }\n    }\n\n    /**\n     * Check if 2 sprites overlaps each another in Z dimension\n     * Best work together with sprites.onOverlap(kind1, kind2)\n     * @param sprite1\n     * @param sprite2\n     */\n    //% blockId=rcRender_isSpritesOverlapZ\n    //% block=\"is sprites $sprite1=variables_get(mySprite) and $sprite2=variables_get(mySprite2) overlaps in Z dimension\"\n    //% group=\"Dimension Z\"\n    //% weight=71\n    //% help=github:pxt-raycasting/docs/is-sprites-overlap-z\n    export function isSpritesOverlapZ(sprite1: Sprite, sprite2: Sprite): boolean {\n        return raycastingRender.isOverlapZ(sprite1, sprite2)\n    }\n\n    /**\n     * Make sprite jump, with specific height and duration\n     * Jump can only happened when sprite is standing, current height = its offset .\n     * @param sprite\n     * @param height jump height in pixel\n     * @param duration hover time span, unit: ms\n     */\n    //% blockId=rcRender_jumpWithHeightAndDuration block=\"Sprite %spr=variables_get(mySprite) jump, with height $height duration $duration=timePicker|ms \"\n    //% height.min=0 height.max=100 height.defl=16\n    //% duration.min=50 duration.max=5000 duration.defl=500\n    //% group=\"Dimension Z\"\n    //% weight=70\n    //% help=github:pxt-raycasting/docs/jump-with-height-and-duration\n    export function jumpWithHeightAndDuration(sprite: Sprite, height: number, duration: number) {\n        raycastingRender.jumpWithHeightAndDuration(sprite, height, duration)\n    }\n\n    /**\n     * Make sprite jump, with specific speed and acceleration\n     * Simular with Move block, but jump can only happened when sprite is standing, current height = its offset.\n     * @param sprite\n     * @param v vetical speed, unit: pixel/s\n     * @param a vetical acceleration, unit: pixel/s\n     */\n    //% blockId=rcRender_jump block=\"Sprite %spr=variables_get(mySprite) jump||, with speed $v=spriteSpeedPicker acceleration $a\"\n    //% v.min=-100 v.max=100 v.defl=60\n    //% a.min=-1000 a.max=1000 a.defl=-250\n    //% group=\"Dimension Z\"\n    //% weight=68\n    //% help=github:pxt-raycasting/docs/jump\n    export function jump(sprite: Sprite, v?: number, a?: number) {\n        raycastingRender.jump(sprite, v, a)\n    }\n\n    /**\n     * Make sprite jump, with specific speed and acceleration\n     * @param sprite\n     * @param v vetical speed, unit: pixel/s\n     * @param a vetical acceleration, unit: pixel/s\n     */\n    //% blockId=rcRender_move block=\"Sprite %spr=variables_get(mySprite) move, with speed $v=spriteSpeedPicker|| acceleration $a\"\n    //% v.min=-200 v.max=200 v.defl=60\n    //% a.min=-1000 a.max=1000 a.defl=-250\n    //% group=\"Dimension Z\"\n    //% weight=66\n    //% help=github:pxt-raycasting/docs/move\n    export function move(sprite: Sprite, v?: number, a?: number) {\n        raycastingRender.move(sprite, v, a)\n    }\n\n    /**\n     * Control the self sprite using the direction buttons from the controller. \n     * To stop controlling self sprite, pass 0 for v and va.\n     *\n     * @param v The velocity used for forward/backword movement when up/down is pressed, in pixel/s\n     * @param va The angle velocity used for turn view direction when left/right is pressed, in radian/s.\n     */\n    //% blockId=\"rcRender_moveWithController\" block=\"move with buttons velocity $v|| turn speed $va camera sway$cameraSway pixels\"\n    //% weight=60\n    //% expandableArgumentMode=\"toggle\"\n    //% v.defl=2 va.defl=3\n    //% group=\"Advanced\"\n    //% v.shadow=\"spriteSpeedPicker\"\n    //% va.shadow=\"spriteSpeedPicker\"\n    //% help=github:pxt-raycasting/docs/move-with-controller\n    export function moveWithController(v: number = 2, va: number = 3, cameraSway?: number) {\n        raycastingRender.velocity = v\n        raycastingRender.velocityAngle = va\n        if (cameraSway != undefined)\n            raycastingRender.cameraSway = cameraSway | 0\n    }\n\n    /**\n     * Render takeover all sprites in current scene\n     * Render will call this automatically, but maybe not in time enough.\n     * If you saw sprite draw at its tilemap position on screen, call this just after created the sprite.\n     */\n    //% blockId=rcRender_takeoverSceneSprites \n    //% block=\"takeover sprites in scene\"\n    //% group=\"Advanced\"\n    //% weight=49\n    //% help=github:pxt-raycasting/docs/takeover-scene-sprites\n    export function takeoverSceneSprites() {\n        raycastingRender.takeoverSceneSprites()\n    }\n\n    /**\n     * Run on sprite dirction updated, present view point to Sprite facing dirction, or which angle you see of the sprite.\n     * Just using with other animation extensions, to set proper Image for sprite.\n     * Not required, if you have used the set animations block provided.\n     * @param dir It is a float number, 0~1 corresponds to 0~360, suggest use Math.round(dir*dirAniTotalCount)%dirAniTotalCount to get index of direction\n     */\n    //% blockId=rcRender_registerOnSpriteDirectionUpdateHandler\n    //% block=\"run code when sprite $spr dirction updated to $dir\"\n    //% draggableParameters\n    //% group=\"Advanced\"\n    //% weight=48\n    //% help=github:pxt-raycasting/docs/register-on-sprite-direction-update-handler\n    export function registerOnSpriteDirectionUpdateHandler(handler: (spr: Sprite, dir: number) => void) {\n        raycastingRender.registerOnSpriteDirectionUpdate(handler)\n    }\n}\n","_render_raycasting.ts":"//% shim=pxt::updateScreen\nfunction updateScreen(img: Image) { }\n\nenum ViewMode {\n    //% block=\"TileMap Mode\"\n    tilemapView,\n    //% block=\"Raycasting Mode\"\n    raycastingView,\n}\n\nnamespace Render {\n    const SH = screen.height, SHHalf = SH / 2\n    const SW = screen.width, SWHalf = SW / 2\n    const fpx = 8\n    const fpx_scale = 2 ** fpx\n    function tofpx(n: number) { return (n * fpx_scale) | 0 }\n    const one = 1 << fpx\n    const one2 = 1 << (fpx + fpx)\n    const FPX_MAX = (1 << fpx) - 1\n\n    class MotionSet1D {\n        p: number\n        v: number = 0\n        a: number = 0\n        constructor(public offset: number) {\n            this.p = offset\n        }\n    }\n\n    export const defaultFov = SW / SH / 2  //Wall just fill screen height when standing 1 tile away\n\n    export class RayCastingRender {\n        private tempScreen: Image = image.create(SW, SH)\n\n        velocityAngle: number = 2\n        velocity: number = 3\n        protected _viewMode = ViewMode.raycastingView\n        protected dirXFpx: number\n        protected dirYFpx: number\n        protected planeX: number\n        protected planeY: number\n        protected _angle: number\n        protected _fov: number\n        protected _wallZScale: number = 1\n        cameraSway = 0\n        protected isWalking = false\n        protected cameraOffsetX = 0\n        protected cameraOffsetZ_fpx = 0\n\n        //sprites & accessories\n        sprSelf: Sprite\n        sprites: Sprite[] = []\n        sprites2D: Sprite[] = []\n        spriteParticles: particles.ParticleSource[] = []\n        spriteLikes: SpriteLike[] = []\n        spriteAnimations: Animations[] = []\n        protected spriteMotionZ: MotionSet1D[] = []\n        protected sayRederers: sprites.BaseSpriteSayRenderer[] = []\n        protected sayEndTimes: number[] = []\n\n        //reference\n        protected tilemapScaleSize = 1 << TileScale.Sixteen\n        map: tiles.TileMapData\n        bg: Image\n        textures: Image[]\n        protected oldRender: scene.Renderable\n        protected myRender: scene.Renderable\n\n        //render\n        protected wallHeightInView: number\n        protected wallWidthInView: number\n        protected dist: number[] = []\n        //render perf const\n        cameraRangeAngle: number\n        viewZPos: number\n        selfXFpx: number\n        selfYFpx: number\n\n        //for drawing sprites\n        protected invDet: number //required for correct matrix multiplication\n        camera: scene.Camera\n        tempSprite: Sprite = sprites.create(img`0`)\n        protected transformX: number[] = []\n        protected transformY: number[] = []\n        protected angleSelfToSpr: number[] = []\n\n        onSpriteDirectionUpdateHandler: (spr: Sprite, dir: number) => void\n\n        get xFpx(): number {\n            return Fx.add(this.sprSelf._x, Fx.div(this.sprSelf._width, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        // set xFpx(v: number) {\n        //     this.sprSelf._x = v * this.tilemapScaleSize as any as Fx8\n        // }\n\n        get yFpx(): number {\n            return Fx.add(this.sprSelf._y, Fx.div(this.sprSelf._height, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        // set yFpx(v: number) {\n        //     this.sprSelf._y = v * this.tilemapScaleSize as any as Fx8\n        // }\n\n        get dirX(): number {\n            return this.dirXFpx / fpx_scale\n        }\n\n        get dirY(): number {\n            return this.dirYFpx / fpx_scale\n        }\n\n        set dirX(v: number) {\n            this.dirXFpx = v * fpx_scale\n        }\n\n        set dirY(v: number) {\n            this.dirYFpx = v * fpx_scale\n        }\n\n        sprXFx8(spr: Sprite) {\n            return Fx.add(spr._x, Fx.div(spr._width, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        sprYFx8(spr: Sprite) {\n            return Fx.add(spr._y, Fx.div(spr._height, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        get fov(): number {\n            return this._fov\n        }\n\n        set fov(fov: number) {\n            this._fov = fov\n            this.wallHeightInView = (SW << (fpx - 1)) / this._fov\n            this.wallWidthInView = this.wallHeightInView >> fpx // not fpx  // wallSize / this.fov * 4 / 3 * 2\n            this.cameraRangeAngle = Math.atan(this.fov) + .1 //tolerance for spr center just out of camera\n\n            this.setVectors()\n        }\n\n        get viewAngle(): number {\n            return this._angle\n        }\n        set viewAngle(angle: number) {\n            this._angle = angle\n            this.setVectors()\n            this.updateSelfImage()\n        }\n\n        get wallZScale(): number {\n            return this._wallZScale\n        }\n        set wallZScale(v: number) {\n            this._wallZScale = v\n        }\n\n        getMotionZ(spr: Sprite, offsetZ: number = 0) {\n            let motionZ = this.spriteMotionZ[spr.id]\n            if (!motionZ) {\n                motionZ = new MotionSet1D(tofpx(offsetZ))\n                this.spriteMotionZ[spr.id] = motionZ\n            }\n            return motionZ\n        }\n\n        getZOffset(spr: Sprite) {\n            return this.getMotionZ(spr).offset / fpx_scale\n        }\n\n        setZOffset(spr: Sprite, offsetZ: number, duration: number = 500) {\n            const motionZ = this.getMotionZ(spr, offsetZ)\n\n            motionZ.offset = tofpx(offsetZ)\n            if (motionZ.p != motionZ.offset) {\n                if (duration === 0)\n                    motionZ.p = motionZ.offset\n                else if (motionZ.v == 0)\n                    this.move(spr, (motionZ.offset - motionZ.p) / fpx_scale * 1000 / duration, 0)\n            }\n        }\n\n        getMotionZPosition(spr: Sprite) {\n            return this.getMotionZ(spr).p / fpx_scale\n        }\n\n        //todo, use ZHeight(set from sprite.Height when takeover, then sprite.Height will be replace with width)\n        isOverlapZ(sprite1: Sprite, sprite2: Sprite): boolean {\n            const p1 = this.getMotionZPosition(sprite1)\n            const p2 = this.getMotionZPosition(sprite2)\n            if (p1 < p2) {\n                if (p1 + sprite1.height > p2) return true\n            } else {\n                if (p2 + sprite2.height > p1) return true\n            }\n            return false\n        }\n\n        move(spr: Sprite, v: number, a: number) {\n            const motionZ = this.getMotionZ(spr)\n\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        jump(spr: Sprite, v: number, a: number) {\n            const motionZ = this.getMotionZ(spr)\n            if (motionZ.p != motionZ.offset)\n                return\n\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        jumpWithHeightAndDuration(spr: Sprite, height: number, duration: number) {\n            const motionZ = this.getMotionZ(spr)\n            if (motionZ.p != motionZ.offset)\n                return\n\n            // height= -v*v/a/2\n            // duration = -v/a*2 *1000\n            const v = height * 4000 / duration\n            const a = -v * 2000 / duration\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        get viewMode(): ViewMode {\n            return this._viewMode\n        }\n\n        set viewMode(v: ViewMode) {\n            this._viewMode = v\n        }\n\n        updateViewZPos() {\n            this.viewZPos = this.spriteMotionZ[this.sprSelf.id].p + (this.sprSelf._height as any as number) - (2 << fpx)\n        }\n\n        takeoverSceneSprites() {\n            const sc_allSprites = game.currentScene().allSprites\n            for (let i = 0; i < sc_allSprites.length;) {\n                const spr = sc_allSprites[i]\n                if (spr instanceof Sprite) {\n                    const sprList = (spr.flags & sprites.Flag.RelativeToCamera) ? this.sprites2D : this.sprites\n                    if (sprList.indexOf(spr) < 0) {\n                        sprList.push(spr as Sprite)\n                        this.getMotionZ(spr, 0)\n                        spr.onDestroyed(() => {\n                            this.sprites.removeElement(spr as Sprite)   //can be in one of 2 lists\n                            this.sprites2D.removeElement(spr as Sprite) //can be in one of 2 lists\n                            const sayRenderer = this.sayRederers[spr.id]\n                            if (sayRenderer) {\n                                this.sayRederers.removeElement(sayRenderer)\n                                sayRenderer.destroy()\n                            }\n                        })\n                    }\n                } else if (spr instanceof particles.ParticleSource) {\n                    const particle = (spr as particles.ParticleSource)\n                    if (this.spriteParticles.indexOf(particle) < 0) {\n                        this.spriteParticles[(particle.anchor as Sprite).id] = particle\n                        particle.anchor = this.tempSprite\n                    }\n                } else {\n                    if (this.spriteLikes.indexOf(spr) < 0)\n                        this.spriteLikes.push(spr)\n                }\n                sc_allSprites.removeElement(spr)\n            }\n            this.sprites.forEach((spr) => {\n                if (spr)\n                    this.takeoverSayRenderOfSprite(spr)\n            })\n        }\n        takeoverSayRenderOfSprite(sprite: Sprite) {\n            const sprite_as_any = (sprite as any)\n            if (sprite_as_any.sayRenderer) {\n                this.sayRederers[sprite.id] = sprite_as_any.sayRenderer\n                this.sayEndTimes[sprite.id] = sprite_as_any.sayEndTime;\n                sprite_as_any.sayRenderer = undefined\n                sprite_as_any.sayEndTime = undefined\n            }\n        }\n\n        tilemapLoaded() {\n            const sc = game.currentScene()\n            this.map = sc.tileMap.data\n            this.textures = sc.tileMap.data.getTileset()\n            this.tilemapScaleSize = 1 << sc.tileMap.data.scale\n            this.oldRender = sc.tileMap.renderable\n            this.spriteLikes.removeElement(this.oldRender)\n            sc.allSprites.removeElement(this.oldRender)\n\n            let frameCallback_update = sc.eventContext.registerFrameHandler(scene.PRE_RENDER_UPDATE_PRIORITY + 1, () => {\n                const dt = sc.eventContext.deltaTime;\n                // sc.camera.update();  // already did in scene\n                for (const s of this.sprites)\n                    s.__update(sc.camera, dt);\n                this.sprSelf.__update(sc.camera, dt)\n            })\n\n            let frameCallback_draw = sc.eventContext.registerFrameHandler(scene.RENDER_SPRITES_PRIORITY + 1, () => {\n                if (this._viewMode == ViewMode.tilemapView) {\n                   // screen.drawImage(sc.background.image, 0, 0)\n                    this.oldRender.__drawCore(sc.camera)\n                    this.sprites.forEach(spr => spr.__draw(sc.camera))\n                    this.sprSelf.__draw(sc.camera)\n                } else {\n                 //   this.tempScreen.drawImage(sc.background.image, 0, 0)\n                    //debug\n                    // const ms=control.micros()\n                    this.render()\n                    // info.setScore(control.micros()-ms)\n                    screen.fill(0)\n                }\n                this.sprites2D.forEach(spr => spr.__draw(sc.camera))\n                this.spriteLikes.forEach(spr => spr.__draw(sc.camera))\n                if (this._viewMode == ViewMode.raycastingView)\n                    this.tempScreen.drawTransparentImage(screen, 0, 0)\n            })\n\n            sc.tileMap.addEventListener(tiles.TileMapEvent.Unloaded, data => {\n                sc.eventContext.unregisterFrameHandler(frameCallback_update)\n                sc.eventContext.unregisterFrameHandler(frameCallback_draw)\n            })\n\n            // this.myRender = scene.createRenderable(\n            //     scene.TILE_MAP_Z,\n            //     (t, c) => this.trace(t, c)\n            // )\n\n        }\n\n        constructor() {\n            this._angle = 0\n            this.fov = defaultFov\n            this.camera = new scene.Camera()\n\n            const sc = game.currentScene()\n            if (!sc.tileMap) {\n                sc.tileMap = new tiles.TileMap();\n            } else {\n                this.tilemapLoaded()\n            }\n            game.currentScene().tileMap.addEventListener(tiles.TileMapEvent.Loaded, data => this.tilemapLoaded())\n\n            //self sprite\n            this.sprSelf = sprites.create(image.create(this.tilemapScaleSize >> 1, this.tilemapScaleSize >> 1), SpriteKind.Player)\n            this.takeoverSceneSprites()\n            this.sprites.removeElement(this.sprSelf)\n            this.updateViewZPos()\n            scene.cameraFollowSprite(this.sprSelf)\n            this.updateSelfImage()\n\n            game.onUpdate(function () {\n                this.updateControls()\n            })\n\n            game.onUpdateInterval(400, () => {\n                for (let i = 0; i < this.sprites.length;) {\n                    const spr = this.sprites[i]\n                    if (spr.flags & sprites.Flag.RelativeToCamera) {\n                        this.sprites.removeElement(spr)\n                        this.sprites2D.push(spr)\n                    } else { i++ }\n                }\n                for (let i = 0; i < this.sprites2D.length;) {\n                    const spr = this.sprites2D[i]\n                    if (!(spr.flags & sprites.Flag.RelativeToCamera)) {\n                        this.sprites2D.removeElement(spr)\n                        this.sprites.push(spr)\n                    } else { i++ }\n                }\n                this.takeoverSceneSprites() // in case some one new\n            })\n\n\n            game.onUpdateInterval(25, () => {\n                if (this.cameraSway && this.isWalking) {\n                    this.cameraOffsetX = (Math.sin(control.millis() / 150) * this.cameraSway * 3) | 0\n                    this.cameraOffsetZ_fpx = tofpx(Math.cos(control.millis() / 75) * this.cameraSway) | 0\n                }\n            });\n            control.__screen.setupUpdate(() => {\n                if (this.viewMode == ViewMode.raycastingView)\n                    updateScreen(this.tempScreen)\n                else\n                    updateScreen(screen)\n            })\n\n            game.addScenePushHandler((oldScene) => {\n                control.__screen.setupUpdate(() => { updateScreen(screen) })\n            })\n            game.addScenePopHandler((oldScene) => {\n                control.__screen.setupUpdate(() => {\n                    if (this.viewMode == ViewMode.raycastingView)\n                        updateScreen(this.tempScreen)\n                    else\n                        updateScreen(screen)\n                })\n            })\n        }\n\n        private setVectors() {\n            const sin = Math.sin(this._angle)\n            const cos = Math.cos(this._angle)\n            this.dirXFpx = tofpx(cos)\n            this.dirYFpx = tofpx(sin)\n            this.planeX = tofpx(sin * this._fov)\n            this.planeY = tofpx(cos * -this._fov)\n        }\n\n        //todo, pre-drawn dirctional image\n        public updateSelfImage() {\n            const img = this.sprSelf.image\n            img.fill(6)\n            const arrowLength = img.width / 2\n            img.drawLine(arrowLength, arrowLength, arrowLength + this.dirX * arrowLength, arrowLength + this.dirY * arrowLength, 2)\n            img.fillRect(arrowLength - 1, arrowLength - 1, 2, 2, 2)\n        }\n\n        updateControls() {\n            if (this.velocityAngle !== 0) {\n                const dx = controller.dx(this.velocityAngle)\n                if (dx) {\n                    this.viewAngle += dx\n                }\n            }\n            if (this.velocity !== 0) {\n                this.isWalking = true\n                const dy = controller.dy(this.velocity)\n                if (dy) {\n                    const nx = this.xFpx - Math.round(this.dirXFpx * dy)\n                    const ny = this.yFpx - Math.round(this.dirYFpx * dy)\n                    this.sprSelf.setPosition((nx * this.tilemapScaleSize / fpx_scale), (ny * this.tilemapScaleSize / fpx_scale))\n                } else {\n                    this.isWalking = false\n                }\n            }\n\n            for (const spr of this.sprites) {\n                this.updateMotionZ(spr)\n            }\n            this.updateMotionZ(this.sprSelf)\n        }\n\n        updateMotionZ(spr: Sprite) {\n            const dt = game.eventContext().deltaTime\n            const motionZ = this.spriteMotionZ[spr.id]\n            //if (!motionZ) continue\n\n            if (motionZ.v != 0 || motionZ.p != motionZ.offset) {\n                motionZ.v += motionZ.a * dt, motionZ.p += motionZ.v * dt\n                //landing\n                if ((motionZ.a >= 0 && motionZ.v > 0 && motionZ.p > motionZ.offset) ||\n                    (motionZ.a <= 0 && motionZ.v < 0 && motionZ.p < motionZ.offset)) { motionZ.p = motionZ.offset, motionZ.v = 0 }\n                if (spr === this.sprSelf)\n                    this.updateViewZPos()\n            }\n\n        }\n\n\n        blitRowBreak(screenX: number, screenUp: number, screenDown: number, source: Image, sourceX: number, sourceYBreak: number) {\n\n            let stepY = (sourceYBreak) / (SHHalf - screenUp )\n            let sourceY = sourceYBreak - stepY\n            let y = SHHalf -1\n            if (screenUp < 0)\n                screenUp = 0\n            while (y  >= Math.ceil(screenUp)-1) {\n                if (sourceY < 0) \n                    sourceY = 0\n                const c = source.getPixel(sourceX, sourceY)\n                this.tempScreen.setPixel(screenX, y, c)\n                y--\n                sourceY -= stepY\n            }\n            // from screen half  going down\n            stepY = (source.height - sourceYBreak) / (screenDown - SHHalf)\n            sourceY = sourceYBreak \n            y = SHHalf\n            if (screenDown > SH)\n                screenDown = SH\n            while (y < Math.round(screenDown)) {\n                const c = source.getPixel(sourceX, sourceY)\n                this.tempScreen.setPixel(screenX, y, c)\n                y++\n                sourceY += stepY\n            }\n\n        }\n        \n        render() {\n            // based on https://lodev.org/cgtutor/raycasting.html\n            this.selfXFpx = this.xFpx\n            this.selfYFpx = this.yFpx\n\n            let drawStart = 0\n            let drawHeight = 0\n            let lastDist = -1, lastTexX = -1, lastMapX = -1, lastMapY = -1\n            this.viewZPos = this.spriteMotionZ[this.sprSelf.id].p + (this.sprSelf._height as any as number) - (2 << fpx) + this.cameraOffsetZ_fpx\n            let cameraRangeAngle = Math.atan(this.fov) + .1 //tolerance for spr center just out of camera\n            //debug\n            // const ms=control.millis()\n\n            \n\n\n            const tex = this.textures[1]\n            let rayDirX0 = this.dirXFpx / fpx_scale + (this.planeX / fpx_scale)\n            let rayDirY0 = this.dirYFpx / fpx_scale + (this.planeY / fpx_scale)\n            let rayDirX1 = this.dirXFpx / fpx_scale - (this.planeX / fpx_scale)\n            let rayDirY1 = this.dirYFpx / fpx_scale - (this.planeY / fpx_scale)\n            let fmapX = this.selfXFpx / fpx_scale\n            let fmapY = this.selfYFpx / fpx_scale\n\n            const sc = game.currentScene() \n           // background\n            const speed = 2 // 2: normal speed\n            let backgroundOffset = (this._angle / Math.PI * speed ) % 1  // range -1..1\n            if (backgroundOffset < 0) backgroundOffset++  // range 0..1\n            backgroundOffset *= SW    // range 0..screenwidth\n            \n            //floor\n            for (let y = 60; y < SH; y++) {\n                let p = y - SHHalf\n                let posZ = SH * this.viewZPos / this.tilemapScaleSize / fpx_scale\n                let rowDistance = posZ / p\n                let floorStepX = rowDistance * (rayDirX1 - rayDirX0) / SW\n                let floorStepY = rowDistance * (rayDirY1 - rayDirY0) / SW\n\n\n\n                let floorX = fmapX + rowDistance * rayDirX0\n                let floorY = fmapY + rowDistance * rayDirY0\n                for (let x = 0; x < SW; x++) {\n                      let cellX = Math.floor(floorX)\n                     let cellY = Math.floor(floorY)\n                    let tx =  (16 * (floorX - cellX)) & 15\n                      let ty = (16 * (floorY - cellY)) & (15)\n                    let mapX = Math.round(floorX - 0.5) % 16\n                    let mapY = Math.round(floorY - 0.5) % 16\n                    let tileType = this.map.getTile(mapX, mapY)\n                    let floorTex = this.textures[tileType]\n                    floorX += floorStepX\n                    floorY += floorStepY\n                    let c = floorTex.getPixel(tx, ty)\n                    this.tempScreen.setPixel(x, y, c)\n\n                }\n\n\n\n            }\n            // walls\n\n            for (let x = 0; x < SW; x++) {\n                const cameraX: number = one - Math.idiv(((x + this.cameraOffsetX) << fpx) << 1, SW)\n                let rayDirX = this.dirXFpx + (this.planeX * cameraX >> fpx)\n                let rayDirY = this.dirYFpx + (this.planeY * cameraX >> fpx)\n\n                // avoid division by zero\n                if (rayDirX == 0) rayDirX = 1\n                if (rayDirY == 0) rayDirY = 1\n\n                let mapX = this.selfXFpx >> fpx\n                let mapY = this.selfYFpx >> fpx\n\n                // length of ray from current position to next x or y-side\n                let sideDistX = 0, sideDistY = 0\n\n                // length of ray from one x or y-side to next x or y-side\n                const deltaDistX = Math.abs(Math.idiv(one2, rayDirX));\n                const deltaDistY = Math.abs(Math.idiv(one2, rayDirY));\n\n                let mapStepX = 0, mapStepY = 0\n\n                let sideWallHit = false;\n\n                //calculate step and initial sideDist\n                if (rayDirX < 0) {\n                    mapStepX = -1;\n                    sideDistX = ((this.selfXFpx - (mapX << fpx)) * deltaDistX) >> fpx;\n                } else {\n                    mapStepX = 1;\n                    sideDistX = (((mapX << fpx) + one - this.selfXFpx) * deltaDistX) >> fpx;\n                }\n                if (rayDirY < 0) {\n                    mapStepY = -1;\n                    sideDistY = ((this.selfYFpx - (mapY << fpx)) * deltaDistY) >> fpx;\n                } else {\n                    mapStepY = 1;\n                    sideDistY = (((mapY << fpx) + one - this.selfYFpx) * deltaDistY) >> fpx;\n                }\n\n                let color = 0\n\n                while (true) {\n                    //jump to next map square, OR in x-direction, OR in y-direction\n                    if (sideDistX < sideDistY) {\n                        sideDistX += deltaDistX;\n                        mapX += mapStepX;\n                        sideWallHit = false;\n                    } else {\n                        sideDistY += deltaDistY;\n                        mapY += mapStepY;\n                        sideWallHit = true;\n                    }\n\n                    if (this.map.isOutsideMap(mapX, mapY))\n                        break\n                    color = this.map.getTile(mapX, mapY)\n                    if  (this.map.isWall(mapX, mapY))\n                        break; // hit!\n                }\n\n                if (this.map.isOutsideMap(mapX, mapY))\n                    continue\n\n                let perpWallDist = 0\n                let wallX = 0\n                if (!sideWallHit) {\n                    perpWallDist = Math.idiv(((mapX << fpx) - this.selfXFpx + (1 - mapStepX << fpx - 1)) << fpx, rayDirX)\n                    wallX = this.selfYFpx + (perpWallDist * rayDirY >> fpx);\n                } else {\n                    perpWallDist = Math.idiv(((mapY << fpx) - this.selfYFpx + (1 - mapStepY << fpx - 1)) << fpx, rayDirY)\n                    wallX = this.selfXFpx + (perpWallDist * rayDirX >> fpx);\n                }\n                wallX &= FPX_MAX\n\n                // color = (color - 1) * 2\n                // if (sideWallHit) color++\n\n                const tex = this.textures[color]\n                if (!tex)\n                    continue\n\n                let texX = (wallX * tex.width) >> fpx;\n                // if ((!sideWallHit && rayDirX > 0) || (sideWallHit && rayDirY < 0))\n                //     texX = tex.width - texX - 1;\n\n                const lineHeight = (this.wallHeightInView / perpWallDist)\n                const drawEnd = lineHeight * this.viewZPos / this.tilemapScaleSize / fpx_scale;\n                const horizontBreak = 1 - this.viewZPos / this.tilemapScaleSize / fpx_scale;\n                if (perpWallDist !== lastDist && (texX !== lastTexX || mapX !== lastMapX || mapY !== lastMapY)) {//neighbor line of tex share same parameters\n                     \n                    drawStart = drawEnd - lineHeight * (this._wallZScale) ;\n                    drawHeight = (Math.ceil(drawEnd) - Math.ceil(drawStart) )\n                    drawStart += (SH >> 1)\n\n                    lastDist = perpWallDist\n                    lastTexX = texX\n                    lastMapX = mapX\n                    lastMapY = mapY\n                }\n                //fix start&end points to avoid regmatic between lines\n               \n\n                //if (x < SWHalf)\n                //    this.tempScreen.blitRow(x, drawStart, tex, texX, drawHeight)\n                //else\n                    this.blitRowBreak(x, SHHalf + drawEnd - lineHeight, SHHalf + drawEnd, tex, texX, tex.height * horizontBreak)\n\n                this.dist[x] = perpWallDist\n\n                // background \n                for (let y = 0; y < drawStart; y++ ){\n                    let backX = (backgroundOffset + x) % SW\n                    let c = sc.background.image.getPixel(backX,y)\n                    this.tempScreen.setPixel(x,y,c)\n                }\n            }\n            //debug\n            // info.setScore(control.millis()-ms)\n           // this.tempScreen.print(backgroundOffset.toString(), 0,0,7 )\n           // this.tempScreen.print([Math.roundWithPrecision(this._angle, 3)].join(), 20, 5)\n\n            this.drawSprites()\n        }\n\n        drawSprites() {\n            //debug\n            // let msSprs=control.millis()\n            /////////////////// sprites ///////////////////\n\n            //for sprite\n            const invDet = one2 / (this.planeX * this.dirYFpx - this.dirXFpx * this.planeY); //required for correct matrix multiplication\n\n            this.sprites\n                .filter((spr, i) => {\n                    const spriteX = this.sprXFx8(spr) - this.xFpx // this.selfXFpx\n                    const spriteY = this.sprYFx8(spr) - this.yFpx // this.selfYFpx\n                    this.angleSelfToSpr[spr.id] = Math.atan2(spriteX, spriteY)\n                    this.transformX[spr.id] = invDet * (this.dirYFpx * spriteX - this.dirXFpx * spriteY) >> fpx;\n                    this.transformY[spr.id] = invDet * (-this.planeY * spriteX + this.planeX * spriteY) >> fpx; //this is actually the depth inside the screen, that what Z is in 3D\n                    const angleInCamera = Math.atan2(this.transformX[spr.id] * this.fov, this.transformY[spr.id])\n                    return angleInCamera > -this.cameraRangeAngle && angleInCamera < this.cameraRangeAngle //(this.transformY[spr.id] > 0\n                }).sort((spr1, spr2) => {   // far to near\n                    return (this.transformY[spr2.id] - this.transformY[spr1.id])\n                }).forEach((spr, index) => {\n                    //debug\n                    // this.tempScreen.print([spr.id,Math.roundWithPrecision(angle[spr.id],3)].join(), 0, index * 10 + 10,9)\n                    this.drawSprite(spr, index, this.transformX[spr.id], this.transformY[spr.id], this.angleSelfToSpr[spr.id])\n                })\n\n            //debug\n            // info.setLife(control.millis() - msSprs+1)\n             //this.tempScreen.print([Math.roundWithPrecision(this._angle,3)].join(), 20,  0)\n\n        }\n\n        registerOnSpriteDirectionUpdate(handler: (spr: Sprite, dir: number) => void) {\n            this.onSpriteDirectionUpdateHandler = handler\n        }\n\n        drawSprite(spr: Sprite, index: number, transformX: number, transformY: number, myAngle: number) {\n            const spriteScreenX = Math.ceil((SWHalf) * (1 - transformX / transformY)) - this.cameraOffsetX;\n            const spriteScreenHalfWidth = Math.idiv((spr._width as any as number) / this.tilemapScaleSize / 2 * this.wallWidthInView, transformY)  //origin: (texSpr.width / 2 << fpx) / transformY / this.fov / 3 * 2 * 4\n            const spriteScreenLeft = spriteScreenX - spriteScreenHalfWidth\n            const spriteScreenRight = spriteScreenX + spriteScreenHalfWidth\n\n            //calculate drawing range in X direction\n            //assume there is one range only\n            let blitX = 0, blitWidth = 0\n            for (let sprX = 0; sprX < SW; sprX++) {\n                if (this.dist[sprX] > transformY) {\n                    if (blitWidth == 0)\n                        blitX = sprX\n                    blitWidth++\n                } else if (blitWidth > 0) {\n                    if (blitX <= spriteScreenRight && blitX + blitWidth >= spriteScreenLeft)\n                        break\n                    else\n                        blitX = 0, blitWidth = 0;\n                }\n            }\n            // this.tempScreen.print([this.getxFx8(spr), this.getyFx8(spr)].join(), 0,index*10+10)\n            const blitXSpr = Math.max(blitX, spriteScreenLeft)\n            const blitWidthSpr = Math.min(blitX + blitWidth, spriteScreenRight) - blitXSpr\n            if (blitWidthSpr <= 0)\n                return\n\n            const lineHeight = Math.idiv(this.wallHeightInView, transformY)\n            const drawStart = SHHalf + (lineHeight * ((this.viewZPos - this.spriteMotionZ[spr.id].p - (spr._height as any as number)) / this.tilemapScaleSize) >> fpx)\n\n            //for textures=image[][], abandoned\n            //    const texSpr = spr.getTexture(Math.floor(((Math.atan2(spr.vxFx8, spr.vyFx8) - myAngle) / Math.PI / 2 + 2-.25) * spr.textures.length +.5) % spr.textures.length)\n            //for deal in user code\n            if (this.onSpriteDirectionUpdateHandler)\n                this.onSpriteDirectionUpdateHandler(spr, ((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25))\n            //for CharacterAnimation ext.\n            //     const iTexture = Math.floor(((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25) * 4 + .5) % 4\n            //     const characterAniDirs = [Predicate.MovingLeft,Predicate.MovingDown, Predicate.MovingRight, Predicate.MovingUp]\n            //     character.setCharacterState(spr, character.rule(characterAniDirs[iTexture]))\n            //for this.spriteAnimations\n            const texSpr = !this.spriteAnimations[spr.id] ? spr.image : this.spriteAnimations[spr.id].getFrameByDir(((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25))\n\n            const sprTexRatio = texSpr.width / spriteScreenHalfWidth / 2\n            helpers.imageBlit(\n                this.tempScreen,\n                blitXSpr,\n                drawStart,\n                blitWidthSpr,\n                lineHeight * spr.height / this.tilemapScaleSize,\n                texSpr,\n                (blitXSpr - (spriteScreenX - spriteScreenHalfWidth)) * sprTexRatio\n                ,\n                0,\n                blitWidthSpr * sprTexRatio, texSpr.height, true, false)\n\n            screen.fill(0)\n            const fpx_div_transformy = Math.roundWithPrecision(transformY / 4 / fpx_scale, 2)\n            const height = (SH / fpx_div_transformy)\n            const blitXSaySrc = ((blitX - spriteScreenX) * fpx_div_transformy) + SWHalf\n            const blitWidthSaySrc = (blitWidth * fpx_div_transformy)\n\n            //sprite\n            // screen.drawImage(texSpr, SWHalf-texSpr.width/2, SHHalf)\n            //sayText\n            const sayRender = this.sayRederers[spr.id]\n            if (sayRender) {\n                if (this.sayEndTimes[spr.id] && control.millis() > this.sayEndTimes[spr.id]) {\n                    this.sayRederers[spr.id] = undefined\n                } else {\n                    this.tempSprite.x = SWHalf\n                    this.tempSprite.y = SHHalf + 2\n                    this.camera.drawOffsetX = 0\n                    this.camera.drawOffsetY = 0\n                    sayRender.draw(screen, this.camera, this.tempSprite)\n                }\n            }\n            //particle\n            const particle = this.spriteParticles[spr.id]\n            if (particle) {\n                if (particle.lifespan) {\n                    //debug\n                    // this.tempScreen.print([spr.id].join(), 0,index*10+10)\n                    this.tempSprite.x = SWHalf\n                    this.tempSprite.y = SHHalf + spr.height\n                    this.camera.drawOffsetX = 0//spr.x-SWHalf\n                    this.camera.drawOffsetY = 0//spr.y-SH\n                    particle.__draw(this.camera)\n                } else {\n                    this.spriteParticles[spr.id] = undefined\n                }\n            }\n            //update screen for this spr\n            // const sayTransformY = \n            if (blitXSaySrc <= 0) { //imageBlit considers negative value as 0\n                helpers.imageBlit(\n                    this.tempScreen,\n                    spriteScreenX - SWHalf / fpx_div_transformy, drawStart - height / 2, (blitWidthSaySrc + blitXSaySrc) / fpx_div_transformy, height,\n                    screen,\n                    0, 0, blitWidthSaySrc + blitXSaySrc, SH, true, false)\n            } else {\n                helpers.imageBlit(\n                    this.tempScreen,\n                    // blitX, drawStart - height / 2 , blitWidth, height,\n                    blitX, drawStart - height / 2, blitWidth, height,\n                    screen,\n                    blitXSaySrc, 0, blitWidthSaySrc, SH,\n                    true, false)\n            }\n        }\n    }\n\n    //%fixedinstance\n    export const raycastingRender = new Render.RayCastingRender()\n}\n\n","tilemap.g.jres":"{\n    \"transparency16\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true\n    },\n    \"tile1\": {\n        \"data\": \"hwQQABAAAABBbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfQ==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile\"\n    },\n    \"tile2\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile0\"\n    },\n    \"tile3\": {\n        \"data\": \"hwQQABAAAAB34AAAAAAAAACeAAAAAAAAcOcAAAAAAAAA4AAAAAAAAHcHDgAAAAAA4O4AAAAAAAB34OAAAAAAAADu4AAAAAAAcAfuAAAAAAAH5w4AAAAAAHcADgAAAAAAB+fpAAAAAAB3DgAAAAAAAADgAAAAAAAAd+cOAAAAAAAHDgAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile1\"\n    },\n    \"tile5\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALsLAAAAAAAAuwsAAAAAAAC7CwAAAAAAALv7AAAAAAAAu/vd3d3dDQC7+wAAAAAAALsLAAAAAAAAuwsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile3\"\n    },\n    \"tile6\": {\n        \"data\": \"hwQQABAAAAAkL/QiJCIvJP8v8iQiJP//JE/y//8iT0JCL/IiIiRPIiQv8iIkIi8iIi8iIiJCLyQiL/T//yIvQv8vIi8kQv//Qi8i8iIkLyJCT/L//yIvRCIvIiIiQk8iJC/0QiIiLyRCL/IiQkIvQiQv8v//Ii8k/y/yIiJC//8iT/IiJCIvJA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile4\"\n    },\n    \"tile4\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile2\"\n    },\n    \"tile8\": {\n        \"data\": \"hwQQABAAAAAPAAAAAAAPAA/w//8AAA8A/w8AAP//AAAADwAA/wAAMAAPAAAPAAAAAA8AAA//AAAADwAADwAAAPDw//8AAAAADwAAAP////8PAAAA/////wDw//8AAAAAAA8AAA8AAAAADwAADwAAAAAPAAAPAAAAAA8AAA8AAAAA8P//AAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile6\"\n    },\n    \"tile7\": {\n        \"data\": \"hwQQABAAAAAfERERERER8R8RERERERHx/xEREREREf//mZmZmZmZ//+qqqqqqqr//5mZmZmZmf//mZmZmZmZ//+Zn//5n5n//5mf//mfmf//mZmZmZmZ//+ZmZmZmZn//6qqqqqqqv//mZmZmZmZ//8RERERERH/HxEREREREfEfERERERER8Q==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile5\"\n    },\n    \"level1\": {\n        \"id\": \"level1\",\n        \"mimeType\": \"application/mkcd-tilemap\",\n        \"data\": \"MTAxZTAwMTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMzAyMDIwMjAxMDUwMzAxMDEwMjAyMDIwMjAyMDEwMzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMzAyMDIwMjAxMDEwNDAxMDEwMjAyMDIwMjAyMDEwMzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMzAxMDIwMjAxMDEwMzAxMDEwMjAyMDIwMjAyMDEwMzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMzAzMDUwNTAxMDEwMzAxMDEwMjAyMDIwMjAyMDEwMzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMzAzMDMwMzAzMDMwMzAxMDEwMjAyMDIwMjAyMDEwMzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMzAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMzAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMzAxMDEwMTAxMDIwMjAyMDIwMjAxMDEwMTAxMDEwMzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMzAxMDEwMTAxMDIwMjAyMDIwMjAxMDIwMjAyMDIwMzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMzAxMDEwMTAxMDIwMjAyMDIwMjAxMDIwMjAyMDIwMzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMzAyMDIwMTAxMDIwMjAyMDIwMjAxMDIwMjAyMDIwMzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMzAyMDIwMTAxMDIwMjAyMDIwMjAxMDIwMjAyMDIwMzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMzAyMDIwMTAxMDEwMTAxMDEwMTAxMDIwMjAyMDIwMzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMzAyMDIwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAwMDAwMDAwMDAwMDAwMjIyMjIyMjIyMjIyMjIyMjAwMDAwMDAwMDAwMDAwMDIwMDIwMDIwMDAwMDAyMDAwMDAwMDAwMDAwMDAwMDIwMDAwMDIwMDAwMDAyMDAwMDAwMDAwMDAwMDAwMDIwMDAwMDIwMDAwMDAyMDAwMDAwMDAwMDAwMDAwMjIyMjAwMDIwMDAwMDAyMDAwMDAwMDAwMDAwMDAwMjIyMjIyMDIwMDAwMDAyMDAwMDAwMDAwMDAwMDAwMDIwMDAwMDAwMDAwMDAyMDAwMDAwMDAwMDAwMDAwMDIwMDAwMDAwMDAwMDAyMDAwMDAwMDAwMDAwMDAwMDIwMDAwMDAwMDAwMDAyMDAwMDAwMDAwMDAwMDAwMDIwMDAwMDAwMDAwMDAyMDAwMDAwMDAwMDAwMDAwMDIwMDAwMDAwMDAwMDAyMDAwMDAwMDAwMDAwMDAwMDIwMDAwMDAwMDAwMDAyMDAwMDAwMDAwMDAwMDAwMDIwMDAwMDAwMDAwMDAyMDAwMDAwMDAwMDAwMDAwMDIwMDAwMDAwMDAwMDAyMDAwMDAwMDAwMDAwMDAwMDIwMDAwMDAwMDAwMDAyMDAwMDAwMDAwMDAwMDAwMjIyMjIyMjIyMjIyMjIyMg==\",\n        \"tileset\": [\n            \"myTiles.transparency16\",\n            \"sprites.dungeon.floorLight0\",\n            \"sprites.dungeon.floorLight1\",\n            \"sprites.dungeon.floorDark0\",\n            \"sprites.dungeon.floorDark3\",\n            \"myTiles.tile7\"\n        ],\n        \"displayName\": \"level\"\n    },\n    \"*\": {\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"dataEncoding\": \"base64\",\n        \"namespace\": \"myTiles\"\n    }\n}","tilemap.g.ts":"","pxt.json":"{\n    \"name\": \"3d floor and background\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"device\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"assets.json\",\n        \"_animation.ts\",\n        \"_render_blocks.ts\",\n        \"_render_raycasting.ts\",\n        \"tilemap.g.jres\",\n        \"tilemap.g.ts\"\n    ],\n    \"targetVersions\": {\n        \"branch\": \"v1.10.36\",\n        \"tag\": \"v1.10.36\",\n        \"commits\": \"https://github.com/microsoft/pxt-arcade/commits/3a5a7e13703edf0412c17bdb9b1469e282a5b31b\",\n        \"target\": \"1.10.36\",\n        \"pxt\": \"8.3.9\"\n    },\n    \"preferredEditor\": \"blocksprj\"\n}\n"}},{"timestamp":1763729243992,"editorVersion":"2.0.62","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable type=\"KIND_SpriteKind\" id=\"USZ`q|D]$0kk|,E!b7c6\">Player</variable><variable type=\"KIND_SpriteKind\" id=\"@8#W0|ESmtdS+3`?Z+:+\">Projectile</variable><variable type=\"KIND_SpriteKind\" id=\"h1jvB:JPL=NMGpJB=4/[\">Food</variable><variable type=\"KIND_SpriteKind\" id=\"(3Y]|wk94c4t/c`pc((X\">Enemy</variable><variable type=\"KIND_SpriteKind\" id=\"2B=HiFZ(Kz-^Ln6ox1L~\">Help</variable><variable id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</variable><variable id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</variable><variable id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</variable></variables><block type=\"keyonevent\" x=\"351\" y=\"-168\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_toggleViewMode\"></block></statement></block><block type=\"pxt-on-start\" x=\"-82\" y=\"-80\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">You have been abandoned by your crew and trapped on the moon base</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Try and find a way out before the asteroid hits</field></shadow></value><next><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff99d99bbbbbcfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff99ddbdd66168bcccccc9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff999ddbbbd66888111ccccccb99fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9966ddbbbb6688811818ccccccbbc99fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdd69dddbbb66618881888818818cccccbe9fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffddd96dd6b6dbd68888888888888888cccccc99fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffdbbd9666666dbb668886888888cccccccccccccc9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffdbbb99666966d68866888888cccccccccccccccccc69ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffdbbb999669666666888888888ccccbbbcc8bcccccccccc9fffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffdbbb999666666666888888888cbbcbe8bbbcbcccccbbcccb9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffff9bbb999666666666688888888bccb888888bbbbb88888bcccccfffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffdbbb999669666666866888868bbbbb8888888ccc888b88bbc8cccffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffdbbb9d99ddd666668868888688bbcb888888888bc888bcc8bc886c9fffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffbbbbbbddd966666888688888888888888b88888888888cc8ccc886c9ffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffdbbbbbbdd6966666666868888888888bbdbbebb8888888888bcc8c86c9fffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffff9bbdbddd6666666666888688868888ddddddddde8888888888bccbbccccfffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffff9dbb9dd666666666668868888888bddddddbdbbddcccccd88b8ebccbbbbc9ffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffdd99999666666666668868888888bdddddbbbbbdbbbccccccb8bbbccc8bbb9fffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffff9dd99996696966666666668888bbbdddddbbbddbbbbbbbbbcccc8bcccbb8bbcfffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffff9d999996666966666668688888bbdddbbbbdbbbbbbbbbbbcccccc8bbccc88bc9ffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff99999999666996696668868868bbdddddbbbdbbbbbbbbbbbbcbccc88bcccc88c6ffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff999996696669666966d8868666bddbbbddbbdbbbbbbbbbbbbcccccc88bbccc8869fffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff9999996699669666666d6688668bddbbdbbbbbbbbbbbbbbbbbccccccc88bcccc866fffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff9dd999669966666666666688668bdddbbbbbbbbbbbbbbbbbbbccccccc888bbccc669ffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff999999669d69666666666688868bddbbbdbbbbbbbbbbbbbbbbcccccccc888bbcc869ffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99999996ddd69666666688888868ddbddbbbbbbbbbbbbbbbbbbccccccccc888888866ffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff999999969ddd6669666688688888bbbbbbbbbbbbbbbbbbbbbbbbccbccccc8888888869fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99999966ddddd669666688888888bbbbbbbbbbbbbbbbbbbbbbbcbccccccccc88888869fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff999bb99666dddd6666666668886888bbbbbbbbbbbbbbbbbbbbbbcccccccccccc8888889fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbbb966696666666666888886888bbbbbbbbbbbbbbbbbbbbbbcbccccccccccc888886fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbdbb666969666666668888868888bbbbbbbbbbbbbbbbbbbbccbccccccccccc8888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99dbbbbb6696966666666668886868888bbbbeb888bbbbbbbbbcccccccccccccc8888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbbbbbe6969666666666888888888888888888888bbbbbbbbccccccccccccc88888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbccbc66966666666688888688888888888d888ebbbbbbbcccccccccccbb88888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbbcc69996666688668886888888dd88dbbd88bbbbbbbccccccccccceb88888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbbccc999966668868888888888ddddbbbbd88cbbbbbbbbccccccccc8888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9ebbbbcccccccc9966666688888888888888ddbbbb888bbbbbbbbccccccccc8888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbccccccccc666666888866888888888dddddbdd88bbbbbbccccccccc88888888bb9ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffbbbbbbcccccccccc6666688888888888888888d8888888bbbbbbccccccccc88888888bb9ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9dbbbbccbbccccccb666688868888888888888888888888bbbbbccccccccc888888888b9ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9dbbbbbbbbcccccbb66666688888888888888888888888bbbbccccccccccc88888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbcccccccb666666688888888888888888888888bbbbcccccccccc888888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbccccccbb666666688888888888888888888888bbbbcccccccccc88888888886fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbbbbbbbccccb6666668888888888888888888888888bbbbcbcccccccc88888888886fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99dbbbcbbccccb6666668888888888888888888888888bbbbbccccccccc888cc888869fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99dbbbcccccccc6666668688688888888888888888888bbbbccccccccc8888cc888869fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff999bbbbbccccbc6666666688688888888888888888888bbbbcccccccc88888dd88886ffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff969bbbbbbcccc69666666668688868888888888888888bbbbccccccc88888bd888886ffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff99bbbbcccccc696bb668888888868888888888888888bbbcccccccc8888bbd888869ffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff9999bbbcccc9666dbbb8888888888888888888888888ccbcccccccc8888bc888886fffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff699bbbbccc966966bbb8888888888888888888888888bbbbccccc88888bcc88869fffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff9999bbcccc666666dbbdd88888888688888888888888bbcccccc88888888888669fffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff9699dbcccc66666666bb6d8888888688888888888888bbcccccc8888888888869ffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffff9696bbbcc66666666dbbd6886868888888888888888bbcbccc8888888888d669ffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffff999ebbccc666666666dbb8868888688888888888888bbbccc8888888889b69fffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffff969ccbcc66996666666bbb868888888888888888888bbbc888888888888b6ffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffff96ccccc966966666666bb8688666888888888888888b8888888888888699ffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffff99ccbc996666666666dbb6888668888888888888888888888888888869fffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffff969ccb9666666666666dbb88866888888888888888888888888888869ffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffff969ccc6696666666666dd8888668888888888888888888888888866fffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffff969cc9669666966d66dd8888868888888888888888888bb8888669fffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffff96ccc66699669dddd888868888888888888888888888be888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffff96c66669966666dd88886666668888888888888888dd888669fffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffff96966669966ddd686886868888888888888888888d888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffff969666696666666688686888888888888888888888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffff9966966966666666886888888888888886888888669fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9699996666666888888888888888888118888699ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff969996666668888881188888888881888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff996999666688881818888888881886669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9961161186618811188886116699ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff99161111611118111666699fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9999661166669999ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff999999999fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\nf f f f f f f f f f f f f f f f \n1 1 f f f f f f f f f f f f 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 f f f f f f f f f f f f 1 1 \nf f f f f f f f f f f f f f f f \n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value></block></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"700\" y=\"-91\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile8`</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile10`</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></next></block></statement></block></statement></block><block type=\"spritesoverlap\" x=\"191\" y=\"335\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value><statement name=\"HANDLER\"><block type=\"variables_change\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><next><block type=\"spritedestroy2\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"effect\">effects.spray</field><value name=\"sprite\"><block type=\"argument_reporter_custom\"><mutation typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow></value><next><block type=\"hudsetScore\"><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></next></block></statement></block></xml>","main.ts":"","README.md":" ","assets.json":"","_animation.ts":"//////////////////////// animation.ts contents of previous version, just for test.ts here for convenience /////////////////////\n// file contents:\n// directional animations defines for enging_raycasting.ts\n// for convenience, constructed animations as below, which images are builtin in Arcade, \n// in order from easy to complex\n\n// each are 2D Image array, Image[][]: \n// 1st dimension is direction: \n//    length=1 to any, e.g. 1,2,3,4,...,8,..., engine can automatically arange them to 0~360 \n//    order: start from left, then folling with others in CW order\n//    e.g: \n//         2 directions should be [leftAni,RightAni], \n//         4-direction should be [leftAni, frontAni, rightAni, backAni], \n//         8-direction=[l,lf,f,fr,r,rb,b,lb], ...\n//    the reason that directions start from left, is almost all Arcade builtin one side images are facing left, so that would be convient for using.\n// 2nd dimension is animation Images\n//    length=1 to any, e.g. 1,2,3,4,..., engine will automatically loop them by aniInterval(set when create CompactSprite, or use default)\n\n\n//simplest, just one static image, looks the same in all angle of view\nconst texturesDonut = [[sprites.food.smallDonut]]\nconst texturesBigCake = [[sprites.food.bigCake]]\n\n//1-direction, with ani, looks the same Ani in all angle of view\nconst texturesCoin = [[sprites.builtin.coin0, sprites.builtin.coin1, sprites.builtin.coin2, sprites.builtin.coin3, sprites.builtin.coin4, sprites.builtin.coin5]]\n\nconst texturesDog = [[sprites.builtin.dog0, sprites.builtin.dog1, sprites.builtin.dog2]]\nconst texturesDuck = [[sprites.duck.duck1, sprites.duck.duck2, sprites.duck.duck3, sprites.duck.duck4, sprites.duck.duck5, sprites.duck.duck6]]\n\n//2-direction, with ani, looks difference from left or right side\nconst texturesPlane = [[sprites.vehicle.plane0, sprites.vehicle.plane1, sprites.vehicle.plane2, sprites.vehicle.plane3, sprites.vehicle.plane4, sprites.vehicle.plane5],\n[sprites.vehicle.plane0, sprites.vehicle.plane1, sprites.vehicle.plane2, sprites.vehicle.plane3, sprites.vehicle.plane4, sprites.vehicle.plane5]]\n//no right side ani images builtin, so make them from lefts, and then flipX\nimagesFlipX(texturesPlane[1])\n\nconst texturesFish = [[sprites.builtin.angelFish0, sprites.builtin.angelFish1, sprites.builtin.angelFish2, sprites.builtin.angelFish3],\n[sprites.builtin.angelFish0, sprites.builtin.angelFish1, sprites.builtin.angelFish2, sprites.builtin.angelFish3]]\nimagesFlipX(texturesFish[1])\n\n//4-direction\nconst texturesHero = [\n    [sprites.castle.heroWalkSideLeft1, sprites.castle.heroWalkSideLeft2, sprites.castle.heroWalkSideLeft3, sprites.castle.heroWalkSideLeft4],\n    [sprites.castle.heroWalkFront1, sprites.castle.heroWalkFront2, sprites.castle.heroWalkFront3, sprites.castle.heroWalkFront4],\n    [sprites.castle.heroWalkSideRight1, sprites.castle.heroWalkSideRight2, sprites.castle.heroWalkSideRight3, sprites.castle.heroWalkSideRight4],\n    [sprites.castle.heroWalkBack1, sprites.castle.heroWalkBack2, sprites.castle.heroWalkBack3, sprites.castle.heroWalkBack4],\n]\n\nconst texturesPrincess2 = [\n    [sprites.castle.princess2Left1, sprites.castle.princess2Left2],\n    [sprites.castle.princess2WalkFront1, sprites.castle.princess2WalkFront2, sprites.castle.princess2WalkFront3, sprites.castle.princess2WalkFront2],\n    [sprites.castle.princess2Right1, sprites.castle.princess2Right2],\n    [sprites.castle.princess2WalkBack1, sprites.castle.princess2WalkBack2, sprites.castle.princess2WalkBack3, sprites.castle.princess2WalkBack2],\n]\n\n//4-direction, but back side has only 1 image, so no ani when looking from back\nconst texturesSkelly = [\n    [sprites.castle.skellyWalkLeft1, sprites.castle.skellyWalkLeft2],\n    [sprites.castle.skellyWalkFront1, sprites.castle.skellyWalkFront2, sprites.castle.skellyWalkFront3],\n    [sprites.castle.skellyWalkRight1, sprites.castle.skellyWalkRight2],\n    [img`\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ..........ffff..........\n\t        ........ff1111ff........\n\t        .......fb111111bf.......\n\t        .......f11111111f.......\n\t        ......fd11111111df......\n\t        ......fd11111111df......\n\t        ......fd11111111df......\n\t        ......fb11111111bf......\n\t        ......fcd111111dcf......\n\t        .......fb111111bf.......\n\t        .....ffffdb1bdcfff......\n\t        ....fc111cfbfbc111cf....\n\t        ....f11111ffff11111f....\n\t        ....fbfbfbffffffbfbf....\n\t        .........ffffff.........\n\t        ..........fff...........\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ........................\n\t    `],\n]\n\nconst texturesPrincess = [\n    [sprites.castle.princessLeft0, sprites.castle.princessLeft1, sprites.castle.princessLeft0, sprites.castle.princessLeft2],\n    [sprites.castle.princessFront0, sprites.castle.princessFront1, sprites.castle.princessFront0, sprites.castle.princessFront2],\n    [],\n    [sprites.castle.princessBack0, sprites.castle.princessBack1, sprites.castle.princessBack0, sprites.castle.princessBack2],\n]\ntexturesPrincess[0].forEach((v, i) => {\n    texturesPrincess[2].push(v.clone())\n    texturesPrincess[2][i].flipX()\n}\n)\n\nfunction imagesFlipX(ani: Image[]) {\n    ani.forEach((img, i) => {\n        ani[i] = img.clone() //don't worry memery leak or waste, cause old images are still using by left\n        ani[i].flipX()\n    })\n}\n\n//////////////////////// end of animation.ts contents of previous version //////////////\n\n\n","_render_blocks.ts":"enum RCSpriteAttribute {\n    ZOffset,\n    ZPosition,\n    ZVelocity,\n    ZAcceleration\n}\n/**\n * A 2.5D Screen Render, using Raycasting algorithm\n **/\n//% color=#03AA74 weight=1 icon=\"\\uf1b2\" //cube f1b2 , fold f279\n//% groups='[\"Instance\",\"Basic\", \"Dimension Z\", \"Animate\", \"Advanced\"]'\n//% block=\"3D Render\"\nnamespace Render {\n    export enum attribute {\n        dirX,\n        dirY,\n        fov,\n        wallZScale,\n    }\n\n    export class Animations {\n        constructor(public frameInterval: number, public animations: Image[][]) {\n        }\n\n        msLast = 0\n        index = 0\n        iAnimation = 0\n        getFrameByDir(dir: number): Image {\n            if (control.millis() - this.msLast > this.frameInterval) {\n                this.msLast = control.millis()\n                this.index++\n                this.iAnimation = Math.round((dir * this.animations.length)) % this.animations.length\n                if (this.index >= this.animations[this.iAnimation].length)\n                    this.index = 0\n            }\n            return this.animations[this.iAnimation][this.index]\n        }\n    }\n\n    /**\n * Apply a directional image animations on a sprite\n * @param sprite the sprite to animate on\n * @param animations the directional animates\n */\n    //% blockId=set_animation\n    //% block=\"set $sprite=variables_get(mySprite) with animations$animations\"\n    //% animations.shadow=create_animation\n    //% group=\"Animate\"\n    //% weight=100\n    //% help=github:pxt-raycasting/docs/set-sprite-animations\n    export function setSpriteAnimations(sprite: Sprite, animations: Animations) {\n        raycastingRender.spriteAnimations[sprite.id] = animations\n    }\n\n    /**\n * Create a directional image animations, multi animations will applied to one round dirctions averagely, start from the left. \n * The reason that directions start from left, is almost all Arcade out-of-box 1 or 2-dirction images are facing left, so that would be convient for using.\n * @param frameInterval the time between changes, eg: 150\n * @param frames1 animation, if this is the first of multi animation it will be used as left, others will \n * @param frames2 optional, used for 2 or more dirctional\n * @param frames3 optional, used for 3 or more dirctional\n * @param frames4 optional, used for 4 or more dirctional\n */\n    //% blockId=create_animation\n    //% block=\"interval$frameInterval=timePicker animates:$frames1=animation_editor|| $frames2=animation_editor $frames3=animation_editor $frames4=animation_editor\"\n    //% inlineInputMode=inline\n    //% group=\"Animate\"\n    //% weight=100\n    //% help=github:pxt-raycasting/docs/create-animations\n    export function createAnimations(frameInterval: number, frames1: Image[], frames2?: Image[], frames3?: Image[], frames4?: Image[]): Animations {\n        const animationList = [frames1]\n        if (frames2) animationList.push(frames2)\n        if (frames3) animationList.push(frames3)\n        if (frames4) animationList.push(frames4)\n        return new Animations(frameInterval, animationList)\n    }\n\n    /**\n     * Get the Render\n     * @param img the image\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRCRenderInstance block=\"raycasting render\"\n    //% expandableArgumentMode=toggle\n    //% weight=100 \n    //% blockHidden=true\n    //% hidden=1\n    export function getRCRenderInstance(): RayCastingRender {\n        return raycastingRender\n    }\n\n    /**\n     * Get the render Sprite, which create automatically, for physical collisions, and holding the view point.\n     * You can consider it as \"myself\", and operate it like a usual sprite, eg.: position, speed, scale, collision, ...\n     * But properties relative 3D, eg. ZOffset, ZPosition, viewAngle, and etc. are not in the Sprite class.\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRenderSpriteVariable block=\"myself sprite\"\n    //% expandableArgumentMode=toggle\n    //% blockSetVariable=mySprite\n    //% weight=99\n    //% help=github:pxt-raycasting/get-render-sprite-variable\n    export function getRenderSpriteVariable(): Sprite {\n        return raycastingRender.sprSelf\n    }\n\n    /**\n     * Get the render Sprite, which create automatically, for physical collisions, and holding the view point.(but get/set view direction with dirX/dirY, which not in the Sprite class) \n     * You can consider it as \"myself\", and operate it like a usual sprite.\n     * eg: position, speed, scale, collision, ...\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRenderSpriteInstance block=\"myself sprite\"\n    //% expandableArgumentMode=toggle\n    //% weight=98\n    //% help=github:pxt-raycasting/docs/get-render-sprite-instance\n    export function getRenderSpriteInstance(): Sprite {\n        return raycastingRender.sprSelf\n    }\n\n    /**\n     * Toggle current view mode\n     */\n    //% blockId=rcRender_toggleViewMode block=\"toggle current view mode\"\n    //% group=\"Basic\"\n    //% weight=89\n    //% help=github:pxt-raycasting/docs/toggle-view-mode\n    export function toggleViewMode() {\n        raycastingRender.viewMode = raycastingRender.viewMode == ViewMode.tilemapView ? ViewMode.raycastingView : ViewMode.tilemapView\n    }\n\n    /**\n     * Current view mode is the specific one?\n     * @param viewMode\n     */\n    //% blockId=rcRender_isViewMode block=\"current is $viewMode\"\n    //% group=\"Basic\"\n    //% weight=88\n    //% help=github:pxt-raycasting/docs/is-view-mode\n    export function isViewMode(viewMode: ViewMode): boolean {\n        return viewMode == raycastingRender.viewMode\n    }\n\n    /**\n     * Set view mode\n     * @param viewMode\n     */\n    //% blockId=rcRender_setViewMode block=\"set view mode $viewMode\"\n    //% group=\"Basic\"\n    //% weight=87\n    //% help=github:pxt-raycasting/docs/set-view-mode\n    export function setViewMode(viewMode: ViewMode) {\n        raycastingRender.viewMode = viewMode\n    }\n\n    /**\n     * Get render arribute\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"get %attribute\" \n    //% blockId=rcRender_getAttribute\n    //% weight=83\n    //% help=github:pxt-raycasting/docs/get-attribute\n    export function getAttribute(attr: attribute): number {\n        switch (attr) {\n            case attribute.dirX:\n                return raycastingRender.dirX\n            case attribute.dirY:\n                return raycastingRender.dirY\n            case attribute.fov:\n                return raycastingRender.fov\n            case attribute.wallZScale:\n                return raycastingRender.wallZScale\n            default:\n                return 0\n        }\n    }\n\n    /**\n     * Set render arribute\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"set %attribute = %value\" \n    //% blockId=rcRender_setAttribute\n    //% weight=82\n    //% help=github:pxt-raycasting/docs/set-attribute\n    export function setAttribute(attr: attribute, value: number) {\n        switch (attr) {\n            case attribute.dirX:\n                raycastingRender.dirX = value\n                break\n            case attribute.dirY:\n                raycastingRender.dirY = value\n                break\n            case attribute.fov:\n                if (value < 0) value = 0\n                raycastingRender.fov = value\n                break\n            case attribute.wallZScale:\n                if (value < 0) value = 0\n                raycastingRender.wallZScale = value\n                break\n            default:\n        }\n    }\n\n    /**\n     * Get default FOV (field of view) value\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"defaultFov\"\n    //% blockId=rcRender_getDefaultFov\n    //% weight=81\n    //% help=github:pxt-raycasting/docs/get-default-fov\n    export function getDefaultFov(): number {\n        return defaultFov\n    }\n\n    /**\n     * Set view angle\n     * @param angle, unit: degree 0~360\n     */\n    //% blockId=rcRender_setViewAngleInDegree block=\"set view angle$angle\"\n    //% angle.min=0 angle.max=360 angle.defl=90\n    //% group=\"Basic\"\n    //% weight=80\n    //% help=github:pxt-raycasting/docs/set-view-angle-in-degree\n    export function setViewAngleInDegree(angle: number) {\n        raycastingRender.viewAngle = angle * Math.PI / 180\n    }\n\n    /**\n     * Set view angle by dirX and dirY\n     * @param dirX\n     * @param dirY\n     */\n    //% blockId=rcRender_setViewAngle block=\"set view angle by dirX%dirX and dirY%dirY\"\n    //% group=\"Basic\"\n    //% weight=79\n    //% help=github:pxt-raycasting/docs/set-view-angle\n    export function setViewAngle(dirX: number, dirY: number) {\n        raycastingRender.viewAngle = Math.atan2(dirY, dirX)\n    }\n\n    /**\n     * Set floating offset height for a sprite at Z direction\n     * @param sprite\n     * @param Zoffset Negative floats down, affirmative goes up\n     * @param duration moving time, 0 for immediately, unit: ms\n     */\n    //% blockId=rcRender_setZOffset block=\"set Sprite %spr=variables_get(mySprite) floating %offset pixels|| duration $duration=timePicker|ms \"\n    //% offset.min=-100 offset.max=100 offset.defl=8\n    //% duration.min=0 duration.max=5000 duration.defl=0\n    //% group=\"Dimension Z\"\n    //% weight=77\n    //% blockHidden\n    //% help=github:pxt-raycasting/docs/set-z-offset\n    export function setZOffset(sprite: Sprite, offset: number, duration?: number) {\n        raycastingRender.setZOffset(sprite, offset, duration)\n    }\n\n    /**\n     * Set arribute of a Sprite\n     * @param spr Sprite\n     * @param attr RCSpriteAttribute\n     */\n    //% group=\"Dimension Z\"\n    //% block=\"set Sprite %spr=variables_get(mySprite) %attribute = %value\"\n    //% blockId=rcRender_setSpriteAttribute\n    //% weight=75\n    //% help=github:pxt-raycasting/docs/set-sprite-attribute\n    export function setSpriteAttribute(spr: Sprite, attr: RCSpriteAttribute, value: number) {\n        switch (attr) {\n            case RCSpriteAttribute.ZOffset:\n                raycastingRender.getMotionZ(spr).offset = value\n                break\n            case RCSpriteAttribute.ZPosition:\n                raycastingRender.getMotionZ(spr).p = value\n                break\n            case RCSpriteAttribute.ZVelocity:\n                raycastingRender.getMotionZ(spr).v = value\n                break\n            case RCSpriteAttribute.ZAcceleration:\n                raycastingRender.getMotionZ(spr).a = value\n                break\n            default:\n        }\n    }\n\n    /**\n     * Get arribute of a Sprite\n     * @param spr Sprite\n     * @param attr RCSpriteAttribute\n     */\n    //% group=\"Dimension Z\"\n    //% block=\"get Sprite %spr=variables_get(mySprite) %attribute\"\n    //% blockId=rcRender_getSpriteAttribute\n    //% weight=74\n    //% help=github:pxt-raycasting/docs/get-sprite-attribute\n    export function getSpriteAttribute(spr: Sprite, attr: RCSpriteAttribute): number {\n        switch (attr) {\n            case RCSpriteAttribute.ZOffset:\n                return raycastingRender.getMotionZ(spr).offset\n            case RCSpriteAttribute.ZPosition:\n                return raycastingRender.getMotionZ(spr).p\n            case RCSpriteAttribute.ZVelocity:\n                return raycastingRender.getMotionZ(spr).v\n            case RCSpriteAttribute.ZAcceleration:\n                return raycastingRender.getMotionZ(spr).a\n            default:\n                return 0\n        }\n    }\n\n    /**\n     * Check if 2 sprites overlaps each another in Z dimension\n     * Best work together with sprites.onOverlap(kind1, kind2)\n     * @param sprite1\n     * @param sprite2\n     */\n    //% blockId=rcRender_isSpritesOverlapZ\n    //% block=\"is sprites $sprite1=variables_get(mySprite) and $sprite2=variables_get(mySprite2) overlaps in Z dimension\"\n    //% group=\"Dimension Z\"\n    //% weight=71\n    //% help=github:pxt-raycasting/docs/is-sprites-overlap-z\n    export function isSpritesOverlapZ(sprite1: Sprite, sprite2: Sprite): boolean {\n        return raycastingRender.isOverlapZ(sprite1, sprite2)\n    }\n\n    /**\n     * Make sprite jump, with specific height and duration\n     * Jump can only happened when sprite is standing, current height = its offset .\n     * @param sprite\n     * @param height jump height in pixel\n     * @param duration hover time span, unit: ms\n     */\n    //% blockId=rcRender_jumpWithHeightAndDuration block=\"Sprite %spr=variables_get(mySprite) jump, with height $height duration $duration=timePicker|ms \"\n    //% height.min=0 height.max=100 height.defl=16\n    //% duration.min=50 duration.max=5000 duration.defl=500\n    //% group=\"Dimension Z\"\n    //% weight=70\n    //% help=github:pxt-raycasting/docs/jump-with-height-and-duration\n    export function jumpWithHeightAndDuration(sprite: Sprite, height: number, duration: number) {\n        raycastingRender.jumpWithHeightAndDuration(sprite, height, duration)\n    }\n\n    /**\n     * Make sprite jump, with specific speed and acceleration\n     * Simular with Move block, but jump can only happened when sprite is standing, current height = its offset.\n     * @param sprite\n     * @param v vetical speed, unit: pixel/s\n     * @param a vetical acceleration, unit: pixel/s\n     */\n    //% blockId=rcRender_jump block=\"Sprite %spr=variables_get(mySprite) jump||, with speed $v=spriteSpeedPicker acceleration $a\"\n    //% v.min=-100 v.max=100 v.defl=60\n    //% a.min=-1000 a.max=1000 a.defl=-250\n    //% group=\"Dimension Z\"\n    //% weight=68\n    //% help=github:pxt-raycasting/docs/jump\n    export function jump(sprite: Sprite, v?: number, a?: number) {\n        raycastingRender.jump(sprite, v, a)\n    }\n\n    /**\n     * Make sprite jump, with specific speed and acceleration\n     * @param sprite\n     * @param v vetical speed, unit: pixel/s\n     * @param a vetical acceleration, unit: pixel/s\n     */\n    //% blockId=rcRender_move block=\"Sprite %spr=variables_get(mySprite) move, with speed $v=spriteSpeedPicker|| acceleration $a\"\n    //% v.min=-200 v.max=200 v.defl=60\n    //% a.min=-1000 a.max=1000 a.defl=-250\n    //% group=\"Dimension Z\"\n    //% weight=66\n    //% help=github:pxt-raycasting/docs/move\n    export function move(sprite: Sprite, v?: number, a?: number) {\n        raycastingRender.move(sprite, v, a)\n    }\n\n    /**\n     * Control the self sprite using the direction buttons from the controller. \n     * To stop controlling self sprite, pass 0 for v and va.\n     *\n     * @param v The velocity used for forward/backword movement when up/down is pressed, in pixel/s\n     * @param va The angle velocity used for turn view direction when left/right is pressed, in radian/s.\n     */\n    //% blockId=\"rcRender_moveWithController\" block=\"move with buttons velocity $v|| turn speed $va camera sway$cameraSway pixels\"\n    //% weight=60\n    //% expandableArgumentMode=\"toggle\"\n    //% v.defl=2 va.defl=3\n    //% group=\"Advanced\"\n    //% v.shadow=\"spriteSpeedPicker\"\n    //% va.shadow=\"spriteSpeedPicker\"\n    //% help=github:pxt-raycasting/docs/move-with-controller\n    export function moveWithController(v: number = 2, va: number = 3, cameraSway?: number) {\n        raycastingRender.velocity = v\n        raycastingRender.velocityAngle = va\n        if (cameraSway != undefined)\n            raycastingRender.cameraSway = cameraSway | 0\n    }\n\n    /**\n     * Render takeover all sprites in current scene\n     * Render will call this automatically, but maybe not in time enough.\n     * If you saw sprite draw at its tilemap position on screen, call this just after created the sprite.\n     */\n    //% blockId=rcRender_takeoverSceneSprites \n    //% block=\"takeover sprites in scene\"\n    //% group=\"Advanced\"\n    //% weight=49\n    //% help=github:pxt-raycasting/docs/takeover-scene-sprites\n    export function takeoverSceneSprites() {\n        raycastingRender.takeoverSceneSprites()\n    }\n\n    /**\n     * Run on sprite dirction updated, present view point to Sprite facing dirction, or which angle you see of the sprite.\n     * Just using with other animation extensions, to set proper Image for sprite.\n     * Not required, if you have used the set animations block provided.\n     * @param dir It is a float number, 0~1 corresponds to 0~360, suggest use Math.round(dir*dirAniTotalCount)%dirAniTotalCount to get index of direction\n     */\n    //% blockId=rcRender_registerOnSpriteDirectionUpdateHandler\n    //% block=\"run code when sprite $spr dirction updated to $dir\"\n    //% draggableParameters\n    //% group=\"Advanced\"\n    //% weight=48\n    //% help=github:pxt-raycasting/docs/register-on-sprite-direction-update-handler\n    export function registerOnSpriteDirectionUpdateHandler(handler: (spr: Sprite, dir: number) => void) {\n        raycastingRender.registerOnSpriteDirectionUpdate(handler)\n    }\n}\n","_render_raycasting.ts":"//% shim=pxt::updateScreen\nfunction updateScreen(img: Image) { }\n\nenum ViewMode {\n    //% block=\"TileMap Mode\"\n    tilemapView,\n    //% block=\"Raycasting Mode\"\n    raycastingView,\n}\n\nnamespace Render {\n    const SH = screen.height, SHHalf = SH / 2\n    const SW = screen.width, SWHalf = SW / 2\n    const fpx = 8\n    const fpx_scale = 2 ** fpx\n    function tofpx(n: number) { return (n * fpx_scale) | 0 }\n    const one = 1 << fpx\n    const one2 = 1 << (fpx + fpx)\n    const FPX_MAX = (1 << fpx) - 1\n\n    class MotionSet1D {\n        p: number\n        v: number = 0\n        a: number = 0\n        constructor(public offset: number) {\n            this.p = offset\n        }\n    }\n\n    export const defaultFov = SW / SH / 2  //Wall just fill screen height when standing 1 tile away\n\n    export class RayCastingRender {\n        private tempScreen: Image = image.create(SW, SH)\n\n        velocityAngle: number = 2\n        velocity: number = 3\n        protected _viewMode = ViewMode.raycastingView\n        protected dirXFpx: number\n        protected dirYFpx: number\n        protected planeX: number\n        protected planeY: number\n        protected _angle: number\n        protected _fov: number\n        protected _wallZScale: number = 1\n        cameraSway = 0\n        protected isWalking = false\n        protected cameraOffsetX = 0\n        protected cameraOffsetZ_fpx = 0\n\n        //sprites & accessories\n        sprSelf: Sprite\n        sprites: Sprite[] = []\n        sprites2D: Sprite[] = []\n        spriteParticles: particles.ParticleSource[] = []\n        spriteLikes: SpriteLike[] = []\n        spriteAnimations: Animations[] = []\n        protected spriteMotionZ: MotionSet1D[] = []\n        protected sayRederers: sprites.BaseSpriteSayRenderer[] = []\n        protected sayEndTimes: number[] = []\n\n        //reference\n        protected tilemapScaleSize = 1 << TileScale.Sixteen\n        map: tiles.TileMapData\n        bg: Image\n        textures: Image[]\n        protected oldRender: scene.Renderable\n        protected myRender: scene.Renderable\n\n        //render\n        protected wallHeightInView: number\n        protected wallWidthInView: number\n        protected dist: number[] = []\n        //render perf const\n        cameraRangeAngle: number\n        viewZPos: number\n        selfXFpx: number\n        selfYFpx: number\n\n        //for drawing sprites\n        protected invDet: number //required for correct matrix multiplication\n        camera: scene.Camera\n        tempSprite: Sprite = sprites.create(img`0`)\n        protected transformX: number[] = []\n        protected transformY: number[] = []\n        protected angleSelfToSpr: number[] = []\n\n        onSpriteDirectionUpdateHandler: (spr: Sprite, dir: number) => void\n\n        get xFpx(): number {\n            return Fx.add(this.sprSelf._x, Fx.div(this.sprSelf._width, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        // set xFpx(v: number) {\n        //     this.sprSelf._x = v * this.tilemapScaleSize as any as Fx8\n        // }\n\n        get yFpx(): number {\n            return Fx.add(this.sprSelf._y, Fx.div(this.sprSelf._height, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        // set yFpx(v: number) {\n        //     this.sprSelf._y = v * this.tilemapScaleSize as any as Fx8\n        // }\n\n        get dirX(): number {\n            return this.dirXFpx / fpx_scale\n        }\n\n        get dirY(): number {\n            return this.dirYFpx / fpx_scale\n        }\n\n        set dirX(v: number) {\n            this.dirXFpx = v * fpx_scale\n        }\n\n        set dirY(v: number) {\n            this.dirYFpx = v * fpx_scale\n        }\n\n        sprXFx8(spr: Sprite) {\n            return Fx.add(spr._x, Fx.div(spr._width, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        sprYFx8(spr: Sprite) {\n            return Fx.add(spr._y, Fx.div(spr._height, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        get fov(): number {\n            return this._fov\n        }\n\n        set fov(fov: number) {\n            this._fov = fov\n            this.wallHeightInView = (SW << (fpx - 1)) / this._fov\n            this.wallWidthInView = this.wallHeightInView >> fpx // not fpx  // wallSize / this.fov * 4 / 3 * 2\n            this.cameraRangeAngle = Math.atan(this.fov) + .1 //tolerance for spr center just out of camera\n\n            this.setVectors()\n        }\n\n        get viewAngle(): number {\n            return this._angle\n        }\n        set viewAngle(angle: number) {\n            this._angle = angle\n            this.setVectors()\n            this.updateSelfImage()\n        }\n\n        get wallZScale(): number {\n            return this._wallZScale\n        }\n        set wallZScale(v: number) {\n            this._wallZScale = v\n        }\n\n        getMotionZ(spr: Sprite, offsetZ: number = 0) {\n            let motionZ = this.spriteMotionZ[spr.id]\n            if (!motionZ) {\n                motionZ = new MotionSet1D(tofpx(offsetZ))\n                this.spriteMotionZ[spr.id] = motionZ\n            }\n            return motionZ\n        }\n\n        getZOffset(spr: Sprite) {\n            return this.getMotionZ(spr).offset / fpx_scale\n        }\n\n        setZOffset(spr: Sprite, offsetZ: number, duration: number = 500) {\n            const motionZ = this.getMotionZ(spr, offsetZ)\n\n            motionZ.offset = tofpx(offsetZ)\n            if (motionZ.p != motionZ.offset) {\n                if (duration === 0)\n                    motionZ.p = motionZ.offset\n                else if (motionZ.v == 0)\n                    this.move(spr, (motionZ.offset - motionZ.p) / fpx_scale * 1000 / duration, 0)\n            }\n        }\n\n        getMotionZPosition(spr: Sprite) {\n            return this.getMotionZ(spr).p / fpx_scale\n        }\n\n        //todo, use ZHeight(set from sprite.Height when takeover, then sprite.Height will be replace with width)\n        isOverlapZ(sprite1: Sprite, sprite2: Sprite): boolean {\n            const p1 = this.getMotionZPosition(sprite1)\n            const p2 = this.getMotionZPosition(sprite2)\n            if (p1 < p2) {\n                if (p1 + sprite1.height > p2) return true\n            } else {\n                if (p2 + sprite2.height > p1) return true\n            }\n            return false\n        }\n\n        move(spr: Sprite, v: number, a: number) {\n            const motionZ = this.getMotionZ(spr)\n\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        jump(spr: Sprite, v: number, a: number) {\n            const motionZ = this.getMotionZ(spr)\n            if (motionZ.p != motionZ.offset)\n                return\n\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        jumpWithHeightAndDuration(spr: Sprite, height: number, duration: number) {\n            const motionZ = this.getMotionZ(spr)\n            if (motionZ.p != motionZ.offset)\n                return\n\n            // height= -v*v/a/2\n            // duration = -v/a*2 *1000\n            const v = height * 4000 / duration\n            const a = -v * 2000 / duration\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        get viewMode(): ViewMode {\n            return this._viewMode\n        }\n\n        set viewMode(v: ViewMode) {\n            this._viewMode = v\n        }\n\n        updateViewZPos() {\n            this.viewZPos = this.spriteMotionZ[this.sprSelf.id].p + (this.sprSelf._height as any as number) - (2 << fpx)\n        }\n\n        takeoverSceneSprites() {\n            const sc_allSprites = game.currentScene().allSprites\n            for (let i = 0; i < sc_allSprites.length;) {\n                const spr = sc_allSprites[i]\n                if (spr instanceof Sprite) {\n                    const sprList = (spr.flags & sprites.Flag.RelativeToCamera) ? this.sprites2D : this.sprites\n                    if (sprList.indexOf(spr) < 0) {\n                        sprList.push(spr as Sprite)\n                        this.getMotionZ(spr, 0)\n                        spr.onDestroyed(() => {\n                            this.sprites.removeElement(spr as Sprite)   //can be in one of 2 lists\n                            this.sprites2D.removeElement(spr as Sprite) //can be in one of 2 lists\n                            const sayRenderer = this.sayRederers[spr.id]\n                            if (sayRenderer) {\n                                this.sayRederers.removeElement(sayRenderer)\n                                sayRenderer.destroy()\n                            }\n                        })\n                    }\n                } else if (spr instanceof particles.ParticleSource) {\n                    const particle = (spr as particles.ParticleSource)\n                    if (this.spriteParticles.indexOf(particle) < 0) {\n                        this.spriteParticles[(particle.anchor as Sprite).id] = particle\n                        particle.anchor = this.tempSprite\n                    }\n                } else {\n                    if (this.spriteLikes.indexOf(spr) < 0)\n                        this.spriteLikes.push(spr)\n                }\n                sc_allSprites.removeElement(spr)\n            }\n            this.sprites.forEach((spr) => {\n                if (spr)\n                    this.takeoverSayRenderOfSprite(spr)\n            })\n        }\n        takeoverSayRenderOfSprite(sprite: Sprite) {\n            const sprite_as_any = (sprite as any)\n            if (sprite_as_any.sayRenderer) {\n                this.sayRederers[sprite.id] = sprite_as_any.sayRenderer\n                this.sayEndTimes[sprite.id] = sprite_as_any.sayEndTime;\n                sprite_as_any.sayRenderer = undefined\n                sprite_as_any.sayEndTime = undefined\n            }\n        }\n\n        tilemapLoaded() {\n            const sc = game.currentScene()\n            this.map = sc.tileMap.data\n            this.textures = sc.tileMap.data.getTileset()\n            this.tilemapScaleSize = 1 << sc.tileMap.data.scale\n            this.oldRender = sc.tileMap.renderable\n            this.spriteLikes.removeElement(this.oldRender)\n            sc.allSprites.removeElement(this.oldRender)\n\n            let frameCallback_update = sc.eventContext.registerFrameHandler(scene.PRE_RENDER_UPDATE_PRIORITY + 1, () => {\n                const dt = sc.eventContext.deltaTime;\n                // sc.camera.update();  // already did in scene\n                for (const s of this.sprites)\n                    s.__update(sc.camera, dt);\n                this.sprSelf.__update(sc.camera, dt)\n            })\n\n            let frameCallback_draw = sc.eventContext.registerFrameHandler(scene.RENDER_SPRITES_PRIORITY + 1, () => {\n                if (this._viewMode == ViewMode.tilemapView) {\n                   // screen.drawImage(sc.background.image, 0, 0)\n                    this.oldRender.__drawCore(sc.camera)\n                    this.sprites.forEach(spr => spr.__draw(sc.camera))\n                    this.sprSelf.__draw(sc.camera)\n                } else {\n                 //   this.tempScreen.drawImage(sc.background.image, 0, 0)\n                    //debug\n                    // const ms=control.micros()\n                    this.render()\n                    // info.setScore(control.micros()-ms)\n                    screen.fill(0)\n                }\n                this.sprites2D.forEach(spr => spr.__draw(sc.camera))\n                this.spriteLikes.forEach(spr => spr.__draw(sc.camera))\n                if (this._viewMode == ViewMode.raycastingView)\n                    this.tempScreen.drawTransparentImage(screen, 0, 0)\n            })\n\n            sc.tileMap.addEventListener(tiles.TileMapEvent.Unloaded, data => {\n                sc.eventContext.unregisterFrameHandler(frameCallback_update)\n                sc.eventContext.unregisterFrameHandler(frameCallback_draw)\n            })\n\n            // this.myRender = scene.createRenderable(\n            //     scene.TILE_MAP_Z,\n            //     (t, c) => this.trace(t, c)\n            // )\n\n        }\n\n        constructor() {\n            this._angle = 0\n            this.fov = defaultFov\n            this.camera = new scene.Camera()\n\n            const sc = game.currentScene()\n            if (!sc.tileMap) {\n                sc.tileMap = new tiles.TileMap();\n            } else {\n                this.tilemapLoaded()\n            }\n            game.currentScene().tileMap.addEventListener(tiles.TileMapEvent.Loaded, data => this.tilemapLoaded())\n\n            //self sprite\n            this.sprSelf = sprites.create(image.create(this.tilemapScaleSize >> 1, this.tilemapScaleSize >> 1), SpriteKind.Player)\n            this.takeoverSceneSprites()\n            this.sprites.removeElement(this.sprSelf)\n            this.updateViewZPos()\n            scene.cameraFollowSprite(this.sprSelf)\n            this.updateSelfImage()\n\n            game.onUpdate(function () {\n                this.updateControls()\n            })\n\n            game.onUpdateInterval(400, () => {\n                for (let i = 0; i < this.sprites.length;) {\n                    const spr = this.sprites[i]\n                    if (spr.flags & sprites.Flag.RelativeToCamera) {\n                        this.sprites.removeElement(spr)\n                        this.sprites2D.push(spr)\n                    } else { i++ }\n                }\n                for (let i = 0; i < this.sprites2D.length;) {\n                    const spr = this.sprites2D[i]\n                    if (!(spr.flags & sprites.Flag.RelativeToCamera)) {\n                        this.sprites2D.removeElement(spr)\n                        this.sprites.push(spr)\n                    } else { i++ }\n                }\n                this.takeoverSceneSprites() // in case some one new\n            })\n\n\n            game.onUpdateInterval(25, () => {\n                if (this.cameraSway && this.isWalking) {\n                    this.cameraOffsetX = (Math.sin(control.millis() / 150) * this.cameraSway * 3) | 0\n                    this.cameraOffsetZ_fpx = tofpx(Math.cos(control.millis() / 75) * this.cameraSway) | 0\n                }\n            });\n            control.__screen.setupUpdate(() => {\n                if (this.viewMode == ViewMode.raycastingView)\n                    updateScreen(this.tempScreen)\n                else\n                    updateScreen(screen)\n            })\n\n            game.addScenePushHandler((oldScene) => {\n                control.__screen.setupUpdate(() => { updateScreen(screen) })\n            })\n            game.addScenePopHandler((oldScene) => {\n                control.__screen.setupUpdate(() => {\n                    if (this.viewMode == ViewMode.raycastingView)\n                        updateScreen(this.tempScreen)\n                    else\n                        updateScreen(screen)\n                })\n            })\n        }\n\n        private setVectors() {\n            const sin = Math.sin(this._angle)\n            const cos = Math.cos(this._angle)\n            this.dirXFpx = tofpx(cos)\n            this.dirYFpx = tofpx(sin)\n            this.planeX = tofpx(sin * this._fov)\n            this.planeY = tofpx(cos * -this._fov)\n        }\n\n        //todo, pre-drawn dirctional image\n        public updateSelfImage() {\n            const img = this.sprSelf.image\n            img.fill(6)\n            const arrowLength = img.width / 2\n            img.drawLine(arrowLength, arrowLength, arrowLength + this.dirX * arrowLength, arrowLength + this.dirY * arrowLength, 2)\n            img.fillRect(arrowLength - 1, arrowLength - 1, 2, 2, 2)\n        }\n\n        updateControls() {\n            if (this.velocityAngle !== 0) {\n                const dx = controller.dx(this.velocityAngle)\n                if (dx) {\n                    this.viewAngle += dx\n                }\n            }\n            if (this.velocity !== 0) {\n                this.isWalking = true\n                const dy = controller.dy(this.velocity)\n                if (dy) {\n                    const nx = this.xFpx - Math.round(this.dirXFpx * dy)\n                    const ny = this.yFpx - Math.round(this.dirYFpx * dy)\n                    this.sprSelf.setPosition((nx * this.tilemapScaleSize / fpx_scale), (ny * this.tilemapScaleSize / fpx_scale))\n                } else {\n                    this.isWalking = false\n                }\n            }\n\n            for (const spr of this.sprites) {\n                this.updateMotionZ(spr)\n            }\n            this.updateMotionZ(this.sprSelf)\n        }\n\n        updateMotionZ(spr: Sprite) {\n            const dt = game.eventContext().deltaTime\n            const motionZ = this.spriteMotionZ[spr.id]\n            //if (!motionZ) continue\n\n            if (motionZ.v != 0 || motionZ.p != motionZ.offset) {\n                motionZ.v += motionZ.a * dt, motionZ.p += motionZ.v * dt\n                //landing\n                if ((motionZ.a >= 0 && motionZ.v > 0 && motionZ.p > motionZ.offset) ||\n                    (motionZ.a <= 0 && motionZ.v < 0 && motionZ.p < motionZ.offset)) { motionZ.p = motionZ.offset, motionZ.v = 0 }\n                if (spr === this.sprSelf)\n                    this.updateViewZPos()\n            }\n\n        }\n\n\n        blitRowBreak(screenX: number, screenUp: number, screenDown: number, source: Image, sourceX: number, sourceYBreak: number) {\n\n            let stepY = (sourceYBreak) / (SHHalf - screenUp )\n            let sourceY = sourceYBreak - stepY\n            let y = SHHalf -1\n            if (screenUp < 0)\n                screenUp = 0\n            while (y  >= Math.ceil(screenUp)-1) {\n                if (sourceY < 0) \n                    sourceY = 0\n                const c = source.getPixel(sourceX, sourceY)\n                this.tempScreen.setPixel(screenX, y, c)\n                y--\n                sourceY -= stepY\n            }\n            // from screen half  going down\n            stepY = (source.height - sourceYBreak) / (screenDown - SHHalf)\n            sourceY = sourceYBreak \n            y = SHHalf\n            if (screenDown > SH)\n                screenDown = SH\n            while (y < Math.round(screenDown)) {\n                const c = source.getPixel(sourceX, sourceY)\n                this.tempScreen.setPixel(screenX, y, c)\n                y++\n                sourceY += stepY\n            }\n\n        }\n        \n        render() {\n            // based on https://lodev.org/cgtutor/raycasting.html\n            this.selfXFpx = this.xFpx\n            this.selfYFpx = this.yFpx\n\n            let drawStart = 0\n            let drawHeight = 0\n            let lastDist = -1, lastTexX = -1, lastMapX = -1, lastMapY = -1\n            this.viewZPos = this.spriteMotionZ[this.sprSelf.id].p + (this.sprSelf._height as any as number) - (2 << fpx) + this.cameraOffsetZ_fpx\n            let cameraRangeAngle = Math.atan(this.fov) + .1 //tolerance for spr center just out of camera\n            //debug\n            // const ms=control.millis()\n\n            \n\n\n            const tex = this.textures[1]\n            let rayDirX0 = this.dirXFpx / fpx_scale + (this.planeX / fpx_scale)\n            let rayDirY0 = this.dirYFpx / fpx_scale + (this.planeY / fpx_scale)\n            let rayDirX1 = this.dirXFpx / fpx_scale - (this.planeX / fpx_scale)\n            let rayDirY1 = this.dirYFpx / fpx_scale - (this.planeY / fpx_scale)\n            let fmapX = this.selfXFpx / fpx_scale\n            let fmapY = this.selfYFpx / fpx_scale\n\n            const sc = game.currentScene() \n           // background\n            const speed = 2 // 2: normal speed\n            let backgroundOffset = (this._angle / Math.PI * speed ) % 1  // range -1..1\n            if (backgroundOffset < 0) backgroundOffset++  // range 0..1\n            backgroundOffset *= SW    // range 0..screenwidth\n            \n            //floor\n            for (let y = 60; y < SH; y++) {\n                let p = y - SHHalf\n                let posZ = SH * this.viewZPos / this.tilemapScaleSize / fpx_scale\n                let rowDistance = posZ / p\n                let floorStepX = rowDistance * (rayDirX1 - rayDirX0) / SW\n                let floorStepY = rowDistance * (rayDirY1 - rayDirY0) / SW\n\n\n\n                let floorX = fmapX + rowDistance * rayDirX0\n                let floorY = fmapY + rowDistance * rayDirY0\n                for (let x = 0; x < SW; x++) {\n                      let cellX = Math.floor(floorX)\n                     let cellY = Math.floor(floorY)\n                    let tx =  (16 * (floorX - cellX)) & 15\n                      let ty = (16 * (floorY - cellY)) & (15)\n                    let mapX = Math.round(floorX - 0.5) % 16\n                    let mapY = Math.round(floorY - 0.5) % 16\n                    let tileType = this.map.getTile(mapX, mapY)\n                    let floorTex = this.textures[tileType]\n                    floorX += floorStepX\n                    floorY += floorStepY\n                    let c = floorTex.getPixel(tx, ty)\n                    this.tempScreen.setPixel(x, y, c)\n\n                }\n\n\n\n            }\n            // walls\n\n            for (let x = 0; x < SW; x++) {\n                const cameraX: number = one - Math.idiv(((x + this.cameraOffsetX) << fpx) << 1, SW)\n                let rayDirX = this.dirXFpx + (this.planeX * cameraX >> fpx)\n                let rayDirY = this.dirYFpx + (this.planeY * cameraX >> fpx)\n\n                // avoid division by zero\n                if (rayDirX == 0) rayDirX = 1\n                if (rayDirY == 0) rayDirY = 1\n\n                let mapX = this.selfXFpx >> fpx\n                let mapY = this.selfYFpx >> fpx\n\n                // length of ray from current position to next x or y-side\n                let sideDistX = 0, sideDistY = 0\n\n                // length of ray from one x or y-side to next x or y-side\n                const deltaDistX = Math.abs(Math.idiv(one2, rayDirX));\n                const deltaDistY = Math.abs(Math.idiv(one2, rayDirY));\n\n                let mapStepX = 0, mapStepY = 0\n\n                let sideWallHit = false;\n\n                //calculate step and initial sideDist\n                if (rayDirX < 0) {\n                    mapStepX = -1;\n                    sideDistX = ((this.selfXFpx - (mapX << fpx)) * deltaDistX) >> fpx;\n                } else {\n                    mapStepX = 1;\n                    sideDistX = (((mapX << fpx) + one - this.selfXFpx) * deltaDistX) >> fpx;\n                }\n                if (rayDirY < 0) {\n                    mapStepY = -1;\n                    sideDistY = ((this.selfYFpx - (mapY << fpx)) * deltaDistY) >> fpx;\n                } else {\n                    mapStepY = 1;\n                    sideDistY = (((mapY << fpx) + one - this.selfYFpx) * deltaDistY) >> fpx;\n                }\n\n                let color = 0\n\n                while (true) {\n                    //jump to next map square, OR in x-direction, OR in y-direction\n                    if (sideDistX < sideDistY) {\n                        sideDistX += deltaDistX;\n                        mapX += mapStepX;\n                        sideWallHit = false;\n                    } else {\n                        sideDistY += deltaDistY;\n                        mapY += mapStepY;\n                        sideWallHit = true;\n                    }\n\n                    if (this.map.isOutsideMap(mapX, mapY))\n                        break\n                    color = this.map.getTile(mapX, mapY)\n                    if  (this.map.isWall(mapX, mapY))\n                        break; // hit!\n                }\n\n                if (this.map.isOutsideMap(mapX, mapY))\n                    continue\n\n                let perpWallDist = 0\n                let wallX = 0\n                if (!sideWallHit) {\n                    perpWallDist = Math.idiv(((mapX << fpx) - this.selfXFpx + (1 - mapStepX << fpx - 1)) << fpx, rayDirX)\n                    wallX = this.selfYFpx + (perpWallDist * rayDirY >> fpx);\n                } else {\n                    perpWallDist = Math.idiv(((mapY << fpx) - this.selfYFpx + (1 - mapStepY << fpx - 1)) << fpx, rayDirY)\n                    wallX = this.selfXFpx + (perpWallDist * rayDirX >> fpx);\n                }\n                wallX &= FPX_MAX\n\n                // color = (color - 1) * 2\n                // if (sideWallHit) color++\n\n                const tex = this.textures[color]\n                if (!tex)\n                    continue\n\n                let texX = (wallX * tex.width) >> fpx;\n                // if ((!sideWallHit && rayDirX > 0) || (sideWallHit && rayDirY < 0))\n                //     texX = tex.width - texX - 1;\n\n                const lineHeight = (this.wallHeightInView / perpWallDist)\n                const drawEnd = lineHeight * this.viewZPos / this.tilemapScaleSize / fpx_scale;\n                const horizontBreak = 1 - this.viewZPos / this.tilemapScaleSize / fpx_scale;\n                if (perpWallDist !== lastDist && (texX !== lastTexX || mapX !== lastMapX || mapY !== lastMapY)) {//neighbor line of tex share same parameters\n                     \n                    drawStart = drawEnd - lineHeight * (this._wallZScale) ;\n                    drawHeight = (Math.ceil(drawEnd) - Math.ceil(drawStart) )\n                    drawStart += (SH >> 1)\n\n                    lastDist = perpWallDist\n                    lastTexX = texX\n                    lastMapX = mapX\n                    lastMapY = mapY\n                }\n                //fix start&end points to avoid regmatic between lines\n               \n\n                //if (x < SWHalf)\n                //    this.tempScreen.blitRow(x, drawStart, tex, texX, drawHeight)\n                //else\n                    this.blitRowBreak(x, SHHalf + drawEnd - lineHeight, SHHalf + drawEnd, tex, texX, tex.height * horizontBreak)\n\n                this.dist[x] = perpWallDist\n\n                // background \n                for (let y = 0; y < drawStart; y++ ){\n                    let backX = (backgroundOffset + x) % SW\n                    let c = sc.background.image.getPixel(backX,y)\n                    this.tempScreen.setPixel(x,y,c)\n                }\n            }\n            //debug\n            // info.setScore(control.millis()-ms)\n           // this.tempScreen.print(backgroundOffset.toString(), 0,0,7 )\n           // this.tempScreen.print([Math.roundWithPrecision(this._angle, 3)].join(), 20, 5)\n\n            this.drawSprites()\n        }\n\n        drawSprites() {\n            //debug\n            // let msSprs=control.millis()\n            /////////////////// sprites ///////////////////\n\n            //for sprite\n            const invDet = one2 / (this.planeX * this.dirYFpx - this.dirXFpx * this.planeY); //required for correct matrix multiplication\n\n            this.sprites\n                .filter((spr, i) => {\n                    const spriteX = this.sprXFx8(spr) - this.xFpx // this.selfXFpx\n                    const spriteY = this.sprYFx8(spr) - this.yFpx // this.selfYFpx\n                    this.angleSelfToSpr[spr.id] = Math.atan2(spriteX, spriteY)\n                    this.transformX[spr.id] = invDet * (this.dirYFpx * spriteX - this.dirXFpx * spriteY) >> fpx;\n                    this.transformY[spr.id] = invDet * (-this.planeY * spriteX + this.planeX * spriteY) >> fpx; //this is actually the depth inside the screen, that what Z is in 3D\n                    const angleInCamera = Math.atan2(this.transformX[spr.id] * this.fov, this.transformY[spr.id])\n                    return angleInCamera > -this.cameraRangeAngle && angleInCamera < this.cameraRangeAngle //(this.transformY[spr.id] > 0\n                }).sort((spr1, spr2) => {   // far to near\n                    return (this.transformY[spr2.id] - this.transformY[spr1.id])\n                }).forEach((spr, index) => {\n                    //debug\n                    // this.tempScreen.print([spr.id,Math.roundWithPrecision(angle[spr.id],3)].join(), 0, index * 10 + 10,9)\n                    this.drawSprite(spr, index, this.transformX[spr.id], this.transformY[spr.id], this.angleSelfToSpr[spr.id])\n                })\n\n            //debug\n            // info.setLife(control.millis() - msSprs+1)\n             //this.tempScreen.print([Math.roundWithPrecision(this._angle,3)].join(), 20,  0)\n\n        }\n\n        registerOnSpriteDirectionUpdate(handler: (spr: Sprite, dir: number) => void) {\n            this.onSpriteDirectionUpdateHandler = handler\n        }\n\n        drawSprite(spr: Sprite, index: number, transformX: number, transformY: number, myAngle: number) {\n            const spriteScreenX = Math.ceil((SWHalf) * (1 - transformX / transformY)) - this.cameraOffsetX;\n            const spriteScreenHalfWidth = Math.idiv((spr._width as any as number) / this.tilemapScaleSize / 2 * this.wallWidthInView, transformY)  //origin: (texSpr.width / 2 << fpx) / transformY / this.fov / 3 * 2 * 4\n            const spriteScreenLeft = spriteScreenX - spriteScreenHalfWidth\n            const spriteScreenRight = spriteScreenX + spriteScreenHalfWidth\n\n            //calculate drawing range in X direction\n            //assume there is one range only\n            let blitX = 0, blitWidth = 0\n            for (let sprX = 0; sprX < SW; sprX++) {\n                if (this.dist[sprX] > transformY) {\n                    if (blitWidth == 0)\n                        blitX = sprX\n                    blitWidth++\n                } else if (blitWidth > 0) {\n                    if (blitX <= spriteScreenRight && blitX + blitWidth >= spriteScreenLeft)\n                        break\n                    else\n                        blitX = 0, blitWidth = 0;\n                }\n            }\n            // this.tempScreen.print([this.getxFx8(spr), this.getyFx8(spr)].join(), 0,index*10+10)\n            const blitXSpr = Math.max(blitX, spriteScreenLeft)\n            const blitWidthSpr = Math.min(blitX + blitWidth, spriteScreenRight) - blitXSpr\n            if (blitWidthSpr <= 0)\n                return\n\n            const lineHeight = Math.idiv(this.wallHeightInView, transformY)\n            const drawStart = SHHalf + (lineHeight * ((this.viewZPos - this.spriteMotionZ[spr.id].p - (spr._height as any as number)) / this.tilemapScaleSize) >> fpx)\n\n            //for textures=image[][], abandoned\n            //    const texSpr = spr.getTexture(Math.floor(((Math.atan2(spr.vxFx8, spr.vyFx8) - myAngle) / Math.PI / 2 + 2-.25) * spr.textures.length +.5) % spr.textures.length)\n            //for deal in user code\n            if (this.onSpriteDirectionUpdateHandler)\n                this.onSpriteDirectionUpdateHandler(spr, ((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25))\n            //for CharacterAnimation ext.\n            //     const iTexture = Math.floor(((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25) * 4 + .5) % 4\n            //     const characterAniDirs = [Predicate.MovingLeft,Predicate.MovingDown, Predicate.MovingRight, Predicate.MovingUp]\n            //     character.setCharacterState(spr, character.rule(characterAniDirs[iTexture]))\n            //for this.spriteAnimations\n            const texSpr = !this.spriteAnimations[spr.id] ? spr.image : this.spriteAnimations[spr.id].getFrameByDir(((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25))\n\n            const sprTexRatio = texSpr.width / spriteScreenHalfWidth / 2\n            helpers.imageBlit(\n                this.tempScreen,\n                blitXSpr,\n                drawStart,\n                blitWidthSpr,\n                lineHeight * spr.height / this.tilemapScaleSize,\n                texSpr,\n                (blitXSpr - (spriteScreenX - spriteScreenHalfWidth)) * sprTexRatio\n                ,\n                0,\n                blitWidthSpr * sprTexRatio, texSpr.height, true, false)\n\n            screen.fill(0)\n            const fpx_div_transformy = Math.roundWithPrecision(transformY / 4 / fpx_scale, 2)\n            const height = (SH / fpx_div_transformy)\n            const blitXSaySrc = ((blitX - spriteScreenX) * fpx_div_transformy) + SWHalf\n            const blitWidthSaySrc = (blitWidth * fpx_div_transformy)\n\n            //sprite\n            // screen.drawImage(texSpr, SWHalf-texSpr.width/2, SHHalf)\n            //sayText\n            const sayRender = this.sayRederers[spr.id]\n            if (sayRender) {\n                if (this.sayEndTimes[spr.id] && control.millis() > this.sayEndTimes[spr.id]) {\n                    this.sayRederers[spr.id] = undefined\n                } else {\n                    this.tempSprite.x = SWHalf\n                    this.tempSprite.y = SHHalf + 2\n                    this.camera.drawOffsetX = 0\n                    this.camera.drawOffsetY = 0\n                    sayRender.draw(screen, this.camera, this.tempSprite)\n                }\n            }\n            //particle\n            const particle = this.spriteParticles[spr.id]\n            if (particle) {\n                if (particle.lifespan) {\n                    //debug\n                    // this.tempScreen.print([spr.id].join(), 0,index*10+10)\n                    this.tempSprite.x = SWHalf\n                    this.tempSprite.y = SHHalf + spr.height\n                    this.camera.drawOffsetX = 0//spr.x-SWHalf\n                    this.camera.drawOffsetY = 0//spr.y-SH\n                    particle.__draw(this.camera)\n                } else {\n                    this.spriteParticles[spr.id] = undefined\n                }\n            }\n            //update screen for this spr\n            // const sayTransformY = \n            if (blitXSaySrc <= 0) { //imageBlit considers negative value as 0\n                helpers.imageBlit(\n                    this.tempScreen,\n                    spriteScreenX - SWHalf / fpx_div_transformy, drawStart - height / 2, (blitWidthSaySrc + blitXSaySrc) / fpx_div_transformy, height,\n                    screen,\n                    0, 0, blitWidthSaySrc + blitXSaySrc, SH, true, false)\n            } else {\n                helpers.imageBlit(\n                    this.tempScreen,\n                    // blitX, drawStart - height / 2 , blitWidth, height,\n                    blitX, drawStart - height / 2, blitWidth, height,\n                    screen,\n                    blitXSaySrc, 0, blitWidthSaySrc, SH,\n                    true, false)\n            }\n        }\n    }\n\n    //%fixedinstance\n    export const raycastingRender = new Render.RayCastingRender()\n}\n\n","tilemap.g.jres":"{\n    \"transparency16\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true\n    },\n    \"tile1\": {\n        \"data\": \"hwQQABAAAABBbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfQ==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile\"\n    },\n    \"tile2\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile0\"\n    },\n    \"tile3\": {\n        \"data\": \"hwQQABAAAAB34AAAAAAAAACeAAAAAAAAcOcAAAAAAAAA4AAAAAAAAHcHDgAAAAAA4O4AAAAAAAB34OAAAAAAAADu4AAAAAAAcAfuAAAAAAAH5w4AAAAAAHcADgAAAAAAB+fpAAAAAAB3DgAAAAAAAADgAAAAAAAAd+cOAAAAAAAHDgAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile1\"\n    },\n    \"tile5\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALsLAAAAAAAAuwsAAAAAAAC7CwAAAAAAALv7AAAAAAAAu/vd3d3dDQC7+wAAAAAAALsLAAAAAAAAuwsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile3\"\n    },\n    \"tile6\": {\n        \"data\": \"hwQQABAAAAAkL/QiJCIvJP8v8iQiJP//JE/y//8iT0JCL/IiIiRPIiQv8iIkIi8iIi8iIiJCLyQiL/T//yIvQv8vIi8kQv//Qi8i8iIkLyJCT/L//yIvRCIvIiIiQk8iJC/0QiIiLyRCL/IiQkIvQiQv8v//Ii8k/y/yIiJC//8iT/IiJCIvJA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile4\"\n    },\n    \"tile8\": {\n        \"data\": \"hwQQABAAAAAPAAAAAAAPAA/w//8AAA8A/w8AAP//AAAADwAA/wAAMAAPAAAPAAAAAA8AAA//AAAADwAADwAAAPDw//8AAAAADwAAAP////8PAAAA/////wDw//8AAAAAAA8AAA8AAAAADwAADwAAAAAPAAAPAAAAAA8AAA8AAAAA8P//AAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile6\"\n    },\n    \"tile7\": {\n        \"data\": \"hwQQABAAAAAfERERERER8R8RERERERHx/xEREREREf//mZmZmZmZ//+qqqqqqqr//5mZmZmZmf//mZmZmZmZ//+Zn//5n5n//5mf//mfmf//mZmZmZmZ//+ZmZmZmZn//6qqqqqqqv//mZmZmZmZ//8RERERERH/HxEREREREfEfERERERER8Q==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile5\"\n    },\n    \"tile4\": {\n        \"data\": \"hwQQABAAAADGxsbGxsbGxsbGxv//xsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxvbGxs/Gxg==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile2\"\n    },\n    \"tile9\": {\n        \"data\": \"hwQQABAAAACxu//P/f+7G7G7+8u7v7sbEbv7y7u/uxERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERG7u8u7u7sRsbu7y7u7uxuxu7vLvbu7Gw==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile7\"\n    },\n    \"tile10\": {\n        \"data\": \"hwQQABAAAAAdERGxu7u7u9Hd3b0dERGx0d3dvdHd3b3R3d290d3dvdHd3b3R3d290d3dvdHd3b3R3d3d0d3dvbu7u+3R3bvbHRERsbu7Ee3R3d29HdHd3dHd3b3R3d290d3dvdHd3b3R3d290d3dvdHd3b3R3d290d3d3dHd3b27u7vtu7u77Q==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile8\"\n    },\n    \"tile11\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile9\"\n    },\n    \"tile12\": {\n        \"data\": \"hwQQABAAAAAfEf8f/x8R8R8R8RHxERHx/xEREREREf//mZmZmZmZ//+qqqqqqqr//5mZmZmZmf//mZmZmZmZ//+Zn//5n5n//5mf//mfmf//mZmZmZmZ//+ZmZmZmZn//6qqqqqqqv//mZmZmZmZ//8RERERERH/HxEREREREfEfERERERER8Q==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile10\"\n    },\n    \"level1\": {\n        \"id\": \"level1\",\n        \"mimeType\": \"application/mkcd-tilemap\",\n        \"data\": \"MTAxMDAwMTAwMDAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMjAyMDIwMTA0MDMwMTAxMDIwMjAyMDIwMjAxMDMwMzAyMDIwMjAxMDEwNTAxMDEwMjAyMDIwMjAyMDEwMzAzMDEwMjAyMDEwNzA2MDEwMTAyMDIwMjAyMDIwMTAzMDMwMzA0MDQwMTAxMDMwMTAxMDIwMjAyMDIwMjAxMDMwMzAzMDMwMzAzMDMwMzAxMDEwMjAyMDIwMjAyMDEwMzAzMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAzMDMwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDMwMzAxMDEwMTAxMDIwMjAyMDIwMjAxMDEwMTAxMDEwMzAzMDEwMTAxMDEwMjAyMDIwMjAyMDEwMjAyMDIwMjAzMDMwMTAxMDEwMTAyMDIwMjAyMDIwMTAyMDIwMjAyMDMwMzAyMDIwMTAxMDIwMjAyMDIwMjAxMDIwMjAyMDIwMzAzMDIwMjAxMDEwMjAyMDIwMjAyMDEwMjAyMDIwMjAzMDMwMjAyMDEwMTAxMDEwMTAxMDEwMTAyMDIwMjAyMDMwMzAyMDIwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMjIyMjIyMjIyMjIyMjIyMjAyMDAyMDAyMDAwMDAwMjAwMjAwMDAwMjAwMDAwMDIwMDIwMDAwMDIwMDAwMDAyMDIyMjIwMDAyMDAwMDAwMjAyMjIyMjIwMjAwMDAwMDIwMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMjIyMjIyMjIyMjIyMjIyMg==\",\n        \"tileset\": [\n            \"myTiles.transparency16\",\n            \"sprites.dungeon.floorLight0\",\n            \"sprites.dungeon.floorLight1\",\n            \"sprites.dungeon.floorDark0\",\n            \"myTiles.tile7\",\n            \"myTiles.tile4\",\n            \"myTiles.tile9\",\n            \"myTiles.tile10\"\n        ],\n        \"displayName\": \"level\"\n    },\n    \"*\": {\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"dataEncoding\": \"base64\",\n        \"namespace\": \"myTiles\"\n    }\n}","tilemap.g.ts":"","pxt.json":"{\n    \"name\": \"3d floor and background\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"device\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"assets.json\",\n        \"_animation.ts\",\n        \"_render_blocks.ts\",\n        \"_render_raycasting.ts\",\n        \"tilemap.g.jres\",\n        \"tilemap.g.ts\"\n    ],\n    \"targetVersions\": {\n        \"branch\": \"v1.10.36\",\n        \"tag\": \"v1.10.36\",\n        \"commits\": \"https://github.com/microsoft/pxt-arcade/commits/3a5a7e13703edf0412c17bdb9b1469e282a5b31b\",\n        \"target\": \"1.10.36\",\n        \"pxt\": \"8.3.9\"\n    },\n    \"preferredEditor\": \"blocksprj\"\n}\n"}},{"timestamp":1763731482044,"editorVersion":"2.0.62","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable type=\"KIND_SpriteKind\" id=\"USZ`q|D]$0kk|,E!b7c6\">Player</variable><variable type=\"KIND_SpriteKind\" id=\"@8#W0|ESmtdS+3`?Z+:+\">Projectile</variable><variable type=\"KIND_SpriteKind\" id=\"h1jvB:JPL=NMGpJB=4/[\">Food</variable><variable type=\"KIND_SpriteKind\" id=\"(3Y]|wk94c4t/c`pc((X\">Enemy</variable><variable type=\"KIND_SpriteKind\" id=\"2B=HiFZ(Kz-^Ln6ox1L~\">Help</variable><variable id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</variable><variable id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</variable><variable id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</variable></variables><block type=\"function_definition\" x=\"688\" y=\"-616\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation><field name=\"function_name\">Summon alien</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Enemy</field></shadow></value></block></value><next><block type=\"run_image_animation\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field></block></value><value name=\"frames\"><shadow type=\"animation_editor\"><field name=\"frames\">[img`\n........................\n........................\n........................\n........................\n........................\n..........ffff..........\n........ff1111ff........\n.......fb111111bf.......\n.....fffc1111111f.......\n...fc111cd1111111f......\n...f1b1b1b1111dddf......\n...fbfbffcf11fcddf......\n......fcf111111bbf......\n.......ccbdb1b1fcf......\n.......fffbfbfdff.......\n........ffffffff........\n........fffffffffff.....\n.........fffffc111cf....\n.........fffff1b1b1f....\n..........ffffbfbfbf....\n...........ffff.........\n........................\n........................\n........................\n`,img`\n........................\n........................\n........................\n........................\n........................\n..........ffff..........\n........ff1111ff........\n.......fb111111bf.......\n.......f11111111f.......\n......fd11111111df......\n....7.fd11111111df......\n...7..fd11111111df......\n...7..fd11111111df......\n...7..fddd1111dddff.....\n...77.fbdbfddfbdbfcf....\n...777fcdcf11fcdcfbf....\n....77fffbdb1bdffcf.....\n....fcb1bcffffff........\n....f1c1c1ffffff........\n....fdfdfdfffff.........\n.....f.f.f..............\n........................\n........................\n........................\n`,img`\n........................\n........................\n........................\n........................\n..........ffff..........\n........ff1111ff........\n.......fb111111bf.......\n.......f11111111f.......\n......fd111111111f......\n......fd11111111df......\n......fd11111111df......\n......fcdd1111ddcff.....\n.......fbcf11fcbfbbf....\n.......ffbdb1bdffff.....\n........fcbfbfdf........\n........ffffffff........\n......ffffffffff........\n.....fcb1bcffff.........\n......ffbff.............\n........................\n........................\n........................\n........................\n........................\n`,img`\n........................\n........................\n........................\n........................\n..........ffff..........\n........ff1111ff........\n.......fb111111bf.......\n.......f11111111f.......\n......fd11111111df......\n......fdd111111ddf......\n......fbdd1111dddf......\n......fcdbfddfbdbf......\n.......fbcf11fcbfff.....\n.......ffb1111bcfbcf....\n........fcdb1bdfbbbf....\n.......ffffffffffcf.....\n.....fcb1bcfffff........\n.....f1b1b1ffff.........\n......ffbff.............\n........................\n........................\n........................\n........................\n........................\n`]</field><data>{\"commentRefs\":[],\"fieldData\":{\"frames\":null}}</data></shadow></value><value name=\"frameInterval\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><value name=\"loop\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">14</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"1691\" y=\"-454\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile8`</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile10`</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"mapsetwallat\"><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">false</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Top</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Uh oh. An alien has breached the base.</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Bottom</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Press A to shoot.</field></shadow></value><next><block type=\"function_call\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block></statement></block><block type=\"keyonevent\" x=\"393\" y=\"-141\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_toggleViewMode\"></block></statement></block><block type=\"pxt-on-start\" x=\"54\" y=\"25\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">You have been abandoned by your crew and trapped on the moon base</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Try and find a way out before the asteroid hits</field></shadow></value><next><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff99d99bbbbbcfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff99ddbdd66168bcccccc9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff999ddbbbd66888111ccccccb99fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9966ddbbbb6688811818ccccccbbc99fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdd69dddbbb66618881888818818cccccbe9fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffddd96dd6b6dbd68888888888888888cccccc99fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffdbbd9666666dbb668886888888cccccccccccccc9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffdbbb99666966d68866888888cccccccccccccccccc69ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffdbbb999669666666888888888ccccbbbcc8bcccccccccc9fffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffdbbb999666666666888888888cbbcbe8bbbcbcccccbbcccb9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffff9bbb999666666666688888888bccb888888bbbbb88888bcccccfffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffdbbb999669666666866888868bbbbb8888888ccc888b88bbc8cccffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffdbbb9d99ddd666668868888688bbcb888888888bc888bcc8bc886c9fffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffbbbbbbddd966666888688888888888888b88888888888cc8ccc886c9ffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffdbbbbbbdd6966666666868888888888bbdbbebb8888888888bcc8c86c9fffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffff9bbdbddd6666666666888688868888ddddddddde8888888888bccbbccccfffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffff9dbb9dd666666666668868888888bddddddbdbbddcccccd88b8ebccbbbbc9ffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffdd99999666666666668868888888bdddddbbbbbdbbbccccccb8bbbccc8bbb9fffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffff9dd99996696966666666668888bbbdddddbbbddbbbbbbbbbcccc8bcccbb8bbcfffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffff9d999996666966666668688888bbdddbbbbdbbbbbbbbbbbcccccc8bbccc88bc9ffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff99999999666996696668868868bbdddddbbbdbbbbbbbbbbbbcbccc88bcccc88c6ffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff999996696669666966d8868666bddbbbddbbdbbbbbbbbbbbbcccccc88bbccc8869fffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff9999996699669666666d6688668bddbbdbbbbbbbbbbbbbbbbbccccccc88bcccc866fffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff9dd999669966666666666688668bdddbbbbbbbbbbbbbbbbbbbccccccc888bbccc669ffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff999999669d69666666666688868bddbbbdbbbbbbbbbbbbbbbbcccccccc888bbcc869ffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99999996ddd69666666688888868ddbddbbbbbbbbbbbbbbbbbbccccccccc888888866ffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff999999969ddd6669666688688888bbbbbbbbbbbbbbbbbbbbbbbbccbccccc8888888869fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99999966ddddd669666688888888bbbbbbbbbbbbbbbbbbbbbbbcbccccccccc88888869fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff999bb99666dddd6666666668886888bbbbbbbbbbbbbbbbbbbbbbcccccccccccc8888889fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbbb966696666666666888886888bbbbbbbbbbbbbbbbbbbbbbcbccccccccccc888886fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbdbb666969666666668888868888bbbbbbbbbbbbbbbbbbbbccbccccccccccc8888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99dbbbbb6696966666666668886868888bbbbeb888bbbbbbbbbcccccccccccccc8888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbbbbbe6969666666666888888888888888888888bbbbbbbbccccccccccccc88888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbccbc66966666666688888688888888888d888ebbbbbbbcccccccccccbb88888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbbcc69996666688668886888888dd88dbbd88bbbbbbbccccccccccceb88888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbbccc999966668868888888888ddddbbbbd88cbbbbbbbbccccccccc8888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9ebbbbcccccccc9966666688888888888888ddbbbb888bbbbbbbbccccccccc8888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbccccccccc666666888866888888888dddddbdd88bbbbbbccccccccc88888888bb9ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffbbbbbbcccccccccc6666688888888888888888d8888888bbbbbbccccccccc88888888bb9ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9dbbbbccbbccccccb666688868888888888888888888888bbbbbccccccccc888888888b9ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9dbbbbbbbbcccccbb66666688888888888888888888888bbbbccccccccccc88888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbcccccccb666666688888888888888888888888bbbbcccccccccc888888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbccccccbb666666688888888888888888888888bbbbcccccccccc88888888886fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbbbbbbbccccb6666668888888888888888888888888bbbbcbcccccccc88888888886fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99dbbbcbbccccb6666668888888888888888888888888bbbbbccccccccc888cc888869fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99dbbbcccccccc6666668688688888888888888888888bbbbccccccccc8888cc888869fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff999bbbbbccccbc6666666688688888888888888888888bbbbcccccccc88888dd88886ffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff969bbbbbbcccc69666666668688868888888888888888bbbbccccccc88888bd888886ffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff99bbbbcccccc696bb668888888868888888888888888bbbcccccccc8888bbd888869ffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff9999bbbcccc9666dbbb8888888888888888888888888ccbcccccccc8888bc888886fffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff699bbbbccc966966bbb8888888888888888888888888bbbbccccc88888bcc88869fffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff9999bbcccc666666dbbdd88888888688888888888888bbcccccc88888888888669fffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff9699dbcccc66666666bb6d8888888688888888888888bbcccccc8888888888869ffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffff9696bbbcc66666666dbbd6886868888888888888888bbcbccc8888888888d669ffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffff999ebbccc666666666dbb8868888688888888888888bbbccc8888888889b69fffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffff969ccbcc66996666666bbb868888888888888888888bbbc888888888888b6ffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffff96ccccc966966666666bb8688666888888888888888b8888888888888699ffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffff99ccbc996666666666dbb6888668888888888888888888888888888869fffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffff969ccb9666666666666dbb88866888888888888888888888888888869ffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffff969ccc6696666666666dd8888668888888888888888888888888866fffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffff969cc9669666966d66dd8888868888888888888888888bb8888669fffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffff96ccc66699669dddd888868888888888888888888888be888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffff96c66669966666dd88886666668888888888888888dd888669fffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffff96966669966ddd686886868888888888888888888d888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffff969666696666666688686888888888888888888888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffff9966966966666666886888888888888886888888669fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9699996666666888888888888888888118888699ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff969996666668888881188888888881888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff996999666688881818888888881886669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9961161186618811188886116699ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff99161111611118111666699fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9999661166669999ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff999999999fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</field><value name=\"VALUE\"><shadow type=\"math_number\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\nf f f f f f f f f f f f f f f f \n1 1 f f f f f f f f f f f f 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 f f f f f f f f f f f f 1 1 \nf f f f f f f f f f f f f f f f \n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value></block></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"857\" y=\"248\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></statement></block><block type=\"spritesoverlap\" x=\"688\" y=\"640\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value><statement name=\"HANDLER\"><block type=\"variables_change\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><next><block type=\"spritedestroy2\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"effect\">effects.spray</field><value name=\"sprite\"><block type=\"argument_reporter_custom\"><mutation typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow></value><next><block type=\"hudsetScore\"><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></next></block></statement></block></xml>","main.ts":"","README.md":" ","assets.json":"","_animation.ts":"//////////////////////// animation.ts contents of previous version, just for test.ts here for convenience /////////////////////\n// file contents:\n// directional animations defines for enging_raycasting.ts\n// for convenience, constructed animations as below, which images are builtin in Arcade, \n// in order from easy to complex\n\n// each are 2D Image array, Image[][]: \n// 1st dimension is direction: \n//    length=1 to any, e.g. 1,2,3,4,...,8,..., engine can automatically arange them to 0~360 \n//    order: start from left, then folling with others in CW order\n//    e.g: \n//         2 directions should be [leftAni,RightAni], \n//         4-direction should be [leftAni, frontAni, rightAni, backAni], \n//         8-direction=[l,lf,f,fr,r,rb,b,lb], ...\n//    the reason that directions start from left, is almost all Arcade builtin one side images are facing left, so that would be convient for using.\n// 2nd dimension is animation Images\n//    length=1 to any, e.g. 1,2,3,4,..., engine will automatically loop them by aniInterval(set when create CompactSprite, or use default)\n\n\n//simplest, just one static image, looks the same in all angle of view\nconst texturesDonut = [[sprites.food.smallDonut]]\nconst texturesBigCake = [[sprites.food.bigCake]]\n\n//1-direction, with ani, looks the same Ani in all angle of view\nconst texturesCoin = [[sprites.builtin.coin0, sprites.builtin.coin1, sprites.builtin.coin2, sprites.builtin.coin3, sprites.builtin.coin4, sprites.builtin.coin5]]\n\nconst texturesDog = [[sprites.builtin.dog0, sprites.builtin.dog1, sprites.builtin.dog2]]\nconst texturesDuck = [[sprites.duck.duck1, sprites.duck.duck2, sprites.duck.duck3, sprites.duck.duck4, sprites.duck.duck5, sprites.duck.duck6]]\n\n//2-direction, with ani, looks difference from left or right side\nconst texturesPlane = [[sprites.vehicle.plane0, sprites.vehicle.plane1, sprites.vehicle.plane2, sprites.vehicle.plane3, sprites.vehicle.plane4, sprites.vehicle.plane5],\n[sprites.vehicle.plane0, sprites.vehicle.plane1, sprites.vehicle.plane2, sprites.vehicle.plane3, sprites.vehicle.plane4, sprites.vehicle.plane5]]\n//no right side ani images builtin, so make them from lefts, and then flipX\nimagesFlipX(texturesPlane[1])\n\nconst texturesFish = [[sprites.builtin.angelFish0, sprites.builtin.angelFish1, sprites.builtin.angelFish2, sprites.builtin.angelFish3],\n[sprites.builtin.angelFish0, sprites.builtin.angelFish1, sprites.builtin.angelFish2, sprites.builtin.angelFish3]]\nimagesFlipX(texturesFish[1])\n\n//4-direction\nconst texturesHero = [\n    [sprites.castle.heroWalkSideLeft1, sprites.castle.heroWalkSideLeft2, sprites.castle.heroWalkSideLeft3, sprites.castle.heroWalkSideLeft4],\n    [sprites.castle.heroWalkFront1, sprites.castle.heroWalkFront2, sprites.castle.heroWalkFront3, sprites.castle.heroWalkFront4],\n    [sprites.castle.heroWalkSideRight1, sprites.castle.heroWalkSideRight2, sprites.castle.heroWalkSideRight3, sprites.castle.heroWalkSideRight4],\n    [sprites.castle.heroWalkBack1, sprites.castle.heroWalkBack2, sprites.castle.heroWalkBack3, sprites.castle.heroWalkBack4],\n]\n\nconst texturesPrincess2 = [\n    [sprites.castle.princess2Left1, sprites.castle.princess2Left2],\n    [sprites.castle.princess2WalkFront1, sprites.castle.princess2WalkFront2, sprites.castle.princess2WalkFront3, sprites.castle.princess2WalkFront2],\n    [sprites.castle.princess2Right1, sprites.castle.princess2Right2],\n    [sprites.castle.princess2WalkBack1, sprites.castle.princess2WalkBack2, sprites.castle.princess2WalkBack3, sprites.castle.princess2WalkBack2],\n]\n\n//4-direction, but back side has only 1 image, so no ani when looking from back\nconst texturesSkelly = [\n    [sprites.castle.skellyWalkLeft1, sprites.castle.skellyWalkLeft2],\n    [sprites.castle.skellyWalkFront1, sprites.castle.skellyWalkFront2, sprites.castle.skellyWalkFront3],\n    [sprites.castle.skellyWalkRight1, sprites.castle.skellyWalkRight2],\n    [img`\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ..........ffff..........\n\t        ........ff1111ff........\n\t        .......fb111111bf.......\n\t        .......f11111111f.......\n\t        ......fd11111111df......\n\t        ......fd11111111df......\n\t        ......fd11111111df......\n\t        ......fb11111111bf......\n\t        ......fcd111111dcf......\n\t        .......fb111111bf.......\n\t        .....ffffdb1bdcfff......\n\t        ....fc111cfbfbc111cf....\n\t        ....f11111ffff11111f....\n\t        ....fbfbfbffffffbfbf....\n\t        .........ffffff.........\n\t        ..........fff...........\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ........................\n\t    `],\n]\n\nconst texturesPrincess = [\n    [sprites.castle.princessLeft0, sprites.castle.princessLeft1, sprites.castle.princessLeft0, sprites.castle.princessLeft2],\n    [sprites.castle.princessFront0, sprites.castle.princessFront1, sprites.castle.princessFront0, sprites.castle.princessFront2],\n    [],\n    [sprites.castle.princessBack0, sprites.castle.princessBack1, sprites.castle.princessBack0, sprites.castle.princessBack2],\n]\ntexturesPrincess[0].forEach((v, i) => {\n    texturesPrincess[2].push(v.clone())\n    texturesPrincess[2][i].flipX()\n}\n)\n\nfunction imagesFlipX(ani: Image[]) {\n    ani.forEach((img, i) => {\n        ani[i] = img.clone() //don't worry memery leak or waste, cause old images are still using by left\n        ani[i].flipX()\n    })\n}\n\n//////////////////////// end of animation.ts contents of previous version //////////////\n\n\n","_render_blocks.ts":"enum RCSpriteAttribute {\n    ZOffset,\n    ZPosition,\n    ZVelocity,\n    ZAcceleration\n}\n/**\n * A 2.5D Screen Render, using Raycasting algorithm\n **/\n//% color=#03AA74 weight=1 icon=\"\\uf1b2\" //cube f1b2 , fold f279\n//% groups='[\"Instance\",\"Basic\", \"Dimension Z\", \"Animate\", \"Advanced\"]'\n//% block=\"3D Render\"\nnamespace Render {\n    export enum attribute {\n        dirX,\n        dirY,\n        fov,\n        wallZScale,\n    }\n\n    export class Animations {\n        constructor(public frameInterval: number, public animations: Image[][]) {\n        }\n\n        msLast = 0\n        index = 0\n        iAnimation = 0\n        getFrameByDir(dir: number): Image {\n            if (control.millis() - this.msLast > this.frameInterval) {\n                this.msLast = control.millis()\n                this.index++\n                this.iAnimation = Math.round((dir * this.animations.length)) % this.animations.length\n                if (this.index >= this.animations[this.iAnimation].length)\n                    this.index = 0\n            }\n            return this.animations[this.iAnimation][this.index]\n        }\n    }\n\n    /**\n * Apply a directional image animations on a sprite\n * @param sprite the sprite to animate on\n * @param animations the directional animates\n */\n    //% blockId=set_animation\n    //% block=\"set $sprite=variables_get(mySprite) with animations$animations\"\n    //% animations.shadow=create_animation\n    //% group=\"Animate\"\n    //% weight=100\n    //% help=github:pxt-raycasting/docs/set-sprite-animations\n    export function setSpriteAnimations(sprite: Sprite, animations: Animations) {\n        raycastingRender.spriteAnimations[sprite.id] = animations\n    }\n\n    /**\n * Create a directional image animations, multi animations will applied to one round dirctions averagely, start from the left. \n * The reason that directions start from left, is almost all Arcade out-of-box 1 or 2-dirction images are facing left, so that would be convient for using.\n * @param frameInterval the time between changes, eg: 150\n * @param frames1 animation, if this is the first of multi animation it will be used as left, others will \n * @param frames2 optional, used for 2 or more dirctional\n * @param frames3 optional, used for 3 or more dirctional\n * @param frames4 optional, used for 4 or more dirctional\n */\n    //% blockId=create_animation\n    //% block=\"interval$frameInterval=timePicker animates:$frames1=animation_editor|| $frames2=animation_editor $frames3=animation_editor $frames4=animation_editor\"\n    //% inlineInputMode=inline\n    //% group=\"Animate\"\n    //% weight=100\n    //% help=github:pxt-raycasting/docs/create-animations\n    export function createAnimations(frameInterval: number, frames1: Image[], frames2?: Image[], frames3?: Image[], frames4?: Image[]): Animations {\n        const animationList = [frames1]\n        if (frames2) animationList.push(frames2)\n        if (frames3) animationList.push(frames3)\n        if (frames4) animationList.push(frames4)\n        return new Animations(frameInterval, animationList)\n    }\n\n    /**\n     * Get the Render\n     * @param img the image\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRCRenderInstance block=\"raycasting render\"\n    //% expandableArgumentMode=toggle\n    //% weight=100 \n    //% blockHidden=true\n    //% hidden=1\n    export function getRCRenderInstance(): RayCastingRender {\n        return raycastingRender\n    }\n\n    /**\n     * Get the render Sprite, which create automatically, for physical collisions, and holding the view point.\n     * You can consider it as \"myself\", and operate it like a usual sprite, eg.: position, speed, scale, collision, ...\n     * But properties relative 3D, eg. ZOffset, ZPosition, viewAngle, and etc. are not in the Sprite class.\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRenderSpriteVariable block=\"myself sprite\"\n    //% expandableArgumentMode=toggle\n    //% blockSetVariable=mySprite\n    //% weight=99\n    //% help=github:pxt-raycasting/get-render-sprite-variable\n    export function getRenderSpriteVariable(): Sprite {\n        return raycastingRender.sprSelf\n    }\n\n    /**\n     * Get the render Sprite, which create automatically, for physical collisions, and holding the view point.(but get/set view direction with dirX/dirY, which not in the Sprite class) \n     * You can consider it as \"myself\", and operate it like a usual sprite.\n     * eg: position, speed, scale, collision, ...\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRenderSpriteInstance block=\"myself sprite\"\n    //% expandableArgumentMode=toggle\n    //% weight=98\n    //% help=github:pxt-raycasting/docs/get-render-sprite-instance\n    export function getRenderSpriteInstance(): Sprite {\n        return raycastingRender.sprSelf\n    }\n\n    /**\n     * Toggle current view mode\n     */\n    //% blockId=rcRender_toggleViewMode block=\"toggle current view mode\"\n    //% group=\"Basic\"\n    //% weight=89\n    //% help=github:pxt-raycasting/docs/toggle-view-mode\n    export function toggleViewMode() {\n        raycastingRender.viewMode = raycastingRender.viewMode == ViewMode.tilemapView ? ViewMode.raycastingView : ViewMode.tilemapView\n    }\n\n    /**\n     * Current view mode is the specific one?\n     * @param viewMode\n     */\n    //% blockId=rcRender_isViewMode block=\"current is $viewMode\"\n    //% group=\"Basic\"\n    //% weight=88\n    //% help=github:pxt-raycasting/docs/is-view-mode\n    export function isViewMode(viewMode: ViewMode): boolean {\n        return viewMode == raycastingRender.viewMode\n    }\n\n    /**\n     * Set view mode\n     * @param viewMode\n     */\n    //% blockId=rcRender_setViewMode block=\"set view mode $viewMode\"\n    //% group=\"Basic\"\n    //% weight=87\n    //% help=github:pxt-raycasting/docs/set-view-mode\n    export function setViewMode(viewMode: ViewMode) {\n        raycastingRender.viewMode = viewMode\n    }\n\n    /**\n     * Get render arribute\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"get %attribute\" \n    //% blockId=rcRender_getAttribute\n    //% weight=83\n    //% help=github:pxt-raycasting/docs/get-attribute\n    export function getAttribute(attr: attribute): number {\n        switch (attr) {\n            case attribute.dirX:\n                return raycastingRender.dirX\n            case attribute.dirY:\n                return raycastingRender.dirY\n            case attribute.fov:\n                return raycastingRender.fov\n            case attribute.wallZScale:\n                return raycastingRender.wallZScale\n            default:\n                return 0\n        }\n    }\n\n    /**\n     * Set render arribute\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"set %attribute = %value\" \n    //% blockId=rcRender_setAttribute\n    //% weight=82\n    //% help=github:pxt-raycasting/docs/set-attribute\n    export function setAttribute(attr: attribute, value: number) {\n        switch (attr) {\n            case attribute.dirX:\n                raycastingRender.dirX = value\n                break\n            case attribute.dirY:\n                raycastingRender.dirY = value\n                break\n            case attribute.fov:\n                if (value < 0) value = 0\n                raycastingRender.fov = value\n                break\n            case attribute.wallZScale:\n                if (value < 0) value = 0\n                raycastingRender.wallZScale = value\n                break\n            default:\n        }\n    }\n\n    /**\n     * Get default FOV (field of view) value\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"defaultFov\"\n    //% blockId=rcRender_getDefaultFov\n    //% weight=81\n    //% help=github:pxt-raycasting/docs/get-default-fov\n    export function getDefaultFov(): number {\n        return defaultFov\n    }\n\n    /**\n     * Set view angle\n     * @param angle, unit: degree 0~360\n     */\n    //% blockId=rcRender_setViewAngleInDegree block=\"set view angle$angle\"\n    //% angle.min=0 angle.max=360 angle.defl=90\n    //% group=\"Basic\"\n    //% weight=80\n    //% help=github:pxt-raycasting/docs/set-view-angle-in-degree\n    export function setViewAngleInDegree(angle: number) {\n        raycastingRender.viewAngle = angle * Math.PI / 180\n    }\n\n    /**\n     * Set view angle by dirX and dirY\n     * @param dirX\n     * @param dirY\n     */\n    //% blockId=rcRender_setViewAngle block=\"set view angle by dirX%dirX and dirY%dirY\"\n    //% group=\"Basic\"\n    //% weight=79\n    //% help=github:pxt-raycasting/docs/set-view-angle\n    export function setViewAngle(dirX: number, dirY: number) {\n        raycastingRender.viewAngle = Math.atan2(dirY, dirX)\n    }\n\n    /**\n     * Set floating offset height for a sprite at Z direction\n     * @param sprite\n     * @param Zoffset Negative floats down, affirmative goes up\n     * @param duration moving time, 0 for immediately, unit: ms\n     */\n    //% blockId=rcRender_setZOffset block=\"set Sprite %spr=variables_get(mySprite) floating %offset pixels|| duration $duration=timePicker|ms \"\n    //% offset.min=-100 offset.max=100 offset.defl=8\n    //% duration.min=0 duration.max=5000 duration.defl=0\n    //% group=\"Dimension Z\"\n    //% weight=77\n    //% blockHidden\n    //% help=github:pxt-raycasting/docs/set-z-offset\n    export function setZOffset(sprite: Sprite, offset: number, duration?: number) {\n        raycastingRender.setZOffset(sprite, offset, duration)\n    }\n\n    /**\n     * Set arribute of a Sprite\n     * @param spr Sprite\n     * @param attr RCSpriteAttribute\n     */\n    //% group=\"Dimension Z\"\n    //% block=\"set Sprite %spr=variables_get(mySprite) %attribute = %value\"\n    //% blockId=rcRender_setSpriteAttribute\n    //% weight=75\n    //% help=github:pxt-raycasting/docs/set-sprite-attribute\n    export function setSpriteAttribute(spr: Sprite, attr: RCSpriteAttribute, value: number) {\n        switch (attr) {\n            case RCSpriteAttribute.ZOffset:\n                raycastingRender.getMotionZ(spr).offset = value\n                break\n            case RCSpriteAttribute.ZPosition:\n                raycastingRender.getMotionZ(spr).p = value\n                break\n            case RCSpriteAttribute.ZVelocity:\n                raycastingRender.getMotionZ(spr).v = value\n                break\n            case RCSpriteAttribute.ZAcceleration:\n                raycastingRender.getMotionZ(spr).a = value\n                break\n            default:\n        }\n    }\n\n    /**\n     * Get arribute of a Sprite\n     * @param spr Sprite\n     * @param attr RCSpriteAttribute\n     */\n    //% group=\"Dimension Z\"\n    //% block=\"get Sprite %spr=variables_get(mySprite) %attribute\"\n    //% blockId=rcRender_getSpriteAttribute\n    //% weight=74\n    //% help=github:pxt-raycasting/docs/get-sprite-attribute\n    export function getSpriteAttribute(spr: Sprite, attr: RCSpriteAttribute): number {\n        switch (attr) {\n            case RCSpriteAttribute.ZOffset:\n                return raycastingRender.getMotionZ(spr).offset\n            case RCSpriteAttribute.ZPosition:\n                return raycastingRender.getMotionZ(spr).p\n            case RCSpriteAttribute.ZVelocity:\n                return raycastingRender.getMotionZ(spr).v\n            case RCSpriteAttribute.ZAcceleration:\n                return raycastingRender.getMotionZ(spr).a\n            default:\n                return 0\n        }\n    }\n\n    /**\n     * Check if 2 sprites overlaps each another in Z dimension\n     * Best work together with sprites.onOverlap(kind1, kind2)\n     * @param sprite1\n     * @param sprite2\n     */\n    //% blockId=rcRender_isSpritesOverlapZ\n    //% block=\"is sprites $sprite1=variables_get(mySprite) and $sprite2=variables_get(mySprite2) overlaps in Z dimension\"\n    //% group=\"Dimension Z\"\n    //% weight=71\n    //% help=github:pxt-raycasting/docs/is-sprites-overlap-z\n    export function isSpritesOverlapZ(sprite1: Sprite, sprite2: Sprite): boolean {\n        return raycastingRender.isOverlapZ(sprite1, sprite2)\n    }\n\n    /**\n     * Make sprite jump, with specific height and duration\n     * Jump can only happened when sprite is standing, current height = its offset .\n     * @param sprite\n     * @param height jump height in pixel\n     * @param duration hover time span, unit: ms\n     */\n    //% blockId=rcRender_jumpWithHeightAndDuration block=\"Sprite %spr=variables_get(mySprite) jump, with height $height duration $duration=timePicker|ms \"\n    //% height.min=0 height.max=100 height.defl=16\n    //% duration.min=50 duration.max=5000 duration.defl=500\n    //% group=\"Dimension Z\"\n    //% weight=70\n    //% help=github:pxt-raycasting/docs/jump-with-height-and-duration\n    export function jumpWithHeightAndDuration(sprite: Sprite, height: number, duration: number) {\n        raycastingRender.jumpWithHeightAndDuration(sprite, height, duration)\n    }\n\n    /**\n     * Make sprite jump, with specific speed and acceleration\n     * Simular with Move block, but jump can only happened when sprite is standing, current height = its offset.\n     * @param sprite\n     * @param v vetical speed, unit: pixel/s\n     * @param a vetical acceleration, unit: pixel/s\n     */\n    //% blockId=rcRender_jump block=\"Sprite %spr=variables_get(mySprite) jump||, with speed $v=spriteSpeedPicker acceleration $a\"\n    //% v.min=-100 v.max=100 v.defl=60\n    //% a.min=-1000 a.max=1000 a.defl=-250\n    //% group=\"Dimension Z\"\n    //% weight=68\n    //% help=github:pxt-raycasting/docs/jump\n    export function jump(sprite: Sprite, v?: number, a?: number) {\n        raycastingRender.jump(sprite, v, a)\n    }\n\n    /**\n     * Make sprite jump, with specific speed and acceleration\n     * @param sprite\n     * @param v vetical speed, unit: pixel/s\n     * @param a vetical acceleration, unit: pixel/s\n     */\n    //% blockId=rcRender_move block=\"Sprite %spr=variables_get(mySprite) move, with speed $v=spriteSpeedPicker|| acceleration $a\"\n    //% v.min=-200 v.max=200 v.defl=60\n    //% a.min=-1000 a.max=1000 a.defl=-250\n    //% group=\"Dimension Z\"\n    //% weight=66\n    //% help=github:pxt-raycasting/docs/move\n    export function move(sprite: Sprite, v?: number, a?: number) {\n        raycastingRender.move(sprite, v, a)\n    }\n\n    /**\n     * Control the self sprite using the direction buttons from the controller. \n     * To stop controlling self sprite, pass 0 for v and va.\n     *\n     * @param v The velocity used for forward/backword movement when up/down is pressed, in pixel/s\n     * @param va The angle velocity used for turn view direction when left/right is pressed, in radian/s.\n     */\n    //% blockId=\"rcRender_moveWithController\" block=\"move with buttons velocity $v|| turn speed $va camera sway$cameraSway pixels\"\n    //% weight=60\n    //% expandableArgumentMode=\"toggle\"\n    //% v.defl=2 va.defl=3\n    //% group=\"Advanced\"\n    //% v.shadow=\"spriteSpeedPicker\"\n    //% va.shadow=\"spriteSpeedPicker\"\n    //% help=github:pxt-raycasting/docs/move-with-controller\n    export function moveWithController(v: number = 2, va: number = 3, cameraSway?: number) {\n        raycastingRender.velocity = v\n        raycastingRender.velocityAngle = va\n        if (cameraSway != undefined)\n            raycastingRender.cameraSway = cameraSway | 0\n    }\n\n    /**\n     * Render takeover all sprites in current scene\n     * Render will call this automatically, but maybe not in time enough.\n     * If you saw sprite draw at its tilemap position on screen, call this just after created the sprite.\n     */\n    //% blockId=rcRender_takeoverSceneSprites \n    //% block=\"takeover sprites in scene\"\n    //% group=\"Advanced\"\n    //% weight=49\n    //% help=github:pxt-raycasting/docs/takeover-scene-sprites\n    export function takeoverSceneSprites() {\n        raycastingRender.takeoverSceneSprites()\n    }\n\n    /**\n     * Run on sprite dirction updated, present view point to Sprite facing dirction, or which angle you see of the sprite.\n     * Just using with other animation extensions, to set proper Image for sprite.\n     * Not required, if you have used the set animations block provided.\n     * @param dir It is a float number, 0~1 corresponds to 0~360, suggest use Math.round(dir*dirAniTotalCount)%dirAniTotalCount to get index of direction\n     */\n    //% blockId=rcRender_registerOnSpriteDirectionUpdateHandler\n    //% block=\"run code when sprite $spr dirction updated to $dir\"\n    //% draggableParameters\n    //% group=\"Advanced\"\n    //% weight=48\n    //% help=github:pxt-raycasting/docs/register-on-sprite-direction-update-handler\n    export function registerOnSpriteDirectionUpdateHandler(handler: (spr: Sprite, dir: number) => void) {\n        raycastingRender.registerOnSpriteDirectionUpdate(handler)\n    }\n}\n","_render_raycasting.ts":"//% shim=pxt::updateScreen\nfunction updateScreen(img: Image) { }\n\nenum ViewMode {\n    //% block=\"TileMap Mode\"\n    tilemapView,\n    //% block=\"Raycasting Mode\"\n    raycastingView,\n}\n\nnamespace Render {\n    const SH = screen.height, SHHalf = SH / 2\n    const SW = screen.width, SWHalf = SW / 2\n    const fpx = 8\n    const fpx_scale = 2 ** fpx\n    function tofpx(n: number) { return (n * fpx_scale) | 0 }\n    const one = 1 << fpx\n    const one2 = 1 << (fpx + fpx)\n    const FPX_MAX = (1 << fpx) - 1\n\n    class MotionSet1D {\n        p: number\n        v: number = 0\n        a: number = 0\n        constructor(public offset: number) {\n            this.p = offset\n        }\n    }\n\n    export const defaultFov = SW / SH / 2  //Wall just fill screen height when standing 1 tile away\n\n    export class RayCastingRender {\n        private tempScreen: Image = image.create(SW, SH)\n\n        velocityAngle: number = 2\n        velocity: number = 3\n        protected _viewMode = ViewMode.raycastingView\n        protected dirXFpx: number\n        protected dirYFpx: number\n        protected planeX: number\n        protected planeY: number\n        protected _angle: number\n        protected _fov: number\n        protected _wallZScale: number = 1\n        cameraSway = 0\n        protected isWalking = false\n        protected cameraOffsetX = 0\n        protected cameraOffsetZ_fpx = 0\n\n        //sprites & accessories\n        sprSelf: Sprite\n        sprites: Sprite[] = []\n        sprites2D: Sprite[] = []\n        spriteParticles: particles.ParticleSource[] = []\n        spriteLikes: SpriteLike[] = []\n        spriteAnimations: Animations[] = []\n        protected spriteMotionZ: MotionSet1D[] = []\n        protected sayRederers: sprites.BaseSpriteSayRenderer[] = []\n        protected sayEndTimes: number[] = []\n\n        //reference\n        protected tilemapScaleSize = 1 << TileScale.Sixteen\n        map: tiles.TileMapData\n        bg: Image\n        textures: Image[]\n        protected oldRender: scene.Renderable\n        protected myRender: scene.Renderable\n\n        //render\n        protected wallHeightInView: number\n        protected wallWidthInView: number\n        protected dist: number[] = []\n        //render perf const\n        cameraRangeAngle: number\n        viewZPos: number\n        selfXFpx: number\n        selfYFpx: number\n\n        //for drawing sprites\n        protected invDet: number //required for correct matrix multiplication\n        camera: scene.Camera\n        tempSprite: Sprite = sprites.create(img`0`)\n        protected transformX: number[] = []\n        protected transformY: number[] = []\n        protected angleSelfToSpr: number[] = []\n\n        onSpriteDirectionUpdateHandler: (spr: Sprite, dir: number) => void\n\n        get xFpx(): number {\n            return Fx.add(this.sprSelf._x, Fx.div(this.sprSelf._width, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        // set xFpx(v: number) {\n        //     this.sprSelf._x = v * this.tilemapScaleSize as any as Fx8\n        // }\n\n        get yFpx(): number {\n            return Fx.add(this.sprSelf._y, Fx.div(this.sprSelf._height, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        // set yFpx(v: number) {\n        //     this.sprSelf._y = v * this.tilemapScaleSize as any as Fx8\n        // }\n\n        get dirX(): number {\n            return this.dirXFpx / fpx_scale\n        }\n\n        get dirY(): number {\n            return this.dirYFpx / fpx_scale\n        }\n\n        set dirX(v: number) {\n            this.dirXFpx = v * fpx_scale\n        }\n\n        set dirY(v: number) {\n            this.dirYFpx = v * fpx_scale\n        }\n\n        sprXFx8(spr: Sprite) {\n            return Fx.add(spr._x, Fx.div(spr._width, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        sprYFx8(spr: Sprite) {\n            return Fx.add(spr._y, Fx.div(spr._height, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        get fov(): number {\n            return this._fov\n        }\n\n        set fov(fov: number) {\n            this._fov = fov\n            this.wallHeightInView = (SW << (fpx - 1)) / this._fov\n            this.wallWidthInView = this.wallHeightInView >> fpx // not fpx  // wallSize / this.fov * 4 / 3 * 2\n            this.cameraRangeAngle = Math.atan(this.fov) + .1 //tolerance for spr center just out of camera\n\n            this.setVectors()\n        }\n\n        get viewAngle(): number {\n            return this._angle\n        }\n        set viewAngle(angle: number) {\n            this._angle = angle\n            this.setVectors()\n            this.updateSelfImage()\n        }\n\n        get wallZScale(): number {\n            return this._wallZScale\n        }\n        set wallZScale(v: number) {\n            this._wallZScale = v\n        }\n\n        getMotionZ(spr: Sprite, offsetZ: number = 0) {\n            let motionZ = this.spriteMotionZ[spr.id]\n            if (!motionZ) {\n                motionZ = new MotionSet1D(tofpx(offsetZ))\n                this.spriteMotionZ[spr.id] = motionZ\n            }\n            return motionZ\n        }\n\n        getZOffset(spr: Sprite) {\n            return this.getMotionZ(spr).offset / fpx_scale\n        }\n\n        setZOffset(spr: Sprite, offsetZ: number, duration: number = 500) {\n            const motionZ = this.getMotionZ(spr, offsetZ)\n\n            motionZ.offset = tofpx(offsetZ)\n            if (motionZ.p != motionZ.offset) {\n                if (duration === 0)\n                    motionZ.p = motionZ.offset\n                else if (motionZ.v == 0)\n                    this.move(spr, (motionZ.offset - motionZ.p) / fpx_scale * 1000 / duration, 0)\n            }\n        }\n\n        getMotionZPosition(spr: Sprite) {\n            return this.getMotionZ(spr).p / fpx_scale\n        }\n\n        //todo, use ZHeight(set from sprite.Height when takeover, then sprite.Height will be replace with width)\n        isOverlapZ(sprite1: Sprite, sprite2: Sprite): boolean {\n            const p1 = this.getMotionZPosition(sprite1)\n            const p2 = this.getMotionZPosition(sprite2)\n            if (p1 < p2) {\n                if (p1 + sprite1.height > p2) return true\n            } else {\n                if (p2 + sprite2.height > p1) return true\n            }\n            return false\n        }\n\n        move(spr: Sprite, v: number, a: number) {\n            const motionZ = this.getMotionZ(spr)\n\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        jump(spr: Sprite, v: number, a: number) {\n            const motionZ = this.getMotionZ(spr)\n            if (motionZ.p != motionZ.offset)\n                return\n\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        jumpWithHeightAndDuration(spr: Sprite, height: number, duration: number) {\n            const motionZ = this.getMotionZ(spr)\n            if (motionZ.p != motionZ.offset)\n                return\n\n            // height= -v*v/a/2\n            // duration = -v/a*2 *1000\n            const v = height * 4000 / duration\n            const a = -v * 2000 / duration\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        get viewMode(): ViewMode {\n            return this._viewMode\n        }\n\n        set viewMode(v: ViewMode) {\n            this._viewMode = v\n        }\n\n        updateViewZPos() {\n            this.viewZPos = this.spriteMotionZ[this.sprSelf.id].p + (this.sprSelf._height as any as number) - (2 << fpx)\n        }\n\n        takeoverSceneSprites() {\n            const sc_allSprites = game.currentScene().allSprites\n            for (let i = 0; i < sc_allSprites.length;) {\n                const spr = sc_allSprites[i]\n                if (spr instanceof Sprite) {\n                    const sprList = (spr.flags & sprites.Flag.RelativeToCamera) ? this.sprites2D : this.sprites\n                    if (sprList.indexOf(spr) < 0) {\n                        sprList.push(spr as Sprite)\n                        this.getMotionZ(spr, 0)\n                        spr.onDestroyed(() => {\n                            this.sprites.removeElement(spr as Sprite)   //can be in one of 2 lists\n                            this.sprites2D.removeElement(spr as Sprite) //can be in one of 2 lists\n                            const sayRenderer = this.sayRederers[spr.id]\n                            if (sayRenderer) {\n                                this.sayRederers.removeElement(sayRenderer)\n                                sayRenderer.destroy()\n                            }\n                        })\n                    }\n                } else if (spr instanceof particles.ParticleSource) {\n                    const particle = (spr as particles.ParticleSource)\n                    if (this.spriteParticles.indexOf(particle) < 0) {\n                        this.spriteParticles[(particle.anchor as Sprite).id] = particle\n                        particle.anchor = this.tempSprite\n                    }\n                } else {\n                    if (this.spriteLikes.indexOf(spr) < 0)\n                        this.spriteLikes.push(spr)\n                }\n                sc_allSprites.removeElement(spr)\n            }\n            this.sprites.forEach((spr) => {\n                if (spr)\n                    this.takeoverSayRenderOfSprite(spr)\n            })\n        }\n        takeoverSayRenderOfSprite(sprite: Sprite) {\n            const sprite_as_any = (sprite as any)\n            if (sprite_as_any.sayRenderer) {\n                this.sayRederers[sprite.id] = sprite_as_any.sayRenderer\n                this.sayEndTimes[sprite.id] = sprite_as_any.sayEndTime;\n                sprite_as_any.sayRenderer = undefined\n                sprite_as_any.sayEndTime = undefined\n            }\n        }\n\n        tilemapLoaded() {\n            const sc = game.currentScene()\n            this.map = sc.tileMap.data\n            this.textures = sc.tileMap.data.getTileset()\n            this.tilemapScaleSize = 1 << sc.tileMap.data.scale\n            this.oldRender = sc.tileMap.renderable\n            this.spriteLikes.removeElement(this.oldRender)\n            sc.allSprites.removeElement(this.oldRender)\n\n            let frameCallback_update = sc.eventContext.registerFrameHandler(scene.PRE_RENDER_UPDATE_PRIORITY + 1, () => {\n                const dt = sc.eventContext.deltaTime;\n                // sc.camera.update();  // already did in scene\n                for (const s of this.sprites)\n                    s.__update(sc.camera, dt);\n                this.sprSelf.__update(sc.camera, dt)\n            })\n\n            let frameCallback_draw = sc.eventContext.registerFrameHandler(scene.RENDER_SPRITES_PRIORITY + 1, () => {\n                if (this._viewMode == ViewMode.tilemapView) {\n                   // screen.drawImage(sc.background.image, 0, 0)\n                    this.oldRender.__drawCore(sc.camera)\n                    this.sprites.forEach(spr => spr.__draw(sc.camera))\n                    this.sprSelf.__draw(sc.camera)\n                } else {\n                 //   this.tempScreen.drawImage(sc.background.image, 0, 0)\n                    //debug\n                    // const ms=control.micros()\n                    this.render()\n                    // info.setScore(control.micros()-ms)\n                    screen.fill(0)\n                }\n                this.sprites2D.forEach(spr => spr.__draw(sc.camera))\n                this.spriteLikes.forEach(spr => spr.__draw(sc.camera))\n                if (this._viewMode == ViewMode.raycastingView)\n                    this.tempScreen.drawTransparentImage(screen, 0, 0)\n            })\n\n            sc.tileMap.addEventListener(tiles.TileMapEvent.Unloaded, data => {\n                sc.eventContext.unregisterFrameHandler(frameCallback_update)\n                sc.eventContext.unregisterFrameHandler(frameCallback_draw)\n            })\n\n            // this.myRender = scene.createRenderable(\n            //     scene.TILE_MAP_Z,\n            //     (t, c) => this.trace(t, c)\n            // )\n\n        }\n\n        constructor() {\n            this._angle = 0\n            this.fov = defaultFov\n            this.camera = new scene.Camera()\n\n            const sc = game.currentScene()\n            if (!sc.tileMap) {\n                sc.tileMap = new tiles.TileMap();\n            } else {\n                this.tilemapLoaded()\n            }\n            game.currentScene().tileMap.addEventListener(tiles.TileMapEvent.Loaded, data => this.tilemapLoaded())\n\n            //self sprite\n            this.sprSelf = sprites.create(image.create(this.tilemapScaleSize >> 1, this.tilemapScaleSize >> 1), SpriteKind.Player)\n            this.takeoverSceneSprites()\n            this.sprites.removeElement(this.sprSelf)\n            this.updateViewZPos()\n            scene.cameraFollowSprite(this.sprSelf)\n            this.updateSelfImage()\n\n            game.onUpdate(function () {\n                this.updateControls()\n            })\n\n            game.onUpdateInterval(400, () => {\n                for (let i = 0; i < this.sprites.length;) {\n                    const spr = this.sprites[i]\n                    if (spr.flags & sprites.Flag.RelativeToCamera) {\n                        this.sprites.removeElement(spr)\n                        this.sprites2D.push(spr)\n                    } else { i++ }\n                }\n                for (let i = 0; i < this.sprites2D.length;) {\n                    const spr = this.sprites2D[i]\n                    if (!(spr.flags & sprites.Flag.RelativeToCamera)) {\n                        this.sprites2D.removeElement(spr)\n                        this.sprites.push(spr)\n                    } else { i++ }\n                }\n                this.takeoverSceneSprites() // in case some one new\n            })\n\n\n            game.onUpdateInterval(25, () => {\n                if (this.cameraSway && this.isWalking) {\n                    this.cameraOffsetX = (Math.sin(control.millis() / 150) * this.cameraSway * 3) | 0\n                    this.cameraOffsetZ_fpx = tofpx(Math.cos(control.millis() / 75) * this.cameraSway) | 0\n                }\n            });\n            control.__screen.setupUpdate(() => {\n                if (this.viewMode == ViewMode.raycastingView)\n                    updateScreen(this.tempScreen)\n                else\n                    updateScreen(screen)\n            })\n\n            game.addScenePushHandler((oldScene) => {\n                control.__screen.setupUpdate(() => { updateScreen(screen) })\n            })\n            game.addScenePopHandler((oldScene) => {\n                control.__screen.setupUpdate(() => {\n                    if (this.viewMode == ViewMode.raycastingView)\n                        updateScreen(this.tempScreen)\n                    else\n                        updateScreen(screen)\n                })\n            })\n        }\n\n        private setVectors() {\n            const sin = Math.sin(this._angle)\n            const cos = Math.cos(this._angle)\n            this.dirXFpx = tofpx(cos)\n            this.dirYFpx = tofpx(sin)\n            this.planeX = tofpx(sin * this._fov)\n            this.planeY = tofpx(cos * -this._fov)\n        }\n\n        //todo, pre-drawn dirctional image\n        public updateSelfImage() {\n            const img = this.sprSelf.image\n            img.fill(6)\n            const arrowLength = img.width / 2\n            img.drawLine(arrowLength, arrowLength, arrowLength + this.dirX * arrowLength, arrowLength + this.dirY * arrowLength, 2)\n            img.fillRect(arrowLength - 1, arrowLength - 1, 2, 2, 2)\n        }\n\n        updateControls() {\n            if (this.velocityAngle !== 0) {\n                const dx = controller.dx(this.velocityAngle)\n                if (dx) {\n                    this.viewAngle += dx\n                }\n            }\n            if (this.velocity !== 0) {\n                this.isWalking = true\n                const dy = controller.dy(this.velocity)\n                if (dy) {\n                    const nx = this.xFpx - Math.round(this.dirXFpx * dy)\n                    const ny = this.yFpx - Math.round(this.dirYFpx * dy)\n                    this.sprSelf.setPosition((nx * this.tilemapScaleSize / fpx_scale), (ny * this.tilemapScaleSize / fpx_scale))\n                } else {\n                    this.isWalking = false\n                }\n            }\n\n            for (const spr of this.sprites) {\n                this.updateMotionZ(spr)\n            }\n            this.updateMotionZ(this.sprSelf)\n        }\n\n        updateMotionZ(spr: Sprite) {\n            const dt = game.eventContext().deltaTime\n            const motionZ = this.spriteMotionZ[spr.id]\n            //if (!motionZ) continue\n\n            if (motionZ.v != 0 || motionZ.p != motionZ.offset) {\n                motionZ.v += motionZ.a * dt, motionZ.p += motionZ.v * dt\n                //landing\n                if ((motionZ.a >= 0 && motionZ.v > 0 && motionZ.p > motionZ.offset) ||\n                    (motionZ.a <= 0 && motionZ.v < 0 && motionZ.p < motionZ.offset)) { motionZ.p = motionZ.offset, motionZ.v = 0 }\n                if (spr === this.sprSelf)\n                    this.updateViewZPos()\n            }\n\n        }\n\n\n        blitRowBreak(screenX: number, screenUp: number, screenDown: number, source: Image, sourceX: number, sourceYBreak: number) {\n\n            let stepY = (sourceYBreak) / (SHHalf - screenUp )\n            let sourceY = sourceYBreak - stepY\n            let y = SHHalf -1\n            if (screenUp < 0)\n                screenUp = 0\n            while (y  >= Math.ceil(screenUp)-1) {\n                if (sourceY < 0) \n                    sourceY = 0\n                const c = source.getPixel(sourceX, sourceY)\n                this.tempScreen.setPixel(screenX, y, c)\n                y--\n                sourceY -= stepY\n            }\n            // from screen half  going down\n            stepY = (source.height - sourceYBreak) / (screenDown - SHHalf)\n            sourceY = sourceYBreak \n            y = SHHalf\n            if (screenDown > SH)\n                screenDown = SH\n            while (y < Math.round(screenDown)) {\n                const c = source.getPixel(sourceX, sourceY)\n                this.tempScreen.setPixel(screenX, y, c)\n                y++\n                sourceY += stepY\n            }\n\n        }\n        \n        render() {\n            // based on https://lodev.org/cgtutor/raycasting.html\n            this.selfXFpx = this.xFpx\n            this.selfYFpx = this.yFpx\n\n            let drawStart = 0\n            let drawHeight = 0\n            let lastDist = -1, lastTexX = -1, lastMapX = -1, lastMapY = -1\n            this.viewZPos = this.spriteMotionZ[this.sprSelf.id].p + (this.sprSelf._height as any as number) - (2 << fpx) + this.cameraOffsetZ_fpx\n            let cameraRangeAngle = Math.atan(this.fov) + .1 //tolerance for spr center just out of camera\n            //debug\n            // const ms=control.millis()\n\n            \n\n\n            const tex = this.textures[1]\n            let rayDirX0 = this.dirXFpx / fpx_scale + (this.planeX / fpx_scale)\n            let rayDirY0 = this.dirYFpx / fpx_scale + (this.planeY / fpx_scale)\n            let rayDirX1 = this.dirXFpx / fpx_scale - (this.planeX / fpx_scale)\n            let rayDirY1 = this.dirYFpx / fpx_scale - (this.planeY / fpx_scale)\n            let fmapX = this.selfXFpx / fpx_scale\n            let fmapY = this.selfYFpx / fpx_scale\n\n            const sc = game.currentScene() \n           // background\n            const speed = 2 // 2: normal speed\n            let backgroundOffset = (this._angle / Math.PI * speed ) % 1  // range -1..1\n            if (backgroundOffset < 0) backgroundOffset++  // range 0..1\n            backgroundOffset *= SW    // range 0..screenwidth\n            \n            //floor\n            for (let y = 60; y < SH; y++) {\n                let p = y - SHHalf\n                let posZ = SH * this.viewZPos / this.tilemapScaleSize / fpx_scale\n                let rowDistance = posZ / p\n                let floorStepX = rowDistance * (rayDirX1 - rayDirX0) / SW\n                let floorStepY = rowDistance * (rayDirY1 - rayDirY0) / SW\n\n\n\n                let floorX = fmapX + rowDistance * rayDirX0\n                let floorY = fmapY + rowDistance * rayDirY0\n                for (let x = 0; x < SW; x++) {\n                      let cellX = Math.floor(floorX)\n                     let cellY = Math.floor(floorY)\n                    let tx =  (16 * (floorX - cellX)) & 15\n                      let ty = (16 * (floorY - cellY)) & (15)\n                    let mapX = Math.round(floorX - 0.5) % 16\n                    let mapY = Math.round(floorY - 0.5) % 16\n                    let tileType = this.map.getTile(mapX, mapY)\n                    let floorTex = this.textures[tileType]\n                    floorX += floorStepX\n                    floorY += floorStepY\n                    let c = floorTex.getPixel(tx, ty)\n                    this.tempScreen.setPixel(x, y, c)\n\n                }\n\n\n\n            }\n            // walls\n\n            for (let x = 0; x < SW; x++) {\n                const cameraX: number = one - Math.idiv(((x + this.cameraOffsetX) << fpx) << 1, SW)\n                let rayDirX = this.dirXFpx + (this.planeX * cameraX >> fpx)\n                let rayDirY = this.dirYFpx + (this.planeY * cameraX >> fpx)\n\n                // avoid division by zero\n                if (rayDirX == 0) rayDirX = 1\n                if (rayDirY == 0) rayDirY = 1\n\n                let mapX = this.selfXFpx >> fpx\n                let mapY = this.selfYFpx >> fpx\n\n                // length of ray from current position to next x or y-side\n                let sideDistX = 0, sideDistY = 0\n\n                // length of ray from one x or y-side to next x or y-side\n                const deltaDistX = Math.abs(Math.idiv(one2, rayDirX));\n                const deltaDistY = Math.abs(Math.idiv(one2, rayDirY));\n\n                let mapStepX = 0, mapStepY = 0\n\n                let sideWallHit = false;\n\n                //calculate step and initial sideDist\n                if (rayDirX < 0) {\n                    mapStepX = -1;\n                    sideDistX = ((this.selfXFpx - (mapX << fpx)) * deltaDistX) >> fpx;\n                } else {\n                    mapStepX = 1;\n                    sideDistX = (((mapX << fpx) + one - this.selfXFpx) * deltaDistX) >> fpx;\n                }\n                if (rayDirY < 0) {\n                    mapStepY = -1;\n                    sideDistY = ((this.selfYFpx - (mapY << fpx)) * deltaDistY) >> fpx;\n                } else {\n                    mapStepY = 1;\n                    sideDistY = (((mapY << fpx) + one - this.selfYFpx) * deltaDistY) >> fpx;\n                }\n\n                let color = 0\n\n                while (true) {\n                    //jump to next map square, OR in x-direction, OR in y-direction\n                    if (sideDistX < sideDistY) {\n                        sideDistX += deltaDistX;\n                        mapX += mapStepX;\n                        sideWallHit = false;\n                    } else {\n                        sideDistY += deltaDistY;\n                        mapY += mapStepY;\n                        sideWallHit = true;\n                    }\n\n                    if (this.map.isOutsideMap(mapX, mapY))\n                        break\n                    color = this.map.getTile(mapX, mapY)\n                    if  (this.map.isWall(mapX, mapY))\n                        break; // hit!\n                }\n\n                if (this.map.isOutsideMap(mapX, mapY))\n                    continue\n\n                let perpWallDist = 0\n                let wallX = 0\n                if (!sideWallHit) {\n                    perpWallDist = Math.idiv(((mapX << fpx) - this.selfXFpx + (1 - mapStepX << fpx - 1)) << fpx, rayDirX)\n                    wallX = this.selfYFpx + (perpWallDist * rayDirY >> fpx);\n                } else {\n                    perpWallDist = Math.idiv(((mapY << fpx) - this.selfYFpx + (1 - mapStepY << fpx - 1)) << fpx, rayDirY)\n                    wallX = this.selfXFpx + (perpWallDist * rayDirX >> fpx);\n                }\n                wallX &= FPX_MAX\n\n                // color = (color - 1) * 2\n                // if (sideWallHit) color++\n\n                const tex = this.textures[color]\n                if (!tex)\n                    continue\n\n                let texX = (wallX * tex.width) >> fpx;\n                // if ((!sideWallHit && rayDirX > 0) || (sideWallHit && rayDirY < 0))\n                //     texX = tex.width - texX - 1;\n\n                const lineHeight = (this.wallHeightInView / perpWallDist)\n                const drawEnd = lineHeight * this.viewZPos / this.tilemapScaleSize / fpx_scale;\n                const horizontBreak = 1 - this.viewZPos / this.tilemapScaleSize / fpx_scale;\n                if (perpWallDist !== lastDist && (texX !== lastTexX || mapX !== lastMapX || mapY !== lastMapY)) {//neighbor line of tex share same parameters\n                     \n                    drawStart = drawEnd - lineHeight * (this._wallZScale) ;\n                    drawHeight = (Math.ceil(drawEnd) - Math.ceil(drawStart) )\n                    drawStart += (SH >> 1)\n\n                    lastDist = perpWallDist\n                    lastTexX = texX\n                    lastMapX = mapX\n                    lastMapY = mapY\n                }\n                //fix start&end points to avoid regmatic between lines\n               \n\n                //if (x < SWHalf)\n                //    this.tempScreen.blitRow(x, drawStart, tex, texX, drawHeight)\n                //else\n                    this.blitRowBreak(x, SHHalf + drawEnd - lineHeight, SHHalf + drawEnd, tex, texX, tex.height * horizontBreak)\n\n                this.dist[x] = perpWallDist\n\n                // background \n                for (let y = 0; y < drawStart; y++ ){\n                    let backX = (backgroundOffset + x) % SW\n                    let c = sc.background.image.getPixel(backX,y)\n                    this.tempScreen.setPixel(x,y,c)\n                }\n            }\n            //debug\n            // info.setScore(control.millis()-ms)\n           // this.tempScreen.print(backgroundOffset.toString(), 0,0,7 )\n           // this.tempScreen.print([Math.roundWithPrecision(this._angle, 3)].join(), 20, 5)\n\n            this.drawSprites()\n        }\n\n        drawSprites() {\n            //debug\n            // let msSprs=control.millis()\n            /////////////////// sprites ///////////////////\n\n            //for sprite\n            const invDet = one2 / (this.planeX * this.dirYFpx - this.dirXFpx * this.planeY); //required for correct matrix multiplication\n\n            this.sprites\n                .filter((spr, i) => {\n                    const spriteX = this.sprXFx8(spr) - this.xFpx // this.selfXFpx\n                    const spriteY = this.sprYFx8(spr) - this.yFpx // this.selfYFpx\n                    this.angleSelfToSpr[spr.id] = Math.atan2(spriteX, spriteY)\n                    this.transformX[spr.id] = invDet * (this.dirYFpx * spriteX - this.dirXFpx * spriteY) >> fpx;\n                    this.transformY[spr.id] = invDet * (-this.planeY * spriteX + this.planeX * spriteY) >> fpx; //this is actually the depth inside the screen, that what Z is in 3D\n                    const angleInCamera = Math.atan2(this.transformX[spr.id] * this.fov, this.transformY[spr.id])\n                    return angleInCamera > -this.cameraRangeAngle && angleInCamera < this.cameraRangeAngle //(this.transformY[spr.id] > 0\n                }).sort((spr1, spr2) => {   // far to near\n                    return (this.transformY[spr2.id] - this.transformY[spr1.id])\n                }).forEach((spr, index) => {\n                    //debug\n                    // this.tempScreen.print([spr.id,Math.roundWithPrecision(angle[spr.id],3)].join(), 0, index * 10 + 10,9)\n                    this.drawSprite(spr, index, this.transformX[spr.id], this.transformY[spr.id], this.angleSelfToSpr[spr.id])\n                })\n\n            //debug\n            // info.setLife(control.millis() - msSprs+1)\n             //this.tempScreen.print([Math.roundWithPrecision(this._angle,3)].join(), 20,  0)\n\n        }\n\n        registerOnSpriteDirectionUpdate(handler: (spr: Sprite, dir: number) => void) {\n            this.onSpriteDirectionUpdateHandler = handler\n        }\n\n        drawSprite(spr: Sprite, index: number, transformX: number, transformY: number, myAngle: number) {\n            const spriteScreenX = Math.ceil((SWHalf) * (1 - transformX / transformY)) - this.cameraOffsetX;\n            const spriteScreenHalfWidth = Math.idiv((spr._width as any as number) / this.tilemapScaleSize / 2 * this.wallWidthInView, transformY)  //origin: (texSpr.width / 2 << fpx) / transformY / this.fov / 3 * 2 * 4\n            const spriteScreenLeft = spriteScreenX - spriteScreenHalfWidth\n            const spriteScreenRight = spriteScreenX + spriteScreenHalfWidth\n\n            //calculate drawing range in X direction\n            //assume there is one range only\n            let blitX = 0, blitWidth = 0\n            for (let sprX = 0; sprX < SW; sprX++) {\n                if (this.dist[sprX] > transformY) {\n                    if (blitWidth == 0)\n                        blitX = sprX\n                    blitWidth++\n                } else if (blitWidth > 0) {\n                    if (blitX <= spriteScreenRight && blitX + blitWidth >= spriteScreenLeft)\n                        break\n                    else\n                        blitX = 0, blitWidth = 0;\n                }\n            }\n            // this.tempScreen.print([this.getxFx8(spr), this.getyFx8(spr)].join(), 0,index*10+10)\n            const blitXSpr = Math.max(blitX, spriteScreenLeft)\n            const blitWidthSpr = Math.min(blitX + blitWidth, spriteScreenRight) - blitXSpr\n            if (blitWidthSpr <= 0)\n                return\n\n            const lineHeight = Math.idiv(this.wallHeightInView, transformY)\n            const drawStart = SHHalf + (lineHeight * ((this.viewZPos - this.spriteMotionZ[spr.id].p - (spr._height as any as number)) / this.tilemapScaleSize) >> fpx)\n\n            //for textures=image[][], abandoned\n            //    const texSpr = spr.getTexture(Math.floor(((Math.atan2(spr.vxFx8, spr.vyFx8) - myAngle) / Math.PI / 2 + 2-.25) * spr.textures.length +.5) % spr.textures.length)\n            //for deal in user code\n            if (this.onSpriteDirectionUpdateHandler)\n                this.onSpriteDirectionUpdateHandler(spr, ((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25))\n            //for CharacterAnimation ext.\n            //     const iTexture = Math.floor(((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25) * 4 + .5) % 4\n            //     const characterAniDirs = [Predicate.MovingLeft,Predicate.MovingDown, Predicate.MovingRight, Predicate.MovingUp]\n            //     character.setCharacterState(spr, character.rule(characterAniDirs[iTexture]))\n            //for this.spriteAnimations\n            const texSpr = !this.spriteAnimations[spr.id] ? spr.image : this.spriteAnimations[spr.id].getFrameByDir(((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25))\n\n            const sprTexRatio = texSpr.width / spriteScreenHalfWidth / 2\n            helpers.imageBlit(\n                this.tempScreen,\n                blitXSpr,\n                drawStart,\n                blitWidthSpr,\n                lineHeight * spr.height / this.tilemapScaleSize,\n                texSpr,\n                (blitXSpr - (spriteScreenX - spriteScreenHalfWidth)) * sprTexRatio\n                ,\n                0,\n                blitWidthSpr * sprTexRatio, texSpr.height, true, false)\n\n            screen.fill(0)\n            const fpx_div_transformy = Math.roundWithPrecision(transformY / 4 / fpx_scale, 2)\n            const height = (SH / fpx_div_transformy)\n            const blitXSaySrc = ((blitX - spriteScreenX) * fpx_div_transformy) + SWHalf\n            const blitWidthSaySrc = (blitWidth * fpx_div_transformy)\n\n            //sprite\n            // screen.drawImage(texSpr, SWHalf-texSpr.width/2, SHHalf)\n            //sayText\n            const sayRender = this.sayRederers[spr.id]\n            if (sayRender) {\n                if (this.sayEndTimes[spr.id] && control.millis() > this.sayEndTimes[spr.id]) {\n                    this.sayRederers[spr.id] = undefined\n                } else {\n                    this.tempSprite.x = SWHalf\n                    this.tempSprite.y = SHHalf + 2\n                    this.camera.drawOffsetX = 0\n                    this.camera.drawOffsetY = 0\n                    sayRender.draw(screen, this.camera, this.tempSprite)\n                }\n            }\n            //particle\n            const particle = this.spriteParticles[spr.id]\n            if (particle) {\n                if (particle.lifespan) {\n                    //debug\n                    // this.tempScreen.print([spr.id].join(), 0,index*10+10)\n                    this.tempSprite.x = SWHalf\n                    this.tempSprite.y = SHHalf + spr.height\n                    this.camera.drawOffsetX = 0//spr.x-SWHalf\n                    this.camera.drawOffsetY = 0//spr.y-SH\n                    particle.__draw(this.camera)\n                } else {\n                    this.spriteParticles[spr.id] = undefined\n                }\n            }\n            //update screen for this spr\n            // const sayTransformY = \n            if (blitXSaySrc <= 0) { //imageBlit considers negative value as 0\n                helpers.imageBlit(\n                    this.tempScreen,\n                    spriteScreenX - SWHalf / fpx_div_transformy, drawStart - height / 2, (blitWidthSaySrc + blitXSaySrc) / fpx_div_transformy, height,\n                    screen,\n                    0, 0, blitWidthSaySrc + blitXSaySrc, SH, true, false)\n            } else {\n                helpers.imageBlit(\n                    this.tempScreen,\n                    // blitX, drawStart - height / 2 , blitWidth, height,\n                    blitX, drawStart - height / 2, blitWidth, height,\n                    screen,\n                    blitXSaySrc, 0, blitWidthSaySrc, SH,\n                    true, false)\n            }\n        }\n    }\n\n    //%fixedinstance\n    export const raycastingRender = new Render.RayCastingRender()\n}\n\n","tilemap.g.jres":"{\n    \"transparency16\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true\n    },\n    \"tile1\": {\n        \"data\": \"hwQQABAAAABBbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfQ==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile\"\n    },\n    \"tile2\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile0\"\n    },\n    \"tile3\": {\n        \"data\": \"hwQQABAAAAB34AAAAAAAAACeAAAAAAAAcOcAAAAAAAAA4AAAAAAAAHcHDgAAAAAA4O4AAAAAAAB34OAAAAAAAADu4AAAAAAAcAfuAAAAAAAH5w4AAAAAAHcADgAAAAAAB+fpAAAAAAB3DgAAAAAAAADgAAAAAAAAd+cOAAAAAAAHDgAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile1\"\n    },\n    \"tile5\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALsLAAAAAAAAuwsAAAAAAAC7CwAAAAAAALv7AAAAAAAAu/vd3d3dDQC7+wAAAAAAALsLAAAAAAAAuwsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile3\"\n    },\n    \"tile6\": {\n        \"data\": \"hwQQABAAAAAkL/QiJCIvJP8v8iQiJP//JE/y//8iT0JCL/IiIiRPIiQv8iIkIi8iIi8iIiJCLyQiL/T//yIvQv8vIi8kQv//Qi8i8iIkLyJCT/L//yIvRCIvIiIiQk8iJC/0QiIiLyRCL/IiQkIvQiQv8v//Ii8k/y/yIiJC//8iT/IiJCIvJA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile4\"\n    },\n    \"tile8\": {\n        \"data\": \"hwQQABAAAAAPAAAAAAAPAA/w//8AAA8A/w8AAP//AAAADwAA/wAAMAAPAAAPAAAAAA8AAA//AAAADwAADwAAAPDw//8AAAAADwAAAP////8PAAAA/////wDw//8AAAAAAA8AAA8AAAAADwAADwAAAAAPAAAPAAAAAA8AAA8AAAAA8P//AAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile6\"\n    },\n    \"tile7\": {\n        \"data\": \"hwQQABAAAAAfERERERER8R8RERERERHx/xEREREREf//mZmZmZmZ//+qqqqqqqr//5mZmZmZmf//mZmZmZmZ//+Zn//5n5n//5mf//mfmf//mZmZmZmZ//+ZmZmZmZn//6qqqqqqqv//mZmZmZmZ//8RERERERH/HxEREREREfEfERERERER8Q==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile5\"\n    },\n    \"tile4\": {\n        \"data\": \"hwQQABAAAADGxsbGxsbGxsbGxv//xsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxvbGxs/Gxg==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile2\"\n    },\n    \"tile9\": {\n        \"data\": \"hwQQABAAAACxu//P/f+7G7G7+8u7v7sbEbv7y7u/uxERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERG7u8u7u7sRsbu7y7u7uxuxu7vLvbu7Gw==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile7\"\n    },\n    \"tile10\": {\n        \"data\": \"hwQQABAAAAAdERGxu7u7u9Hd3b0dERGx0d3dvdHd3b3R3d290d3dvdHd3b3R3d290d3dvdHd3b3R3d3d0d3dvbu7u+3R3bvbHRERsbu7Ee3R3d29HdHd3dHd3b3R3d290d3dvdHd3b3R3d290d3dvdHd3b3R3d290d3d3dHd3b27u7vtu7u77Q==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile8\"\n    },\n    \"tile11\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile9\"\n    },\n    \"tile12\": {\n        \"data\": \"hwQQABAAAAAfEf8f/x8R8R8R8RHxERHx/xEREREREf//mZmZmZmZ//+qqqqqqqr//5mZmZmZmf//mZmZmZmZ//+Zn//5n5n//5mf//mfmf//mZmZmZmZ//+ZmZmZmZn//6qqqqqqqv//mZmZmZmZ//8RERERERH/HxEREREREfEfERERERER8Q==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile10\"\n    },\n    \"level1\": {\n        \"id\": \"level1\",\n        \"mimeType\": \"application/mkcd-tilemap\",\n        \"data\": \"MTAxMDAwMTAwMDAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMjAyMDIwMTA0MDMwMTAxMDIwMjAyMDIwMjAxMDMwMzAyMDIwMjAxMDEwNTAxMDEwMjAyMDIwMjAyMDEwMzAzMDEwMjAyMDEwNzA2MDEwMTAyMDIwMjAyMDIwMTAzMDMwMzA0MDQwMTAxMDMwMTAxMDIwMjAyMDIwMjAxMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAzMDMwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDMwMzAxMDEwMTAxMDIwMjAyMDIwMjAxMDEwMTAxMDEwMzAzMDEwMTAxMDEwMjAyMDIwMjAyMDEwMjAyMDIwMjAzMDMwMTAxMDEwMTAyMDIwMjAyMDIwMTAyMDIwMjAyMDMwMzAyMDIwMTAxMDIwMjAyMDIwMjAxMDIwMjAyMDIwMzAzMDIwMjAxMDEwMjAyMDIwMjAyMDEwMjAyMDIwMjAzMDMwMjAyMDEwMTAxMDEwMTAxMDEwMTAyMDIwMjAyMDMwMzAyMDIwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMjIyMjIyMjIyMjIyMjIyMjAyMDAyMDAyMDAwMDAwMjAwMjAwMDAwMjAwMDAwMDIwMDIwMDAwMDIwMDAwMDAyMDIyMjIwMDAyMDAwMDAwMjAyMjIyMjIyMjIyMjIyMjIyMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMjIyMjIyMjIyMjIyMjIyMg==\",\n        \"tileset\": [\n            \"myTiles.transparency16\",\n            \"sprites.dungeon.floorLight0\",\n            \"sprites.dungeon.floorLight1\",\n            \"sprites.dungeon.floorDark0\",\n            \"myTiles.tile7\",\n            \"myTiles.tile4\",\n            \"myTiles.tile9\",\n            \"myTiles.tile10\"\n        ],\n        \"displayName\": \"level\"\n    },\n    \"*\": {\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"dataEncoding\": \"base64\",\n        \"namespace\": \"myTiles\"\n    }\n}","tilemap.g.ts":"","pxt.json":"{\n    \"name\": \"3d floor and background\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"device\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"assets.json\",\n        \"_animation.ts\",\n        \"_render_blocks.ts\",\n        \"_render_raycasting.ts\",\n        \"tilemap.g.jres\",\n        \"tilemap.g.ts\"\n    ],\n    \"targetVersions\": {\n        \"branch\": \"v1.10.36\",\n        \"tag\": \"v1.10.36\",\n        \"commits\": \"https://github.com/microsoft/pxt-arcade/commits/3a5a7e13703edf0412c17bdb9b1469e282a5b31b\",\n        \"target\": \"1.10.36\",\n        \"pxt\": \"8.3.9\"\n    },\n    \"preferredEditor\": \"blocksprj\"\n}\n"}},{"timestamp":1763745313671,"editorVersion":"2.0.62","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable type=\"KIND_SpriteKind\" id=\"USZ`q|D]$0kk|,E!b7c6\">Player</variable><variable type=\"KIND_SpriteKind\" id=\"@8#W0|ESmtdS+3`?Z+:+\">Projectile</variable><variable type=\"KIND_SpriteKind\" id=\"h1jvB:JPL=NMGpJB=4/[\">Food</variable><variable type=\"KIND_SpriteKind\" id=\"(3Y]|wk94c4t/c`pc((X\">Enemy</variable><variable type=\"KIND_SpriteKind\" id=\"2B=HiFZ(Kz-^Ln6ox1L~\">Help</variable><variable id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</variable><variable id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</variable><variable id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</variable><variable id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</variable></variables><block type=\"function_definition\" x=\"634\" y=\"-641\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation><field name=\"function_name\">Summon alien</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Enemy</field></shadow></value></block></value><next><block type=\"run_image_animation\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field></block></value><value name=\"frames\"><shadow type=\"animation_editor\"><field name=\"frames\">[img`\n........................\n........................\n........................\n........................\n........................\n..........ffff..........\n........ff1111ff........\n.......fb111111bf.......\n.....fffc1111111f.......\n...fc111cd1111111f......\n...f1b1b1b1111dddf......\n...fbfbffcf11fcddf......\n......fcf111111bbf......\n.......ccbdb1b1fcf......\n.......fffbfbfdff.......\n........ffffffff........\n........fffffffffff.....\n.........fffffc111cf....\n.........fffff1b1b1f....\n..........ffffbfbfbf....\n...........ffff.........\n........................\n........................\n........................\n`,img`\n........................\n........................\n........................\n........................\n........................\n..........ffff..........\n........ff1111ff........\n.......fb111111bf.......\n.......f11111111f.......\n......fd11111111df......\n....7.fd11111111df......\n...7..fd11111111df......\n...7..fd11111111df......\n...7..fddd1111dddff.....\n...77.fbdbfddfbdbfcf....\n...777fcdcf11fcdcfbf....\n....77fffbdb1bdffcf.....\n....fcb1bcffffff........\n....f1c1c1ffffff........\n....fdfdfdfffff.........\n.....f.f.f..............\n........................\n........................\n........................\n`,img`\n........................\n........................\n........................\n........................\n..........ffff..........\n........ff1111ff........\n.......fb111111bf.......\n.......f11111111f.......\n......fd111111111f......\n......fd11111111df......\n......fd11111111df......\n......fcdd1111ddcff.....\n.......fbcf11fcbfbbf....\n.......ffbdb1bdffff.....\n........fcbfbfdf........\n........ffffffff........\n......ffffffffff........\n.....fcb1bcffff.........\n......ffbff.............\n........................\n........................\n........................\n........................\n........................\n`,img`\n........................\n........................\n........................\n........................\n..........ffff..........\n........ff1111ff........\n.......fb111111bf.......\n.......f11111111f.......\n......fd11111111df......\n......fdd111111ddf......\n......fbdd1111dddf......\n......fcdbfddfbdbf......\n.......fbcf11fcbfff.....\n.......ffb1111bcfbcf....\n........fcdb1bdfbbbf....\n.......ffffffffffcf.....\n.....fcb1bcfffff........\n.....f1b1b1ffff.........\n......ffbff.............\n........................\n........................\n........................\n........................\n........................\n`]</field><data>{\"commentRefs\":[],\"fieldData\":{\"frames\":null}}</data></shadow></value><value name=\"frameInterval\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><value name=\"loop\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">14</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"1637\" y=\"-479\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile8`</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile10`</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"mapsetwallat\"><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">false</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Top</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Uh oh. An alien has breached the base.</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Bottom</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Press A to shoot.</field></shadow></value><next><block type=\"function_call\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block></statement></block><block type=\"keyonevent\" x=\"339\" y=\"-166\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_toggleViewMode\"></block></statement></block><block type=\"pxt-on-start\" x=\"39\" y=\"49\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">You have been abandoned by your crew and trapped on the moon base</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Try and find a way out before the asteroid hits</field></shadow></value><next><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff99d99bbbbbcfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff99ddbdd66168bcccccc9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff999ddbbbd66888111ccccccb99fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9966ddbbbb6688811818ccccccbbc99fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdd69dddbbb66618881888818818cccccbe9fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffddd96dd6b6dbd68888888888888888cccccc99fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffdbbd9666666dbb668886888888cccccccccccccc9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffdbbb99666966d68866888888cccccccccccccccccc69ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffdbbb999669666666888888888ccccbbbcc8bcccccccccc9fffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffdbbb999666666666888888888cbbcbe8bbbcbcccccbbcccb9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffff9bbb999666666666688888888bccb888888bbbbb88888bcccccfffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffdbbb999669666666866888868bbbbb8888888ccc888b88bbc8cccffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffdbbb9d99ddd666668868888688bbcb888888888bc888bcc8bc886c9fffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffbbbbbbddd966666888688888888888888b88888888888cc8ccc886c9ffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffdbbbbbbdd6966666666868888888888bbdbbebb8888888888bcc8c86c9fffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffff9bbdbddd6666666666888688868888ddddddddde8888888888bccbbccccfffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffff9dbb9dd666666666668868888888bddddddbdbbddcccccd88b8ebccbbbbc9ffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffdd99999666666666668868888888bdddddbbbbbdbbbccccccb8bbbccc8bbb9fffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffff9dd99996696966666666668888bbbdddddbbbddbbbbbbbbbcccc8bcccbb8bbcfffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffff9d999996666966666668688888bbdddbbbbdbbbbbbbbbbbcccccc8bbccc88bc9ffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff99999999666996696668868868bbdddddbbbdbbbbbbbbbbbbcbccc88bcccc88c6ffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff999996696669666966d8868666bddbbbddbbdbbbbbbbbbbbbcccccc88bbccc8869fffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff9999996699669666666d6688668bddbbdbbbbbbbbbbbbbbbbbccccccc88bcccc866fffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff9dd999669966666666666688668bdddbbbbbbbbbbbbbbbbbbbccccccc888bbccc669ffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff999999669d69666666666688868bddbbbdbbbbbbbbbbbbbbbbcccccccc888bbcc869ffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99999996ddd69666666688888868ddbddbbbbbbbbbbbbbbbbbbccccccccc888888866ffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff999999969ddd6669666688688888bbbbbbbbbbbbbbbbbbbbbbbbccbccccc8888888869fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99999966ddddd669666688888888bbbbbbbbbbbbbbbbbbbbbbbcbccccccccc88888869fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff999bb99666dddd6666666668886888bbbbbbbbbbbbbbbbbbbbbbcccccccccccc8888889fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbbb966696666666666888886888bbbbbbbbbbbbbbbbbbbbbbcbccccccccccc888886fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbdbb666969666666668888868888bbbbbbbbbbbbbbbbbbbbccbccccccccccc8888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99dbbbbb6696966666666668886868888bbbbeb888bbbbbbbbbcccccccccccccc8888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbbbbbe6969666666666888888888888888888888bbbbbbbbccccccccccccc88888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbccbc66966666666688888688888888888d888ebbbbbbbcccccccccccbb88888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbbcc69996666688668886888888dd88dbbd88bbbbbbbccccccccccceb88888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbbccc999966668868888888888ddddbbbbd88cbbbbbbbbccccccccc8888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9ebbbbcccccccc9966666688888888888888ddbbbb888bbbbbbbbccccccccc8888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbccccccccc666666888866888888888dddddbdd88bbbbbbccccccccc88888888bb9ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffbbbbbbcccccccccc6666688888888888888888d8888888bbbbbbccccccccc88888888bb9ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9dbbbbccbbccccccb666688868888888888888888888888bbbbbccccccccc888888888b9ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9dbbbbbbbbcccccbb66666688888888888888888888888bbbbccccccccccc88888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbcccccccb666666688888888888888888888888bbbbcccccccccc888888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbccccccbb666666688888888888888888888888bbbbcccccccccc88888888886fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbbbbbbbccccb6666668888888888888888888888888bbbbcbcccccccc88888888886fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99dbbbcbbccccb6666668888888888888888888888888bbbbbccccccccc888cc888869fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99dbbbcccccccc6666668688688888888888888888888bbbbccccccccc8888cc888869fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff999bbbbbccccbc6666666688688888888888888888888bbbbcccccccc88888dd88886ffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff969bbbbbbcccc69666666668688868888888888888888bbbbccccccc88888bd888886ffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff99bbbbcccccc696bb668888888868888888888888888bbbcccccccc8888bbd888869ffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff9999bbbcccc9666dbbb8888888888888888888888888ccbcccccccc8888bc888886fffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff699bbbbccc966966bbb8888888888888888888888888bbbbccccc88888bcc88869fffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff9999bbcccc666666dbbdd88888888688888888888888bbcccccc88888888888669fffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff9699dbcccc66666666bb6d8888888688888888888888bbcccccc8888888888869ffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffff9696bbbcc66666666dbbd6886868888888888888888bbcbccc8888888888d669ffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffff999ebbccc666666666dbb8868888688888888888888bbbccc8888888889b69fffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffff969ccbcc66996666666bbb868888888888888888888bbbc888888888888b6ffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffff96ccccc966966666666bb8688666888888888888888b8888888888888699ffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffff99ccbc996666666666dbb6888668888888888888888888888888888869fffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffff969ccb9666666666666dbb88866888888888888888888888888888869ffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffff969ccc6696666666666dd8888668888888888888888888888888866fffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffff969cc9669666966d66dd8888868888888888888888888bb8888669fffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffff96ccc66699669dddd888868888888888888888888888be888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffff96c66669966666dd88886666668888888888888888dd888669fffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffff96966669966ddd686886868888888888888888888d888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffff969666696666666688686888888888888888888888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffff9966966966666666886888888888888886888888669fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9699996666666888888888888888888118888699ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff969996666668888881188888888881888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff996999666688881818888888881886669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9961161186618811188886116699ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff99161111611118111666699fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9999661166669999ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff999999999fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</field><value name=\"VALUE\"><shadow type=\"math_number\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\nf f f f f f f f f f f f f f f f \n1 1 f f f f f f f f f f f f 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 f f f f f f f f f f f f 1 1 \nf f f f f f f f f f f f f f f f \n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value></block></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreatenoset\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\nb . . . . . . . . . . . . . . b \n. b . . . . . . . . . . . . b . \n. . b . . . . . . . . . . b . . \n. . . b . . . . . . . . b . . . \n. . . . b . . . . . . b . . . . \n. . . . . b . . . . b . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . b . . . . . . . . . . \n. . . . b . . . . . . . . . . . \n. . . b . . . . . . . . b . . . \n. . b . . . . . . . . . . b . . \n. b . . . . . . . . . . . . b . \nb . . . . . . . . . . . . . . b \n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value></block></value><next><block type=\"sprite_scale_to_pixels_ex\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"direction\">ScaleDirection.Horizontally</field><field name=\"anchor\">ScaleAnchor.Middle</field><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</field></block></value><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">32</field></shadow></value><value name=\"proportional\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"803\" y=\"223\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></statement></block><block type=\"spritesoverlap\" x=\"634\" y=\"615\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value><statement name=\"HANDLER\"><block type=\"variables_change\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><next><block type=\"spritedestroy2\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"effect\">effects.spray</field><value name=\"sprite\"><block type=\"argument_reporter_custom\"><mutation typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow></value><next><block type=\"hudsetScore\"><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></next></block></statement></block></xml>","main.ts":"","README.md":" ","assets.json":"","_animation.ts":"//////////////////////// animation.ts contents of previous version, just for test.ts here for convenience /////////////////////\n// file contents:\n// directional animations defines for enging_raycasting.ts\n// for convenience, constructed animations as below, which images are builtin in Arcade, \n// in order from easy to complex\n\n// each are 2D Image array, Image[][]: \n// 1st dimension is direction: \n//    length=1 to any, e.g. 1,2,3,4,...,8,..., engine can automatically arange them to 0~360 \n//    order: start from left, then folling with others in CW order\n//    e.g: \n//         2 directions should be [leftAni,RightAni], \n//         4-direction should be [leftAni, frontAni, rightAni, backAni], \n//         8-direction=[l,lf,f,fr,r,rb,b,lb], ...\n//    the reason that directions start from left, is almost all Arcade builtin one side images are facing left, so that would be convient for using.\n// 2nd dimension is animation Images\n//    length=1 to any, e.g. 1,2,3,4,..., engine will automatically loop them by aniInterval(set when create CompactSprite, or use default)\n\n\n//simplest, just one static image, looks the same in all angle of view\nconst texturesDonut = [[sprites.food.smallDonut]]\nconst texturesBigCake = [[sprites.food.bigCake]]\n\n//1-direction, with ani, looks the same Ani in all angle of view\nconst texturesCoin = [[sprites.builtin.coin0, sprites.builtin.coin1, sprites.builtin.coin2, sprites.builtin.coin3, sprites.builtin.coin4, sprites.builtin.coin5]]\n\nconst texturesDog = [[sprites.builtin.dog0, sprites.builtin.dog1, sprites.builtin.dog2]]\nconst texturesDuck = [[sprites.duck.duck1, sprites.duck.duck2, sprites.duck.duck3, sprites.duck.duck4, sprites.duck.duck5, sprites.duck.duck6]]\n\n//2-direction, with ani, looks difference from left or right side\nconst texturesPlane = [[sprites.vehicle.plane0, sprites.vehicle.plane1, sprites.vehicle.plane2, sprites.vehicle.plane3, sprites.vehicle.plane4, sprites.vehicle.plane5],\n[sprites.vehicle.plane0, sprites.vehicle.plane1, sprites.vehicle.plane2, sprites.vehicle.plane3, sprites.vehicle.plane4, sprites.vehicle.plane5]]\n//no right side ani images builtin, so make them from lefts, and then flipX\nimagesFlipX(texturesPlane[1])\n\nconst texturesFish = [[sprites.builtin.angelFish0, sprites.builtin.angelFish1, sprites.builtin.angelFish2, sprites.builtin.angelFish3],\n[sprites.builtin.angelFish0, sprites.builtin.angelFish1, sprites.builtin.angelFish2, sprites.builtin.angelFish3]]\nimagesFlipX(texturesFish[1])\n\n//4-direction\nconst texturesHero = [\n    [sprites.castle.heroWalkSideLeft1, sprites.castle.heroWalkSideLeft2, sprites.castle.heroWalkSideLeft3, sprites.castle.heroWalkSideLeft4],\n    [sprites.castle.heroWalkFront1, sprites.castle.heroWalkFront2, sprites.castle.heroWalkFront3, sprites.castle.heroWalkFront4],\n    [sprites.castle.heroWalkSideRight1, sprites.castle.heroWalkSideRight2, sprites.castle.heroWalkSideRight3, sprites.castle.heroWalkSideRight4],\n    [sprites.castle.heroWalkBack1, sprites.castle.heroWalkBack2, sprites.castle.heroWalkBack3, sprites.castle.heroWalkBack4],\n]\n\nconst texturesPrincess2 = [\n    [sprites.castle.princess2Left1, sprites.castle.princess2Left2],\n    [sprites.castle.princess2WalkFront1, sprites.castle.princess2WalkFront2, sprites.castle.princess2WalkFront3, sprites.castle.princess2WalkFront2],\n    [sprites.castle.princess2Right1, sprites.castle.princess2Right2],\n    [sprites.castle.princess2WalkBack1, sprites.castle.princess2WalkBack2, sprites.castle.princess2WalkBack3, sprites.castle.princess2WalkBack2],\n]\n\n//4-direction, but back side has only 1 image, so no ani when looking from back\nconst texturesSkelly = [\n    [sprites.castle.skellyWalkLeft1, sprites.castle.skellyWalkLeft2],\n    [sprites.castle.skellyWalkFront1, sprites.castle.skellyWalkFront2, sprites.castle.skellyWalkFront3],\n    [sprites.castle.skellyWalkRight1, sprites.castle.skellyWalkRight2],\n    [img`\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ..........ffff..........\n\t        ........ff1111ff........\n\t        .......fb111111bf.......\n\t        .......f11111111f.......\n\t        ......fd11111111df......\n\t        ......fd11111111df......\n\t        ......fd11111111df......\n\t        ......fb11111111bf......\n\t        ......fcd111111dcf......\n\t        .......fb111111bf.......\n\t        .....ffffdb1bdcfff......\n\t        ....fc111cfbfbc111cf....\n\t        ....f11111ffff11111f....\n\t        ....fbfbfbffffffbfbf....\n\t        .........ffffff.........\n\t        ..........fff...........\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ........................\n\t    `],\n]\n\nconst texturesPrincess = [\n    [sprites.castle.princessLeft0, sprites.castle.princessLeft1, sprites.castle.princessLeft0, sprites.castle.princessLeft2],\n    [sprites.castle.princessFront0, sprites.castle.princessFront1, sprites.castle.princessFront0, sprites.castle.princessFront2],\n    [],\n    [sprites.castle.princessBack0, sprites.castle.princessBack1, sprites.castle.princessBack0, sprites.castle.princessBack2],\n]\ntexturesPrincess[0].forEach((v, i) => {\n    texturesPrincess[2].push(v.clone())\n    texturesPrincess[2][i].flipX()\n}\n)\n\nfunction imagesFlipX(ani: Image[]) {\n    ani.forEach((img, i) => {\n        ani[i] = img.clone() //don't worry memery leak or waste, cause old images are still using by left\n        ani[i].flipX()\n    })\n}\n\n//////////////////////// end of animation.ts contents of previous version //////////////\n\n\n","_render_blocks.ts":"enum RCSpriteAttribute {\n    ZOffset,\n    ZPosition,\n    ZVelocity,\n    ZAcceleration\n}\n/**\n * A 2.5D Screen Render, using Raycasting algorithm\n **/\n//% color=#03AA74 weight=1 icon=\"\\uf1b2\" //cube f1b2 , fold f279\n//% groups='[\"Instance\",\"Basic\", \"Dimension Z\", \"Animate\", \"Advanced\"]'\n//% block=\"3D Render\"\nnamespace Render {\n    export enum attribute {\n        dirX,\n        dirY,\n        fov,\n        wallZScale,\n    }\n\n    export class Animations {\n        constructor(public frameInterval: number, public animations: Image[][]) {\n        }\n\n        msLast = 0\n        index = 0\n        iAnimation = 0\n        getFrameByDir(dir: number): Image {\n            if (control.millis() - this.msLast > this.frameInterval) {\n                this.msLast = control.millis()\n                this.index++\n                this.iAnimation = Math.round((dir * this.animations.length)) % this.animations.length\n                if (this.index >= this.animations[this.iAnimation].length)\n                    this.index = 0\n            }\n            return this.animations[this.iAnimation][this.index]\n        }\n    }\n\n    /**\n * Apply a directional image animations on a sprite\n * @param sprite the sprite to animate on\n * @param animations the directional animates\n */\n    //% blockId=set_animation\n    //% block=\"set $sprite=variables_get(mySprite) with animations$animations\"\n    //% animations.shadow=create_animation\n    //% group=\"Animate\"\n    //% weight=100\n    //% help=github:pxt-raycasting/docs/set-sprite-animations\n    export function setSpriteAnimations(sprite: Sprite, animations: Animations) {\n        raycastingRender.spriteAnimations[sprite.id] = animations\n    }\n\n    /**\n * Create a directional image animations, multi animations will applied to one round dirctions averagely, start from the left. \n * The reason that directions start from left, is almost all Arcade out-of-box 1 or 2-dirction images are facing left, so that would be convient for using.\n * @param frameInterval the time between changes, eg: 150\n * @param frames1 animation, if this is the first of multi animation it will be used as left, others will \n * @param frames2 optional, used for 2 or more dirctional\n * @param frames3 optional, used for 3 or more dirctional\n * @param frames4 optional, used for 4 or more dirctional\n */\n    //% blockId=create_animation\n    //% block=\"interval$frameInterval=timePicker animates:$frames1=animation_editor|| $frames2=animation_editor $frames3=animation_editor $frames4=animation_editor\"\n    //% inlineInputMode=inline\n    //% group=\"Animate\"\n    //% weight=100\n    //% help=github:pxt-raycasting/docs/create-animations\n    export function createAnimations(frameInterval: number, frames1: Image[], frames2?: Image[], frames3?: Image[], frames4?: Image[]): Animations {\n        const animationList = [frames1]\n        if (frames2) animationList.push(frames2)\n        if (frames3) animationList.push(frames3)\n        if (frames4) animationList.push(frames4)\n        return new Animations(frameInterval, animationList)\n    }\n\n    /**\n     * Get the Render\n     * @param img the image\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRCRenderInstance block=\"raycasting render\"\n    //% expandableArgumentMode=toggle\n    //% weight=100 \n    //% blockHidden=true\n    //% hidden=1\n    export function getRCRenderInstance(): RayCastingRender {\n        return raycastingRender\n    }\n\n    /**\n     * Get the render Sprite, which create automatically, for physical collisions, and holding the view point.\n     * You can consider it as \"myself\", and operate it like a usual sprite, eg.: position, speed, scale, collision, ...\n     * But properties relative 3D, eg. ZOffset, ZPosition, viewAngle, and etc. are not in the Sprite class.\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRenderSpriteVariable block=\"myself sprite\"\n    //% expandableArgumentMode=toggle\n    //% blockSetVariable=mySprite\n    //% weight=99\n    //% help=github:pxt-raycasting/get-render-sprite-variable\n    export function getRenderSpriteVariable(): Sprite {\n        return raycastingRender.sprSelf\n    }\n\n    /**\n     * Get the render Sprite, which create automatically, for physical collisions, and holding the view point.(but get/set view direction with dirX/dirY, which not in the Sprite class) \n     * You can consider it as \"myself\", and operate it like a usual sprite.\n     * eg: position, speed, scale, collision, ...\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRenderSpriteInstance block=\"myself sprite\"\n    //% expandableArgumentMode=toggle\n    //% weight=98\n    //% help=github:pxt-raycasting/docs/get-render-sprite-instance\n    export function getRenderSpriteInstance(): Sprite {\n        return raycastingRender.sprSelf\n    }\n\n    /**\n     * Toggle current view mode\n     */\n    //% blockId=rcRender_toggleViewMode block=\"toggle current view mode\"\n    //% group=\"Basic\"\n    //% weight=89\n    //% help=github:pxt-raycasting/docs/toggle-view-mode\n    export function toggleViewMode() {\n        raycastingRender.viewMode = raycastingRender.viewMode == ViewMode.tilemapView ? ViewMode.raycastingView : ViewMode.tilemapView\n    }\n\n    /**\n     * Current view mode is the specific one?\n     * @param viewMode\n     */\n    //% blockId=rcRender_isViewMode block=\"current is $viewMode\"\n    //% group=\"Basic\"\n    //% weight=88\n    //% help=github:pxt-raycasting/docs/is-view-mode\n    export function isViewMode(viewMode: ViewMode): boolean {\n        return viewMode == raycastingRender.viewMode\n    }\n\n    /**\n     * Set view mode\n     * @param viewMode\n     */\n    //% blockId=rcRender_setViewMode block=\"set view mode $viewMode\"\n    //% group=\"Basic\"\n    //% weight=87\n    //% help=github:pxt-raycasting/docs/set-view-mode\n    export function setViewMode(viewMode: ViewMode) {\n        raycastingRender.viewMode = viewMode\n    }\n\n    /**\n     * Get render arribute\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"get %attribute\" \n    //% blockId=rcRender_getAttribute\n    //% weight=83\n    //% help=github:pxt-raycasting/docs/get-attribute\n    export function getAttribute(attr: attribute): number {\n        switch (attr) {\n            case attribute.dirX:\n                return raycastingRender.dirX\n            case attribute.dirY:\n                return raycastingRender.dirY\n            case attribute.fov:\n                return raycastingRender.fov\n            case attribute.wallZScale:\n                return raycastingRender.wallZScale\n            default:\n                return 0\n        }\n    }\n\n    /**\n     * Set render arribute\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"set %attribute = %value\" \n    //% blockId=rcRender_setAttribute\n    //% weight=82\n    //% help=github:pxt-raycasting/docs/set-attribute\n    export function setAttribute(attr: attribute, value: number) {\n        switch (attr) {\n            case attribute.dirX:\n                raycastingRender.dirX = value\n                break\n            case attribute.dirY:\n                raycastingRender.dirY = value\n                break\n            case attribute.fov:\n                if (value < 0) value = 0\n                raycastingRender.fov = value\n                break\n            case attribute.wallZScale:\n                if (value < 0) value = 0\n                raycastingRender.wallZScale = value\n                break\n            default:\n        }\n    }\n\n    /**\n     * Get default FOV (field of view) value\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"defaultFov\"\n    //% blockId=rcRender_getDefaultFov\n    //% weight=81\n    //% help=github:pxt-raycasting/docs/get-default-fov\n    export function getDefaultFov(): number {\n        return defaultFov\n    }\n\n    /**\n     * Set view angle\n     * @param angle, unit: degree 0~360\n     */\n    //% blockId=rcRender_setViewAngleInDegree block=\"set view angle$angle\"\n    //% angle.min=0 angle.max=360 angle.defl=90\n    //% group=\"Basic\"\n    //% weight=80\n    //% help=github:pxt-raycasting/docs/set-view-angle-in-degree\n    export function setViewAngleInDegree(angle: number) {\n        raycastingRender.viewAngle = angle * Math.PI / 180\n    }\n\n    /**\n     * Set view angle by dirX and dirY\n     * @param dirX\n     * @param dirY\n     */\n    //% blockId=rcRender_setViewAngle block=\"set view angle by dirX%dirX and dirY%dirY\"\n    //% group=\"Basic\"\n    //% weight=79\n    //% help=github:pxt-raycasting/docs/set-view-angle\n    export function setViewAngle(dirX: number, dirY: number) {\n        raycastingRender.viewAngle = Math.atan2(dirY, dirX)\n    }\n\n    /**\n     * Set floating offset height for a sprite at Z direction\n     * @param sprite\n     * @param Zoffset Negative floats down, affirmative goes up\n     * @param duration moving time, 0 for immediately, unit: ms\n     */\n    //% blockId=rcRender_setZOffset block=\"set Sprite %spr=variables_get(mySprite) floating %offset pixels|| duration $duration=timePicker|ms \"\n    //% offset.min=-100 offset.max=100 offset.defl=8\n    //% duration.min=0 duration.max=5000 duration.defl=0\n    //% group=\"Dimension Z\"\n    //% weight=77\n    //% blockHidden\n    //% help=github:pxt-raycasting/docs/set-z-offset\n    export function setZOffset(sprite: Sprite, offset: number, duration?: number) {\n        raycastingRender.setZOffset(sprite, offset, duration)\n    }\n\n    /**\n     * Set arribute of a Sprite\n     * @param spr Sprite\n     * @param attr RCSpriteAttribute\n     */\n    //% group=\"Dimension Z\"\n    //% block=\"set Sprite %spr=variables_get(mySprite) %attribute = %value\"\n    //% blockId=rcRender_setSpriteAttribute\n    //% weight=75\n    //% help=github:pxt-raycasting/docs/set-sprite-attribute\n    export function setSpriteAttribute(spr: Sprite, attr: RCSpriteAttribute, value: number) {\n        switch (attr) {\n            case RCSpriteAttribute.ZOffset:\n                raycastingRender.getMotionZ(spr).offset = value\n                break\n            case RCSpriteAttribute.ZPosition:\n                raycastingRender.getMotionZ(spr).p = value\n                break\n            case RCSpriteAttribute.ZVelocity:\n                raycastingRender.getMotionZ(spr).v = value\n                break\n            case RCSpriteAttribute.ZAcceleration:\n                raycastingRender.getMotionZ(spr).a = value\n                break\n            default:\n        }\n    }\n\n    /**\n     * Get arribute of a Sprite\n     * @param spr Sprite\n     * @param attr RCSpriteAttribute\n     */\n    //% group=\"Dimension Z\"\n    //% block=\"get Sprite %spr=variables_get(mySprite) %attribute\"\n    //% blockId=rcRender_getSpriteAttribute\n    //% weight=74\n    //% help=github:pxt-raycasting/docs/get-sprite-attribute\n    export function getSpriteAttribute(spr: Sprite, attr: RCSpriteAttribute): number {\n        switch (attr) {\n            case RCSpriteAttribute.ZOffset:\n                return raycastingRender.getMotionZ(spr).offset\n            case RCSpriteAttribute.ZPosition:\n                return raycastingRender.getMotionZ(spr).p\n            case RCSpriteAttribute.ZVelocity:\n                return raycastingRender.getMotionZ(spr).v\n            case RCSpriteAttribute.ZAcceleration:\n                return raycastingRender.getMotionZ(spr).a\n            default:\n                return 0\n        }\n    }\n\n    /**\n     * Check if 2 sprites overlaps each another in Z dimension\n     * Best work together with sprites.onOverlap(kind1, kind2)\n     * @param sprite1\n     * @param sprite2\n     */\n    //% blockId=rcRender_isSpritesOverlapZ\n    //% block=\"is sprites $sprite1=variables_get(mySprite) and $sprite2=variables_get(mySprite2) overlaps in Z dimension\"\n    //% group=\"Dimension Z\"\n    //% weight=71\n    //% help=github:pxt-raycasting/docs/is-sprites-overlap-z\n    export function isSpritesOverlapZ(sprite1: Sprite, sprite2: Sprite): boolean {\n        return raycastingRender.isOverlapZ(sprite1, sprite2)\n    }\n\n    /**\n     * Make sprite jump, with specific height and duration\n     * Jump can only happened when sprite is standing, current height = its offset .\n     * @param sprite\n     * @param height jump height in pixel\n     * @param duration hover time span, unit: ms\n     */\n    //% blockId=rcRender_jumpWithHeightAndDuration block=\"Sprite %spr=variables_get(mySprite) jump, with height $height duration $duration=timePicker|ms \"\n    //% height.min=0 height.max=100 height.defl=16\n    //% duration.min=50 duration.max=5000 duration.defl=500\n    //% group=\"Dimension Z\"\n    //% weight=70\n    //% help=github:pxt-raycasting/docs/jump-with-height-and-duration\n    export function jumpWithHeightAndDuration(sprite: Sprite, height: number, duration: number) {\n        raycastingRender.jumpWithHeightAndDuration(sprite, height, duration)\n    }\n\n    /**\n     * Make sprite jump, with specific speed and acceleration\n     * Simular with Move block, but jump can only happened when sprite is standing, current height = its offset.\n     * @param sprite\n     * @param v vetical speed, unit: pixel/s\n     * @param a vetical acceleration, unit: pixel/s\n     */\n    //% blockId=rcRender_jump block=\"Sprite %spr=variables_get(mySprite) jump||, with speed $v=spriteSpeedPicker acceleration $a\"\n    //% v.min=-100 v.max=100 v.defl=60\n    //% a.min=-1000 a.max=1000 a.defl=-250\n    //% group=\"Dimension Z\"\n    //% weight=68\n    //% help=github:pxt-raycasting/docs/jump\n    export function jump(sprite: Sprite, v?: number, a?: number) {\n        raycastingRender.jump(sprite, v, a)\n    }\n\n    /**\n     * Make sprite jump, with specific speed and acceleration\n     * @param sprite\n     * @param v vetical speed, unit: pixel/s\n     * @param a vetical acceleration, unit: pixel/s\n     */\n    //% blockId=rcRender_move block=\"Sprite %spr=variables_get(mySprite) move, with speed $v=spriteSpeedPicker|| acceleration $a\"\n    //% v.min=-200 v.max=200 v.defl=60\n    //% a.min=-1000 a.max=1000 a.defl=-250\n    //% group=\"Dimension Z\"\n    //% weight=66\n    //% help=github:pxt-raycasting/docs/move\n    export function move(sprite: Sprite, v?: number, a?: number) {\n        raycastingRender.move(sprite, v, a)\n    }\n\n    /**\n     * Control the self sprite using the direction buttons from the controller. \n     * To stop controlling self sprite, pass 0 for v and va.\n     *\n     * @param v The velocity used for forward/backword movement when up/down is pressed, in pixel/s\n     * @param va The angle velocity used for turn view direction when left/right is pressed, in radian/s.\n     */\n    //% blockId=\"rcRender_moveWithController\" block=\"move with buttons velocity $v|| turn speed $va camera sway$cameraSway pixels\"\n    //% weight=60\n    //% expandableArgumentMode=\"toggle\"\n    //% v.defl=2 va.defl=3\n    //% group=\"Advanced\"\n    //% v.shadow=\"spriteSpeedPicker\"\n    //% va.shadow=\"spriteSpeedPicker\"\n    //% help=github:pxt-raycasting/docs/move-with-controller\n    export function moveWithController(v: number = 2, va: number = 3, cameraSway?: number) {\n        raycastingRender.velocity = v\n        raycastingRender.velocityAngle = va\n        if (cameraSway != undefined)\n            raycastingRender.cameraSway = cameraSway | 0\n    }\n\n    /**\n     * Render takeover all sprites in current scene\n     * Render will call this automatically, but maybe not in time enough.\n     * If you saw sprite draw at its tilemap position on screen, call this just after created the sprite.\n     */\n    //% blockId=rcRender_takeoverSceneSprites \n    //% block=\"takeover sprites in scene\"\n    //% group=\"Advanced\"\n    //% weight=49\n    //% help=github:pxt-raycasting/docs/takeover-scene-sprites\n    export function takeoverSceneSprites() {\n        raycastingRender.takeoverSceneSprites()\n    }\n\n    /**\n     * Run on sprite dirction updated, present view point to Sprite facing dirction, or which angle you see of the sprite.\n     * Just using with other animation extensions, to set proper Image for sprite.\n     * Not required, if you have used the set animations block provided.\n     * @param dir It is a float number, 0~1 corresponds to 0~360, suggest use Math.round(dir*dirAniTotalCount)%dirAniTotalCount to get index of direction\n     */\n    //% blockId=rcRender_registerOnSpriteDirectionUpdateHandler\n    //% block=\"run code when sprite $spr dirction updated to $dir\"\n    //% draggableParameters\n    //% group=\"Advanced\"\n    //% weight=48\n    //% help=github:pxt-raycasting/docs/register-on-sprite-direction-update-handler\n    export function registerOnSpriteDirectionUpdateHandler(handler: (spr: Sprite, dir: number) => void) {\n        raycastingRender.registerOnSpriteDirectionUpdate(handler)\n    }\n}\n","_render_raycasting.ts":"//% shim=pxt::updateScreen\nfunction updateScreen(img: Image) { }\n\nenum ViewMode {\n    //% block=\"TileMap Mode\"\n    tilemapView,\n    //% block=\"Raycasting Mode\"\n    raycastingView,\n}\n\nnamespace Render {\n    const SH = screen.height, SHHalf = SH / 2\n    const SW = screen.width, SWHalf = SW / 2\n    const fpx = 8\n    const fpx_scale = 2 ** fpx\n    function tofpx(n: number) { return (n * fpx_scale) | 0 }\n    const one = 1 << fpx\n    const one2 = 1 << (fpx + fpx)\n    const FPX_MAX = (1 << fpx) - 1\n\n    class MotionSet1D {\n        p: number\n        v: number = 0\n        a: number = 0\n        constructor(public offset: number) {\n            this.p = offset\n        }\n    }\n\n    export const defaultFov = SW / SH / 2  //Wall just fill screen height when standing 1 tile away\n\n    export class RayCastingRender {\n        private tempScreen: Image = image.create(SW, SH)\n\n        velocityAngle: number = 2\n        velocity: number = 3\n        protected _viewMode = ViewMode.raycastingView\n        protected dirXFpx: number\n        protected dirYFpx: number\n        protected planeX: number\n        protected planeY: number\n        protected _angle: number\n        protected _fov: number\n        protected _wallZScale: number = 1\n        cameraSway = 0\n        protected isWalking = false\n        protected cameraOffsetX = 0\n        protected cameraOffsetZ_fpx = 0\n\n        //sprites & accessories\n        sprSelf: Sprite\n        sprites: Sprite[] = []\n        sprites2D: Sprite[] = []\n        spriteParticles: particles.ParticleSource[] = []\n        spriteLikes: SpriteLike[] = []\n        spriteAnimations: Animations[] = []\n        protected spriteMotionZ: MotionSet1D[] = []\n        protected sayRederers: sprites.BaseSpriteSayRenderer[] = []\n        protected sayEndTimes: number[] = []\n\n        //reference\n        protected tilemapScaleSize = 1 << TileScale.Sixteen\n        map: tiles.TileMapData\n        bg: Image\n        textures: Image[]\n        protected oldRender: scene.Renderable\n        protected myRender: scene.Renderable\n\n        //render\n        protected wallHeightInView: number\n        protected wallWidthInView: number\n        protected dist: number[] = []\n        //render perf const\n        cameraRangeAngle: number\n        viewZPos: number\n        selfXFpx: number\n        selfYFpx: number\n\n        //for drawing sprites\n        protected invDet: number //required for correct matrix multiplication\n        camera: scene.Camera\n        tempSprite: Sprite = sprites.create(img`0`)\n        protected transformX: number[] = []\n        protected transformY: number[] = []\n        protected angleSelfToSpr: number[] = []\n\n        onSpriteDirectionUpdateHandler: (spr: Sprite, dir: number) => void\n\n        get xFpx(): number {\n            return Fx.add(this.sprSelf._x, Fx.div(this.sprSelf._width, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        // set xFpx(v: number) {\n        //     this.sprSelf._x = v * this.tilemapScaleSize as any as Fx8\n        // }\n\n        get yFpx(): number {\n            return Fx.add(this.sprSelf._y, Fx.div(this.sprSelf._height, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        // set yFpx(v: number) {\n        //     this.sprSelf._y = v * this.tilemapScaleSize as any as Fx8\n        // }\n\n        get dirX(): number {\n            return this.dirXFpx / fpx_scale\n        }\n\n        get dirY(): number {\n            return this.dirYFpx / fpx_scale\n        }\n\n        set dirX(v: number) {\n            this.dirXFpx = v * fpx_scale\n        }\n\n        set dirY(v: number) {\n            this.dirYFpx = v * fpx_scale\n        }\n\n        sprXFx8(spr: Sprite) {\n            return Fx.add(spr._x, Fx.div(spr._width, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        sprYFx8(spr: Sprite) {\n            return Fx.add(spr._y, Fx.div(spr._height, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        get fov(): number {\n            return this._fov\n        }\n\n        set fov(fov: number) {\n            this._fov = fov\n            this.wallHeightInView = (SW << (fpx - 1)) / this._fov\n            this.wallWidthInView = this.wallHeightInView >> fpx // not fpx  // wallSize / this.fov * 4 / 3 * 2\n            this.cameraRangeAngle = Math.atan(this.fov) + .1 //tolerance for spr center just out of camera\n\n            this.setVectors()\n        }\n\n        get viewAngle(): number {\n            return this._angle\n        }\n        set viewAngle(angle: number) {\n            this._angle = angle\n            this.setVectors()\n            this.updateSelfImage()\n        }\n\n        get wallZScale(): number {\n            return this._wallZScale\n        }\n        set wallZScale(v: number) {\n            this._wallZScale = v\n        }\n\n        getMotionZ(spr: Sprite, offsetZ: number = 0) {\n            let motionZ = this.spriteMotionZ[spr.id]\n            if (!motionZ) {\n                motionZ = new MotionSet1D(tofpx(offsetZ))\n                this.spriteMotionZ[spr.id] = motionZ\n            }\n            return motionZ\n        }\n\n        getZOffset(spr: Sprite) {\n            return this.getMotionZ(spr).offset / fpx_scale\n        }\n\n        setZOffset(spr: Sprite, offsetZ: number, duration: number = 500) {\n            const motionZ = this.getMotionZ(spr, offsetZ)\n\n            motionZ.offset = tofpx(offsetZ)\n            if (motionZ.p != motionZ.offset) {\n                if (duration === 0)\n                    motionZ.p = motionZ.offset\n                else if (motionZ.v == 0)\n                    this.move(spr, (motionZ.offset - motionZ.p) / fpx_scale * 1000 / duration, 0)\n            }\n        }\n\n        getMotionZPosition(spr: Sprite) {\n            return this.getMotionZ(spr).p / fpx_scale\n        }\n\n        //todo, use ZHeight(set from sprite.Height when takeover, then sprite.Height will be replace with width)\n        isOverlapZ(sprite1: Sprite, sprite2: Sprite): boolean {\n            const p1 = this.getMotionZPosition(sprite1)\n            const p2 = this.getMotionZPosition(sprite2)\n            if (p1 < p2) {\n                if (p1 + sprite1.height > p2) return true\n            } else {\n                if (p2 + sprite2.height > p1) return true\n            }\n            return false\n        }\n\n        move(spr: Sprite, v: number, a: number) {\n            const motionZ = this.getMotionZ(spr)\n\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        jump(spr: Sprite, v: number, a: number) {\n            const motionZ = this.getMotionZ(spr)\n            if (motionZ.p != motionZ.offset)\n                return\n\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        jumpWithHeightAndDuration(spr: Sprite, height: number, duration: number) {\n            const motionZ = this.getMotionZ(spr)\n            if (motionZ.p != motionZ.offset)\n                return\n\n            // height= -v*v/a/2\n            // duration = -v/a*2 *1000\n            const v = height * 4000 / duration\n            const a = -v * 2000 / duration\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        get viewMode(): ViewMode {\n            return this._viewMode\n        }\n\n        set viewMode(v: ViewMode) {\n            this._viewMode = v\n        }\n\n        updateViewZPos() {\n            this.viewZPos = this.spriteMotionZ[this.sprSelf.id].p + (this.sprSelf._height as any as number) - (2 << fpx)\n        }\n\n        takeoverSceneSprites() {\n            const sc_allSprites = game.currentScene().allSprites\n            for (let i = 0; i < sc_allSprites.length;) {\n                const spr = sc_allSprites[i]\n                if (spr instanceof Sprite) {\n                    const sprList = (spr.flags & sprites.Flag.RelativeToCamera) ? this.sprites2D : this.sprites\n                    if (sprList.indexOf(spr) < 0) {\n                        sprList.push(spr as Sprite)\n                        this.getMotionZ(spr, 0)\n                        spr.onDestroyed(() => {\n                            this.sprites.removeElement(spr as Sprite)   //can be in one of 2 lists\n                            this.sprites2D.removeElement(spr as Sprite) //can be in one of 2 lists\n                            const sayRenderer = this.sayRederers[spr.id]\n                            if (sayRenderer) {\n                                this.sayRederers.removeElement(sayRenderer)\n                                sayRenderer.destroy()\n                            }\n                        })\n                    }\n                } else if (spr instanceof particles.ParticleSource) {\n                    const particle = (spr as particles.ParticleSource)\n                    if (this.spriteParticles.indexOf(particle) < 0) {\n                        this.spriteParticles[(particle.anchor as Sprite).id] = particle\n                        particle.anchor = this.tempSprite\n                    }\n                } else {\n                    if (this.spriteLikes.indexOf(spr) < 0)\n                        this.spriteLikes.push(spr)\n                }\n                sc_allSprites.removeElement(spr)\n            }\n            this.sprites.forEach((spr) => {\n                if (spr)\n                    this.takeoverSayRenderOfSprite(spr)\n            })\n        }\n        takeoverSayRenderOfSprite(sprite: Sprite) {\n            const sprite_as_any = (sprite as any)\n            if (sprite_as_any.sayRenderer) {\n                this.sayRederers[sprite.id] = sprite_as_any.sayRenderer\n                this.sayEndTimes[sprite.id] = sprite_as_any.sayEndTime;\n                sprite_as_any.sayRenderer = undefined\n                sprite_as_any.sayEndTime = undefined\n            }\n        }\n\n        tilemapLoaded() {\n            const sc = game.currentScene()\n            this.map = sc.tileMap.data\n            this.textures = sc.tileMap.data.getTileset()\n            this.tilemapScaleSize = 1 << sc.tileMap.data.scale\n            this.oldRender = sc.tileMap.renderable\n            this.spriteLikes.removeElement(this.oldRender)\n            sc.allSprites.removeElement(this.oldRender)\n\n            let frameCallback_update = sc.eventContext.registerFrameHandler(scene.PRE_RENDER_UPDATE_PRIORITY + 1, () => {\n                const dt = sc.eventContext.deltaTime;\n                // sc.camera.update();  // already did in scene\n                for (const s of this.sprites)\n                    s.__update(sc.camera, dt);\n                this.sprSelf.__update(sc.camera, dt)\n            })\n\n            let frameCallback_draw = sc.eventContext.registerFrameHandler(scene.RENDER_SPRITES_PRIORITY + 1, () => {\n                if (this._viewMode == ViewMode.tilemapView) {\n                   // screen.drawImage(sc.background.image, 0, 0)\n                    this.oldRender.__drawCore(sc.camera)\n                    this.sprites.forEach(spr => spr.__draw(sc.camera))\n                    this.sprSelf.__draw(sc.camera)\n                } else {\n                 //   this.tempScreen.drawImage(sc.background.image, 0, 0)\n                    //debug\n                    // const ms=control.micros()\n                    this.render()\n                    // info.setScore(control.micros()-ms)\n                    screen.fill(0)\n                }\n                this.sprites2D.forEach(spr => spr.__draw(sc.camera))\n                this.spriteLikes.forEach(spr => spr.__draw(sc.camera))\n                if (this._viewMode == ViewMode.raycastingView)\n                    this.tempScreen.drawTransparentImage(screen, 0, 0)\n            })\n\n            sc.tileMap.addEventListener(tiles.TileMapEvent.Unloaded, data => {\n                sc.eventContext.unregisterFrameHandler(frameCallback_update)\n                sc.eventContext.unregisterFrameHandler(frameCallback_draw)\n            })\n\n            // this.myRender = scene.createRenderable(\n            //     scene.TILE_MAP_Z,\n            //     (t, c) => this.trace(t, c)\n            // )\n\n        }\n\n        constructor() {\n            this._angle = 0\n            this.fov = defaultFov\n            this.camera = new scene.Camera()\n\n            const sc = game.currentScene()\n            if (!sc.tileMap) {\n                sc.tileMap = new tiles.TileMap();\n            } else {\n                this.tilemapLoaded()\n            }\n            game.currentScene().tileMap.addEventListener(tiles.TileMapEvent.Loaded, data => this.tilemapLoaded())\n\n            //self sprite\n            this.sprSelf = sprites.create(image.create(this.tilemapScaleSize >> 1, this.tilemapScaleSize >> 1), SpriteKind.Player)\n            this.takeoverSceneSprites()\n            this.sprites.removeElement(this.sprSelf)\n            this.updateViewZPos()\n            scene.cameraFollowSprite(this.sprSelf)\n            this.updateSelfImage()\n\n            game.onUpdate(function () {\n                this.updateControls()\n            })\n\n            game.onUpdateInterval(400, () => {\n                for (let i = 0; i < this.sprites.length;) {\n                    const spr = this.sprites[i]\n                    if (spr.flags & sprites.Flag.RelativeToCamera) {\n                        this.sprites.removeElement(spr)\n                        this.sprites2D.push(spr)\n                    } else { i++ }\n                }\n                for (let i = 0; i < this.sprites2D.length;) {\n                    const spr = this.sprites2D[i]\n                    if (!(spr.flags & sprites.Flag.RelativeToCamera)) {\n                        this.sprites2D.removeElement(spr)\n                        this.sprites.push(spr)\n                    } else { i++ }\n                }\n                this.takeoverSceneSprites() // in case some one new\n            })\n\n\n            game.onUpdateInterval(25, () => {\n                if (this.cameraSway && this.isWalking) {\n                    this.cameraOffsetX = (Math.sin(control.millis() / 150) * this.cameraSway * 3) | 0\n                    this.cameraOffsetZ_fpx = tofpx(Math.cos(control.millis() / 75) * this.cameraSway) | 0\n                }\n            });\n            control.__screen.setupUpdate(() => {\n                if (this.viewMode == ViewMode.raycastingView)\n                    updateScreen(this.tempScreen)\n                else\n                    updateScreen(screen)\n            })\n\n            game.addScenePushHandler((oldScene) => {\n                control.__screen.setupUpdate(() => { updateScreen(screen) })\n            })\n            game.addScenePopHandler((oldScene) => {\n                control.__screen.setupUpdate(() => {\n                    if (this.viewMode == ViewMode.raycastingView)\n                        updateScreen(this.tempScreen)\n                    else\n                        updateScreen(screen)\n                })\n            })\n        }\n\n        private setVectors() {\n            const sin = Math.sin(this._angle)\n            const cos = Math.cos(this._angle)\n            this.dirXFpx = tofpx(cos)\n            this.dirYFpx = tofpx(sin)\n            this.planeX = tofpx(sin * this._fov)\n            this.planeY = tofpx(cos * -this._fov)\n        }\n\n        //todo, pre-drawn dirctional image\n        public updateSelfImage() {\n            const img = this.sprSelf.image\n            img.fill(6)\n            const arrowLength = img.width / 2\n            img.drawLine(arrowLength, arrowLength, arrowLength + this.dirX * arrowLength, arrowLength + this.dirY * arrowLength, 2)\n            img.fillRect(arrowLength - 1, arrowLength - 1, 2, 2, 2)\n        }\n\n        updateControls() {\n            if (this.velocityAngle !== 0) {\n                const dx = controller.dx(this.velocityAngle)\n                if (dx) {\n                    this.viewAngle += dx\n                }\n            }\n            if (this.velocity !== 0) {\n                this.isWalking = true\n                const dy = controller.dy(this.velocity)\n                if (dy) {\n                    const nx = this.xFpx - Math.round(this.dirXFpx * dy)\n                    const ny = this.yFpx - Math.round(this.dirYFpx * dy)\n                    this.sprSelf.setPosition((nx * this.tilemapScaleSize / fpx_scale), (ny * this.tilemapScaleSize / fpx_scale))\n                } else {\n                    this.isWalking = false\n                }\n            }\n\n            for (const spr of this.sprites) {\n                this.updateMotionZ(spr)\n            }\n            this.updateMotionZ(this.sprSelf)\n        }\n\n        updateMotionZ(spr: Sprite) {\n            const dt = game.eventContext().deltaTime\n            const motionZ = this.spriteMotionZ[spr.id]\n            //if (!motionZ) continue\n\n            if (motionZ.v != 0 || motionZ.p != motionZ.offset) {\n                motionZ.v += motionZ.a * dt, motionZ.p += motionZ.v * dt\n                //landing\n                if ((motionZ.a >= 0 && motionZ.v > 0 && motionZ.p > motionZ.offset) ||\n                    (motionZ.a <= 0 && motionZ.v < 0 && motionZ.p < motionZ.offset)) { motionZ.p = motionZ.offset, motionZ.v = 0 }\n                if (spr === this.sprSelf)\n                    this.updateViewZPos()\n            }\n\n        }\n\n\n        blitRowBreak(screenX: number, screenUp: number, screenDown: number, source: Image, sourceX: number, sourceYBreak: number) {\n\n            let stepY = (sourceYBreak) / (SHHalf - screenUp )\n            let sourceY = sourceYBreak - stepY\n            let y = SHHalf -1\n            if (screenUp < 0)\n                screenUp = 0\n            while (y  >= Math.ceil(screenUp)-1) {\n                if (sourceY < 0) \n                    sourceY = 0\n                const c = source.getPixel(sourceX, sourceY)\n                this.tempScreen.setPixel(screenX, y, c)\n                y--\n                sourceY -= stepY\n            }\n            // from screen half  going down\n            stepY = (source.height - sourceYBreak) / (screenDown - SHHalf)\n            sourceY = sourceYBreak \n            y = SHHalf\n            if (screenDown > SH)\n                screenDown = SH\n            while (y < Math.round(screenDown)) {\n                const c = source.getPixel(sourceX, sourceY)\n                this.tempScreen.setPixel(screenX, y, c)\n                y++\n                sourceY += stepY\n            }\n\n        }\n        \n        render() {\n            // based on https://lodev.org/cgtutor/raycasting.html\n            this.selfXFpx = this.xFpx\n            this.selfYFpx = this.yFpx\n\n            let drawStart = 0\n            let drawHeight = 0\n            let lastDist = -1, lastTexX = -1, lastMapX = -1, lastMapY = -1\n            this.viewZPos = this.spriteMotionZ[this.sprSelf.id].p + (this.sprSelf._height as any as number) - (2 << fpx) + this.cameraOffsetZ_fpx\n            let cameraRangeAngle = Math.atan(this.fov) + .1 //tolerance for spr center just out of camera\n            //debug\n            // const ms=control.millis()\n\n            \n\n\n            const tex = this.textures[1]\n            let rayDirX0 = this.dirXFpx / fpx_scale + (this.planeX / fpx_scale)\n            let rayDirY0 = this.dirYFpx / fpx_scale + (this.planeY / fpx_scale)\n            let rayDirX1 = this.dirXFpx / fpx_scale - (this.planeX / fpx_scale)\n            let rayDirY1 = this.dirYFpx / fpx_scale - (this.planeY / fpx_scale)\n            let fmapX = this.selfXFpx / fpx_scale\n            let fmapY = this.selfYFpx / fpx_scale\n\n            const sc = game.currentScene() \n           // background\n            const speed = 2 // 2: normal speed\n            let backgroundOffset = (this._angle / Math.PI * speed ) % 1  // range -1..1\n            if (backgroundOffset < 0) backgroundOffset++  // range 0..1\n            backgroundOffset *= SW    // range 0..screenwidth\n            \n            //floor\n            for (let y = 60; y < SH; y++) {\n                let p = y - SHHalf\n                let posZ = SH * this.viewZPos / this.tilemapScaleSize / fpx_scale\n                let rowDistance = posZ / p\n                let floorStepX = rowDistance * (rayDirX1 - rayDirX0) / SW\n                let floorStepY = rowDistance * (rayDirY1 - rayDirY0) / SW\n\n\n\n                let floorX = fmapX + rowDistance * rayDirX0\n                let floorY = fmapY + rowDistance * rayDirY0\n                for (let x = 0; x < SW; x++) {\n                      let cellX = Math.floor(floorX)\n                     let cellY = Math.floor(floorY)\n                    let tx =  (16 * (floorX - cellX)) & 15\n                      let ty = (16 * (floorY - cellY)) & (15)\n                    let mapX = Math.round(floorX - 0.5) % 16\n                    let mapY = Math.round(floorY - 0.5) % 16\n                    let tileType = this.map.getTile(mapX, mapY)\n                    let floorTex = this.textures[tileType]\n                    floorX += floorStepX\n                    floorY += floorStepY\n                    let c = floorTex.getPixel(tx, ty)\n                    this.tempScreen.setPixel(x, y, c)\n\n                }\n\n\n\n            }\n            // walls\n\n            for (let x = 0; x < SW; x++) {\n                const cameraX: number = one - Math.idiv(((x + this.cameraOffsetX) << fpx) << 1, SW)\n                let rayDirX = this.dirXFpx + (this.planeX * cameraX >> fpx)\n                let rayDirY = this.dirYFpx + (this.planeY * cameraX >> fpx)\n\n                // avoid division by zero\n                if (rayDirX == 0) rayDirX = 1\n                if (rayDirY == 0) rayDirY = 1\n\n                let mapX = this.selfXFpx >> fpx\n                let mapY = this.selfYFpx >> fpx\n\n                // length of ray from current position to next x or y-side\n                let sideDistX = 0, sideDistY = 0\n\n                // length of ray from one x or y-side to next x or y-side\n                const deltaDistX = Math.abs(Math.idiv(one2, rayDirX));\n                const deltaDistY = Math.abs(Math.idiv(one2, rayDirY));\n\n                let mapStepX = 0, mapStepY = 0\n\n                let sideWallHit = false;\n\n                //calculate step and initial sideDist\n                if (rayDirX < 0) {\n                    mapStepX = -1;\n                    sideDistX = ((this.selfXFpx - (mapX << fpx)) * deltaDistX) >> fpx;\n                } else {\n                    mapStepX = 1;\n                    sideDistX = (((mapX << fpx) + one - this.selfXFpx) * deltaDistX) >> fpx;\n                }\n                if (rayDirY < 0) {\n                    mapStepY = -1;\n                    sideDistY = ((this.selfYFpx - (mapY << fpx)) * deltaDistY) >> fpx;\n                } else {\n                    mapStepY = 1;\n                    sideDistY = (((mapY << fpx) + one - this.selfYFpx) * deltaDistY) >> fpx;\n                }\n\n                let color = 0\n\n                while (true) {\n                    //jump to next map square, OR in x-direction, OR in y-direction\n                    if (sideDistX < sideDistY) {\n                        sideDistX += deltaDistX;\n                        mapX += mapStepX;\n                        sideWallHit = false;\n                    } else {\n                        sideDistY += deltaDistY;\n                        mapY += mapStepY;\n                        sideWallHit = true;\n                    }\n\n                    if (this.map.isOutsideMap(mapX, mapY))\n                        break\n                    color = this.map.getTile(mapX, mapY)\n                    if  (this.map.isWall(mapX, mapY))\n                        break; // hit!\n                }\n\n                if (this.map.isOutsideMap(mapX, mapY))\n                    continue\n\n                let perpWallDist = 0\n                let wallX = 0\n                if (!sideWallHit) {\n                    perpWallDist = Math.idiv(((mapX << fpx) - this.selfXFpx + (1 - mapStepX << fpx - 1)) << fpx, rayDirX)\n                    wallX = this.selfYFpx + (perpWallDist * rayDirY >> fpx);\n                } else {\n                    perpWallDist = Math.idiv(((mapY << fpx) - this.selfYFpx + (1 - mapStepY << fpx - 1)) << fpx, rayDirY)\n                    wallX = this.selfXFpx + (perpWallDist * rayDirX >> fpx);\n                }\n                wallX &= FPX_MAX\n\n                // color = (color - 1) * 2\n                // if (sideWallHit) color++\n\n                const tex = this.textures[color]\n                if (!tex)\n                    continue\n\n                let texX = (wallX * tex.width) >> fpx;\n                // if ((!sideWallHit && rayDirX > 0) || (sideWallHit && rayDirY < 0))\n                //     texX = tex.width - texX - 1;\n\n                const lineHeight = (this.wallHeightInView / perpWallDist)\n                const drawEnd = lineHeight * this.viewZPos / this.tilemapScaleSize / fpx_scale;\n                const horizontBreak = 1 - this.viewZPos / this.tilemapScaleSize / fpx_scale;\n                if (perpWallDist !== lastDist && (texX !== lastTexX || mapX !== lastMapX || mapY !== lastMapY)) {//neighbor line of tex share same parameters\n                     \n                    drawStart = drawEnd - lineHeight * (this._wallZScale) ;\n                    drawHeight = (Math.ceil(drawEnd) - Math.ceil(drawStart) )\n                    drawStart += (SH >> 1)\n\n                    lastDist = perpWallDist\n                    lastTexX = texX\n                    lastMapX = mapX\n                    lastMapY = mapY\n                }\n                //fix start&end points to avoid regmatic between lines\n               \n\n                //if (x < SWHalf)\n                //    this.tempScreen.blitRow(x, drawStart, tex, texX, drawHeight)\n                //else\n                    this.blitRowBreak(x, SHHalf + drawEnd - lineHeight, SHHalf + drawEnd, tex, texX, tex.height * horizontBreak)\n\n                this.dist[x] = perpWallDist\n\n                // background \n                for (let y = 0; y < drawStart; y++ ){\n                    let backX = (backgroundOffset + x) % SW\n                    let c = sc.background.image.getPixel(backX,y)\n                    this.tempScreen.setPixel(x,y,c)\n                }\n            }\n            //debug\n            // info.setScore(control.millis()-ms)\n           // this.tempScreen.print(backgroundOffset.toString(), 0,0,7 )\n           // this.tempScreen.print([Math.roundWithPrecision(this._angle, 3)].join(), 20, 5)\n\n            this.drawSprites()\n        }\n\n        drawSprites() {\n            //debug\n            // let msSprs=control.millis()\n            /////////////////// sprites ///////////////////\n\n            //for sprite\n            const invDet = one2 / (this.planeX * this.dirYFpx - this.dirXFpx * this.planeY); //required for correct matrix multiplication\n\n            this.sprites\n                .filter((spr, i) => {\n                    const spriteX = this.sprXFx8(spr) - this.xFpx // this.selfXFpx\n                    const spriteY = this.sprYFx8(spr) - this.yFpx // this.selfYFpx\n                    this.angleSelfToSpr[spr.id] = Math.atan2(spriteX, spriteY)\n                    this.transformX[spr.id] = invDet * (this.dirYFpx * spriteX - this.dirXFpx * spriteY) >> fpx;\n                    this.transformY[spr.id] = invDet * (-this.planeY * spriteX + this.planeX * spriteY) >> fpx; //this is actually the depth inside the screen, that what Z is in 3D\n                    const angleInCamera = Math.atan2(this.transformX[spr.id] * this.fov, this.transformY[spr.id])\n                    return angleInCamera > -this.cameraRangeAngle && angleInCamera < this.cameraRangeAngle //(this.transformY[spr.id] > 0\n                }).sort((spr1, spr2) => {   // far to near\n                    return (this.transformY[spr2.id] - this.transformY[spr1.id])\n                }).forEach((spr, index) => {\n                    //debug\n                    // this.tempScreen.print([spr.id,Math.roundWithPrecision(angle[spr.id],3)].join(), 0, index * 10 + 10,9)\n                    this.drawSprite(spr, index, this.transformX[spr.id], this.transformY[spr.id], this.angleSelfToSpr[spr.id])\n                })\n\n            //debug\n            // info.setLife(control.millis() - msSprs+1)\n             //this.tempScreen.print([Math.roundWithPrecision(this._angle,3)].join(), 20,  0)\n\n        }\n\n        registerOnSpriteDirectionUpdate(handler: (spr: Sprite, dir: number) => void) {\n            this.onSpriteDirectionUpdateHandler = handler\n        }\n\n        drawSprite(spr: Sprite, index: number, transformX: number, transformY: number, myAngle: number) {\n            const spriteScreenX = Math.ceil((SWHalf) * (1 - transformX / transformY)) - this.cameraOffsetX;\n            const spriteScreenHalfWidth = Math.idiv((spr._width as any as number) / this.tilemapScaleSize / 2 * this.wallWidthInView, transformY)  //origin: (texSpr.width / 2 << fpx) / transformY / this.fov / 3 * 2 * 4\n            const spriteScreenLeft = spriteScreenX - spriteScreenHalfWidth\n            const spriteScreenRight = spriteScreenX + spriteScreenHalfWidth\n\n            //calculate drawing range in X direction\n            //assume there is one range only\n            let blitX = 0, blitWidth = 0\n            for (let sprX = 0; sprX < SW; sprX++) {\n                if (this.dist[sprX] > transformY) {\n                    if (blitWidth == 0)\n                        blitX = sprX\n                    blitWidth++\n                } else if (blitWidth > 0) {\n                    if (blitX <= spriteScreenRight && blitX + blitWidth >= spriteScreenLeft)\n                        break\n                    else\n                        blitX = 0, blitWidth = 0;\n                }\n            }\n            // this.tempScreen.print([this.getxFx8(spr), this.getyFx8(spr)].join(), 0,index*10+10)\n            const blitXSpr = Math.max(blitX, spriteScreenLeft)\n            const blitWidthSpr = Math.min(blitX + blitWidth, spriteScreenRight) - blitXSpr\n            if (blitWidthSpr <= 0)\n                return\n\n            const lineHeight = Math.idiv(this.wallHeightInView, transformY)\n            const drawStart = SHHalf + (lineHeight * ((this.viewZPos - this.spriteMotionZ[spr.id].p - (spr._height as any as number)) / this.tilemapScaleSize) >> fpx)\n\n            //for textures=image[][], abandoned\n            //    const texSpr = spr.getTexture(Math.floor(((Math.atan2(spr.vxFx8, spr.vyFx8) - myAngle) / Math.PI / 2 + 2-.25) * spr.textures.length +.5) % spr.textures.length)\n            //for deal in user code\n            if (this.onSpriteDirectionUpdateHandler)\n                this.onSpriteDirectionUpdateHandler(spr, ((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25))\n            //for CharacterAnimation ext.\n            //     const iTexture = Math.floor(((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25) * 4 + .5) % 4\n            //     const characterAniDirs = [Predicate.MovingLeft,Predicate.MovingDown, Predicate.MovingRight, Predicate.MovingUp]\n            //     character.setCharacterState(spr, character.rule(characterAniDirs[iTexture]))\n            //for this.spriteAnimations\n            const texSpr = !this.spriteAnimations[spr.id] ? spr.image : this.spriteAnimations[spr.id].getFrameByDir(((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25))\n\n            const sprTexRatio = texSpr.width / spriteScreenHalfWidth / 2\n            helpers.imageBlit(\n                this.tempScreen,\n                blitXSpr,\n                drawStart,\n                blitWidthSpr,\n                lineHeight * spr.height / this.tilemapScaleSize,\n                texSpr,\n                (blitXSpr - (spriteScreenX - spriteScreenHalfWidth)) * sprTexRatio\n                ,\n                0,\n                blitWidthSpr * sprTexRatio, texSpr.height, true, false)\n\n            screen.fill(0)\n            const fpx_div_transformy = Math.roundWithPrecision(transformY / 4 / fpx_scale, 2)\n            const height = (SH / fpx_div_transformy)\n            const blitXSaySrc = ((blitX - spriteScreenX) * fpx_div_transformy) + SWHalf\n            const blitWidthSaySrc = (blitWidth * fpx_div_transformy)\n\n            //sprite\n            // screen.drawImage(texSpr, SWHalf-texSpr.width/2, SHHalf)\n            //sayText\n            const sayRender = this.sayRederers[spr.id]\n            if (sayRender) {\n                if (this.sayEndTimes[spr.id] && control.millis() > this.sayEndTimes[spr.id]) {\n                    this.sayRederers[spr.id] = undefined\n                } else {\n                    this.tempSprite.x = SWHalf\n                    this.tempSprite.y = SHHalf + 2\n                    this.camera.drawOffsetX = 0\n                    this.camera.drawOffsetY = 0\n                    sayRender.draw(screen, this.camera, this.tempSprite)\n                }\n            }\n            //particle\n            const particle = this.spriteParticles[spr.id]\n            if (particle) {\n                if (particle.lifespan) {\n                    //debug\n                    // this.tempScreen.print([spr.id].join(), 0,index*10+10)\n                    this.tempSprite.x = SWHalf\n                    this.tempSprite.y = SHHalf + spr.height\n                    this.camera.drawOffsetX = 0//spr.x-SWHalf\n                    this.camera.drawOffsetY = 0//spr.y-SH\n                    particle.__draw(this.camera)\n                } else {\n                    this.spriteParticles[spr.id] = undefined\n                }\n            }\n            //update screen for this spr\n            // const sayTransformY = \n            if (blitXSaySrc <= 0) { //imageBlit considers negative value as 0\n                helpers.imageBlit(\n                    this.tempScreen,\n                    spriteScreenX - SWHalf / fpx_div_transformy, drawStart - height / 2, (blitWidthSaySrc + blitXSaySrc) / fpx_div_transformy, height,\n                    screen,\n                    0, 0, blitWidthSaySrc + blitXSaySrc, SH, true, false)\n            } else {\n                helpers.imageBlit(\n                    this.tempScreen,\n                    // blitX, drawStart - height / 2 , blitWidth, height,\n                    blitX, drawStart - height / 2, blitWidth, height,\n                    screen,\n                    blitXSaySrc, 0, blitWidthSaySrc, SH,\n                    true, false)\n            }\n        }\n    }\n\n    //%fixedinstance\n    export const raycastingRender = new Render.RayCastingRender()\n}\n\n","tilemap.g.jres":"{\n    \"transparency16\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true\n    },\n    \"tile1\": {\n        \"data\": \"hwQQABAAAABBbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfQ==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile\"\n    },\n    \"tile2\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile0\"\n    },\n    \"tile3\": {\n        \"data\": \"hwQQABAAAAB34AAAAAAAAACeAAAAAAAAcOcAAAAAAAAA4AAAAAAAAHcHDgAAAAAA4O4AAAAAAAB34OAAAAAAAADu4AAAAAAAcAfuAAAAAAAH5w4AAAAAAHcADgAAAAAAB+fpAAAAAAB3DgAAAAAAAADgAAAAAAAAd+cOAAAAAAAHDgAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile1\"\n    },\n    \"tile5\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALsLAAAAAAAAuwsAAAAAAAC7CwAAAAAAALv7AAAAAAAAu/vd3d3dDQC7+wAAAAAAALsLAAAAAAAAuwsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile3\"\n    },\n    \"tile6\": {\n        \"data\": \"hwQQABAAAAAkL/QiJCIvJP8v8iQiJP//JE/y//8iT0JCL/IiIiRPIiQv8iIkIi8iIi8iIiJCLyQiL/T//yIvQv8vIi8kQv//Qi8i8iIkLyJCT/L//yIvRCIvIiIiQk8iJC/0QiIiLyRCL/IiQkIvQiQv8v//Ii8k/y/yIiJC//8iT/IiJCIvJA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile4\"\n    },\n    \"tile8\": {\n        \"data\": \"hwQQABAAAAAPAAAAAAAPAA/w//8AAA8A/w8AAP//AAAADwAA/wAAMAAPAAAPAAAAAA8AAA//AAAADwAADwAAAPDw//8AAAAADwAAAP////8PAAAA/////wDw//8AAAAAAA8AAA8AAAAADwAADwAAAAAPAAAPAAAAAA8AAA8AAAAA8P//AAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile6\"\n    },\n    \"tile7\": {\n        \"data\": \"hwQQABAAAAAfERERERER8R8RERERERHx/xEREREREf//mZmZmZmZ//+qqqqqqqr//5mZmZmZmf//mZmZmZmZ//+Zn//5n5n//5mf//mfmf//mZmZmZmZ//+ZmZmZmZn//6qqqqqqqv//mZmZmZmZ//8RERERERH/HxEREREREfEfERERERER8Q==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile5\"\n    },\n    \"tile4\": {\n        \"data\": \"hwQQABAAAADGxsbGxsbGxsbGxv//xsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxvbGxs/Gxg==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile2\"\n    },\n    \"tile9\": {\n        \"data\": \"hwQQABAAAACxu//P/f+7G7G7+8u7v7sbEbv7y7u/uxERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERG7u8u7u7sRsbu7y7u7uxuxu7vLvbu7Gw==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile7\"\n    },\n    \"tile10\": {\n        \"data\": \"hwQQABAAAAAdERGxu7u7u9Hd3b0dERGx0d3dvdHd3b3R3d290d3dvdHd3b3R3d290d3dvdHd3b3R3d3d0d3dvbu7u+3R3bvbHRERsbu7Ee3R3d29HdHd3dHd3b3R3d290d3dvdHd3b3R3d290d3dvdHd3b3R3d290d3d3dHd3b27u7vtu7u77Q==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile8\"\n    },\n    \"tile11\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile9\"\n    },\n    \"tile12\": {\n        \"data\": \"hwQQABAAAAAfEf8f/x8R8R8R8RHxERHx/xEREREREf//mZmZmZmZ//+qqqqqqqr//5mZmZmZmf//mZmZmZmZ//+Zn//5n5n//5mf//mfmf//mZmZmZmZ//+ZmZmZmZn//6qqqqqqqv//mZmZmZmZ//8RERERERH/HxEREREREfEfERERERER8Q==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile10\"\n    },\n    \"level1\": {\n        \"id\": \"level1\",\n        \"mimeType\": \"application/mkcd-tilemap\",\n        \"data\": \"MTAxMDAwMTAwMDAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMjAyMDIwMTA0MDMwMTAxMDIwMjAyMDIwMjAxMDMwMzAyMDIwMjAxMDEwNTAxMDEwMjAyMDIwMjAyMDEwMzAzMDEwMjAyMDEwNzA2MDEwMTAyMDIwMjAyMDIwMTAzMDMwMzA0MDQwMTAxMDMwMTAxMDIwMjAyMDIwMjAxMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAzMDMwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDMwMzAxMDEwMTAxMDIwMjAyMDIwMjAxMDEwMTAxMDEwMzAzMDEwMTAxMDEwMjAyMDIwMjAyMDEwMjAyMDIwMjAzMDMwMTAxMDEwMTAyMDIwMjAyMDIwMTAyMDIwMjAyMDMwMzAyMDIwMTAxMDIwMjAyMDIwMjAxMDIwMjAyMDIwMzAzMDIwMjAxMDEwMjAyMDIwMjAyMDEwMjAyMDIwMjAzMDMwMjAyMDEwMTAxMDEwMTAxMDEwMTAyMDIwMjAyMDMwMzAyMDIwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMjIyMjIyMjIyMjIyMjIyMjAyMDAyMDAyMDAwMDAwMjAwMjAwMDAwMjAwMDAwMDIwMDIwMDAwMDIwMDAwMDAyMDIyMjIwMDAyMDAwMDAwMjAyMjIyMjIyMjIyMjIyMjIyMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMjIyMjIyMjIyMjIyMjIyMg==\",\n        \"tileset\": [\n            \"myTiles.transparency16\",\n            \"sprites.dungeon.floorLight0\",\n            \"sprites.dungeon.floorLight1\",\n            \"sprites.dungeon.floorDark0\",\n            \"myTiles.tile7\",\n            \"myTiles.tile4\",\n            \"myTiles.tile9\",\n            \"myTiles.tile10\"\n        ],\n        \"displayName\": \"level\"\n    },\n    \"*\": {\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"dataEncoding\": \"base64\",\n        \"namespace\": \"myTiles\"\n    }\n}","tilemap.g.ts":"","pxt.json":"{\n    \"name\": \"3d floor and background - Copy\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"device\": \"*\",\n        \"sprite-scaling\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"assets.json\",\n        \"_animation.ts\",\n        \"_render_blocks.ts\",\n        \"_render_raycasting.ts\",\n        \"tilemap.g.jres\",\n        \"tilemap.g.ts\"\n    ],\n    \"targetVersions\": {\n        \"branch\": \"v1.10.36\",\n        \"tag\": \"v1.10.36\",\n        \"commits\": \"https://github.com/microsoft/pxt-arcade/commits/3a5a7e13703edf0412c17bdb9b1469e282a5b31b\",\n        \"target\": \"1.10.36\",\n        \"pxt\": \"8.3.9\"\n    },\n    \"preferredEditor\": \"blocksprj\"\n}\n"}},{"timestamp":1763747116809,"editorVersion":"2.0.62","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable type=\"KIND_SpriteKind\" id=\"USZ`q|D]$0kk|,E!b7c6\">Player</variable><variable type=\"KIND_SpriteKind\" id=\"@8#W0|ESmtdS+3`?Z+:+\">Projectile</variable><variable type=\"KIND_SpriteKind\" id=\"h1jvB:JPL=NMGpJB=4/[\">Food</variable><variable type=\"KIND_SpriteKind\" id=\"(3Y]|wk94c4t/c`pc((X\">Enemy</variable><variable type=\"KIND_SpriteKind\" id=\"2B=HiFZ(Kz-^Ln6ox1L~\">Help</variable><variable id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</variable><variable id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</variable><variable id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</variable><variable id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</variable><variable id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</variable><variable id=\"[a3#yOs:sosi5Zk_px6P\">mySprite3</variable><variable id=\"i:_MCpc`P;?/}W#x|ztg\">Shell</variable></variables><block type=\"function_definition\" x=\"320\" y=\"-841\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation><field name=\"function_name\">Summon alien</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Enemy</field></shadow></value></block></value><next><block type=\"run_image_animation\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field></block></value><value name=\"frames\"><shadow type=\"animation_editor\"><field name=\"frames\">[img`\n........................\n........................\n........................\n........................\n........................\n..........ffff..........\n........ff1111ff........\n.......fb111111bf.......\n.....fffc1111111f.......\n...fc111cd1111111f......\n...f1b1b1b1111dddf......\n...fbfbffcf11fcddf......\n......fcf111111bbf......\n.......ccbdb1b1fcf......\n.......fffbfbfdff.......\n........ffffffff........\n........fffffffffff.....\n.........fffffc111cf....\n.........fffff1b1b1f....\n..........ffffbfbfbf....\n...........ffff.........\n........................\n........................\n........................\n`,img`\n........................\n........................\n........................\n........................\n........................\n..........ffff..........\n........ff1111ff........\n.......fb111111bf.......\n.......f11111111f.......\n......fd11111111df......\n....7.fd11111111df......\n...7..fd11111111df......\n...7..fd11111111df......\n...7..fddd1111dddff.....\n...77.fbdbfddfbdbfcf....\n...777fcdcf11fcdcfbf....\n....77fffbdb1bdffcf.....\n....fcb1bcffffff........\n....f1c1c1ffffff........\n....fdfdfdfffff.........\n.....f.f.f..............\n........................\n........................\n........................\n`,img`\n........................\n........................\n........................\n........................\n..........ffff..........\n........ff1111ff........\n.......fb111111bf.......\n.......f11111111f.......\n......fd111111111f......\n......fd11111111df......\n......fd11111111df......\n......fcdd1111ddcff.....\n.......fbcf11fcbfbbf....\n.......ffbdb1bdffff.....\n........fcbfbfdf........\n........ffffffff........\n......ffffffffff........\n.....fcb1bcffff.........\n......ffbff.............\n........................\n........................\n........................\n........................\n........................\n`,img`\n........................\n........................\n........................\n........................\n..........ffff..........\n........ff1111ff........\n.......fb111111bf.......\n.......f11111111f.......\n......fd11111111df......\n......fdd111111ddf......\n......fbdd1111dddf......\n......fcdbfddfbdbf......\n.......fbcf11fcbfff.....\n.......ffb1111bcfbcf....\n........fcdb1bdfbbbf....\n.......ffffffffffcf.....\n.....fcb1bcfffff........\n.....f1b1b1ffff.........\n......ffbff.............\n........................\n........................\n........................\n........................\n........................\n`]</field><data>{\"commentRefs\":[],\"fieldData\":{\"frames\":null}}</data></shadow></value><value name=\"frameInterval\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><value name=\"loop\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">14</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"1323\" y=\"-679\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile8`</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile10`</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"mapsetwallat\"><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">false</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Top</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Uh oh. An alien has breached the base.</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Bottom</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Press A to shoot.</field></shadow></value><next><block type=\"function_call\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block></statement></block><block type=\"keyonevent\" x=\"25\" y=\"-366\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_toggleViewMode\"></block></statement></block><block type=\"keyonevent\" x=\"481\" y=\"-200\"><field name=\"button\">controller.A</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"i:_MCpc`P;?/}W#x|ztg\">Shell</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . b b . . . . . . . \n. . . . . . b 9 9 b . . . . . . \n. . . . . . b c 9 b . . . . . . \n. . . . . . . b b . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value></block></value></block></statement></block><block type=\"spriteshittile\" x=\"37\" y=\"32\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></statement></block><block type=\"pxt-on-start\" x=\"-323\" y=\"175\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"rcRender_getRenderSpriteVariable\"></block></value><next><block type=\"rcRender_moveWithController\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"2\" _input_init=\"true\"></mutation><value name=\"v\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">2</field></shadow></value><value name=\"va\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">3</field></shadow></value><value name=\"cameraSway\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">You have been abandoned by your crew and trapped on the moon base</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Try and find a way out before the asteroid hits</field></shadow></value><next><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff99d99bbbbbcfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff99ddbdd66168bcccccc9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff999ddbbbd66888111ccccccb99fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9966ddbbbb6688811818ccccccbbc99fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdd69dddbbb66618881888818818cccccbe9fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffddd96dd6b6dbd68888888888888888cccccc99fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffdbbd9666666dbb668886888888cccccccccccccc9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffdbbb99666966d68866888888cccccccccccccccccc69ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffdbbb999669666666888888888ccccbbbcc8bcccccccccc9fffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffdbbb999666666666888888888cbbcbe8bbbcbcccccbbcccb9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffff9bbb999666666666688888888bccb888888bbbbb88888bcccccfffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffdbbb999669666666866888868bbbbb8888888ccc888b88bbc8cccffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffdbbb9d99ddd666668868888688bbcb888888888bc888bcc8bc886c9fffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffbbbbbbddd966666888688888888888888b88888888888cc8ccc886c9ffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffdbbbbbbdd6966666666868888888888bbdbbebb8888888888bcc8c86c9fffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffff9bbdbddd6666666666888688868888ddddddddde8888888888bccbbccccfffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffff9dbb9dd666666666668868888888bddddddbdbbddcccccd88b8ebccbbbbc9ffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffdd99999666666666668868888888bdddddbbbbbdbbbccccccb8bbbccc8bbb9fffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffff9dd99996696966666666668888bbbdddddbbbddbbbbbbbbbcccc8bcccbb8bbcfffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffff9d999996666966666668688888bbdddbbbbdbbbbbbbbbbbcccccc8bbccc88bc9ffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff99999999666996696668868868bbdddddbbbdbbbbbbbbbbbbcbccc88bcccc88c6ffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff999996696669666966d8868666bddbbbddbbdbbbbbbbbbbbbcccccc88bbccc8869fffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff9999996699669666666d6688668bddbbdbbbbbbbbbbbbbbbbbccccccc88bcccc866fffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff9dd999669966666666666688668bdddbbbbbbbbbbbbbbbbbbbccccccc888bbccc669ffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff999999669d69666666666688868bddbbbdbbbbbbbbbbbbbbbbcccccccc888bbcc869ffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99999996ddd69666666688888868ddbddbbbbbbbbbbbbbbbbbbccccccccc888888866ffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff999999969ddd6669666688688888bbbbbbbbbbbbbbbbbbbbbbbbccbccccc8888888869fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99999966ddddd669666688888888bbbbbbbbbbbbbbbbbbbbbbbcbccccccccc88888869fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff999bb99666dddd6666666668886888bbbbbbbbbbbbbbbbbbbbbbcccccccccccc8888889fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbbb966696666666666888886888bbbbbbbbbbbbbbbbbbbbbbcbccccccccccc888886fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbdbb666969666666668888868888bbbbbbbbbbbbbbbbbbbbccbccccccccccc8888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99dbbbbb6696966666666668886868888bbbbeb888bbbbbbbbbcccccccccccccc8888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbbbbbe6969666666666888888888888888888888bbbbbbbbccccccccccccc88888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbccbc66966666666688888688888888888d888ebbbbbbbcccccccccccbb88888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbbcc69996666688668886888888dd88dbbd88bbbbbbbccccccccccceb88888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbbccc999966668868888888888ddddbbbbd88cbbbbbbbbccccccccc8888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9ebbbbcccccccc9966666688888888888888ddbbbb888bbbbbbbbccccccccc8888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbccccccccc666666888866888888888dddddbdd88bbbbbbccccccccc88888888bb9ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffbbbbbbcccccccccc6666688888888888888888d8888888bbbbbbccccccccc88888888bb9ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9dbbbbccbbccccccb666688868888888888888888888888bbbbbccccccccc888888888b9ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9dbbbbbbbbcccccbb66666688888888888888888888888bbbbccccccccccc88888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbcccccccb666666688888888888888888888888bbbbcccccccccc888888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbccccccbb666666688888888888888888888888bbbbcccccccccc88888888886fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbbbbbbbccccb6666668888888888888888888888888bbbbcbcccccccc88888888886fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99dbbbcbbccccb6666668888888888888888888888888bbbbbccccccccc888cc888869fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99dbbbcccccccc6666668688688888888888888888888bbbbccccccccc8888cc888869fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff999bbbbbccccbc6666666688688888888888888888888bbbbcccccccc88888dd88886ffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff969bbbbbbcccc69666666668688868888888888888888bbbbccccccc88888bd888886ffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff99bbbbcccccc696bb668888888868888888888888888bbbcccccccc8888bbd888869ffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff9999bbbcccc9666dbbb8888888888888888888888888ccbcccccccc8888bc888886fffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff699bbbbccc966966bbb8888888888888888888888888bbbbccccc88888bcc88869fffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff9999bbcccc666666dbbdd88888888688888888888888bbcccccc88888888888669fffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff9699dbcccc66666666bb6d8888888688888888888888bbcccccc8888888888869ffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffff9696bbbcc66666666dbbd6886868888888888888888bbcbccc8888888888d669ffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffff999ebbccc666666666dbb8868888688888888888888bbbccc8888888889b69fffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffff969ccbcc66996666666bbb868888888888888888888bbbc888888888888b6ffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffff96ccccc966966666666bb8688666888888888888888b8888888888888699ffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffff99ccbc996666666666dbb6888668888888888888888888888888888869fffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffff969ccb9666666666666dbb88866888888888888888888888888888869ffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffff969ccc6696666666666dd8888668888888888888888888888888866fffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffff969cc9669666966d66dd8888868888888888888888888bb8888669fffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffff96ccc66699669dddd888868888888888888888888888be888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffff96c66669966666dd88886666668888888888888888dd888669fffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffff96966669966ddd686886868888888888888888888d888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffff969666696666666688686888888888888888888888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffff9966966966666666886888888888888886888888669fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9699996666666888888888888888888118888699ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff969996666668888881188888888881888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff996999666688881818888888881886669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9961161186618811188886116699ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff99161111611118111666699fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9999661166669999ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff999999999fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</field><value name=\"VALUE\"><shadow type=\"math_number\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\nf f f f f f f f f f f f f f f f \n1 1 f f f f f f f f f f f f 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 f f 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 1 1 9 a 9 9 9 9 a 9 1 1 1 1 \n1 1 f f f f f f f f f f f f 1 1 \nf f f f f f f f f f f f f f f f \n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value></block></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow><block type=\"screen_image_picker\"><field name=\"img\">img`\nf c . . . . . . . . . . . . c f \nc f c . . . . . . . . . . c f c \n. c f c . . . . . . . . c f c . \n. . c f c c . . . . . c f c . . \n. . . c f c . . . . c f c . . . \n. . . . c f c . . c f c . . . . \n. . . . . c 1 . . 1 c . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . c 1 . . 1 c . . . . . \n. . . . c f c . . c f c . . . . \n. . . c f c . . . . c f c . . . \n. . c f c . . . . . . c f c . . \n. c f c . . . . . . . . c f c . \nc f c . . . . . . . . . . c f c \nf c . . . . . . . . . . . . c f \n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value></block></value><next><block type=\"spritesetsetflag\"><field name=\"flag\">SpriteFlag.RelativeToCamera</field><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</field></block></value><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spritesoverlap\" x=\"555\" y=\"510\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value><statement name=\"HANDLER\"><block type=\"variables_change\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><next><block type=\"spritedestroy2\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"effect\">effects.spray</field><value name=\"sprite\"><block type=\"argument_reporter_custom\"><mutation typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow></value><next><block type=\"hudsetScore\"><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></next></block></statement></block><block type=\"keyonevent\" disabled-reasons=\"MANUALLY_DISABLED\" x=\"-64\" y=\"869\"><field name=\"button\">controller.A</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_jumpWithHeightAndDuration\" disabled-reasons=\"MANUALLY_DISABLED\"><value name=\"spr\"><block type=\"variables_get\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field></block></value><value name=\"height\"><shadow type=\"math_number_minmax\" disabled-reasons=\"MANUALLY_DISABLED\"><mutation min=\"0\" max=\"100\" label=\"Height\" precision=\"0\"></mutation><field name=\"SLIDER\">16</field></shadow></value><value name=\"duration\"><shadow type=\"timePicker\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"ms\">1000</field></shadow></value></block></statement></block></xml>","main.ts":"","README.md":" ","assets.json":"","_animation.ts":"//////////////////////// animation.ts contents of previous version, just for test.ts here for convenience /////////////////////\n// file contents:\n// directional animations defines for enging_raycasting.ts\n// for convenience, constructed animations as below, which images are builtin in Arcade, \n// in order from easy to complex\n\n// each are 2D Image array, Image[][]: \n// 1st dimension is direction: \n//    length=1 to any, e.g. 1,2,3,4,...,8,..., engine can automatically arange them to 0~360 \n//    order: start from left, then folling with others in CW order\n//    e.g: \n//         2 directions should be [leftAni,RightAni], \n//         4-direction should be [leftAni, frontAni, rightAni, backAni], \n//         8-direction=[l,lf,f,fr,r,rb,b,lb], ...\n//    the reason that directions start from left, is almost all Arcade builtin one side images are facing left, so that would be convient for using.\n// 2nd dimension is animation Images\n//    length=1 to any, e.g. 1,2,3,4,..., engine will automatically loop them by aniInterval(set when create CompactSprite, or use default)\n\n\n//simplest, just one static image, looks the same in all angle of view\nconst texturesDonut = [[sprites.food.smallDonut]]\nconst texturesBigCake = [[sprites.food.bigCake]]\n\n//1-direction, with ani, looks the same Ani in all angle of view\nconst texturesCoin = [[sprites.builtin.coin0, sprites.builtin.coin1, sprites.builtin.coin2, sprites.builtin.coin3, sprites.builtin.coin4, sprites.builtin.coin5]]\n\nconst texturesDog = [[sprites.builtin.dog0, sprites.builtin.dog1, sprites.builtin.dog2]]\nconst texturesDuck = [[sprites.duck.duck1, sprites.duck.duck2, sprites.duck.duck3, sprites.duck.duck4, sprites.duck.duck5, sprites.duck.duck6]]\n\n//2-direction, with ani, looks difference from left or right side\nconst texturesPlane = [[sprites.vehicle.plane0, sprites.vehicle.plane1, sprites.vehicle.plane2, sprites.vehicle.plane3, sprites.vehicle.plane4, sprites.vehicle.plane5],\n[sprites.vehicle.plane0, sprites.vehicle.plane1, sprites.vehicle.plane2, sprites.vehicle.plane3, sprites.vehicle.plane4, sprites.vehicle.plane5]]\n//no right side ani images builtin, so make them from lefts, and then flipX\nimagesFlipX(texturesPlane[1])\n\nconst texturesFish = [[sprites.builtin.angelFish0, sprites.builtin.angelFish1, sprites.builtin.angelFish2, sprites.builtin.angelFish3],\n[sprites.builtin.angelFish0, sprites.builtin.angelFish1, sprites.builtin.angelFish2, sprites.builtin.angelFish3]]\nimagesFlipX(texturesFish[1])\n\n//4-direction\nconst texturesHero = [\n    [sprites.castle.heroWalkSideLeft1, sprites.castle.heroWalkSideLeft2, sprites.castle.heroWalkSideLeft3, sprites.castle.heroWalkSideLeft4],\n    [sprites.castle.heroWalkFront1, sprites.castle.heroWalkFront2, sprites.castle.heroWalkFront3, sprites.castle.heroWalkFront4],\n    [sprites.castle.heroWalkSideRight1, sprites.castle.heroWalkSideRight2, sprites.castle.heroWalkSideRight3, sprites.castle.heroWalkSideRight4],\n    [sprites.castle.heroWalkBack1, sprites.castle.heroWalkBack2, sprites.castle.heroWalkBack3, sprites.castle.heroWalkBack4],\n]\n\nconst texturesPrincess2 = [\n    [sprites.castle.princess2Left1, sprites.castle.princess2Left2],\n    [sprites.castle.princess2WalkFront1, sprites.castle.princess2WalkFront2, sprites.castle.princess2WalkFront3, sprites.castle.princess2WalkFront2],\n    [sprites.castle.princess2Right1, sprites.castle.princess2Right2],\n    [sprites.castle.princess2WalkBack1, sprites.castle.princess2WalkBack2, sprites.castle.princess2WalkBack3, sprites.castle.princess2WalkBack2],\n]\n\n//4-direction, but back side has only 1 image, so no ani when looking from back\nconst texturesSkelly = [\n    [sprites.castle.skellyWalkLeft1, sprites.castle.skellyWalkLeft2],\n    [sprites.castle.skellyWalkFront1, sprites.castle.skellyWalkFront2, sprites.castle.skellyWalkFront3],\n    [sprites.castle.skellyWalkRight1, sprites.castle.skellyWalkRight2],\n    [img`\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ..........ffff..........\n\t        ........ff1111ff........\n\t        .......fb111111bf.......\n\t        .......f11111111f.......\n\t        ......fd11111111df......\n\t        ......fd11111111df......\n\t        ......fd11111111df......\n\t        ......fb11111111bf......\n\t        ......fcd111111dcf......\n\t        .......fb111111bf.......\n\t        .....ffffdb1bdcfff......\n\t        ....fc111cfbfbc111cf....\n\t        ....f11111ffff11111f....\n\t        ....fbfbfbffffffbfbf....\n\t        .........ffffff.........\n\t        ..........fff...........\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ........................\n\t    `],\n]\n\nconst texturesPrincess = [\n    [sprites.castle.princessLeft0, sprites.castle.princessLeft1, sprites.castle.princessLeft0, sprites.castle.princessLeft2],\n    [sprites.castle.princessFront0, sprites.castle.princessFront1, sprites.castle.princessFront0, sprites.castle.princessFront2],\n    [],\n    [sprites.castle.princessBack0, sprites.castle.princessBack1, sprites.castle.princessBack0, sprites.castle.princessBack2],\n]\ntexturesPrincess[0].forEach((v, i) => {\n    texturesPrincess[2].push(v.clone())\n    texturesPrincess[2][i].flipX()\n}\n)\n\nfunction imagesFlipX(ani: Image[]) {\n    ani.forEach((img, i) => {\n        ani[i] = img.clone() //don't worry memery leak or waste, cause old images are still using by left\n        ani[i].flipX()\n    })\n}\n\n//////////////////////// end of animation.ts contents of previous version //////////////\n\n\n","_render_blocks.ts":"enum RCSpriteAttribute {\n    ZOffset,\n    ZPosition,\n    ZVelocity,\n    ZAcceleration\n}\n/**\n * A 2.5D Screen Render, using Raycasting algorithm\n **/\n//% color=#03AA74 weight=1 icon=\"\\uf1b2\" //cube f1b2 , fold f279\n//% groups='[\"Instance\",\"Basic\", \"Dimension Z\", \"Animate\", \"Advanced\"]'\n//% block=\"3D Render\"\nnamespace Render {\n    export enum attribute {\n        dirX,\n        dirY,\n        fov,\n        wallZScale,\n    }\n\n    export class Animations {\n        constructor(public frameInterval: number, public animations: Image[][]) {\n        }\n\n        msLast = 0\n        index = 0\n        iAnimation = 0\n        getFrameByDir(dir: number): Image {\n            if (control.millis() - this.msLast > this.frameInterval) {\n                this.msLast = control.millis()\n                this.index++\n                this.iAnimation = Math.round((dir * this.animations.length)) % this.animations.length\n                if (this.index >= this.animations[this.iAnimation].length)\n                    this.index = 0\n            }\n            return this.animations[this.iAnimation][this.index]\n        }\n    }\n\n    /**\n * Apply a directional image animations on a sprite\n * @param sprite the sprite to animate on\n * @param animations the directional animates\n */\n    //% blockId=set_animation\n    //% block=\"set $sprite=variables_get(mySprite) with animations$animations\"\n    //% animations.shadow=create_animation\n    //% group=\"Animate\"\n    //% weight=100\n    //% help=github:pxt-raycasting/docs/set-sprite-animations\n    export function setSpriteAnimations(sprite: Sprite, animations: Animations) {\n        raycastingRender.spriteAnimations[sprite.id] = animations\n    }\n\n    /**\n * Create a directional image animations, multi animations will applied to one round dirctions averagely, start from the left. \n * The reason that directions start from left, is almost all Arcade out-of-box 1 or 2-dirction images are facing left, so that would be convient for using.\n * @param frameInterval the time between changes, eg: 150\n * @param frames1 animation, if this is the first of multi animation it will be used as left, others will \n * @param frames2 optional, used for 2 or more dirctional\n * @param frames3 optional, used for 3 or more dirctional\n * @param frames4 optional, used for 4 or more dirctional\n */\n    //% blockId=create_animation\n    //% block=\"interval$frameInterval=timePicker animates:$frames1=animation_editor|| $frames2=animation_editor $frames3=animation_editor $frames4=animation_editor\"\n    //% inlineInputMode=inline\n    //% group=\"Animate\"\n    //% weight=100\n    //% help=github:pxt-raycasting/docs/create-animations\n    export function createAnimations(frameInterval: number, frames1: Image[], frames2?: Image[], frames3?: Image[], frames4?: Image[]): Animations {\n        const animationList = [frames1]\n        if (frames2) animationList.push(frames2)\n        if (frames3) animationList.push(frames3)\n        if (frames4) animationList.push(frames4)\n        return new Animations(frameInterval, animationList)\n    }\n\n    /**\n     * Get the Render\n     * @param img the image\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRCRenderInstance block=\"raycasting render\"\n    //% expandableArgumentMode=toggle\n    //% weight=100 \n    //% blockHidden=true\n    //% hidden=1\n    export function getRCRenderInstance(): RayCastingRender {\n        return raycastingRender\n    }\n\n    /**\n     * Get the render Sprite, which create automatically, for physical collisions, and holding the view point.\n     * You can consider it as \"myself\", and operate it like a usual sprite, eg.: position, speed, scale, collision, ...\n     * But properties relative 3D, eg. ZOffset, ZPosition, viewAngle, and etc. are not in the Sprite class.\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRenderSpriteVariable block=\"myself sprite\"\n    //% expandableArgumentMode=toggle\n    //% blockSetVariable=mySprite\n    //% weight=99\n    //% help=github:pxt-raycasting/get-render-sprite-variable\n    export function getRenderSpriteVariable(): Sprite {\n        return raycastingRender.sprSelf\n    }\n\n    /**\n     * Get the render Sprite, which create automatically, for physical collisions, and holding the view point.(but get/set view direction with dirX/dirY, which not in the Sprite class) \n     * You can consider it as \"myself\", and operate it like a usual sprite.\n     * eg: position, speed, scale, collision, ...\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRenderSpriteInstance block=\"myself sprite\"\n    //% expandableArgumentMode=toggle\n    //% weight=98\n    //% help=github:pxt-raycasting/docs/get-render-sprite-instance\n    export function getRenderSpriteInstance(): Sprite {\n        return raycastingRender.sprSelf\n    }\n\n    /**\n     * Toggle current view mode\n     */\n    //% blockId=rcRender_toggleViewMode block=\"toggle current view mode\"\n    //% group=\"Basic\"\n    //% weight=89\n    //% help=github:pxt-raycasting/docs/toggle-view-mode\n    export function toggleViewMode() {\n        raycastingRender.viewMode = raycastingRender.viewMode == ViewMode.tilemapView ? ViewMode.raycastingView : ViewMode.tilemapView\n    }\n\n    /**\n     * Current view mode is the specific one?\n     * @param viewMode\n     */\n    //% blockId=rcRender_isViewMode block=\"current is $viewMode\"\n    //% group=\"Basic\"\n    //% weight=88\n    //% help=github:pxt-raycasting/docs/is-view-mode\n    export function isViewMode(viewMode: ViewMode): boolean {\n        return viewMode == raycastingRender.viewMode\n    }\n\n    /**\n     * Set view mode\n     * @param viewMode\n     */\n    //% blockId=rcRender_setViewMode block=\"set view mode $viewMode\"\n    //% group=\"Basic\"\n    //% weight=87\n    //% help=github:pxt-raycasting/docs/set-view-mode\n    export function setViewMode(viewMode: ViewMode) {\n        raycastingRender.viewMode = viewMode\n    }\n\n    /**\n     * Get render arribute\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"get %attribute\" \n    //% blockId=rcRender_getAttribute\n    //% weight=83\n    //% help=github:pxt-raycasting/docs/get-attribute\n    export function getAttribute(attr: attribute): number {\n        switch (attr) {\n            case attribute.dirX:\n                return raycastingRender.dirX\n            case attribute.dirY:\n                return raycastingRender.dirY\n            case attribute.fov:\n                return raycastingRender.fov\n            case attribute.wallZScale:\n                return raycastingRender.wallZScale\n            default:\n                return 0\n        }\n    }\n\n    /**\n     * Set render arribute\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"set %attribute = %value\" \n    //% blockId=rcRender_setAttribute\n    //% weight=82\n    //% help=github:pxt-raycasting/docs/set-attribute\n    export function setAttribute(attr: attribute, value: number) {\n        switch (attr) {\n            case attribute.dirX:\n                raycastingRender.dirX = value\n                break\n            case attribute.dirY:\n                raycastingRender.dirY = value\n                break\n            case attribute.fov:\n                if (value < 0) value = 0\n                raycastingRender.fov = value\n                break\n            case attribute.wallZScale:\n                if (value < 0) value = 0\n                raycastingRender.wallZScale = value\n                break\n            default:\n        }\n    }\n\n    /**\n     * Get default FOV (field of view) value\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"defaultFov\"\n    //% blockId=rcRender_getDefaultFov\n    //% weight=81\n    //% help=github:pxt-raycasting/docs/get-default-fov\n    export function getDefaultFov(): number {\n        return defaultFov\n    }\n\n    /**\n     * Set view angle\n     * @param angle, unit: degree 0~360\n     */\n    //% blockId=rcRender_setViewAngleInDegree block=\"set view angle$angle\"\n    //% angle.min=0 angle.max=360 angle.defl=90\n    //% group=\"Basic\"\n    //% weight=80\n    //% help=github:pxt-raycasting/docs/set-view-angle-in-degree\n    export function setViewAngleInDegree(angle: number) {\n        raycastingRender.viewAngle = angle * Math.PI / 180\n    }\n\n    /**\n     * Set view angle by dirX and dirY\n     * @param dirX\n     * @param dirY\n     */\n    //% blockId=rcRender_setViewAngle block=\"set view angle by dirX%dirX and dirY%dirY\"\n    //% group=\"Basic\"\n    //% weight=79\n    //% help=github:pxt-raycasting/docs/set-view-angle\n    export function setViewAngle(dirX: number, dirY: number) {\n        raycastingRender.viewAngle = Math.atan2(dirY, dirX)\n    }\n\n    /**\n     * Set floating offset height for a sprite at Z direction\n     * @param sprite\n     * @param Zoffset Negative floats down, affirmative goes up\n     * @param duration moving time, 0 for immediately, unit: ms\n     */\n    //% blockId=rcRender_setZOffset block=\"set Sprite %spr=variables_get(mySprite) floating %offset pixels|| duration $duration=timePicker|ms \"\n    //% offset.min=-100 offset.max=100 offset.defl=8\n    //% duration.min=0 duration.max=5000 duration.defl=0\n    //% group=\"Dimension Z\"\n    //% weight=77\n    //% blockHidden\n    //% help=github:pxt-raycasting/docs/set-z-offset\n    export function setZOffset(sprite: Sprite, offset: number, duration?: number) {\n        raycastingRender.setZOffset(sprite, offset, duration)\n    }\n\n    /**\n     * Set arribute of a Sprite\n     * @param spr Sprite\n     * @param attr RCSpriteAttribute\n     */\n    //% group=\"Dimension Z\"\n    //% block=\"set Sprite %spr=variables_get(mySprite) %attribute = %value\"\n    //% blockId=rcRender_setSpriteAttribute\n    //% weight=75\n    //% help=github:pxt-raycasting/docs/set-sprite-attribute\n    export function setSpriteAttribute(spr: Sprite, attr: RCSpriteAttribute, value: number) {\n        switch (attr) {\n            case RCSpriteAttribute.ZOffset:\n                raycastingRender.getMotionZ(spr).offset = value\n                break\n            case RCSpriteAttribute.ZPosition:\n                raycastingRender.getMotionZ(spr).p = value\n                break\n            case RCSpriteAttribute.ZVelocity:\n                raycastingRender.getMotionZ(spr).v = value\n                break\n            case RCSpriteAttribute.ZAcceleration:\n                raycastingRender.getMotionZ(spr).a = value\n                break\n            default:\n        }\n    }\n\n    /**\n     * Get arribute of a Sprite\n     * @param spr Sprite\n     * @param attr RCSpriteAttribute\n     */\n    //% group=\"Dimension Z\"\n    //% block=\"get Sprite %spr=variables_get(mySprite) %attribute\"\n    //% blockId=rcRender_getSpriteAttribute\n    //% weight=74\n    //% help=github:pxt-raycasting/docs/get-sprite-attribute\n    export function getSpriteAttribute(spr: Sprite, attr: RCSpriteAttribute): number {\n        switch (attr) {\n            case RCSpriteAttribute.ZOffset:\n                return raycastingRender.getMotionZ(spr).offset\n            case RCSpriteAttribute.ZPosition:\n                return raycastingRender.getMotionZ(spr).p\n            case RCSpriteAttribute.ZVelocity:\n                return raycastingRender.getMotionZ(spr).v\n            case RCSpriteAttribute.ZAcceleration:\n                return raycastingRender.getMotionZ(spr).a\n            default:\n                return 0\n        }\n    }\n\n    /**\n     * Check if 2 sprites overlaps each another in Z dimension\n     * Best work together with sprites.onOverlap(kind1, kind2)\n     * @param sprite1\n     * @param sprite2\n     */\n    //% blockId=rcRender_isSpritesOverlapZ\n    //% block=\"is sprites $sprite1=variables_get(mySprite) and $sprite2=variables_get(mySprite2) overlaps in Z dimension\"\n    //% group=\"Dimension Z\"\n    //% weight=71\n    //% help=github:pxt-raycasting/docs/is-sprites-overlap-z\n    export function isSpritesOverlapZ(sprite1: Sprite, sprite2: Sprite): boolean {\n        return raycastingRender.isOverlapZ(sprite1, sprite2)\n    }\n\n    /**\n     * Make sprite jump, with specific height and duration\n     * Jump can only happened when sprite is standing, current height = its offset .\n     * @param sprite\n     * @param height jump height in pixel\n     * @param duration hover time span, unit: ms\n     */\n    //% blockId=rcRender_jumpWithHeightAndDuration block=\"Sprite %spr=variables_get(mySprite) jump, with height $height duration $duration=timePicker|ms \"\n    //% height.min=0 height.max=100 height.defl=16\n    //% duration.min=50 duration.max=5000 duration.defl=500\n    //% group=\"Dimension Z\"\n    //% weight=70\n    //% help=github:pxt-raycasting/docs/jump-with-height-and-duration\n    export function jumpWithHeightAndDuration(sprite: Sprite, height: number, duration: number) {\n        raycastingRender.jumpWithHeightAndDuration(sprite, height, duration)\n    }\n\n    /**\n     * Make sprite jump, with specific speed and acceleration\n     * Simular with Move block, but jump can only happened when sprite is standing, current height = its offset.\n     * @param sprite\n     * @param v vetical speed, unit: pixel/s\n     * @param a vetical acceleration, unit: pixel/s\n     */\n    //% blockId=rcRender_jump block=\"Sprite %spr=variables_get(mySprite) jump||, with speed $v=spriteSpeedPicker acceleration $a\"\n    //% v.min=-100 v.max=100 v.defl=60\n    //% a.min=-1000 a.max=1000 a.defl=-250\n    //% group=\"Dimension Z\"\n    //% weight=68\n    //% help=github:pxt-raycasting/docs/jump\n    export function jump(sprite: Sprite, v?: number, a?: number) {\n        raycastingRender.jump(sprite, v, a)\n    }\n\n    /**\n     * Make sprite jump, with specific speed and acceleration\n     * @param sprite\n     * @param v vetical speed, unit: pixel/s\n     * @param a vetical acceleration, unit: pixel/s\n     */\n    //% blockId=rcRender_move block=\"Sprite %spr=variables_get(mySprite) move, with speed $v=spriteSpeedPicker|| acceleration $a\"\n    //% v.min=-200 v.max=200 v.defl=60\n    //% a.min=-1000 a.max=1000 a.defl=-250\n    //% group=\"Dimension Z\"\n    //% weight=66\n    //% help=github:pxt-raycasting/docs/move\n    export function move(sprite: Sprite, v?: number, a?: number) {\n        raycastingRender.move(sprite, v, a)\n    }\n\n    /**\n     * Control the self sprite using the direction buttons from the controller. \n     * To stop controlling self sprite, pass 0 for v and va.\n     *\n     * @param v The velocity used for forward/backword movement when up/down is pressed, in pixel/s\n     * @param va The angle velocity used for turn view direction when left/right is pressed, in radian/s.\n     */\n    //% blockId=\"rcRender_moveWithController\" block=\"move with buttons velocity $v|| turn speed $va camera sway$cameraSway pixels\"\n    //% weight=60\n    //% expandableArgumentMode=\"toggle\"\n    //% v.defl=2 va.defl=3\n    //% group=\"Advanced\"\n    //% v.shadow=\"spriteSpeedPicker\"\n    //% va.shadow=\"spriteSpeedPicker\"\n    //% help=github:pxt-raycasting/docs/move-with-controller\n    export function moveWithController(v: number = 2, va: number = 3, cameraSway?: number) {\n        raycastingRender.velocity = v\n        raycastingRender.velocityAngle = va\n        if (cameraSway != undefined)\n            raycastingRender.cameraSway = cameraSway | 0\n    }\n\n    /**\n     * Render takeover all sprites in current scene\n     * Render will call this automatically, but maybe not in time enough.\n     * If you saw sprite draw at its tilemap position on screen, call this just after created the sprite.\n     */\n    //% blockId=rcRender_takeoverSceneSprites \n    //% block=\"takeover sprites in scene\"\n    //% group=\"Advanced\"\n    //% weight=49\n    //% help=github:pxt-raycasting/docs/takeover-scene-sprites\n    export function takeoverSceneSprites() {\n        raycastingRender.takeoverSceneSprites()\n    }\n\n    /**\n     * Run on sprite dirction updated, present view point to Sprite facing dirction, or which angle you see of the sprite.\n     * Just using with other animation extensions, to set proper Image for sprite.\n     * Not required, if you have used the set animations block provided.\n     * @param dir It is a float number, 0~1 corresponds to 0~360, suggest use Math.round(dir*dirAniTotalCount)%dirAniTotalCount to get index of direction\n     */\n    //% blockId=rcRender_registerOnSpriteDirectionUpdateHandler\n    //% block=\"run code when sprite $spr dirction updated to $dir\"\n    //% draggableParameters\n    //% group=\"Advanced\"\n    //% weight=48\n    //% help=github:pxt-raycasting/docs/register-on-sprite-direction-update-handler\n    export function registerOnSpriteDirectionUpdateHandler(handler: (spr: Sprite, dir: number) => void) {\n        raycastingRender.registerOnSpriteDirectionUpdate(handler)\n    }\n}\n","_render_raycasting.ts":"//% shim=pxt::updateScreen\nfunction updateScreen(img: Image) { }\n\nenum ViewMode {\n    //% block=\"TileMap Mode\"\n    tilemapView,\n    //% block=\"Raycasting Mode\"\n    raycastingView,\n}\n\nnamespace Render {\n    const SH = screen.height, SHHalf = SH / 2\n    const SW = screen.width, SWHalf = SW / 2\n    const fpx = 8\n    const fpx_scale = 2 ** fpx\n    function tofpx(n: number) { return (n * fpx_scale) | 0 }\n    const one = 1 << fpx\n    const one2 = 1 << (fpx + fpx)\n    const FPX_MAX = (1 << fpx) - 1\n\n    class MotionSet1D {\n        p: number\n        v: number = 0\n        a: number = 0\n        constructor(public offset: number) {\n            this.p = offset\n        }\n    }\n\n    export const defaultFov = SW / SH / 2  //Wall just fill screen height when standing 1 tile away\n\n    export class RayCastingRender {\n        private tempScreen: Image = image.create(SW, SH)\n\n        velocityAngle: number = 2\n        velocity: number = 3\n        protected _viewMode = ViewMode.raycastingView\n        protected dirXFpx: number\n        protected dirYFpx: number\n        protected planeX: number\n        protected planeY: number\n        protected _angle: number\n        protected _fov: number\n        protected _wallZScale: number = 1\n        cameraSway = 0\n        protected isWalking = false\n        protected cameraOffsetX = 0\n        protected cameraOffsetZ_fpx = 0\n\n        //sprites & accessories\n        sprSelf: Sprite\n        sprites: Sprite[] = []\n        sprites2D: Sprite[] = []\n        spriteParticles: particles.ParticleSource[] = []\n        spriteLikes: SpriteLike[] = []\n        spriteAnimations: Animations[] = []\n        protected spriteMotionZ: MotionSet1D[] = []\n        protected sayRederers: sprites.BaseSpriteSayRenderer[] = []\n        protected sayEndTimes: number[] = []\n\n        //reference\n        protected tilemapScaleSize = 1 << TileScale.Sixteen\n        map: tiles.TileMapData\n        bg: Image\n        textures: Image[]\n        protected oldRender: scene.Renderable\n        protected myRender: scene.Renderable\n\n        //render\n        protected wallHeightInView: number\n        protected wallWidthInView: number\n        protected dist: number[] = []\n        //render perf const\n        cameraRangeAngle: number\n        viewZPos: number\n        selfXFpx: number\n        selfYFpx: number\n\n        //for drawing sprites\n        protected invDet: number //required for correct matrix multiplication\n        camera: scene.Camera\n        tempSprite: Sprite = sprites.create(img`0`)\n        protected transformX: number[] = []\n        protected transformY: number[] = []\n        protected angleSelfToSpr: number[] = []\n\n        onSpriteDirectionUpdateHandler: (spr: Sprite, dir: number) => void\n\n        get xFpx(): number {\n            return Fx.add(this.sprSelf._x, Fx.div(this.sprSelf._width, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        // set xFpx(v: number) {\n        //     this.sprSelf._x = v * this.tilemapScaleSize as any as Fx8\n        // }\n\n        get yFpx(): number {\n            return Fx.add(this.sprSelf._y, Fx.div(this.sprSelf._height, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        // set yFpx(v: number) {\n        //     this.sprSelf._y = v * this.tilemapScaleSize as any as Fx8\n        // }\n\n        get dirX(): number {\n            return this.dirXFpx / fpx_scale\n        }\n\n        get dirY(): number {\n            return this.dirYFpx / fpx_scale\n        }\n\n        set dirX(v: number) {\n            this.dirXFpx = v * fpx_scale\n        }\n\n        set dirY(v: number) {\n            this.dirYFpx = v * fpx_scale\n        }\n\n        sprXFx8(spr: Sprite) {\n            return Fx.add(spr._x, Fx.div(spr._width, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        sprYFx8(spr: Sprite) {\n            return Fx.add(spr._y, Fx.div(spr._height, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        get fov(): number {\n            return this._fov\n        }\n\n        set fov(fov: number) {\n            this._fov = fov\n            this.wallHeightInView = (SW << (fpx - 1)) / this._fov\n            this.wallWidthInView = this.wallHeightInView >> fpx // not fpx  // wallSize / this.fov * 4 / 3 * 2\n            this.cameraRangeAngle = Math.atan(this.fov) + .1 //tolerance for spr center just out of camera\n\n            this.setVectors()\n        }\n\n        get viewAngle(): number {\n            return this._angle\n        }\n        set viewAngle(angle: number) {\n            this._angle = angle\n            this.setVectors()\n            this.updateSelfImage()\n        }\n\n        get wallZScale(): number {\n            return this._wallZScale\n        }\n        set wallZScale(v: number) {\n            this._wallZScale = v\n        }\n\n        getMotionZ(spr: Sprite, offsetZ: number = 0) {\n            let motionZ = this.spriteMotionZ[spr.id]\n            if (!motionZ) {\n                motionZ = new MotionSet1D(tofpx(offsetZ))\n                this.spriteMotionZ[spr.id] = motionZ\n            }\n            return motionZ\n        }\n\n        getZOffset(spr: Sprite) {\n            return this.getMotionZ(spr).offset / fpx_scale\n        }\n\n        setZOffset(spr: Sprite, offsetZ: number, duration: number = 500) {\n            const motionZ = this.getMotionZ(spr, offsetZ)\n\n            motionZ.offset = tofpx(offsetZ)\n            if (motionZ.p != motionZ.offset) {\n                if (duration === 0)\n                    motionZ.p = motionZ.offset\n                else if (motionZ.v == 0)\n                    this.move(spr, (motionZ.offset - motionZ.p) / fpx_scale * 1000 / duration, 0)\n            }\n        }\n\n        getMotionZPosition(spr: Sprite) {\n            return this.getMotionZ(spr).p / fpx_scale\n        }\n\n        //todo, use ZHeight(set from sprite.Height when takeover, then sprite.Height will be replace with width)\n        isOverlapZ(sprite1: Sprite, sprite2: Sprite): boolean {\n            const p1 = this.getMotionZPosition(sprite1)\n            const p2 = this.getMotionZPosition(sprite2)\n            if (p1 < p2) {\n                if (p1 + sprite1.height > p2) return true\n            } else {\n                if (p2 + sprite2.height > p1) return true\n            }\n            return false\n        }\n\n        move(spr: Sprite, v: number, a: number) {\n            const motionZ = this.getMotionZ(spr)\n\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        jump(spr: Sprite, v: number, a: number) {\n            const motionZ = this.getMotionZ(spr)\n            if (motionZ.p != motionZ.offset)\n                return\n\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        jumpWithHeightAndDuration(spr: Sprite, height: number, duration: number) {\n            const motionZ = this.getMotionZ(spr)\n            if (motionZ.p != motionZ.offset)\n                return\n\n            // height= -v*v/a/2\n            // duration = -v/a*2 *1000\n            const v = height * 4000 / duration\n            const a = -v * 2000 / duration\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        get viewMode(): ViewMode {\n            return this._viewMode\n        }\n\n        set viewMode(v: ViewMode) {\n            this._viewMode = v\n        }\n\n        updateViewZPos() {\n            this.viewZPos = this.spriteMotionZ[this.sprSelf.id].p + (this.sprSelf._height as any as number) - (2 << fpx)\n        }\n\n        takeoverSceneSprites() {\n            const sc_allSprites = game.currentScene().allSprites\n            for (let i = 0; i < sc_allSprites.length;) {\n                const spr = sc_allSprites[i]\n                if (spr instanceof Sprite) {\n                    const sprList = (spr.flags & sprites.Flag.RelativeToCamera) ? this.sprites2D : this.sprites\n                    if (sprList.indexOf(spr) < 0) {\n                        sprList.push(spr as Sprite)\n                        this.getMotionZ(spr, 0)\n                        spr.onDestroyed(() => {\n                            this.sprites.removeElement(spr as Sprite)   //can be in one of 2 lists\n                            this.sprites2D.removeElement(spr as Sprite) //can be in one of 2 lists\n                            const sayRenderer = this.sayRederers[spr.id]\n                            if (sayRenderer) {\n                                this.sayRederers.removeElement(sayRenderer)\n                                sayRenderer.destroy()\n                            }\n                        })\n                    }\n                } else if (spr instanceof particles.ParticleSource) {\n                    const particle = (spr as particles.ParticleSource)\n                    if (this.spriteParticles.indexOf(particle) < 0) {\n                        this.spriteParticles[(particle.anchor as Sprite).id] = particle\n                        particle.anchor = this.tempSprite\n                    }\n                } else {\n                    if (this.spriteLikes.indexOf(spr) < 0)\n                        this.spriteLikes.push(spr)\n                }\n                sc_allSprites.removeElement(spr)\n            }\n            this.sprites.forEach((spr) => {\n                if (spr)\n                    this.takeoverSayRenderOfSprite(spr)\n            })\n        }\n        takeoverSayRenderOfSprite(sprite: Sprite) {\n            const sprite_as_any = (sprite as any)\n            if (sprite_as_any.sayRenderer) {\n                this.sayRederers[sprite.id] = sprite_as_any.sayRenderer\n                this.sayEndTimes[sprite.id] = sprite_as_any.sayEndTime;\n                sprite_as_any.sayRenderer = undefined\n                sprite_as_any.sayEndTime = undefined\n            }\n        }\n\n        tilemapLoaded() {\n            const sc = game.currentScene()\n            this.map = sc.tileMap.data\n            this.textures = sc.tileMap.data.getTileset()\n            this.tilemapScaleSize = 1 << sc.tileMap.data.scale\n            this.oldRender = sc.tileMap.renderable\n            this.spriteLikes.removeElement(this.oldRender)\n            sc.allSprites.removeElement(this.oldRender)\n\n            let frameCallback_update = sc.eventContext.registerFrameHandler(scene.PRE_RENDER_UPDATE_PRIORITY + 1, () => {\n                const dt = sc.eventContext.deltaTime;\n                // sc.camera.update();  // already did in scene\n                for (const s of this.sprites)\n                    s.__update(sc.camera, dt);\n                this.sprSelf.__update(sc.camera, dt)\n            })\n\n            let frameCallback_draw = sc.eventContext.registerFrameHandler(scene.RENDER_SPRITES_PRIORITY + 1, () => {\n                if (this._viewMode == ViewMode.tilemapView) {\n                   // screen.drawImage(sc.background.image, 0, 0)\n                    this.oldRender.__drawCore(sc.camera)\n                    this.sprites.forEach(spr => spr.__draw(sc.camera))\n                    this.sprSelf.__draw(sc.camera)\n                } else {\n                 //   this.tempScreen.drawImage(sc.background.image, 0, 0)\n                    //debug\n                    // const ms=control.micros()\n                    this.render()\n                    // info.setScore(control.micros()-ms)\n                    screen.fill(0)\n                }\n                this.sprites2D.forEach(spr => spr.__draw(sc.camera))\n                this.spriteLikes.forEach(spr => spr.__draw(sc.camera))\n                if (this._viewMode == ViewMode.raycastingView)\n                    this.tempScreen.drawTransparentImage(screen, 0, 0)\n            })\n\n            sc.tileMap.addEventListener(tiles.TileMapEvent.Unloaded, data => {\n                sc.eventContext.unregisterFrameHandler(frameCallback_update)\n                sc.eventContext.unregisterFrameHandler(frameCallback_draw)\n            })\n\n            // this.myRender = scene.createRenderable(\n            //     scene.TILE_MAP_Z,\n            //     (t, c) => this.trace(t, c)\n            // )\n\n        }\n\n        constructor() {\n            this._angle = 0\n            this.fov = defaultFov\n            this.camera = new scene.Camera()\n\n            const sc = game.currentScene()\n            if (!sc.tileMap) {\n                sc.tileMap = new tiles.TileMap();\n            } else {\n                this.tilemapLoaded()\n            }\n            game.currentScene().tileMap.addEventListener(tiles.TileMapEvent.Loaded, data => this.tilemapLoaded())\n\n            //self sprite\n            this.sprSelf = sprites.create(image.create(this.tilemapScaleSize >> 1, this.tilemapScaleSize >> 1), SpriteKind.Player)\n            this.takeoverSceneSprites()\n            this.sprites.removeElement(this.sprSelf)\n            this.updateViewZPos()\n            scene.cameraFollowSprite(this.sprSelf)\n            this.updateSelfImage()\n\n            game.onUpdate(function () {\n                this.updateControls()\n            })\n\n            game.onUpdateInterval(400, () => {\n                for (let i = 0; i < this.sprites.length;) {\n                    const spr = this.sprites[i]\n                    if (spr.flags & sprites.Flag.RelativeToCamera) {\n                        this.sprites.removeElement(spr)\n                        this.sprites2D.push(spr)\n                    } else { i++ }\n                }\n                for (let i = 0; i < this.sprites2D.length;) {\n                    const spr = this.sprites2D[i]\n                    if (!(spr.flags & sprites.Flag.RelativeToCamera)) {\n                        this.sprites2D.removeElement(spr)\n                        this.sprites.push(spr)\n                    } else { i++ }\n                }\n                this.takeoverSceneSprites() // in case some one new\n            })\n\n\n            game.onUpdateInterval(25, () => {\n                if (this.cameraSway && this.isWalking) {\n                    this.cameraOffsetX = (Math.sin(control.millis() / 150) * this.cameraSway * 3) | 0\n                    this.cameraOffsetZ_fpx = tofpx(Math.cos(control.millis() / 75) * this.cameraSway) | 0\n                }\n            });\n            control.__screen.setupUpdate(() => {\n                if (this.viewMode == ViewMode.raycastingView)\n                    updateScreen(this.tempScreen)\n                else\n                    updateScreen(screen)\n            })\n\n            game.addScenePushHandler((oldScene) => {\n                control.__screen.setupUpdate(() => { updateScreen(screen) })\n            })\n            game.addScenePopHandler((oldScene) => {\n                control.__screen.setupUpdate(() => {\n                    if (this.viewMode == ViewMode.raycastingView)\n                        updateScreen(this.tempScreen)\n                    else\n                        updateScreen(screen)\n                })\n            })\n        }\n\n        private setVectors() {\n            const sin = Math.sin(this._angle)\n            const cos = Math.cos(this._angle)\n            this.dirXFpx = tofpx(cos)\n            this.dirYFpx = tofpx(sin)\n            this.planeX = tofpx(sin * this._fov)\n            this.planeY = tofpx(cos * -this._fov)\n        }\n\n        //todo, pre-drawn dirctional image\n        public updateSelfImage() {\n            const img = this.sprSelf.image\n            img.fill(6)\n            const arrowLength = img.width / 2\n            img.drawLine(arrowLength, arrowLength, arrowLength + this.dirX * arrowLength, arrowLength + this.dirY * arrowLength, 2)\n            img.fillRect(arrowLength - 1, arrowLength - 1, 2, 2, 2)\n        }\n\n        updateControls() {\n            if (this.velocityAngle !== 0) {\n                const dx = controller.dx(this.velocityAngle)\n                if (dx) {\n                    this.viewAngle += dx\n                }\n            }\n            if (this.velocity !== 0) {\n                this.isWalking = true\n                const dy = controller.dy(this.velocity)\n                if (dy) {\n                    const nx = this.xFpx - Math.round(this.dirXFpx * dy)\n                    const ny = this.yFpx - Math.round(this.dirYFpx * dy)\n                    this.sprSelf.setPosition((nx * this.tilemapScaleSize / fpx_scale), (ny * this.tilemapScaleSize / fpx_scale))\n                } else {\n                    this.isWalking = false\n                }\n            }\n\n            for (const spr of this.sprites) {\n                this.updateMotionZ(spr)\n            }\n            this.updateMotionZ(this.sprSelf)\n        }\n\n        updateMotionZ(spr: Sprite) {\n            const dt = game.eventContext().deltaTime\n            const motionZ = this.spriteMotionZ[spr.id]\n            //if (!motionZ) continue\n\n            if (motionZ.v != 0 || motionZ.p != motionZ.offset) {\n                motionZ.v += motionZ.a * dt, motionZ.p += motionZ.v * dt\n                //landing\n                if ((motionZ.a >= 0 && motionZ.v > 0 && motionZ.p > motionZ.offset) ||\n                    (motionZ.a <= 0 && motionZ.v < 0 && motionZ.p < motionZ.offset)) { motionZ.p = motionZ.offset, motionZ.v = 0 }\n                if (spr === this.sprSelf)\n                    this.updateViewZPos()\n            }\n\n        }\n\n\n        blitRowBreak(screenX: number, screenUp: number, screenDown: number, source: Image, sourceX: number, sourceYBreak: number) {\n\n            let stepY = (sourceYBreak) / (SHHalf - screenUp )\n            let sourceY = sourceYBreak - stepY\n            let y = SHHalf -1\n            if (screenUp < 0)\n                screenUp = 0\n            while (y  >= Math.ceil(screenUp)-1) {\n                if (sourceY < 0) \n                    sourceY = 0\n                const c = source.getPixel(sourceX, sourceY)\n                this.tempScreen.setPixel(screenX, y, c)\n                y--\n                sourceY -= stepY\n            }\n            // from screen half  going down\n            stepY = (source.height - sourceYBreak) / (screenDown - SHHalf)\n            sourceY = sourceYBreak \n            y = SHHalf\n            if (screenDown > SH)\n                screenDown = SH\n            while (y < Math.round(screenDown)) {\n                const c = source.getPixel(sourceX, sourceY)\n                this.tempScreen.setPixel(screenX, y, c)\n                y++\n                sourceY += stepY\n            }\n\n        }\n        \n        render() {\n            // based on https://lodev.org/cgtutor/raycasting.html\n            this.selfXFpx = this.xFpx\n            this.selfYFpx = this.yFpx\n\n            let drawStart = 0\n            let drawHeight = 0\n            let lastDist = -1, lastTexX = -1, lastMapX = -1, lastMapY = -1\n            this.viewZPos = this.spriteMotionZ[this.sprSelf.id].p + (this.sprSelf._height as any as number) - (2 << fpx) + this.cameraOffsetZ_fpx\n            let cameraRangeAngle = Math.atan(this.fov) + .1 //tolerance for spr center just out of camera\n            //debug\n            // const ms=control.millis()\n\n            \n\n\n            const tex = this.textures[1]\n            let rayDirX0 = this.dirXFpx / fpx_scale + (this.planeX / fpx_scale)\n            let rayDirY0 = this.dirYFpx / fpx_scale + (this.planeY / fpx_scale)\n            let rayDirX1 = this.dirXFpx / fpx_scale - (this.planeX / fpx_scale)\n            let rayDirY1 = this.dirYFpx / fpx_scale - (this.planeY / fpx_scale)\n            let fmapX = this.selfXFpx / fpx_scale\n            let fmapY = this.selfYFpx / fpx_scale\n\n            const sc = game.currentScene() \n           // background\n            const speed = 2 // 2: normal speed\n            let backgroundOffset = (this._angle / Math.PI * speed ) % 1  // range -1..1\n            if (backgroundOffset < 0) backgroundOffset++  // range 0..1\n            backgroundOffset *= SW    // range 0..screenwidth\n            \n            //floor\n            for (let y = 60; y < SH; y++) {\n                let p = y - SHHalf\n                let posZ = SH * this.viewZPos / this.tilemapScaleSize / fpx_scale\n                let rowDistance = posZ / p\n                let floorStepX = rowDistance * (rayDirX1 - rayDirX0) / SW\n                let floorStepY = rowDistance * (rayDirY1 - rayDirY0) / SW\n\n\n\n                let floorX = fmapX + rowDistance * rayDirX0\n                let floorY = fmapY + rowDistance * rayDirY0\n                for (let x = 0; x < SW; x++) {\n                      let cellX = Math.floor(floorX)\n                     let cellY = Math.floor(floorY)\n                    let tx =  (16 * (floorX - cellX)) & 15\n                      let ty = (16 * (floorY - cellY)) & (15)\n                    let mapX = Math.round(floorX - 0.5) % 16\n                    let mapY = Math.round(floorY - 0.5) % 16\n                    let tileType = this.map.getTile(mapX, mapY)\n                    let floorTex = this.textures[tileType]\n                    floorX += floorStepX\n                    floorY += floorStepY\n                    let c = floorTex.getPixel(tx, ty)\n                    this.tempScreen.setPixel(x, y, c)\n\n                }\n\n\n\n            }\n            // walls\n\n            for (let x = 0; x < SW; x++) {\n                const cameraX: number = one - Math.idiv(((x + this.cameraOffsetX) << fpx) << 1, SW)\n                let rayDirX = this.dirXFpx + (this.planeX * cameraX >> fpx)\n                let rayDirY = this.dirYFpx + (this.planeY * cameraX >> fpx)\n\n                // avoid division by zero\n                if (rayDirX == 0) rayDirX = 1\n                if (rayDirY == 0) rayDirY = 1\n\n                let mapX = this.selfXFpx >> fpx\n                let mapY = this.selfYFpx >> fpx\n\n                // length of ray from current position to next x or y-side\n                let sideDistX = 0, sideDistY = 0\n\n                // length of ray from one x or y-side to next x or y-side\n                const deltaDistX = Math.abs(Math.idiv(one2, rayDirX));\n                const deltaDistY = Math.abs(Math.idiv(one2, rayDirY));\n\n                let mapStepX = 0, mapStepY = 0\n\n                let sideWallHit = false;\n\n                //calculate step and initial sideDist\n                if (rayDirX < 0) {\n                    mapStepX = -1;\n                    sideDistX = ((this.selfXFpx - (mapX << fpx)) * deltaDistX) >> fpx;\n                } else {\n                    mapStepX = 1;\n                    sideDistX = (((mapX << fpx) + one - this.selfXFpx) * deltaDistX) >> fpx;\n                }\n                if (rayDirY < 0) {\n                    mapStepY = -1;\n                    sideDistY = ((this.selfYFpx - (mapY << fpx)) * deltaDistY) >> fpx;\n                } else {\n                    mapStepY = 1;\n                    sideDistY = (((mapY << fpx) + one - this.selfYFpx) * deltaDistY) >> fpx;\n                }\n\n                let color = 0\n\n                while (true) {\n                    //jump to next map square, OR in x-direction, OR in y-direction\n                    if (sideDistX < sideDistY) {\n                        sideDistX += deltaDistX;\n                        mapX += mapStepX;\n                        sideWallHit = false;\n                    } else {\n                        sideDistY += deltaDistY;\n                        mapY += mapStepY;\n                        sideWallHit = true;\n                    }\n\n                    if (this.map.isOutsideMap(mapX, mapY))\n                        break\n                    color = this.map.getTile(mapX, mapY)\n                    if  (this.map.isWall(mapX, mapY))\n                        break; // hit!\n                }\n\n                if (this.map.isOutsideMap(mapX, mapY))\n                    continue\n\n                let perpWallDist = 0\n                let wallX = 0\n                if (!sideWallHit) {\n                    perpWallDist = Math.idiv(((mapX << fpx) - this.selfXFpx + (1 - mapStepX << fpx - 1)) << fpx, rayDirX)\n                    wallX = this.selfYFpx + (perpWallDist * rayDirY >> fpx);\n                } else {\n                    perpWallDist = Math.idiv(((mapY << fpx) - this.selfYFpx + (1 - mapStepY << fpx - 1)) << fpx, rayDirY)\n                    wallX = this.selfXFpx + (perpWallDist * rayDirX >> fpx);\n                }\n                wallX &= FPX_MAX\n\n                // color = (color - 1) * 2\n                // if (sideWallHit) color++\n\n                const tex = this.textures[color]\n                if (!tex)\n                    continue\n\n                let texX = (wallX * tex.width) >> fpx;\n                // if ((!sideWallHit && rayDirX > 0) || (sideWallHit && rayDirY < 0))\n                //     texX = tex.width - texX - 1;\n\n                const lineHeight = (this.wallHeightInView / perpWallDist)\n                const drawEnd = lineHeight * this.viewZPos / this.tilemapScaleSize / fpx_scale;\n                const horizontBreak = 1 - this.viewZPos / this.tilemapScaleSize / fpx_scale;\n                if (perpWallDist !== lastDist && (texX !== lastTexX || mapX !== lastMapX || mapY !== lastMapY)) {//neighbor line of tex share same parameters\n                     \n                    drawStart = drawEnd - lineHeight * (this._wallZScale) ;\n                    drawHeight = (Math.ceil(drawEnd) - Math.ceil(drawStart) )\n                    drawStart += (SH >> 1)\n\n                    lastDist = perpWallDist\n                    lastTexX = texX\n                    lastMapX = mapX\n                    lastMapY = mapY\n                }\n                //fix start&end points to avoid regmatic between lines\n               \n\n                //if (x < SWHalf)\n                //    this.tempScreen.blitRow(x, drawStart, tex, texX, drawHeight)\n                //else\n                    this.blitRowBreak(x, SHHalf + drawEnd - lineHeight, SHHalf + drawEnd, tex, texX, tex.height * horizontBreak)\n\n                this.dist[x] = perpWallDist\n\n                // background \n                for (let y = 0; y < drawStart; y++ ){\n                    let backX = (backgroundOffset + x) % SW\n                    let c = sc.background.image.getPixel(backX,y)\n                    this.tempScreen.setPixel(x,y,c)\n                }\n            }\n            //debug\n            // info.setScore(control.millis()-ms)\n           // this.tempScreen.print(backgroundOffset.toString(), 0,0,7 )\n           // this.tempScreen.print([Math.roundWithPrecision(this._angle, 3)].join(), 20, 5)\n\n            this.drawSprites()\n        }\n\n        drawSprites() {\n            //debug\n            // let msSprs=control.millis()\n            /////////////////// sprites ///////////////////\n\n            //for sprite\n            const invDet = one2 / (this.planeX * this.dirYFpx - this.dirXFpx * this.planeY); //required for correct matrix multiplication\n\n            this.sprites\n                .filter((spr, i) => {\n                    const spriteX = this.sprXFx8(spr) - this.xFpx // this.selfXFpx\n                    const spriteY = this.sprYFx8(spr) - this.yFpx // this.selfYFpx\n                    this.angleSelfToSpr[spr.id] = Math.atan2(spriteX, spriteY)\n                    this.transformX[spr.id] = invDet * (this.dirYFpx * spriteX - this.dirXFpx * spriteY) >> fpx;\n                    this.transformY[spr.id] = invDet * (-this.planeY * spriteX + this.planeX * spriteY) >> fpx; //this is actually the depth inside the screen, that what Z is in 3D\n                    const angleInCamera = Math.atan2(this.transformX[spr.id] * this.fov, this.transformY[spr.id])\n                    return angleInCamera > -this.cameraRangeAngle && angleInCamera < this.cameraRangeAngle //(this.transformY[spr.id] > 0\n                }).sort((spr1, spr2) => {   // far to near\n                    return (this.transformY[spr2.id] - this.transformY[spr1.id])\n                }).forEach((spr, index) => {\n                    //debug\n                    // this.tempScreen.print([spr.id,Math.roundWithPrecision(angle[spr.id],3)].join(), 0, index * 10 + 10,9)\n                    this.drawSprite(spr, index, this.transformX[spr.id], this.transformY[spr.id], this.angleSelfToSpr[spr.id])\n                })\n\n            //debug\n            // info.setLife(control.millis() - msSprs+1)\n             //this.tempScreen.print([Math.roundWithPrecision(this._angle,3)].join(), 20,  0)\n\n        }\n\n        registerOnSpriteDirectionUpdate(handler: (spr: Sprite, dir: number) => void) {\n            this.onSpriteDirectionUpdateHandler = handler\n        }\n\n        drawSprite(spr: Sprite, index: number, transformX: number, transformY: number, myAngle: number) {\n            const spriteScreenX = Math.ceil((SWHalf) * (1 - transformX / transformY)) - this.cameraOffsetX;\n            const spriteScreenHalfWidth = Math.idiv((spr._width as any as number) / this.tilemapScaleSize / 2 * this.wallWidthInView, transformY)  //origin: (texSpr.width / 2 << fpx) / transformY / this.fov / 3 * 2 * 4\n            const spriteScreenLeft = spriteScreenX - spriteScreenHalfWidth\n            const spriteScreenRight = spriteScreenX + spriteScreenHalfWidth\n\n            //calculate drawing range in X direction\n            //assume there is one range only\n            let blitX = 0, blitWidth = 0\n            for (let sprX = 0; sprX < SW; sprX++) {\n                if (this.dist[sprX] > transformY) {\n                    if (blitWidth == 0)\n                        blitX = sprX\n                    blitWidth++\n                } else if (blitWidth > 0) {\n                    if (blitX <= spriteScreenRight && blitX + blitWidth >= spriteScreenLeft)\n                        break\n                    else\n                        blitX = 0, blitWidth = 0;\n                }\n            }\n            // this.tempScreen.print([this.getxFx8(spr), this.getyFx8(spr)].join(), 0,index*10+10)\n            const blitXSpr = Math.max(blitX, spriteScreenLeft)\n            const blitWidthSpr = Math.min(blitX + blitWidth, spriteScreenRight) - blitXSpr\n            if (blitWidthSpr <= 0)\n                return\n\n            const lineHeight = Math.idiv(this.wallHeightInView, transformY)\n            const drawStart = SHHalf + (lineHeight * ((this.viewZPos - this.spriteMotionZ[spr.id].p - (spr._height as any as number)) / this.tilemapScaleSize) >> fpx)\n\n            //for textures=image[][], abandoned\n            //    const texSpr = spr.getTexture(Math.floor(((Math.atan2(spr.vxFx8, spr.vyFx8) - myAngle) / Math.PI / 2 + 2-.25) * spr.textures.length +.5) % spr.textures.length)\n            //for deal in user code\n            if (this.onSpriteDirectionUpdateHandler)\n                this.onSpriteDirectionUpdateHandler(spr, ((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25))\n            //for CharacterAnimation ext.\n            //     const iTexture = Math.floor(((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25) * 4 + .5) % 4\n            //     const characterAniDirs = [Predicate.MovingLeft,Predicate.MovingDown, Predicate.MovingRight, Predicate.MovingUp]\n            //     character.setCharacterState(spr, character.rule(characterAniDirs[iTexture]))\n            //for this.spriteAnimations\n            const texSpr = !this.spriteAnimations[spr.id] ? spr.image : this.spriteAnimations[spr.id].getFrameByDir(((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25))\n\n            const sprTexRatio = texSpr.width / spriteScreenHalfWidth / 2\n            helpers.imageBlit(\n                this.tempScreen,\n                blitXSpr,\n                drawStart,\n                blitWidthSpr,\n                lineHeight * spr.height / this.tilemapScaleSize,\n                texSpr,\n                (blitXSpr - (spriteScreenX - spriteScreenHalfWidth)) * sprTexRatio\n                ,\n                0,\n                blitWidthSpr * sprTexRatio, texSpr.height, true, false)\n\n            screen.fill(0)\n            const fpx_div_transformy = Math.roundWithPrecision(transformY / 4 / fpx_scale, 2)\n            const height = (SH / fpx_div_transformy)\n            const blitXSaySrc = ((blitX - spriteScreenX) * fpx_div_transformy) + SWHalf\n            const blitWidthSaySrc = (blitWidth * fpx_div_transformy)\n\n            //sprite\n            // screen.drawImage(texSpr, SWHalf-texSpr.width/2, SHHalf)\n            //sayText\n            const sayRender = this.sayRederers[spr.id]\n            if (sayRender) {\n                if (this.sayEndTimes[spr.id] && control.millis() > this.sayEndTimes[spr.id]) {\n                    this.sayRederers[spr.id] = undefined\n                } else {\n                    this.tempSprite.x = SWHalf\n                    this.tempSprite.y = SHHalf + 2\n                    this.camera.drawOffsetX = 0\n                    this.camera.drawOffsetY = 0\n                    sayRender.draw(screen, this.camera, this.tempSprite)\n                }\n            }\n            //particle\n            const particle = this.spriteParticles[spr.id]\n            if (particle) {\n                if (particle.lifespan) {\n                    //debug\n                    // this.tempScreen.print([spr.id].join(), 0,index*10+10)\n                    this.tempSprite.x = SWHalf\n                    this.tempSprite.y = SHHalf + spr.height\n                    this.camera.drawOffsetX = 0//spr.x-SWHalf\n                    this.camera.drawOffsetY = 0//spr.y-SH\n                    particle.__draw(this.camera)\n                } else {\n                    this.spriteParticles[spr.id] = undefined\n                }\n            }\n            //update screen for this spr\n            // const sayTransformY = \n            if (blitXSaySrc <= 0) { //imageBlit considers negative value as 0\n                helpers.imageBlit(\n                    this.tempScreen,\n                    spriteScreenX - SWHalf / fpx_div_transformy, drawStart - height / 2, (blitWidthSaySrc + blitXSaySrc) / fpx_div_transformy, height,\n                    screen,\n                    0, 0, blitWidthSaySrc + blitXSaySrc, SH, true, false)\n            } else {\n                helpers.imageBlit(\n                    this.tempScreen,\n                    // blitX, drawStart - height / 2 , blitWidth, height,\n                    blitX, drawStart - height / 2, blitWidth, height,\n                    screen,\n                    blitXSaySrc, 0, blitWidthSaySrc, SH,\n                    true, false)\n            }\n        }\n    }\n\n    //%fixedinstance\n    export const raycastingRender = new Render.RayCastingRender()\n}\n\n","tilemap.g.jres":"{\n    \"transparency16\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true\n    },\n    \"tile1\": {\n        \"data\": \"hwQQABAAAABBbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfQ==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile\"\n    },\n    \"tile2\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile0\"\n    },\n    \"tile3\": {\n        \"data\": \"hwQQABAAAAB34AAAAAAAAACeAAAAAAAAcOcAAAAAAAAA4AAAAAAAAHcHDgAAAAAA4O4AAAAAAAB34OAAAAAAAADu4AAAAAAAcAfuAAAAAAAH5w4AAAAAAHcADgAAAAAAB+fpAAAAAAB3DgAAAAAAAADgAAAAAAAAd+cOAAAAAAAHDgAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile1\"\n    },\n    \"tile5\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALsLAAAAAAAAuwsAAAAAAAC7CwAAAAAAALv7AAAAAAAAu/vd3d3dDQC7+wAAAAAAALsLAAAAAAAAuwsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile3\"\n    },\n    \"tile6\": {\n        \"data\": \"hwQQABAAAAAkL/QiJCIvJP8v8iQiJP//JE/y//8iT0JCL/IiIiRPIiQv8iIkIi8iIi8iIiJCLyQiL/T//yIvQv8vIi8kQv//Qi8i8iIkLyJCT/L//yIvRCIvIiIiQk8iJC/0QiIiLyRCL/IiQkIvQiQv8v//Ii8k/y/yIiJC//8iT/IiJCIvJA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile4\"\n    },\n    \"tile8\": {\n        \"data\": \"hwQQABAAAAAPAAAAAAAPAA/w//8AAA8A/w8AAP//AAAADwAA/wAAMAAPAAAPAAAAAA8AAA//AAAADwAADwAAAPDw//8AAAAADwAAAP////8PAAAA/////wDw//8AAAAAAA8AAA8AAAAADwAADwAAAAAPAAAPAAAAAA8AAA8AAAAA8P//AAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile6\"\n    },\n    \"tile7\": {\n        \"data\": \"hwQQABAAAAAfERERERER8R8RERERERHx/xEREREREf//mZmZmZmZ//+qqqqqqqr//5mZmZmZmf//mZmZmZmZ//+Zn//5n5n//5mf//mfmf//mZmZmZmZ//+ZmZmZmZn//6qqqqqqqv//mZmZmZmZ//8RERERERH/HxEREREREfEfERERERER8Q==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile5\"\n    },\n    \"tile4\": {\n        \"data\": \"hwQQABAAAADGxsbGxsbGxsbGxv//xsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxvbGxs/Gxg==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile2\"\n    },\n    \"tile9\": {\n        \"data\": \"hwQQABAAAACxu//P/f+7G7G7+8u7v7sbEbv7y7u/uxERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERG7u8u7u7sRsbu7y7u7uxuxu7vLvbu7Gw==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile7\"\n    },\n    \"tile10\": {\n        \"data\": \"hwQQABAAAAAdERGxu7u7u9Hd3b0dERGx0d3dvdHd3b3R3d290d3dvdHd3b3R3d290d3dvdHd3b3R3d3d0d3dvbu7u+3R3bvbHRERsbu7Ee3R3d29HdHd3dHd3b3R3d290d3dvdHd3b3R3d290d3dvdHd3b3R3d290d3d3dHd3b27u7vtu7u77Q==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile8\"\n    },\n    \"tile11\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile9\"\n    },\n    \"tile12\": {\n        \"data\": \"hwQQABAAAAAfEf8f/x8R8R8R8RHxERHx/xEREREREf//mZmZmZmZ//+qqqqqqqr//5mZmZmZmf//mZmZmZmZ//+Zn//5n5n//5mf//mfmf//mZmZmZmZ//+ZmZmZmZn//6qqqqqqqv//mZmZmZmZ//8RERERERH/HxEREREREfEfERERERER8Q==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile10\"\n    },\n    \"level1\": {\n        \"id\": \"level1\",\n        \"mimeType\": \"application/mkcd-tilemap\",\n        \"data\": \"MTAxMDAwMTAwMDAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMjAyMDIwMTA0MDMwMTAxMDIwMjAyMDIwMjAxMDMwMzAyMDIwMjAxMDEwNTAxMDEwMjAyMDIwMjAyMDEwMzAzMDEwMjAyMDEwNzA2MDEwMTAyMDIwMjAyMDIwMTAzMDMwMzA0MDQwMTAxMDMwMTAxMDIwMjAyMDIwMjAxMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAzMDMwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDMwMzAxMDEwMTAxMDIwMjAyMDIwMjAxMDEwMTAxMDEwMzAzMDEwMTAxMDEwMjAyMDIwMjAyMDEwMjAyMDIwMjAzMDMwMTAxMDEwMTAyMDIwMjAyMDIwMTAyMDIwMjAyMDMwMzAyMDIwMTAxMDIwMjAyMDIwMjAxMDIwMjAyMDIwMzAzMDIwMjAxMDEwMjAyMDIwMjAyMDEwMjAyMDIwMjAzMDMwMjAyMDEwMTAxMDEwMTAxMDEwMTAyMDIwMjAyMDMwMzAyMDIwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMjIyMjIyMjIyMjIyMjIyMjAyMDAyMDAyMDAwMDAwMjAwMjAwMDAwMjAwMDAwMDIwMDIwMDAwMDIwMDAwMDAyMDIyMjIwMDAyMDAwMDAwMjAyMjIyMjIyMjIyMjIyMjIyMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMjIyMjIyMjIyMjIyMjIyMg==\",\n        \"tileset\": [\n            \"myTiles.transparency16\",\n            \"sprites.dungeon.floorLight0\",\n            \"sprites.dungeon.floorLight1\",\n            \"sprites.dungeon.floorDark0\",\n            \"myTiles.tile7\",\n            \"myTiles.tile4\",\n            \"myTiles.tile9\",\n            \"myTiles.tile10\"\n        ],\n        \"displayName\": \"level\"\n    },\n    \"*\": {\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"dataEncoding\": \"base64\",\n        \"namespace\": \"myTiles\"\n    }\n}","tilemap.g.ts":"","pxt.json":"{\n    \"name\": \"3d floor and background - Copy\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"device\": \"*\",\n        \"sprite-scaling\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"assets.json\",\n        \"_animation.ts\",\n        \"_render_blocks.ts\",\n        \"_render_raycasting.ts\",\n        \"tilemap.g.jres\",\n        \"tilemap.g.ts\"\n    ],\n    \"targetVersions\": {\n        \"branch\": \"v1.10.36\",\n        \"tag\": \"v1.10.36\",\n        \"commits\": \"https://github.com/microsoft/pxt-arcade/commits/3a5a7e13703edf0412c17bdb9b1469e282a5b31b\",\n        \"target\": \"1.10.36\",\n        \"pxt\": \"8.3.9\"\n    },\n    \"preferredEditor\": \"blocksprj\"\n}\n"}},{"timestamp":1763748928826,"editorVersion":"2.0.62","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable type=\"KIND_SpriteKind\" id=\"USZ`q|D]$0kk|,E!b7c6\">Player</variable><variable type=\"KIND_SpriteKind\" id=\"@8#W0|ESmtdS+3`?Z+:+\">Projectile</variable><variable type=\"KIND_SpriteKind\" id=\"h1jvB:JPL=NMGpJB=4/[\">Food</variable><variable type=\"KIND_SpriteKind\" id=\"(3Y]|wk94c4t/c`pc((X\">Enemy</variable><variable type=\"KIND_SpriteKind\" id=\"2B=HiFZ(Kz-^Ln6ox1L~\">Help</variable><variable type=\"KIND_SpriteKind\" id=\"JWhoDx%e%9JIa%.pfAVv\">StatusBar</variable><variable type=\"KIND_StatusBarKind\" id=\"s%(2IG9YG[q#qn#zR$RL\">Health</variable><variable type=\"KIND_StatusBarKind\" id=\"INxD@r~~T0Wy@hJh=pGh\">Energy</variable><variable type=\"KIND_StatusBarKind\" id=\"z}t^*,Y7$$C-kcZG$91G\">Magic</variable><variable type=\"KIND_StatusBarKind\" id=\"|+h5Z!s*YkuLvDsM!-~j\">EnemyHealth</variable><variable id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</variable><variable id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</variable><variable id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</variable><variable id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</variable><variable id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</variable><variable id=\"[a3#yOs:sosi5Zk_px6P\">mySprite3</variable><variable id=\"i:_MCpc`P;?/}W#x|ztg\">Shell</variable><variable id=\"a+nB2f%[4OGi;MHB]27Q\">projectile</variable><variable id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</variable><variable id=\":9u@hfRXr7DucX:sce8;\">statusbar2</variable><variable id=\"prjF_cc1IE$ODI9J$|9|\">otherSprite</variable></variables><block type=\"function_definition\" x=\"407\" y=\"-987\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation><field name=\"function_name\">Summon alien</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Enemy</field></shadow></value></block></value><next><block type=\"run_image_animation\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field></block></value><value name=\"frames\"><shadow type=\"animation_editor\"><field name=\"frames\">[img`\n........................\n........................\n........................\n........................\n........................\n..........ffff..........\n........ff1111ff........\n.......fb111111bf.......\n.....fffc1111111f.......\n...fc111cd1111111f......\n...f1b1b1b1111dddf......\n...fbfbffcf11fcddf......\n......fcf111111bbf......\n.......ccbdb1b1fcf......\n.......fffbfbfdff.......\n........ffffffff........\n........fffffffffff.....\n.........fffffc111cf....\n.........fffff1b1b1f....\n..........ffffbfbfbf....\n...........ffff.........\n........................\n........................\n........................\n`,img`\n........................\n........................\n........................\n........................\n........................\n..........ffff..........\n........ff1111ff........\n.......fb111111bf.......\n.......f11111111f.......\n......fd11111111df......\n....7.fd11111111df......\n...7..fd11111111df......\n...7..fd11111111df......\n...7..fddd1111dddff.....\n...77.fbdbfddfbdbfcf....\n...777fcdcf11fcdcfbf....\n....77fffbdb1bdffcf.....\n....fcb1bcffffff........\n....f1c1c1ffffff........\n....fdfdfdfffff.........\n.....f.f.f..............\n........................\n........................\n........................\n`,img`\n........................\n........................\n........................\n........................\n..........ffff..........\n........ff1111ff........\n.......fb111111bf.......\n.......f11111111f.......\n......fd111111111f......\n......fd11111111df......\n......fd11111111df......\n......fcdd1111ddcff.....\n.......fbcf11fcbfbbf....\n.......ffbdb1bdffff.....\n........fcbfbfdf........\n........ffffffff........\n......ffffffffff........\n.....fcb1bcffff.........\n......ffbff.............\n........................\n........................\n........................\n........................\n........................\n`,img`\n........................\n........................\n........................\n........................\n..........ffff..........\n........ff1111ff........\n.......fb111111bf.......\n.......f11111111f.......\n......fd11111111df......\n......fdd111111ddf......\n......fbdd1111dddf......\n......fcdbfddfbdbf......\n.......fbcf11fcbfff.....\n.......ffb1111bcfbcf....\n........fcdb1bdfbbbf....\n.......ffffffffffcf.....\n.....fcb1bcfffff........\n.....f1b1b1ffff.........\n......ffbff.............\n........................\n........................\n........................\n........................\n........................\n`]</field><data>{\"commentRefs\":[],\"fieldData\":{\"frames\":null}}</data></shadow></value><value name=\"frameInterval\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><value name=\"loop\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">14</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"statusbars_create\"><value name=\"width\"><shadow type=\"math_number\"><field name=\"NUM\">20</field></shadow></value><value name=\"height\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"kind\"><shadow type=\"statusbars_kind\"><field name=\"MEMBER\">EnemyHealth</field></shadow></value></block></value><next><block type=\"statusbars_setColor\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"fillColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">2</field></shadow></value><value name=\"bkgdColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">2</field></shadow></value><value name=\"drainColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">3</field></shadow></value><next><block type=\"statusbar_setLabel\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"label\"><shadow type=\"text\"><field name=\"TEXT\">Aien</field></shadow></value><value name=\"color\"><shadow type=\"colorindexpicker\"><field name=\"index\">1</field></shadow></value><next><block type=\"statusbars_positionNextToSprite\"><field name=\"dir\">CollisionDirection.Bottom</field><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><next><block type=\"StatusBarSprite_blockCombine_set\"><field name=\"property\">StatusBarSprite.value@set</field><value name=\"statusbar\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"1809\" y=\"-969\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile8`</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile10`</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"mapsetwallat\"><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">false</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"timer_after\"><value name=\"time\"><shadow type=\"math_number\"><field name=\"NUM\">5000</field></shadow></value><statement name=\"HANDLER\"><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Center</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Uh oh. An alien has breached the base.</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Center</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Press A to shoot.</field></shadow></value><next><block type=\"function_call\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation></block></next></block></next></block></statement></block></next></block></next></block></next></block></next></block></statement></block></statement></block><block type=\"keyonevent\" x=\"-48\" y=\"-436\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_toggleViewMode\"></block></statement></block><block type=\"keyonevent\" x=\"486\" y=\"-309\"><field name=\"button\">controller.B</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"a+nB2f%[4OGi;MHB]27Q\">projectile</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreateprojectilefromsprite\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow><block type=\"screen_image_picker\"><field name=\"img\">img`\n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . f f . . . . . . . \n. . . . . . f c b f . . . . . . \n. . . . . . f c c f . . . . . . \n. . . . . . . f f . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></block></value><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field></block></value><value name=\"vx\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">50</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"NUM\">0</field></shadow><block type=\"rcRender_getAttribute\"><field name=\"attribute\">Render.attribute.dirX</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value></block></value><value name=\"vy\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">50</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"NUM\">0</field></shadow><block type=\"rcRender_getAttribute\"><field name=\"attribute\">Render.attribute.dirY</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value></block></value></block></value><next><block type=\"spritesetsetflag\"><field name=\"flag\">SpriteFlag.RelativeToCamera</field><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"a+nB2f%[4OGi;MHB]27Q\">projectile</field></block></value><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">false</field></shadow></value></block></next></block></statement></block><block type=\"pxt-on-start\" x=\"-396\" y=\"105\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"rcRender_getRenderSpriteVariable\"></block></value><next><block type=\"rcRender_moveWithController\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"2\" _input_init=\"true\"></mutation><value name=\"v\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">2</field></shadow></value><value name=\"va\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">3</field></shadow></value><value name=\"cameraSway\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"statusbars_create\"><value name=\"width\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value><value name=\"height\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"kind\"><shadow type=\"statusbars_kind\"><field name=\"MEMBER\">Health</field></shadow></value></block></value><next><block type=\"statusbars_setColor\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"fillColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">2</field></shadow></value><value name=\"bkgdColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">15</field></shadow></value><value name=\"drainColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">3</field></shadow></value><next><block type=\"StatusBarSprite_blockCombine_set\"><field name=\"property\">StatusBarSprite.value@set</field><value name=\"statusbar\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value><next><block type=\"statusbars_positionNextToSprite\"><field name=\"dir\">CollisionDirection.Top</field><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><next><block type=\"statusbar_setLabel\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"label\"><shadow type=\"text\"><field name=\"TEXT\">HP</field></shadow></value><value name=\"color\"><shadow type=\"colorindexpicker\"><field name=\"index\">1</field></shadow></value><next><block type=\"setPaddingOffset\"><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"padding\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"offset\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff99d99bbbbbcfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff99ddbdd66168bcccccc9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff999ddbbbd66888111ccccccb99fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9966ddbbbb6688811818ccccccbbc99fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdd69dddbbb66618881888818818cccccbe9fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffddd96dd6b6dbd68888888888888888cccccc99fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffdbbd9666666dbb668886888888cccccccccccccc9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffdbbb99666966d68866888888cccccccccccccccccc69ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffdbbb999669666666888888888ccccbbbcc8bcccccccccc9fffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffdbbb999666666666888888888cbbcbe8bbbcbcccccbbcccb9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffff9bbb999666666666688888888bccb888888bbbbb88888bcccccfffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffdbbb999669666666866888868bbbbb8888888ccc888b88bbc8cccffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffdbbb9d99ddd666668868888688bbcb888888888bc888bcc8bc886c9fffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffbbbbbbddd966666888688888888888888b88888888888cc8ccc886c9ffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffdbbbbbbdd6966666666868888888888bbdbbebb8888888888bcc8c86c9fffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffff9bbdbddd6666666666888688868888ddddddddde8888888888bccbbccccfffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffff9dbb9dd666666666668868888888bddddddbdbbddcccccd88b8ebccbbbbc9ffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffdd99999666666666668868888888bdddddbbbbbdbbbccccccb8bbbccc8bbb9fffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffff9dd99996696966666666668888bbbdddddbbbddbbbbbbbbbcccc8bcccbb8bbcfffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffff9d999996666966666668688888bbdddbbbbdbbbbbbbbbbbcccccc8bbccc88bc9ffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff99999999666996696668868868bbdddddbbbdbbbbbbbbbbbbcbccc88bcccc88c6ffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff999996696669666966d8868666bddbbbddbbdbbbbbbbbbbbbcccccc88bbccc8869fffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff9999996699669666666d6688668bddbbdbbbbbbbbbbbbbbbbbccccccc88bcccc866fffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff9dd999669966666666666688668bdddbbbbbbbbbbbbbbbbbbbccccccc888bbccc669ffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff999999669d69666666666688868bddbbbdbbbbbbbbbbbbbbbbcccccccc888bbcc869ffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99999996ddd69666666688888868ddbddbbbbbbbbbbbbbbbbbbccccccccc888888866ffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff999999969ddd6669666688688888bbbbbbbbbbbbbbbbbbbbbbbbccbccccc8888888869fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99999966ddddd669666688888888bbbbbbbbbbbbbbbbbbbbbbbcbccccccccc88888869fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff999bb99666dddd6666666668886888bbbbbbbbbbbbbbbbbbbbbbcccccccccccc8888889fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbbb966696666666666888886888bbbbbbbbbbbbbbbbbbbbbbcbccccccccccc888886fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbdbb666969666666668888868888bbbbbbbbbbbbbbbbbbbbccbccccccccccc8888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99dbbbbb6696966666666668886868888bbbbeb888bbbbbbbbbcccccccccccccc8888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbbbbbe6969666666666888888888888888888888bbbbbbbbccccccccccccc88888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbccbc66966666666688888688888888888d888ebbbbbbbcccccccccccbb88888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbbcc69996666688668886888888dd88dbbd88bbbbbbbccccccccccceb88888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbbccc999966668868888888888ddddbbbbd88cbbbbbbbbccccccccc8888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9ebbbbcccccccc9966666688888888888888ddbbbb888bbbbbbbbccccccccc8888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbccccccccc666666888866888888888dddddbdd88bbbbbbccccccccc88888888bb9ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffbbbbbbcccccccccc6666688888888888888888d8888888bbbbbbccccccccc88888888bb9ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9dbbbbccbbccccccb666688868888888888888888888888bbbbbccccccccc888888888b9ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9dbbbbbbbbcccccbb66666688888888888888888888888bbbbccccccccccc88888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbcccccccb666666688888888888888888888888bbbbcccccccccc888888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbccccccbb666666688888888888888888888888bbbbcccccccccc88888888886fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbbbbbbbccccb6666668888888888888888888888888bbbbcbcccccccc88888888886fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99dbbbcbbccccb6666668888888888888888888888888bbbbbccccccccc888cc888869fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99dbbbcccccccc6666668688688888888888888888888bbbbccccccccc8888cc888869fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff999bbbbbccccbc6666666688688888888888888888888bbbbcccccccc88888dd88886ffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff969bbbbbbcccc69666666668688868888888888888888bbbbccccccc88888bd888886ffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff99bbbbcccccc696bb668888888868888888888888888bbbcccccccc8888bbd888869ffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff9999bbbcccc9666dbbb8888888888888888888888888ccbcccccccc8888bc888886fffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff699bbbbccc966966bbb8888888888888888888888888bbbbccccc88888bcc88869fffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff9999bbcccc666666dbbdd88888888688888888888888bbcccccc88888888888669fffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff9699dbcccc66666666bb6d8888888688888888888888bbcccccc8888888888869ffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffff9696bbbcc66666666dbbd6886868888888888888888bbcbccc8888888888d669ffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffff999ebbccc666666666dbb8868888688888888888888bbbccc8888888889b69fffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffff969ccbcc66996666666bbb868888888888888888888bbbc888888888888b6ffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffff96ccccc966966666666bb8688666888888888888888b8888888888888699ffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffff99ccbc996666666666dbb6888668888888888888888888888888888869fffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffff969ccb9666666666666dbb88866888888888888888888888888888869ffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffff969ccc6696666666666dd8888668888888888888888888888888866fffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffff969cc9669666966d66dd8888868888888888888888888bb8888669fffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffff96ccc66699669dddd888868888888888888888888888be888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffff96c66669966666dd88886666668888888888888888dd888669fffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffff96966669966ddd686886868888888888888888888d888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffff969666696666666688686888888888888888888888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffff9966966966666666886888888888888886888888669fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9699996666666888888888888888888118888699ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff969996666668888881188888888881888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff996999666688881818888888881886669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9961161186618811188886116699ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff99161111611118111666699fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9999661166669999ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff999999999fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</field><value name=\"VALUE\"><shadow type=\"math_number\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\nf f f f f f f f f f f f f f f f \nb b f f f f f f f f f f f f b b \nb b b b 9 a 9 9 9 9 a 9 b b b b \nb b b b 9 a 9 9 9 9 a 9 b b b b \nb b b b 9 a 9 f f 9 a 9 b b b b \nb b b b 9 a 9 9 9 9 a 9 b b b b \nb b b b 9 a 9 f f 9 a 9 b b b b \nb b b b 9 a 9 f f 9 a 9 b b b b \nb b b b 9 a 9 9 9 9 a 9 b b b b \nb b b b 9 a 9 f f 9 a 9 b b b b \nb b b b 9 a 9 f f 9 a 9 b b b b \nb b b b 9 a 9 9 9 9 a 9 b b b b \nb b b b 9 a 9 9 9 9 a 9 b b b b \nb b b b 9 a 9 9 9 9 a 9 b b b b \nb b f f f f f f f f f f f f b b \nf f f f f f f f f f f f f f f f \n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value></block></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow><block type=\"screen_image_picker\"><field name=\"img\">img`\nf c . . . . . . . . . . . . c f \nc f c . . . . . . . . . . c f c \n. c f c . . . . . . . . c f c . \n. . c f c c . . . . . c f c . . \n. . . c f c . . . . c f c . . . \n. . . . c f c . . c f c . . . . \n. . . . . c 1 . . 1 c . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . c 1 . . 1 c . . . . . \n. . . . c f c . . c f c . . . . \n. . . c f c . . . . c f c . . . \n. . c f c . . . . . . c f c . . \n. c f c . . . . . . . . c f c . \nc f c . . . . . . . . . . c f c \nf c . . . . . . . . . . . . c f \n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value></block></value><next><block type=\"spritesetsetflag\"><field name=\"flag\">SpriteFlag.RelativeToCamera</field><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</field></block></value><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"39\" y=\"93\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></statement></block><block type=\"spritesoverlap\" x=\"583\" y=\"68\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Projectile</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Enemy</field></shadow></value><statement name=\"HANDLER\"><block type=\"StatusBarSprite_blockCombine_change\"><field name=\"property\">StatusBarSprite.value@set</field><value name=\"statusbar\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">-25</field></shadow></value></block></statement></block><block type=\"keyonevent\" x=\"1288\" y=\"69\"><field name=\"button\">controller.A</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_jumpWithHeightAndDuration\"><value name=\"spr\"><block type=\"variables_get\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field></block></value><value name=\"height\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"100\" label=\"Height\" precision=\"0\"></mutation><field name=\"SLIDER\">16</field></shadow></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">1000</field></shadow></value></block></statement></block><block type=\"spritesoverlap\" x=\"482\" y=\"440\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value><statement name=\"HANDLER\"><block type=\"variables_change\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><next><block type=\"spritedestroy2\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"effect\">effects.spray</field><value name=\"sprite\"><block type=\"argument_reporter_custom\"><mutation typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow></value><next><block type=\"hudsetScore\"><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></next></block></statement></block><block type=\"game_show_long_text\" disabled-reasons=\"ORPHANED_BLOCK,MANUALLY_DISABLED\" x=\"-352\" y=\"1197\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"TEXT\">You have been abandoned by your crew and trapped on the moon base</field></shadow></value><next><block type=\"game_show_long_text\" disabled-reasons=\"ORPHANED_BLOCK,MANUALLY_DISABLED\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"TEXT\">Try and find a way out before the asteroid hits</field></shadow></value></block></next></block></xml>","main.ts":"","README.md":" ","assets.json":"","_animation.ts":"//////////////////////// animation.ts contents of previous version, just for test.ts here for convenience /////////////////////\n// file contents:\n// directional animations defines for enging_raycasting.ts\n// for convenience, constructed animations as below, which images are builtin in Arcade, \n// in order from easy to complex\n\n// each are 2D Image array, Image[][]: \n// 1st dimension is direction: \n//    length=1 to any, e.g. 1,2,3,4,...,8,..., engine can automatically arange them to 0~360 \n//    order: start from left, then folling with others in CW order\n//    e.g: \n//         2 directions should be [leftAni,RightAni], \n//         4-direction should be [leftAni, frontAni, rightAni, backAni], \n//         8-direction=[l,lf,f,fr,r,rb,b,lb], ...\n//    the reason that directions start from left, is almost all Arcade builtin one side images are facing left, so that would be convient for using.\n// 2nd dimension is animation Images\n//    length=1 to any, e.g. 1,2,3,4,..., engine will automatically loop them by aniInterval(set when create CompactSprite, or use default)\n\n\n//simplest, just one static image, looks the same in all angle of view\nconst texturesDonut = [[sprites.food.smallDonut]]\nconst texturesBigCake = [[sprites.food.bigCake]]\n\n//1-direction, with ani, looks the same Ani in all angle of view\nconst texturesCoin = [[sprites.builtin.coin0, sprites.builtin.coin1, sprites.builtin.coin2, sprites.builtin.coin3, sprites.builtin.coin4, sprites.builtin.coin5]]\n\nconst texturesDog = [[sprites.builtin.dog0, sprites.builtin.dog1, sprites.builtin.dog2]]\nconst texturesDuck = [[sprites.duck.duck1, sprites.duck.duck2, sprites.duck.duck3, sprites.duck.duck4, sprites.duck.duck5, sprites.duck.duck6]]\n\n//2-direction, with ani, looks difference from left or right side\nconst texturesPlane = [[sprites.vehicle.plane0, sprites.vehicle.plane1, sprites.vehicle.plane2, sprites.vehicle.plane3, sprites.vehicle.plane4, sprites.vehicle.plane5],\n[sprites.vehicle.plane0, sprites.vehicle.plane1, sprites.vehicle.plane2, sprites.vehicle.plane3, sprites.vehicle.plane4, sprites.vehicle.plane5]]\n//no right side ani images builtin, so make them from lefts, and then flipX\nimagesFlipX(texturesPlane[1])\n\nconst texturesFish = [[sprites.builtin.angelFish0, sprites.builtin.angelFish1, sprites.builtin.angelFish2, sprites.builtin.angelFish3],\n[sprites.builtin.angelFish0, sprites.builtin.angelFish1, sprites.builtin.angelFish2, sprites.builtin.angelFish3]]\nimagesFlipX(texturesFish[1])\n\n//4-direction\nconst texturesHero = [\n    [sprites.castle.heroWalkSideLeft1, sprites.castle.heroWalkSideLeft2, sprites.castle.heroWalkSideLeft3, sprites.castle.heroWalkSideLeft4],\n    [sprites.castle.heroWalkFront1, sprites.castle.heroWalkFront2, sprites.castle.heroWalkFront3, sprites.castle.heroWalkFront4],\n    [sprites.castle.heroWalkSideRight1, sprites.castle.heroWalkSideRight2, sprites.castle.heroWalkSideRight3, sprites.castle.heroWalkSideRight4],\n    [sprites.castle.heroWalkBack1, sprites.castle.heroWalkBack2, sprites.castle.heroWalkBack3, sprites.castle.heroWalkBack4],\n]\n\nconst texturesPrincess2 = [\n    [sprites.castle.princess2Left1, sprites.castle.princess2Left2],\n    [sprites.castle.princess2WalkFront1, sprites.castle.princess2WalkFront2, sprites.castle.princess2WalkFront3, sprites.castle.princess2WalkFront2],\n    [sprites.castle.princess2Right1, sprites.castle.princess2Right2],\n    [sprites.castle.princess2WalkBack1, sprites.castle.princess2WalkBack2, sprites.castle.princess2WalkBack3, sprites.castle.princess2WalkBack2],\n]\n\n//4-direction, but back side has only 1 image, so no ani when looking from back\nconst texturesSkelly = [\n    [sprites.castle.skellyWalkLeft1, sprites.castle.skellyWalkLeft2],\n    [sprites.castle.skellyWalkFront1, sprites.castle.skellyWalkFront2, sprites.castle.skellyWalkFront3],\n    [sprites.castle.skellyWalkRight1, sprites.castle.skellyWalkRight2],\n    [img`\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ..........ffff..........\n\t        ........ff1111ff........\n\t        .......fb111111bf.......\n\t        .......f11111111f.......\n\t        ......fd11111111df......\n\t        ......fd11111111df......\n\t        ......fd11111111df......\n\t        ......fb11111111bf......\n\t        ......fcd111111dcf......\n\t        .......fb111111bf.......\n\t        .....ffffdb1bdcfff......\n\t        ....fc111cfbfbc111cf....\n\t        ....f11111ffff11111f....\n\t        ....fbfbfbffffffbfbf....\n\t        .........ffffff.........\n\t        ..........fff...........\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ........................\n\t    `],\n]\n\nconst texturesPrincess = [\n    [sprites.castle.princessLeft0, sprites.castle.princessLeft1, sprites.castle.princessLeft0, sprites.castle.princessLeft2],\n    [sprites.castle.princessFront0, sprites.castle.princessFront1, sprites.castle.princessFront0, sprites.castle.princessFront2],\n    [],\n    [sprites.castle.princessBack0, sprites.castle.princessBack1, sprites.castle.princessBack0, sprites.castle.princessBack2],\n]\ntexturesPrincess[0].forEach((v, i) => {\n    texturesPrincess[2].push(v.clone())\n    texturesPrincess[2][i].flipX()\n}\n)\n\nfunction imagesFlipX(ani: Image[]) {\n    ani.forEach((img, i) => {\n        ani[i] = img.clone() //don't worry memery leak or waste, cause old images are still using by left\n        ani[i].flipX()\n    })\n}\n\n//////////////////////// end of animation.ts contents of previous version //////////////\n\n\n","_render_blocks.ts":"enum RCSpriteAttribute {\n    ZOffset,\n    ZPosition,\n    ZVelocity,\n    ZAcceleration\n}\n/**\n * A 2.5D Screen Render, using Raycasting algorithm\n **/\n//% color=#03AA74 weight=1 icon=\"\\uf1b2\" //cube f1b2 , fold f279\n//% groups='[\"Instance\",\"Basic\", \"Dimension Z\", \"Animate\", \"Advanced\"]'\n//% block=\"3D Render\"\nnamespace Render {\n    export enum attribute {\n        dirX,\n        dirY,\n        fov,\n        wallZScale,\n    }\n\n    export class Animations {\n        constructor(public frameInterval: number, public animations: Image[][]) {\n        }\n\n        msLast = 0\n        index = 0\n        iAnimation = 0\n        getFrameByDir(dir: number): Image {\n            if (control.millis() - this.msLast > this.frameInterval) {\n                this.msLast = control.millis()\n                this.index++\n                this.iAnimation = Math.round((dir * this.animations.length)) % this.animations.length\n                if (this.index >= this.animations[this.iAnimation].length)\n                    this.index = 0\n            }\n            return this.animations[this.iAnimation][this.index]\n        }\n    }\n\n    /**\n * Apply a directional image animations on a sprite\n * @param sprite the sprite to animate on\n * @param animations the directional animates\n */\n    //% blockId=set_animation\n    //% block=\"set $sprite=variables_get(mySprite) with animations$animations\"\n    //% animations.shadow=create_animation\n    //% group=\"Animate\"\n    //% weight=100\n    //% help=github:pxt-raycasting/docs/set-sprite-animations\n    export function setSpriteAnimations(sprite: Sprite, animations: Animations) {\n        raycastingRender.spriteAnimations[sprite.id] = animations\n    }\n\n    /**\n * Create a directional image animations, multi animations will applied to one round dirctions averagely, start from the left. \n * The reason that directions start from left, is almost all Arcade out-of-box 1 or 2-dirction images are facing left, so that would be convient for using.\n * @param frameInterval the time between changes, eg: 150\n * @param frames1 animation, if this is the first of multi animation it will be used as left, others will \n * @param frames2 optional, used for 2 or more dirctional\n * @param frames3 optional, used for 3 or more dirctional\n * @param frames4 optional, used for 4 or more dirctional\n */\n    //% blockId=create_animation\n    //% block=\"interval$frameInterval=timePicker animates:$frames1=animation_editor|| $frames2=animation_editor $frames3=animation_editor $frames4=animation_editor\"\n    //% inlineInputMode=inline\n    //% group=\"Animate\"\n    //% weight=100\n    //% help=github:pxt-raycasting/docs/create-animations\n    export function createAnimations(frameInterval: number, frames1: Image[], frames2?: Image[], frames3?: Image[], frames4?: Image[]): Animations {\n        const animationList = [frames1]\n        if (frames2) animationList.push(frames2)\n        if (frames3) animationList.push(frames3)\n        if (frames4) animationList.push(frames4)\n        return new Animations(frameInterval, animationList)\n    }\n\n    /**\n     * Get the Render\n     * @param img the image\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRCRenderInstance block=\"raycasting render\"\n    //% expandableArgumentMode=toggle\n    //% weight=100 \n    //% blockHidden=true\n    //% hidden=1\n    export function getRCRenderInstance(): RayCastingRender {\n        return raycastingRender\n    }\n\n    /**\n     * Get the render Sprite, which create automatically, for physical collisions, and holding the view point.\n     * You can consider it as \"myself\", and operate it like a usual sprite, eg.: position, speed, scale, collision, ...\n     * But properties relative 3D, eg. ZOffset, ZPosition, viewAngle, and etc. are not in the Sprite class.\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRenderSpriteVariable block=\"myself sprite\"\n    //% expandableArgumentMode=toggle\n    //% blockSetVariable=mySprite\n    //% weight=99\n    //% help=github:pxt-raycasting/get-render-sprite-variable\n    export function getRenderSpriteVariable(): Sprite {\n        return raycastingRender.sprSelf\n    }\n\n    /**\n     * Get the render Sprite, which create automatically, for physical collisions, and holding the view point.(but get/set view direction with dirX/dirY, which not in the Sprite class) \n     * You can consider it as \"myself\", and operate it like a usual sprite.\n     * eg: position, speed, scale, collision, ...\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRenderSpriteInstance block=\"myself sprite\"\n    //% expandableArgumentMode=toggle\n    //% weight=98\n    //% help=github:pxt-raycasting/docs/get-render-sprite-instance\n    export function getRenderSpriteInstance(): Sprite {\n        return raycastingRender.sprSelf\n    }\n\n    /**\n     * Toggle current view mode\n     */\n    //% blockId=rcRender_toggleViewMode block=\"toggle current view mode\"\n    //% group=\"Basic\"\n    //% weight=89\n    //% help=github:pxt-raycasting/docs/toggle-view-mode\n    export function toggleViewMode() {\n        raycastingRender.viewMode = raycastingRender.viewMode == ViewMode.tilemapView ? ViewMode.raycastingView : ViewMode.tilemapView\n    }\n\n    /**\n     * Current view mode is the specific one?\n     * @param viewMode\n     */\n    //% blockId=rcRender_isViewMode block=\"current is $viewMode\"\n    //% group=\"Basic\"\n    //% weight=88\n    //% help=github:pxt-raycasting/docs/is-view-mode\n    export function isViewMode(viewMode: ViewMode): boolean {\n        return viewMode == raycastingRender.viewMode\n    }\n\n    /**\n     * Set view mode\n     * @param viewMode\n     */\n    //% blockId=rcRender_setViewMode block=\"set view mode $viewMode\"\n    //% group=\"Basic\"\n    //% weight=87\n    //% help=github:pxt-raycasting/docs/set-view-mode\n    export function setViewMode(viewMode: ViewMode) {\n        raycastingRender.viewMode = viewMode\n    }\n\n    /**\n     * Get render arribute\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"get %attribute\" \n    //% blockId=rcRender_getAttribute\n    //% weight=83\n    //% help=github:pxt-raycasting/docs/get-attribute\n    export function getAttribute(attr: attribute): number {\n        switch (attr) {\n            case attribute.dirX:\n                return raycastingRender.dirX\n            case attribute.dirY:\n                return raycastingRender.dirY\n            case attribute.fov:\n                return raycastingRender.fov\n            case attribute.wallZScale:\n                return raycastingRender.wallZScale\n            default:\n                return 0\n        }\n    }\n\n    /**\n     * Set render arribute\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"set %attribute = %value\" \n    //% blockId=rcRender_setAttribute\n    //% weight=82\n    //% help=github:pxt-raycasting/docs/set-attribute\n    export function setAttribute(attr: attribute, value: number) {\n        switch (attr) {\n            case attribute.dirX:\n                raycastingRender.dirX = value\n                break\n            case attribute.dirY:\n                raycastingRender.dirY = value\n                break\n            case attribute.fov:\n                if (value < 0) value = 0\n                raycastingRender.fov = value\n                break\n            case attribute.wallZScale:\n                if (value < 0) value = 0\n                raycastingRender.wallZScale = value\n                break\n            default:\n        }\n    }\n\n    /**\n     * Get default FOV (field of view) value\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"defaultFov\"\n    //% blockId=rcRender_getDefaultFov\n    //% weight=81\n    //% help=github:pxt-raycasting/docs/get-default-fov\n    export function getDefaultFov(): number {\n        return defaultFov\n    }\n\n    /**\n     * Set view angle\n     * @param angle, unit: degree 0~360\n     */\n    //% blockId=rcRender_setViewAngleInDegree block=\"set view angle$angle\"\n    //% angle.min=0 angle.max=360 angle.defl=90\n    //% group=\"Basic\"\n    //% weight=80\n    //% help=github:pxt-raycasting/docs/set-view-angle-in-degree\n    export function setViewAngleInDegree(angle: number) {\n        raycastingRender.viewAngle = angle * Math.PI / 180\n    }\n\n    /**\n     * Set view angle by dirX and dirY\n     * @param dirX\n     * @param dirY\n     */\n    //% blockId=rcRender_setViewAngle block=\"set view angle by dirX%dirX and dirY%dirY\"\n    //% group=\"Basic\"\n    //% weight=79\n    //% help=github:pxt-raycasting/docs/set-view-angle\n    export function setViewAngle(dirX: number, dirY: number) {\n        raycastingRender.viewAngle = Math.atan2(dirY, dirX)\n    }\n\n    /**\n     * Set floating offset height for a sprite at Z direction\n     * @param sprite\n     * @param Zoffset Negative floats down, affirmative goes up\n     * @param duration moving time, 0 for immediately, unit: ms\n     */\n    //% blockId=rcRender_setZOffset block=\"set Sprite %spr=variables_get(mySprite) floating %offset pixels|| duration $duration=timePicker|ms \"\n    //% offset.min=-100 offset.max=100 offset.defl=8\n    //% duration.min=0 duration.max=5000 duration.defl=0\n    //% group=\"Dimension Z\"\n    //% weight=77\n    //% blockHidden\n    //% help=github:pxt-raycasting/docs/set-z-offset\n    export function setZOffset(sprite: Sprite, offset: number, duration?: number) {\n        raycastingRender.setZOffset(sprite, offset, duration)\n    }\n\n    /**\n     * Set arribute of a Sprite\n     * @param spr Sprite\n     * @param attr RCSpriteAttribute\n     */\n    //% group=\"Dimension Z\"\n    //% block=\"set Sprite %spr=variables_get(mySprite) %attribute = %value\"\n    //% blockId=rcRender_setSpriteAttribute\n    //% weight=75\n    //% help=github:pxt-raycasting/docs/set-sprite-attribute\n    export function setSpriteAttribute(spr: Sprite, attr: RCSpriteAttribute, value: number) {\n        switch (attr) {\n            case RCSpriteAttribute.ZOffset:\n                raycastingRender.getMotionZ(spr).offset = value\n                break\n            case RCSpriteAttribute.ZPosition:\n                raycastingRender.getMotionZ(spr).p = value\n                break\n            case RCSpriteAttribute.ZVelocity:\n                raycastingRender.getMotionZ(spr).v = value\n                break\n            case RCSpriteAttribute.ZAcceleration:\n                raycastingRender.getMotionZ(spr).a = value\n                break\n            default:\n        }\n    }\n\n    /**\n     * Get arribute of a Sprite\n     * @param spr Sprite\n     * @param attr RCSpriteAttribute\n     */\n    //% group=\"Dimension Z\"\n    //% block=\"get Sprite %spr=variables_get(mySprite) %attribute\"\n    //% blockId=rcRender_getSpriteAttribute\n    //% weight=74\n    //% help=github:pxt-raycasting/docs/get-sprite-attribute\n    export function getSpriteAttribute(spr: Sprite, attr: RCSpriteAttribute): number {\n        switch (attr) {\n            case RCSpriteAttribute.ZOffset:\n                return raycastingRender.getMotionZ(spr).offset\n            case RCSpriteAttribute.ZPosition:\n                return raycastingRender.getMotionZ(spr).p\n            case RCSpriteAttribute.ZVelocity:\n                return raycastingRender.getMotionZ(spr).v\n            case RCSpriteAttribute.ZAcceleration:\n                return raycastingRender.getMotionZ(spr).a\n            default:\n                return 0\n        }\n    }\n\n    /**\n     * Check if 2 sprites overlaps each another in Z dimension\n     * Best work together with sprites.onOverlap(kind1, kind2)\n     * @param sprite1\n     * @param sprite2\n     */\n    //% blockId=rcRender_isSpritesOverlapZ\n    //% block=\"is sprites $sprite1=variables_get(mySprite) and $sprite2=variables_get(mySprite2) overlaps in Z dimension\"\n    //% group=\"Dimension Z\"\n    //% weight=71\n    //% help=github:pxt-raycasting/docs/is-sprites-overlap-z\n    export function isSpritesOverlapZ(sprite1: Sprite, sprite2: Sprite): boolean {\n        return raycastingRender.isOverlapZ(sprite1, sprite2)\n    }\n\n    /**\n     * Make sprite jump, with specific height and duration\n     * Jump can only happened when sprite is standing, current height = its offset .\n     * @param sprite\n     * @param height jump height in pixel\n     * @param duration hover time span, unit: ms\n     */\n    //% blockId=rcRender_jumpWithHeightAndDuration block=\"Sprite %spr=variables_get(mySprite) jump, with height $height duration $duration=timePicker|ms \"\n    //% height.min=0 height.max=100 height.defl=16\n    //% duration.min=50 duration.max=5000 duration.defl=500\n    //% group=\"Dimension Z\"\n    //% weight=70\n    //% help=github:pxt-raycasting/docs/jump-with-height-and-duration\n    export function jumpWithHeightAndDuration(sprite: Sprite, height: number, duration: number) {\n        raycastingRender.jumpWithHeightAndDuration(sprite, height, duration)\n    }\n\n    /**\n     * Make sprite jump, with specific speed and acceleration\n     * Simular with Move block, but jump can only happened when sprite is standing, current height = its offset.\n     * @param sprite\n     * @param v vetical speed, unit: pixel/s\n     * @param a vetical acceleration, unit: pixel/s\n     */\n    //% blockId=rcRender_jump block=\"Sprite %spr=variables_get(mySprite) jump||, with speed $v=spriteSpeedPicker acceleration $a\"\n    //% v.min=-100 v.max=100 v.defl=60\n    //% a.min=-1000 a.max=1000 a.defl=-250\n    //% group=\"Dimension Z\"\n    //% weight=68\n    //% help=github:pxt-raycasting/docs/jump\n    export function jump(sprite: Sprite, v?: number, a?: number) {\n        raycastingRender.jump(sprite, v, a)\n    }\n\n    /**\n     * Make sprite jump, with specific speed and acceleration\n     * @param sprite\n     * @param v vetical speed, unit: pixel/s\n     * @param a vetical acceleration, unit: pixel/s\n     */\n    //% blockId=rcRender_move block=\"Sprite %spr=variables_get(mySprite) move, with speed $v=spriteSpeedPicker|| acceleration $a\"\n    //% v.min=-200 v.max=200 v.defl=60\n    //% a.min=-1000 a.max=1000 a.defl=-250\n    //% group=\"Dimension Z\"\n    //% weight=66\n    //% help=github:pxt-raycasting/docs/move\n    export function move(sprite: Sprite, v?: number, a?: number) {\n        raycastingRender.move(sprite, v, a)\n    }\n\n    /**\n     * Control the self sprite using the direction buttons from the controller. \n     * To stop controlling self sprite, pass 0 for v and va.\n     *\n     * @param v The velocity used for forward/backword movement when up/down is pressed, in pixel/s\n     * @param va The angle velocity used for turn view direction when left/right is pressed, in radian/s.\n     */\n    //% blockId=\"rcRender_moveWithController\" block=\"move with buttons velocity $v|| turn speed $va camera sway$cameraSway pixels\"\n    //% weight=60\n    //% expandableArgumentMode=\"toggle\"\n    //% v.defl=2 va.defl=3\n    //% group=\"Advanced\"\n    //% v.shadow=\"spriteSpeedPicker\"\n    //% va.shadow=\"spriteSpeedPicker\"\n    //% help=github:pxt-raycasting/docs/move-with-controller\n    export function moveWithController(v: number = 2, va: number = 3, cameraSway?: number) {\n        raycastingRender.velocity = v\n        raycastingRender.velocityAngle = va\n        if (cameraSway != undefined)\n            raycastingRender.cameraSway = cameraSway | 0\n    }\n\n    /**\n     * Render takeover all sprites in current scene\n     * Render will call this automatically, but maybe not in time enough.\n     * If you saw sprite draw at its tilemap position on screen, call this just after created the sprite.\n     */\n    //% blockId=rcRender_takeoverSceneSprites \n    //% block=\"takeover sprites in scene\"\n    //% group=\"Advanced\"\n    //% weight=49\n    //% help=github:pxt-raycasting/docs/takeover-scene-sprites\n    export function takeoverSceneSprites() {\n        raycastingRender.takeoverSceneSprites()\n    }\n\n    /**\n     * Run on sprite dirction updated, present view point to Sprite facing dirction, or which angle you see of the sprite.\n     * Just using with other animation extensions, to set proper Image for sprite.\n     * Not required, if you have used the set animations block provided.\n     * @param dir It is a float number, 0~1 corresponds to 0~360, suggest use Math.round(dir*dirAniTotalCount)%dirAniTotalCount to get index of direction\n     */\n    //% blockId=rcRender_registerOnSpriteDirectionUpdateHandler\n    //% block=\"run code when sprite $spr dirction updated to $dir\"\n    //% draggableParameters\n    //% group=\"Advanced\"\n    //% weight=48\n    //% help=github:pxt-raycasting/docs/register-on-sprite-direction-update-handler\n    export function registerOnSpriteDirectionUpdateHandler(handler: (spr: Sprite, dir: number) => void) {\n        raycastingRender.registerOnSpriteDirectionUpdate(handler)\n    }\n}\n","_render_raycasting.ts":"//% shim=pxt::updateScreen\nfunction updateScreen(img: Image) { }\n\nenum ViewMode {\n    //% block=\"TileMap Mode\"\n    tilemapView,\n    //% block=\"Raycasting Mode\"\n    raycastingView,\n}\n\nnamespace Render {\n    const SH = screen.height, SHHalf = SH / 2\n    const SW = screen.width, SWHalf = SW / 2\n    const fpx = 8\n    const fpx_scale = 2 ** fpx\n    function tofpx(n: number) { return (n * fpx_scale) | 0 }\n    const one = 1 << fpx\n    const one2 = 1 << (fpx + fpx)\n    const FPX_MAX = (1 << fpx) - 1\n\n    class MotionSet1D {\n        p: number\n        v: number = 0\n        a: number = 0\n        constructor(public offset: number) {\n            this.p = offset\n        }\n    }\n\n    export const defaultFov = SW / SH / 2  //Wall just fill screen height when standing 1 tile away\n\n    export class RayCastingRender {\n        private tempScreen: Image = image.create(SW, SH)\n\n        velocityAngle: number = 2\n        velocity: number = 3\n        protected _viewMode = ViewMode.raycastingView\n        protected dirXFpx: number\n        protected dirYFpx: number\n        protected planeX: number\n        protected planeY: number\n        protected _angle: number\n        protected _fov: number\n        protected _wallZScale: number = 1\n        cameraSway = 0\n        protected isWalking = false\n        protected cameraOffsetX = 0\n        protected cameraOffsetZ_fpx = 0\n\n        //sprites & accessories\n        sprSelf: Sprite\n        sprites: Sprite[] = []\n        sprites2D: Sprite[] = []\n        spriteParticles: particles.ParticleSource[] = []\n        spriteLikes: SpriteLike[] = []\n        spriteAnimations: Animations[] = []\n        protected spriteMotionZ: MotionSet1D[] = []\n        protected sayRederers: sprites.BaseSpriteSayRenderer[] = []\n        protected sayEndTimes: number[] = []\n\n        //reference\n        protected tilemapScaleSize = 1 << TileScale.Sixteen\n        map: tiles.TileMapData\n        bg: Image\n        textures: Image[]\n        protected oldRender: scene.Renderable\n        protected myRender: scene.Renderable\n\n        //render\n        protected wallHeightInView: number\n        protected wallWidthInView: number\n        protected dist: number[] = []\n        //render perf const\n        cameraRangeAngle: number\n        viewZPos: number\n        selfXFpx: number\n        selfYFpx: number\n\n        //for drawing sprites\n        protected invDet: number //required for correct matrix multiplication\n        camera: scene.Camera\n        tempSprite: Sprite = sprites.create(img`0`)\n        protected transformX: number[] = []\n        protected transformY: number[] = []\n        protected angleSelfToSpr: number[] = []\n\n        onSpriteDirectionUpdateHandler: (spr: Sprite, dir: number) => void\n\n        get xFpx(): number {\n            return Fx.add(this.sprSelf._x, Fx.div(this.sprSelf._width, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        // set xFpx(v: number) {\n        //     this.sprSelf._x = v * this.tilemapScaleSize as any as Fx8\n        // }\n\n        get yFpx(): number {\n            return Fx.add(this.sprSelf._y, Fx.div(this.sprSelf._height, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        // set yFpx(v: number) {\n        //     this.sprSelf._y = v * this.tilemapScaleSize as any as Fx8\n        // }\n\n        get dirX(): number {\n            return this.dirXFpx / fpx_scale\n        }\n\n        get dirY(): number {\n            return this.dirYFpx / fpx_scale\n        }\n\n        set dirX(v: number) {\n            this.dirXFpx = v * fpx_scale\n        }\n\n        set dirY(v: number) {\n            this.dirYFpx = v * fpx_scale\n        }\n\n        sprXFx8(spr: Sprite) {\n            return Fx.add(spr._x, Fx.div(spr._width, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        sprYFx8(spr: Sprite) {\n            return Fx.add(spr._y, Fx.div(spr._height, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        get fov(): number {\n            return this._fov\n        }\n\n        set fov(fov: number) {\n            this._fov = fov\n            this.wallHeightInView = (SW << (fpx - 1)) / this._fov\n            this.wallWidthInView = this.wallHeightInView >> fpx // not fpx  // wallSize / this.fov * 4 / 3 * 2\n            this.cameraRangeAngle = Math.atan(this.fov) + .1 //tolerance for spr center just out of camera\n\n            this.setVectors()\n        }\n\n        get viewAngle(): number {\n            return this._angle\n        }\n        set viewAngle(angle: number) {\n            this._angle = angle\n            this.setVectors()\n            this.updateSelfImage()\n        }\n\n        get wallZScale(): number {\n            return this._wallZScale\n        }\n        set wallZScale(v: number) {\n            this._wallZScale = v\n        }\n\n        getMotionZ(spr: Sprite, offsetZ: number = 0) {\n            let motionZ = this.spriteMotionZ[spr.id]\n            if (!motionZ) {\n                motionZ = new MotionSet1D(tofpx(offsetZ))\n                this.spriteMotionZ[spr.id] = motionZ\n            }\n            return motionZ\n        }\n\n        getZOffset(spr: Sprite) {\n            return this.getMotionZ(spr).offset / fpx_scale\n        }\n\n        setZOffset(spr: Sprite, offsetZ: number, duration: number = 500) {\n            const motionZ = this.getMotionZ(spr, offsetZ)\n\n            motionZ.offset = tofpx(offsetZ)\n            if (motionZ.p != motionZ.offset) {\n                if (duration === 0)\n                    motionZ.p = motionZ.offset\n                else if (motionZ.v == 0)\n                    this.move(spr, (motionZ.offset - motionZ.p) / fpx_scale * 1000 / duration, 0)\n            }\n        }\n\n        getMotionZPosition(spr: Sprite) {\n            return this.getMotionZ(spr).p / fpx_scale\n        }\n\n        //todo, use ZHeight(set from sprite.Height when takeover, then sprite.Height will be replace with width)\n        isOverlapZ(sprite1: Sprite, sprite2: Sprite): boolean {\n            const p1 = this.getMotionZPosition(sprite1)\n            const p2 = this.getMotionZPosition(sprite2)\n            if (p1 < p2) {\n                if (p1 + sprite1.height > p2) return true\n            } else {\n                if (p2 + sprite2.height > p1) return true\n            }\n            return false\n        }\n\n        move(spr: Sprite, v: number, a: number) {\n            const motionZ = this.getMotionZ(spr)\n\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        jump(spr: Sprite, v: number, a: number) {\n            const motionZ = this.getMotionZ(spr)\n            if (motionZ.p != motionZ.offset)\n                return\n\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        jumpWithHeightAndDuration(spr: Sprite, height: number, duration: number) {\n            const motionZ = this.getMotionZ(spr)\n            if (motionZ.p != motionZ.offset)\n                return\n\n            // height= -v*v/a/2\n            // duration = -v/a*2 *1000\n            const v = height * 4000 / duration\n            const a = -v * 2000 / duration\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        get viewMode(): ViewMode {\n            return this._viewMode\n        }\n\n        set viewMode(v: ViewMode) {\n            this._viewMode = v\n        }\n\n        updateViewZPos() {\n            this.viewZPos = this.spriteMotionZ[this.sprSelf.id].p + (this.sprSelf._height as any as number) - (2 << fpx)\n        }\n\n        takeoverSceneSprites() {\n            const sc_allSprites = game.currentScene().allSprites\n            for (let i = 0; i < sc_allSprites.length;) {\n                const spr = sc_allSprites[i]\n                if (spr instanceof Sprite) {\n                    const sprList = (spr.flags & sprites.Flag.RelativeToCamera) ? this.sprites2D : this.sprites\n                    if (sprList.indexOf(spr) < 0) {\n                        sprList.push(spr as Sprite)\n                        this.getMotionZ(spr, 0)\n                        spr.onDestroyed(() => {\n                            this.sprites.removeElement(spr as Sprite)   //can be in one of 2 lists\n                            this.sprites2D.removeElement(spr as Sprite) //can be in one of 2 lists\n                            const sayRenderer = this.sayRederers[spr.id]\n                            if (sayRenderer) {\n                                this.sayRederers.removeElement(sayRenderer)\n                                sayRenderer.destroy()\n                            }\n                        })\n                    }\n                } else if (spr instanceof particles.ParticleSource) {\n                    const particle = (spr as particles.ParticleSource)\n                    if (this.spriteParticles.indexOf(particle) < 0) {\n                        this.spriteParticles[(particle.anchor as Sprite).id] = particle\n                        particle.anchor = this.tempSprite\n                    }\n                } else {\n                    if (this.spriteLikes.indexOf(spr) < 0)\n                        this.spriteLikes.push(spr)\n                }\n                sc_allSprites.removeElement(spr)\n            }\n            this.sprites.forEach((spr) => {\n                if (spr)\n                    this.takeoverSayRenderOfSprite(spr)\n            })\n        }\n        takeoverSayRenderOfSprite(sprite: Sprite) {\n            const sprite_as_any = (sprite as any)\n            if (sprite_as_any.sayRenderer) {\n                this.sayRederers[sprite.id] = sprite_as_any.sayRenderer\n                this.sayEndTimes[sprite.id] = sprite_as_any.sayEndTime;\n                sprite_as_any.sayRenderer = undefined\n                sprite_as_any.sayEndTime = undefined\n            }\n        }\n\n        tilemapLoaded() {\n            const sc = game.currentScene()\n            this.map = sc.tileMap.data\n            this.textures = sc.tileMap.data.getTileset()\n            this.tilemapScaleSize = 1 << sc.tileMap.data.scale\n            this.oldRender = sc.tileMap.renderable\n            this.spriteLikes.removeElement(this.oldRender)\n            sc.allSprites.removeElement(this.oldRender)\n\n            let frameCallback_update = sc.eventContext.registerFrameHandler(scene.PRE_RENDER_UPDATE_PRIORITY + 1, () => {\n                const dt = sc.eventContext.deltaTime;\n                // sc.camera.update();  // already did in scene\n                for (const s of this.sprites)\n                    s.__update(sc.camera, dt);\n                this.sprSelf.__update(sc.camera, dt)\n            })\n\n            let frameCallback_draw = sc.eventContext.registerFrameHandler(scene.RENDER_SPRITES_PRIORITY + 1, () => {\n                if (this._viewMode == ViewMode.tilemapView) {\n                   // screen.drawImage(sc.background.image, 0, 0)\n                    this.oldRender.__drawCore(sc.camera)\n                    this.sprites.forEach(spr => spr.__draw(sc.camera))\n                    this.sprSelf.__draw(sc.camera)\n                } else {\n                 //   this.tempScreen.drawImage(sc.background.image, 0, 0)\n                    //debug\n                    // const ms=control.micros()\n                    this.render()\n                    // info.setScore(control.micros()-ms)\n                    screen.fill(0)\n                }\n                this.sprites2D.forEach(spr => spr.__draw(sc.camera))\n                this.spriteLikes.forEach(spr => spr.__draw(sc.camera))\n                if (this._viewMode == ViewMode.raycastingView)\n                    this.tempScreen.drawTransparentImage(screen, 0, 0)\n            })\n\n            sc.tileMap.addEventListener(tiles.TileMapEvent.Unloaded, data => {\n                sc.eventContext.unregisterFrameHandler(frameCallback_update)\n                sc.eventContext.unregisterFrameHandler(frameCallback_draw)\n            })\n\n            // this.myRender = scene.createRenderable(\n            //     scene.TILE_MAP_Z,\n            //     (t, c) => this.trace(t, c)\n            // )\n\n        }\n\n        constructor() {\n            this._angle = 0\n            this.fov = defaultFov\n            this.camera = new scene.Camera()\n\n            const sc = game.currentScene()\n            if (!sc.tileMap) {\n                sc.tileMap = new tiles.TileMap();\n            } else {\n                this.tilemapLoaded()\n            }\n            game.currentScene().tileMap.addEventListener(tiles.TileMapEvent.Loaded, data => this.tilemapLoaded())\n\n            //self sprite\n            this.sprSelf = sprites.create(image.create(this.tilemapScaleSize >> 1, this.tilemapScaleSize >> 1), SpriteKind.Player)\n            this.takeoverSceneSprites()\n            this.sprites.removeElement(this.sprSelf)\n            this.updateViewZPos()\n            scene.cameraFollowSprite(this.sprSelf)\n            this.updateSelfImage()\n\n            game.onUpdate(function () {\n                this.updateControls()\n            })\n\n            game.onUpdateInterval(400, () => {\n                for (let i = 0; i < this.sprites.length;) {\n                    const spr = this.sprites[i]\n                    if (spr.flags & sprites.Flag.RelativeToCamera) {\n                        this.sprites.removeElement(spr)\n                        this.sprites2D.push(spr)\n                    } else { i++ }\n                }\n                for (let i = 0; i < this.sprites2D.length;) {\n                    const spr = this.sprites2D[i]\n                    if (!(spr.flags & sprites.Flag.RelativeToCamera)) {\n                        this.sprites2D.removeElement(spr)\n                        this.sprites.push(spr)\n                    } else { i++ }\n                }\n                this.takeoverSceneSprites() // in case some one new\n            })\n\n\n            game.onUpdateInterval(25, () => {\n                if (this.cameraSway && this.isWalking) {\n                    this.cameraOffsetX = (Math.sin(control.millis() / 150) * this.cameraSway * 3) | 0\n                    this.cameraOffsetZ_fpx = tofpx(Math.cos(control.millis() / 75) * this.cameraSway) | 0\n                }\n            });\n            control.__screen.setupUpdate(() => {\n                if (this.viewMode == ViewMode.raycastingView)\n                    updateScreen(this.tempScreen)\n                else\n                    updateScreen(screen)\n            })\n\n            game.addScenePushHandler((oldScene) => {\n                control.__screen.setupUpdate(() => { updateScreen(screen) })\n            })\n            game.addScenePopHandler((oldScene) => {\n                control.__screen.setupUpdate(() => {\n                    if (this.viewMode == ViewMode.raycastingView)\n                        updateScreen(this.tempScreen)\n                    else\n                        updateScreen(screen)\n                })\n            })\n        }\n\n        private setVectors() {\n            const sin = Math.sin(this._angle)\n            const cos = Math.cos(this._angle)\n            this.dirXFpx = tofpx(cos)\n            this.dirYFpx = tofpx(sin)\n            this.planeX = tofpx(sin * this._fov)\n            this.planeY = tofpx(cos * -this._fov)\n        }\n\n        //todo, pre-drawn dirctional image\n        public updateSelfImage() {\n            const img = this.sprSelf.image\n            img.fill(6)\n            const arrowLength = img.width / 2\n            img.drawLine(arrowLength, arrowLength, arrowLength + this.dirX * arrowLength, arrowLength + this.dirY * arrowLength, 2)\n            img.fillRect(arrowLength - 1, arrowLength - 1, 2, 2, 2)\n        }\n\n        updateControls() {\n            if (this.velocityAngle !== 0) {\n                const dx = controller.dx(this.velocityAngle)\n                if (dx) {\n                    this.viewAngle += dx\n                }\n            }\n            if (this.velocity !== 0) {\n                this.isWalking = true\n                const dy = controller.dy(this.velocity)\n                if (dy) {\n                    const nx = this.xFpx - Math.round(this.dirXFpx * dy)\n                    const ny = this.yFpx - Math.round(this.dirYFpx * dy)\n                    this.sprSelf.setPosition((nx * this.tilemapScaleSize / fpx_scale), (ny * this.tilemapScaleSize / fpx_scale))\n                } else {\n                    this.isWalking = false\n                }\n            }\n\n            for (const spr of this.sprites) {\n                this.updateMotionZ(spr)\n            }\n            this.updateMotionZ(this.sprSelf)\n        }\n\n        updateMotionZ(spr: Sprite) {\n            const dt = game.eventContext().deltaTime\n            const motionZ = this.spriteMotionZ[spr.id]\n            //if (!motionZ) continue\n\n            if (motionZ.v != 0 || motionZ.p != motionZ.offset) {\n                motionZ.v += motionZ.a * dt, motionZ.p += motionZ.v * dt\n                //landing\n                if ((motionZ.a >= 0 && motionZ.v > 0 && motionZ.p > motionZ.offset) ||\n                    (motionZ.a <= 0 && motionZ.v < 0 && motionZ.p < motionZ.offset)) { motionZ.p = motionZ.offset, motionZ.v = 0 }\n                if (spr === this.sprSelf)\n                    this.updateViewZPos()\n            }\n\n        }\n\n\n        blitRowBreak(screenX: number, screenUp: number, screenDown: number, source: Image, sourceX: number, sourceYBreak: number) {\n\n            let stepY = (sourceYBreak) / (SHHalf - screenUp )\n            let sourceY = sourceYBreak - stepY\n            let y = SHHalf -1\n            if (screenUp < 0)\n                screenUp = 0\n            while (y  >= Math.ceil(screenUp)-1) {\n                if (sourceY < 0) \n                    sourceY = 0\n                const c = source.getPixel(sourceX, sourceY)\n                this.tempScreen.setPixel(screenX, y, c)\n                y--\n                sourceY -= stepY\n            }\n            // from screen half  going down\n            stepY = (source.height - sourceYBreak) / (screenDown - SHHalf)\n            sourceY = sourceYBreak \n            y = SHHalf\n            if (screenDown > SH)\n                screenDown = SH\n            while (y < Math.round(screenDown)) {\n                const c = source.getPixel(sourceX, sourceY)\n                this.tempScreen.setPixel(screenX, y, c)\n                y++\n                sourceY += stepY\n            }\n\n        }\n        \n        render() {\n            // based on https://lodev.org/cgtutor/raycasting.html\n            this.selfXFpx = this.xFpx\n            this.selfYFpx = this.yFpx\n\n            let drawStart = 0\n            let drawHeight = 0\n            let lastDist = -1, lastTexX = -1, lastMapX = -1, lastMapY = -1\n            this.viewZPos = this.spriteMotionZ[this.sprSelf.id].p + (this.sprSelf._height as any as number) - (2 << fpx) + this.cameraOffsetZ_fpx\n            let cameraRangeAngle = Math.atan(this.fov) + .1 //tolerance for spr center just out of camera\n            //debug\n            // const ms=control.millis()\n\n            \n\n\n            const tex = this.textures[1]\n            let rayDirX0 = this.dirXFpx / fpx_scale + (this.planeX / fpx_scale)\n            let rayDirY0 = this.dirYFpx / fpx_scale + (this.planeY / fpx_scale)\n            let rayDirX1 = this.dirXFpx / fpx_scale - (this.planeX / fpx_scale)\n            let rayDirY1 = this.dirYFpx / fpx_scale - (this.planeY / fpx_scale)\n            let fmapX = this.selfXFpx / fpx_scale\n            let fmapY = this.selfYFpx / fpx_scale\n\n            const sc = game.currentScene() \n           // background\n            const speed = 2 // 2: normal speed\n            let backgroundOffset = (this._angle / Math.PI * speed ) % 1  // range -1..1\n            if (backgroundOffset < 0) backgroundOffset++  // range 0..1\n            backgroundOffset *= SW    // range 0..screenwidth\n            \n            //floor\n            for (let y = 60; y < SH; y++) {\n                let p = y - SHHalf\n                let posZ = SH * this.viewZPos / this.tilemapScaleSize / fpx_scale\n                let rowDistance = posZ / p\n                let floorStepX = rowDistance * (rayDirX1 - rayDirX0) / SW\n                let floorStepY = rowDistance * (rayDirY1 - rayDirY0) / SW\n\n\n\n                let floorX = fmapX + rowDistance * rayDirX0\n                let floorY = fmapY + rowDistance * rayDirY0\n                for (let x = 0; x < SW; x++) {\n                      let cellX = Math.floor(floorX)\n                     let cellY = Math.floor(floorY)\n                    let tx =  (16 * (floorX - cellX)) & 15\n                      let ty = (16 * (floorY - cellY)) & (15)\n                    let mapX = Math.round(floorX - 0.5) % 16\n                    let mapY = Math.round(floorY - 0.5) % 16\n                    let tileType = this.map.getTile(mapX, mapY)\n                    let floorTex = this.textures[tileType]\n                    floorX += floorStepX\n                    floorY += floorStepY\n                    let c = floorTex.getPixel(tx, ty)\n                    this.tempScreen.setPixel(x, y, c)\n\n                }\n\n\n\n            }\n            // walls\n\n            for (let x = 0; x < SW; x++) {\n                const cameraX: number = one - Math.idiv(((x + this.cameraOffsetX) << fpx) << 1, SW)\n                let rayDirX = this.dirXFpx + (this.planeX * cameraX >> fpx)\n                let rayDirY = this.dirYFpx + (this.planeY * cameraX >> fpx)\n\n                // avoid division by zero\n                if (rayDirX == 0) rayDirX = 1\n                if (rayDirY == 0) rayDirY = 1\n\n                let mapX = this.selfXFpx >> fpx\n                let mapY = this.selfYFpx >> fpx\n\n                // length of ray from current position to next x or y-side\n                let sideDistX = 0, sideDistY = 0\n\n                // length of ray from one x or y-side to next x or y-side\n                const deltaDistX = Math.abs(Math.idiv(one2, rayDirX));\n                const deltaDistY = Math.abs(Math.idiv(one2, rayDirY));\n\n                let mapStepX = 0, mapStepY = 0\n\n                let sideWallHit = false;\n\n                //calculate step and initial sideDist\n                if (rayDirX < 0) {\n                    mapStepX = -1;\n                    sideDistX = ((this.selfXFpx - (mapX << fpx)) * deltaDistX) >> fpx;\n                } else {\n                    mapStepX = 1;\n                    sideDistX = (((mapX << fpx) + one - this.selfXFpx) * deltaDistX) >> fpx;\n                }\n                if (rayDirY < 0) {\n                    mapStepY = -1;\n                    sideDistY = ((this.selfYFpx - (mapY << fpx)) * deltaDistY) >> fpx;\n                } else {\n                    mapStepY = 1;\n                    sideDistY = (((mapY << fpx) + one - this.selfYFpx) * deltaDistY) >> fpx;\n                }\n\n                let color = 0\n\n                while (true) {\n                    //jump to next map square, OR in x-direction, OR in y-direction\n                    if (sideDistX < sideDistY) {\n                        sideDistX += deltaDistX;\n                        mapX += mapStepX;\n                        sideWallHit = false;\n                    } else {\n                        sideDistY += deltaDistY;\n                        mapY += mapStepY;\n                        sideWallHit = true;\n                    }\n\n                    if (this.map.isOutsideMap(mapX, mapY))\n                        break\n                    color = this.map.getTile(mapX, mapY)\n                    if  (this.map.isWall(mapX, mapY))\n                        break; // hit!\n                }\n\n                if (this.map.isOutsideMap(mapX, mapY))\n                    continue\n\n                let perpWallDist = 0\n                let wallX = 0\n                if (!sideWallHit) {\n                    perpWallDist = Math.idiv(((mapX << fpx) - this.selfXFpx + (1 - mapStepX << fpx - 1)) << fpx, rayDirX)\n                    wallX = this.selfYFpx + (perpWallDist * rayDirY >> fpx);\n                } else {\n                    perpWallDist = Math.idiv(((mapY << fpx) - this.selfYFpx + (1 - mapStepY << fpx - 1)) << fpx, rayDirY)\n                    wallX = this.selfXFpx + (perpWallDist * rayDirX >> fpx);\n                }\n                wallX &= FPX_MAX\n\n                // color = (color - 1) * 2\n                // if (sideWallHit) color++\n\n                const tex = this.textures[color]\n                if (!tex)\n                    continue\n\n                let texX = (wallX * tex.width) >> fpx;\n                // if ((!sideWallHit && rayDirX > 0) || (sideWallHit && rayDirY < 0))\n                //     texX = tex.width - texX - 1;\n\n                const lineHeight = (this.wallHeightInView / perpWallDist)\n                const drawEnd = lineHeight * this.viewZPos / this.tilemapScaleSize / fpx_scale;\n                const horizontBreak = 1 - this.viewZPos / this.tilemapScaleSize / fpx_scale;\n                if (perpWallDist !== lastDist && (texX !== lastTexX || mapX !== lastMapX || mapY !== lastMapY)) {//neighbor line of tex share same parameters\n                     \n                    drawStart = drawEnd - lineHeight * (this._wallZScale) ;\n                    drawHeight = (Math.ceil(drawEnd) - Math.ceil(drawStart) )\n                    drawStart += (SH >> 1)\n\n                    lastDist = perpWallDist\n                    lastTexX = texX\n                    lastMapX = mapX\n                    lastMapY = mapY\n                }\n                //fix start&end points to avoid regmatic between lines\n               \n\n                //if (x < SWHalf)\n                //    this.tempScreen.blitRow(x, drawStart, tex, texX, drawHeight)\n                //else\n                    this.blitRowBreak(x, SHHalf + drawEnd - lineHeight, SHHalf + drawEnd, tex, texX, tex.height * horizontBreak)\n\n                this.dist[x] = perpWallDist\n\n                // background \n                for (let y = 0; y < drawStart; y++ ){\n                    let backX = (backgroundOffset + x) % SW\n                    let c = sc.background.image.getPixel(backX,y)\n                    this.tempScreen.setPixel(x,y,c)\n                }\n            }\n            //debug\n            // info.setScore(control.millis()-ms)\n           // this.tempScreen.print(backgroundOffset.toString(), 0,0,7 )\n           // this.tempScreen.print([Math.roundWithPrecision(this._angle, 3)].join(), 20, 5)\n\n            this.drawSprites()\n        }\n\n        drawSprites() {\n            //debug\n            // let msSprs=control.millis()\n            /////////////////// sprites ///////////////////\n\n            //for sprite\n            const invDet = one2 / (this.planeX * this.dirYFpx - this.dirXFpx * this.planeY); //required for correct matrix multiplication\n\n            this.sprites\n                .filter((spr, i) => {\n                    const spriteX = this.sprXFx8(spr) - this.xFpx // this.selfXFpx\n                    const spriteY = this.sprYFx8(spr) - this.yFpx // this.selfYFpx\n                    this.angleSelfToSpr[spr.id] = Math.atan2(spriteX, spriteY)\n                    this.transformX[spr.id] = invDet * (this.dirYFpx * spriteX - this.dirXFpx * spriteY) >> fpx;\n                    this.transformY[spr.id] = invDet * (-this.planeY * spriteX + this.planeX * spriteY) >> fpx; //this is actually the depth inside the screen, that what Z is in 3D\n                    const angleInCamera = Math.atan2(this.transformX[spr.id] * this.fov, this.transformY[spr.id])\n                    return angleInCamera > -this.cameraRangeAngle && angleInCamera < this.cameraRangeAngle //(this.transformY[spr.id] > 0\n                }).sort((spr1, spr2) => {   // far to near\n                    return (this.transformY[spr2.id] - this.transformY[spr1.id])\n                }).forEach((spr, index) => {\n                    //debug\n                    // this.tempScreen.print([spr.id,Math.roundWithPrecision(angle[spr.id],3)].join(), 0, index * 10 + 10,9)\n                    this.drawSprite(spr, index, this.transformX[spr.id], this.transformY[spr.id], this.angleSelfToSpr[spr.id])\n                })\n\n            //debug\n            // info.setLife(control.millis() - msSprs+1)\n             //this.tempScreen.print([Math.roundWithPrecision(this._angle,3)].join(), 20,  0)\n\n        }\n\n        registerOnSpriteDirectionUpdate(handler: (spr: Sprite, dir: number) => void) {\n            this.onSpriteDirectionUpdateHandler = handler\n        }\n\n        drawSprite(spr: Sprite, index: number, transformX: number, transformY: number, myAngle: number) {\n            const spriteScreenX = Math.ceil((SWHalf) * (1 - transformX / transformY)) - this.cameraOffsetX;\n            const spriteScreenHalfWidth = Math.idiv((spr._width as any as number) / this.tilemapScaleSize / 2 * this.wallWidthInView, transformY)  //origin: (texSpr.width / 2 << fpx) / transformY / this.fov / 3 * 2 * 4\n            const spriteScreenLeft = spriteScreenX - spriteScreenHalfWidth\n            const spriteScreenRight = spriteScreenX + spriteScreenHalfWidth\n\n            //calculate drawing range in X direction\n            //assume there is one range only\n            let blitX = 0, blitWidth = 0\n            for (let sprX = 0; sprX < SW; sprX++) {\n                if (this.dist[sprX] > transformY) {\n                    if (blitWidth == 0)\n                        blitX = sprX\n                    blitWidth++\n                } else if (blitWidth > 0) {\n                    if (blitX <= spriteScreenRight && blitX + blitWidth >= spriteScreenLeft)\n                        break\n                    else\n                        blitX = 0, blitWidth = 0;\n                }\n            }\n            // this.tempScreen.print([this.getxFx8(spr), this.getyFx8(spr)].join(), 0,index*10+10)\n            const blitXSpr = Math.max(blitX, spriteScreenLeft)\n            const blitWidthSpr = Math.min(blitX + blitWidth, spriteScreenRight) - blitXSpr\n            if (blitWidthSpr <= 0)\n                return\n\n            const lineHeight = Math.idiv(this.wallHeightInView, transformY)\n            const drawStart = SHHalf + (lineHeight * ((this.viewZPos - this.spriteMotionZ[spr.id].p - (spr._height as any as number)) / this.tilemapScaleSize) >> fpx)\n\n            //for textures=image[][], abandoned\n            //    const texSpr = spr.getTexture(Math.floor(((Math.atan2(spr.vxFx8, spr.vyFx8) - myAngle) / Math.PI / 2 + 2-.25) * spr.textures.length +.5) % spr.textures.length)\n            //for deal in user code\n            if (this.onSpriteDirectionUpdateHandler)\n                this.onSpriteDirectionUpdateHandler(spr, ((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25))\n            //for CharacterAnimation ext.\n            //     const iTexture = Math.floor(((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25) * 4 + .5) % 4\n            //     const characterAniDirs = [Predicate.MovingLeft,Predicate.MovingDown, Predicate.MovingRight, Predicate.MovingUp]\n            //     character.setCharacterState(spr, character.rule(characterAniDirs[iTexture]))\n            //for this.spriteAnimations\n            const texSpr = !this.spriteAnimations[spr.id] ? spr.image : this.spriteAnimations[spr.id].getFrameByDir(((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25))\n\n            const sprTexRatio = texSpr.width / spriteScreenHalfWidth / 2\n            helpers.imageBlit(\n                this.tempScreen,\n                blitXSpr,\n                drawStart,\n                blitWidthSpr,\n                lineHeight * spr.height / this.tilemapScaleSize,\n                texSpr,\n                (blitXSpr - (spriteScreenX - spriteScreenHalfWidth)) * sprTexRatio\n                ,\n                0,\n                blitWidthSpr * sprTexRatio, texSpr.height, true, false)\n\n            screen.fill(0)\n            const fpx_div_transformy = Math.roundWithPrecision(transformY / 4 / fpx_scale, 2)\n            const height = (SH / fpx_div_transformy)\n            const blitXSaySrc = ((blitX - spriteScreenX) * fpx_div_transformy) + SWHalf\n            const blitWidthSaySrc = (blitWidth * fpx_div_transformy)\n\n            //sprite\n            // screen.drawImage(texSpr, SWHalf-texSpr.width/2, SHHalf)\n            //sayText\n            const sayRender = this.sayRederers[spr.id]\n            if (sayRender) {\n                if (this.sayEndTimes[spr.id] && control.millis() > this.sayEndTimes[spr.id]) {\n                    this.sayRederers[spr.id] = undefined\n                } else {\n                    this.tempSprite.x = SWHalf\n                    this.tempSprite.y = SHHalf + 2\n                    this.camera.drawOffsetX = 0\n                    this.camera.drawOffsetY = 0\n                    sayRender.draw(screen, this.camera, this.tempSprite)\n                }\n            }\n            //particle\n            const particle = this.spriteParticles[spr.id]\n            if (particle) {\n                if (particle.lifespan) {\n                    //debug\n                    // this.tempScreen.print([spr.id].join(), 0,index*10+10)\n                    this.tempSprite.x = SWHalf\n                    this.tempSprite.y = SHHalf + spr.height\n                    this.camera.drawOffsetX = 0//spr.x-SWHalf\n                    this.camera.drawOffsetY = 0//spr.y-SH\n                    particle.__draw(this.camera)\n                } else {\n                    this.spriteParticles[spr.id] = undefined\n                }\n            }\n            //update screen for this spr\n            // const sayTransformY = \n            if (blitXSaySrc <= 0) { //imageBlit considers negative value as 0\n                helpers.imageBlit(\n                    this.tempScreen,\n                    spriteScreenX - SWHalf / fpx_div_transformy, drawStart - height / 2, (blitWidthSaySrc + blitXSaySrc) / fpx_div_transformy, height,\n                    screen,\n                    0, 0, blitWidthSaySrc + blitXSaySrc, SH, true, false)\n            } else {\n                helpers.imageBlit(\n                    this.tempScreen,\n                    // blitX, drawStart - height / 2 , blitWidth, height,\n                    blitX, drawStart - height / 2, blitWidth, height,\n                    screen,\n                    blitXSaySrc, 0, blitWidthSaySrc, SH,\n                    true, false)\n            }\n        }\n    }\n\n    //%fixedinstance\n    export const raycastingRender = new Render.RayCastingRender()\n}\n\n","tilemap.g.jres":"{\n    \"transparency16\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true\n    },\n    \"tile1\": {\n        \"data\": \"hwQQABAAAABBbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfQ==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile\"\n    },\n    \"tile2\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile0\"\n    },\n    \"tile3\": {\n        \"data\": \"hwQQABAAAAB34AAAAAAAAACeAAAAAAAAcOcAAAAAAAAA4AAAAAAAAHcHDgAAAAAA4O4AAAAAAAB34OAAAAAAAADu4AAAAAAAcAfuAAAAAAAH5w4AAAAAAHcADgAAAAAAB+fpAAAAAAB3DgAAAAAAAADgAAAAAAAAd+cOAAAAAAAHDgAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile1\"\n    },\n    \"tile5\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALsLAAAAAAAAuwsAAAAAAAC7CwAAAAAAALv7AAAAAAAAu/vd3d3dDQC7+wAAAAAAALsLAAAAAAAAuwsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile3\"\n    },\n    \"tile6\": {\n        \"data\": \"hwQQABAAAAAkL/QiJCIvJP8v8iQiJP//JE/y//8iT0JCL/IiIiRPIiQv8iIkIi8iIi8iIiJCLyQiL/T//yIvQv8vIi8kQv//Qi8i8iIkLyJCT/L//yIvRCIvIiIiQk8iJC/0QiIiLyRCL/IiQkIvQiQv8v//Ii8k/y/yIiJC//8iT/IiJCIvJA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile4\"\n    },\n    \"tile8\": {\n        \"data\": \"hwQQABAAAAAPAAAAAAAPAA/w//8AAA8A/w8AAP//AAAADwAA/wAAMAAPAAAPAAAAAA8AAA//AAAADwAADwAAAPDw//8AAAAADwAAAP////8PAAAA/////wDw//8AAAAAAA8AAA8AAAAADwAADwAAAAAPAAAPAAAAAA8AAA8AAAAA8P//AAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile6\"\n    },\n    \"tile4\": {\n        \"data\": \"hwQQABAAAADGxsbGxsbGxsbGxv//xsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxvbGxs/Gxg==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile2\"\n    },\n    \"tile10\": {\n        \"data\": \"hwQQABAAAAAdERGxu7u7u9Hd3b0dERGx0d3dvdHd3b3R3d290d3dvdHd3b3R3d290d3dvdHd3b3R3d3d0d3dvbu7u+3R3bvbHRERsbu7Ee3R3d29HdHd3dHd3b3R3d290d3dvdHd3b3R3d290d3dvdHd3b3R3d290d3d3dHd3b27u7vtu7u77Q==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile8\"\n    },\n    \"tile11\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile9\"\n    },\n    \"tile7\": {\n        \"data\": \"hwQQABAAAAC/u7u7u7u7+7+7u7u7u7v7/7u7u7u7u///mZmZmZmZ//+qqqqqqqr//5mZmZmZmf//mZmZmZmZ//+Zn//5n5n//5mf//mfmf//mZmZmZmZ//+ZmZmZmZn//6qqqqqqqv//mZmZmZmZ//+7u7u7u7v/v7u7u7u7u/u/u7u7u7u7+w==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile5\"\n    },\n    \"tile9\": {\n        \"data\": \"hwQQABAAAAC8u//P/f+7y7y7+8u7v7vLzLv7y7u/u8zMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMy7u8u7u7vMvLu7y7u7u8u8u7vLvbu7yw==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile7\"\n    },\n    \"tile12\": {\n        \"data\": \"hwQQABAAAADPzP/P/8/M/M/M/Mz8zMz8/8zMzMzMzP//mZmZmZmZ//+qqqqqqqr//5mZmZmZmf//mZmZmZmZ//+Zn//5n5n//5mf//mfmf//mZmZmZmZ//+ZmZmZmZn//6qqqqqqqv//mZmZmZmZ///MzMzMzMz/z8zMzMzMzPzPzMzMzMzM/A==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile10\"\n    },\n    \"level1\": {\n        \"id\": \"level1\",\n        \"mimeType\": \"application/mkcd-tilemap\",\n        \"data\": \"MTAxMDAwMTAwMDAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMjAyMDIwMTA0MDMwMTAxMDIwMjAyMDIwMjAxMDMwMzAyMDIwMjAxMDEwNTAxMDEwMjAyMDIwMjAyMDEwMzAzMDEwMjAyMDEwNzA2MDEwMTAyMDIwMjAyMDIwMTAzMDMwMzA0MDQwMTAxMDMwMTAxMDIwMjAyMDIwMjAxMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAzMDMwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDMwMzAxMDEwMTAxMDIwMjAyMDIwMjAxMDEwMTAxMDEwMzAzMDEwMTAxMDEwMjAyMDIwMjAyMDEwMjAyMDIwMjAzMDMwMTAxMDEwMTAyMDIwMjAyMDIwMTAyMDIwMjAyMDMwMzAyMDIwMTAxMDIwMjAyMDIwMjAxMDIwMjAyMDIwMzAzMDIwMjAxMDEwMjAyMDIwMjAyMDEwMjAyMDIwMjAzMDMwMjAyMDEwMTAxMDEwMTAxMDEwMTAyMDIwMjAyMDMwMzAyMDIwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMjIyMjIyMjIyMjIyMjIyMjAyMDAyMDAyMDAwMDAwMjAwMjAwMDAwMjAwMDAwMDIwMDIwMDAwMDIwMDAwMDAyMDIyMjIwMDAyMDAwMDAwMjAyMjIyMjIyMjIyMjIyMjIyMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMjIyMjIyMjIyMjIyMjIyMg==\",\n        \"tileset\": [\n            \"myTiles.transparency16\",\n            \"sprites.dungeon.floorLight0\",\n            \"sprites.dungeon.floorLight1\",\n            \"sprites.dungeon.floorDark0\",\n            \"myTiles.tile7\",\n            \"myTiles.tile4\",\n            \"myTiles.tile9\",\n            \"myTiles.tile10\",\n            \"myTiles.tile12\"\n        ],\n        \"displayName\": \"level\"\n    },\n    \"*\": {\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"dataEncoding\": \"base64\",\n        \"namespace\": \"myTiles\"\n    }\n}","tilemap.g.ts":"","pxt.json":"{\n    \"name\": \"3d floor and background - Copy\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"device\": \"*\",\n        \"sprite-scaling\": \"*\",\n        \"pxt-status-bar\": \"github:jwunderl/pxt-status-bar#v0.4.2\",\n        \"Timers\": \"github:microsoft/arcade-timers#v1.1.0\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"assets.json\",\n        \"_animation.ts\",\n        \"_render_blocks.ts\",\n        \"_render_raycasting.ts\",\n        \"tilemap.g.jres\",\n        \"tilemap.g.ts\"\n    ],\n    \"targetVersions\": {\n        \"branch\": \"v1.10.36\",\n        \"tag\": \"v1.10.36\",\n        \"commits\": \"https://github.com/microsoft/pxt-arcade/commits/3a5a7e13703edf0412c17bdb9b1469e282a5b31b\",\n        \"target\": \"1.10.36\",\n        \"pxt\": \"8.3.9\"\n    },\n    \"preferredEditor\": \"blocksprj\"\n}\n"}},{"timestamp":1763750812111,"editorVersion":"2.0.62","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable type=\"KIND_SpriteKind\" id=\"USZ`q|D]$0kk|,E!b7c6\">Player</variable><variable type=\"KIND_SpriteKind\" id=\"@8#W0|ESmtdS+3`?Z+:+\">Projectile</variable><variable type=\"KIND_SpriteKind\" id=\"h1jvB:JPL=NMGpJB=4/[\">Food</variable><variable type=\"KIND_SpriteKind\" id=\"(3Y]|wk94c4t/c`pc((X\">Enemy</variable><variable type=\"KIND_SpriteKind\" id=\"2B=HiFZ(Kz-^Ln6ox1L~\">Help</variable><variable type=\"KIND_SpriteKind\" id=\"JWhoDx%e%9JIa%.pfAVv\">StatusBar</variable><variable type=\"KIND_StatusBarKind\" id=\"s%(2IG9YG[q#qn#zR$RL\">Health</variable><variable type=\"KIND_StatusBarKind\" id=\"INxD@r~~T0Wy@hJh=pGh\">Energy</variable><variable type=\"KIND_StatusBarKind\" id=\"z}t^*,Y7$$C-kcZG$91G\">Magic</variable><variable type=\"KIND_StatusBarKind\" id=\"|+h5Z!s*YkuLvDsM!-~j\">EnemyHealth</variable><variable id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</variable><variable id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</variable><variable id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</variable><variable id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</variable><variable id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</variable><variable id=\"[a3#yOs:sosi5Zk_px6P\">mySprite3</variable><variable id=\"i:_MCpc`P;?/}W#x|ztg\">Shell</variable><variable id=\"a+nB2f%[4OGi;MHB]27Q\">projectile</variable><variable id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</variable><variable id=\":9u@hfRXr7DucX:sce8;\">statusbar2</variable><variable id=\"prjF_cc1IE$ODI9J$|9|\">otherSprite</variable></variables><block type=\"function_definition\" x=\"368\" y=\"-1080\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation><field name=\"function_name\">Summon alien</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n........................\n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Enemy</field></shadow></value></block></value><next><block type=\"run_image_animation\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field></block></value><value name=\"frames\"><shadow type=\"animation_editor\"><field name=\"frames\">[img`\n........................\n........................\n........................\n........................\n........................\n..........ffff..........\n........ff1111ff........\n.......fb111111bf.......\n.....fffc1111111f.......\n...fc111cd1111111f......\n...f1b1b1b1111dddf......\n...fbfbffcf11fcddf......\n......fcf111111bbf......\n.......ccbdb1b1fcf......\n.......fffbfbfdff.......\n........ffffffff........\n........fffffffffff.....\n.........fffffc111cf....\n.........fffff1b1b1f....\n..........ffffbfbfbf....\n...........ffff.........\n........................\n........................\n........................\n`,img`\n........................\n........................\n........................\n........................\n........................\n..........ffff..........\n........ff1111ff........\n.......fb111111bf.......\n.......f11111111f.......\n......fd11111111df......\n....7.fd11111111df......\n...7..fd11111111df......\n...7..fd11111111df......\n...7..fddd1111dddff.....\n...77.fbdbfddfbdbfcf....\n...777fcdcf11fcdcfbf....\n....77fffbdb1bdffcf.....\n....fcb1bcffffff........\n....f1c1c1ffffff........\n....fdfdfdfffff.........\n.....f.f.f..............\n........................\n........................\n........................\n`,img`\n........................\n........................\n........................\n........................\n..........ffff..........\n........ff1111ff........\n.......fb111111bf.......\n.......f11111111f.......\n......fd111111111f......\n......fd11111111df......\n......fd11111111df......\n......fcdd1111ddcff.....\n.......fbcf11fcbfbbf....\n.......ffbdb1bdffff.....\n........fcbfbfdf........\n........ffffffff........\n......ffffffffff........\n.....fcb1bcffff.........\n......ffbff.............\n........................\n........................\n........................\n........................\n........................\n`,img`\n........................\n........................\n........................\n........................\n..........ffff..........\n........ff1111ff........\n.......fb111111bf.......\n.......f11111111f.......\n......fd11111111df......\n......fdd111111ddf......\n......fbdd1111dddf......\n......fcdbfddfbdbf......\n.......fbcf11fcbfff.....\n.......ffb1111bcfbcf....\n........fcdb1bdfbbbf....\n.......ffffffffffcf.....\n.....fcb1bcfffff........\n.....f1b1b1ffff.........\n......ffbff.............\n........................\n........................\n........................\n........................\n........................\n`]</field><data>{\"commentRefs\":[],\"fieldData\":{\"frames\":null}}</data></shadow></value><value name=\"frameInterval\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><value name=\"loop\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"]E-:r;:Z?)yoXY:Os[NT\">mySprite</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">14</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"statusbars_create\"><value name=\"width\"><shadow type=\"math_number\"><field name=\"NUM\">20</field></shadow></value><value name=\"height\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"kind\"><shadow type=\"statusbars_kind\"><field name=\"MEMBER\">EnemyHealth</field></shadow></value></block></value><next><block type=\"statusbars_setColor\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"fillColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">2</field></shadow></value><value name=\"bkgdColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">2</field></shadow></value><value name=\"drainColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">3</field></shadow></value><next><block type=\"statusbar_setLabel\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"label\"><shadow type=\"text\"><field name=\"TEXT\">Aien</field></shadow></value><value name=\"color\"><shadow type=\"colorindexpicker\"><field name=\"index\">1</field></shadow></value><next><block type=\"statusbars_positionNextToSprite\"><field name=\"dir\">CollisionDirection.Bottom</field><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><next><block type=\"StatusBarSprite_blockCombine_set\"><field name=\"property\">StatusBarSprite.value@set</field><value name=\"statusbar\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"-390\" y=\"-765\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile8`</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">assets.tile`myTile10`</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"mapsetwallat\"><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">false</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value></shadow></value><next><block type=\"timer_after\"><value name=\"time\"><shadow type=\"math_number\"><field name=\"NUM\">5000</field></shadow></value><statement name=\"HANDLER\"><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Center</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Uh oh. An alien has breached the base.</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Center</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Press A to shoot.</field></shadow></value><next><block type=\"function_call\"><mutation name=\"Summon alien\" functionid=\"nMZJB{d?_)a%f*?o7Ag0\"></mutation></block></next></block></next></block></statement></block></next></block></next></block></next></block></next></block></statement></block></statement></block><block type=\"keyonevent\" x=\"-87\" y=\"-529\"><field name=\"button\">controller.menu</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_toggleViewMode\"></block></statement></block><block type=\"keyonevent\" x=\"447\" y=\"-402\"><field name=\"button\">controller.B</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"a+nB2f%[4OGi;MHB]27Q\">projectile</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreateprojectilefromsprite\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow><block type=\"screen_image_picker\"><field name=\"img\">img`\n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . f . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></block></value><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field></block></value><value name=\"vx\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">50</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"NUM\">0</field></shadow><block type=\"rcRender_getAttribute\"><field name=\"attribute\">Render.attribute.dirX</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value></block></value><value name=\"vy\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">50</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"NUM\">0</field></shadow><block type=\"rcRender_getAttribute\"><field name=\"attribute\">Render.attribute.dirY</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value></block></value></block></value><next><block type=\"spritesetsetflag\"><field name=\"flag\">SpriteFlag.RelativeToCamera</field><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"a+nB2f%[4OGi;MHB]27Q\">projectile</field></block></value><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">false</field></shadow></value></block></next></block></statement></block><block type=\"pxt-on-start\" x=\"-435\" y=\"12\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"rcRender_getRenderSpriteVariable\"></block></value><next><block type=\"rcRender_moveWithController\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"2\" _input_init=\"true\"></mutation><value name=\"v\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">2</field></shadow></value><value name=\"va\"><shadow type=\"spriteSpeedPicker\"><field name=\"speed\">3</field></shadow></value><value name=\"cameraSway\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"statusbars_create\"><value name=\"width\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value><value name=\"height\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"kind\"><shadow type=\"statusbars_kind\"><field name=\"MEMBER\">Health</field></shadow></value></block></value><next><block type=\"statusbars_setColor\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"fillColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">2</field></shadow></value><value name=\"bkgdColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">15</field></shadow></value><value name=\"drainColor\"><shadow type=\"colorindexpicker\"><field name=\"index\">3</field></shadow></value><next><block type=\"StatusBarSprite_blockCombine_set\"><field name=\"property\">StatusBarSprite.value@set</field><value name=\"statusbar\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value><next><block type=\"statusbars_positionNextToSprite\"><field name=\"dir\">CollisionDirection.Top</field><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><next><block type=\"statusbar_setLabel\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"label\"><shadow type=\"text\"><field name=\"TEXT\">HP</field></shadow></value><value name=\"color\"><shadow type=\"colorindexpicker\"><field name=\"index\">1</field></shadow></value><next><block type=\"setPaddingOffset\"><value name=\"this\"><block type=\"variables_get\"><field name=\"VAR\" id=\"i7.)j5_s@jz|f9GZjgel\">statusbar</field></block></value><value name=\"padding\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"offset\"><shadow type=\"math_number\"><field name=\"NUM\">2</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">You have been abandoned by your crew and trapped on the moon base</field></shadow></value><next><block type=\"game_show_long_text\"><field name=\"layout\">DialogLayout.Full</field><value name=\"str\"><shadow type=\"text\"><field name=\"TEXT\">Try and find a way out before the asteroid hits</field></shadow></value><next><block type=\"set_current_tilemap\"><value name=\"tilemap\"><shadow type=\"tiles_tilemap_editor\"><field name=\"tilemap\">tilemap`level`</field><data>{\"commentRefs\":[],\"fieldData\":{\"tilemap\":\"level1\"}}</data></shadow></value><next><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff99d99bbbbbcfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff99ddbdd66168bcccccc9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff999ddbbbd66888111ccccccb99fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9966ddbbbb6688811818ccccccbbc99fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdd69dddbbb66618881888818818cccccbe9fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffddd96dd6b6dbd68888888888888888cccccc99fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffdbbd9666666dbb668886888888cccccccccccccc9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffdbbb99666966d68866888888cccccccccccccccccc69ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffdbbb999669666666888888888ccccbbbcc8bcccccccccc9fffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffdbbb999666666666888888888cbbcbe8bbbcbcccccbbcccb9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffff9bbb999666666666688888888bccb888888bbbbb88888bcccccfffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffdbbb999669666666866888868bbbbb8888888ccc888b88bbc8cccffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffdbbb9d99ddd666668868888688bbcb888888888bc888bcc8bc886c9fffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffbbbbbbddd966666888688888888888888b88888888888cc8ccc886c9ffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffdbbbbbbdd6966666666868888888888bbdbbebb8888888888bcc8c86c9fffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffff9bbdbddd6666666666888688868888ddddddddde8888888888bccbbccccfffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffff9dbb9dd666666666668868888888bddddddbdbbddcccccd88b8ebccbbbbc9ffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffdd99999666666666668868888888bdddddbbbbbdbbbccccccb8bbbccc8bbb9fffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffff9dd99996696966666666668888bbbdddddbbbddbbbbbbbbbcccc8bcccbb8bbcfffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffff9d999996666966666668688888bbdddbbbbdbbbbbbbbbbbcccccc8bbccc88bc9ffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff99999999666996696668868868bbdddddbbbdbbbbbbbbbbbbcbccc88bcccc88c6ffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff999996696669666966d8868666bddbbbddbbdbbbbbbbbbbbbcccccc88bbccc8869fffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff9999996699669666666d6688668bddbbdbbbbbbbbbbbbbbbbbccccccc88bcccc866fffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff9dd999669966666666666688668bdddbbbbbbbbbbbbbbbbbbbccccccc888bbccc669ffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff999999669d69666666666688868bddbbbdbbbbbbbbbbbbbbbbcccccccc888bbcc869ffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99999996ddd69666666688888868ddbddbbbbbbbbbbbbbbbbbbccccccccc888888866ffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff999999969ddd6669666688688888bbbbbbbbbbbbbbbbbbbbbbbbccbccccc8888888869fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99999966ddddd669666688888888bbbbbbbbbbbbbbbbbbbbbbbcbccccccccc88888869fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff999bb99666dddd6666666668886888bbbbbbbbbbbbbbbbbbbbbbcccccccccccc8888889fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbbb966696666666666888886888bbbbbbbbbbbbbbbbbbbbbbcbccccccccccc888886fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbdbb666969666666668888868888bbbbbbbbbbbbbbbbbbbbccbccccccccccc8888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99dbbbbb6696966666666668886868888bbbbeb888bbbbbbbbbcccccccccccccc8888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbbbbbe6969666666666888888888888888888888bbbbbbbbccccccccccccc88888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbccbc66966666666688888688888888888d888ebbbbbbbcccccccccccbb88888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbbcc69996666688668886888888dd88dbbd88bbbbbbbccccccccccceb88888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbbccc999966668868888888888ddddbbbbd88cbbbbbbbbccccccccc8888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9ebbbbcccccccc9966666688888888888888ddbbbb888bbbbbbbbccccccccc8888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbccccccccc666666888866888888888dddddbdd88bbbbbbccccccccc88888888bb9ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffbbbbbbcccccccccc6666688888888888888888d8888888bbbbbbccccccccc88888888bb9ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9dbbbbccbbccccccb666688868888888888888888888888bbbbbccccccccc888888888b9ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9dbbbbbbbbcccccbb66666688888888888888888888888bbbbccccccccccc88888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbcccccccb666666688888888888888888888888bbbbcccccccccc888888888869ffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff9bbbbbbbccccccbb666666688888888888888888888888bbbbcccccccccc88888888886fffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffff99bbbbbbbbccccb6666668888888888888888888888888bbbbcbcccccccc88888888886fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99dbbbcbbccccb6666668888888888888888888888888bbbbbccccccccc888cc888869fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff99dbbbcccccccc6666668688688888888888888888888bbbbccccccccc8888cc888869fffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff999bbbbbccccbc6666666688688888888888888888888bbbbcccccccc88888dd88886ffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffff969bbbbbbcccc69666666668688868888888888888888bbbbccccccc88888bd888886ffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff99bbbbcccccc696bb668888888868888888888888888bbbcccccccc8888bbd888869ffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffff9999bbbcccc9666dbbb8888888888888888888888888ccbcccccccc8888bc888886fffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff699bbbbccc966966bbb8888888888888888888888888bbbbccccc88888bcc88869fffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff9999bbcccc666666dbbdd88888888688888888888888bbcccccc88888888888669fffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffff9699dbcccc66666666bb6d8888888688888888888888bbcccccc8888888888869ffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffff9696bbbcc66666666dbbd6886868888888888888888bbcbccc8888888888d669ffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffff999ebbccc666666666dbb8868888688888888888888bbbccc8888888889b69fffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffff969ccbcc66996666666bbb868888888888888888888bbbc888888888888b6ffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffff96ccccc966966666666bb8688666888888888888888b8888888888888699ffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffff99ccbc996666666666dbb6888668888888888888888888888888888869fffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffff969ccb9666666666666dbb88866888888888888888888888888888869ffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffff969ccc6696666666666dd8888668888888888888888888888888866fffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffff969cc9669666966d66dd8888868888888888888888888bb8888669fffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffff96ccc66699669dddd888868888888888888888888888be888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffff96c66669966666dd88886666668888888888888888dd888669fffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffff96966669966ddd686886868888888888888888888d888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffff969666696666666688686888888888888888888888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffff9966966966666666886888888888888886888888669fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9699996666666888888888888888888118888699ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff969996666668888881188888888881888669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff996999666688881818888888881886669ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9961161186618811188886116699ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff99161111611118111666699fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9999661166669999ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff999999999fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\nffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</field><value name=\"VALUE\"><shadow type=\"math_number\" disabled-reasons=\"MANUALLY_DISABLED\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\nf f f f f f f f f f f f f f f f \nb b f f f f f f f f f f f f b b \nb b b b 9 a 9 9 9 9 a 9 b b b b \nb b b b 9 a 9 9 9 9 a 9 b b b b \nb b b b 9 a 9 f f 9 a 9 b b b b \nb b b b 9 a 9 9 9 9 a 9 b b b b \nb b b b 9 a 9 f f 9 a 9 b b b b \nb b b b 9 a 9 f f 9 a 9 b b b b \nb b b b 9 a 9 9 9 9 a 9 b b b b \nb b b b 9 a 9 f f 9 a 9 b b b b \nb b b b 9 a 9 f f 9 a 9 b b b b \nb b b b 9 a 9 9 9 9 a 9 b b b b \nb b b b 9 a 9 9 9 9 a 9 b b b b \nb b b b 9 a 9 9 9 9 a 9 b b b b \nb b f f f f f f f f f f f f b b \nf f f f f f f f f f f f f f f f \n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value></block></value><next><block type=\"mapplaceontile\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"$9]am(OMeCg%p@(H-Wcb\">Power Core</field></block></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></shadow><block type=\"screen_image_picker\"><field name=\"img\">img`\nf c . . . . . . . . . . . . c f \nc f c . . . . . . . . . . c f c \n. c f c . . . . . . . . c f c . \n. . c f c c . . . . . c f c . . \n. . . c f c . . . . c f c . . . \n. . . . c f c . . c f c . . . . \n. . . . . c 1 . . 1 c . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . . . . . . . . . . . . \n. . . . . c 1 . . 1 c . . . . . \n. . . . c f c . . c f c . . . . \n. . . c f c . . . . c f c . . . \n. . c f c . . . . . . c f c . . \n. c f c . . . . . . . . c f c . \nc f c . . . . . . . . . . c f c \nf c . . . . . . . . . . . . c f \n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":null}}</data></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value></block></value><next><block type=\"spritesetsetflag\"><field name=\"flag\">SpriteFlag.RelativeToCamera</field><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\"yN+qcd^u,}G|D2!Ll|}r\">Crosshair</field></block></value><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"spriteshittile\" x=\"0\" y=\"0\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_location\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"tiles.Location\"></mutation><field name=\"VALUE\">location</field></block></value><statement name=\"HANDLER\"><block type=\"mapsettileat\"><value name=\"tile\"><shadow type=\"tileset_tile_picker\"><field name=\"tile\">sprites.dungeon.floorDark0</field></shadow></value><value name=\"loc\"><shadow type=\"mapgettile\"><value name=\"col\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value><value name=\"row\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></shadow></value></block></statement></block><block type=\"spritesoverlap\" x=\"544\" y=\"-25\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Projectile</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Enemy</field></shadow></value><statement name=\"HANDLER\"><block type=\"StatusBarSprite_blockCombine_change\"><field name=\"property\">StatusBarSprite.value@set</field><value name=\"statusbar\"><block type=\"variables_get\"><field name=\"VAR\" id=\":9u@hfRXr7DucX:sce8;\">statusbar2</field></block></value><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">-25</field></shadow></value></block></statement></block><block type=\"keyonevent\" x=\"1249\" y=\"-24\"><field name=\"button\">controller.A</field><field name=\"event\">ControllerButtonEvent.Pressed</field><statement name=\"HANDLER\"><block type=\"rcRender_jumpWithHeightAndDuration\"><value name=\"spr\"><block type=\"variables_get\"><field name=\"VAR\" id=\"Ed`)aC9;AU!85fI5,Q`1\">mySprite2</field></block></value><value name=\"height\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"100\" label=\"Height\" precision=\"0\"></mutation><field name=\"SLIDER\">16</field></shadow></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">1000</field></shadow></value></block></statement></block><block type=\"spritesoverlap\" x=\"443\" y=\"347\"><value name=\"HANDLER_DRAG_PARAM_sprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">sprite</field></block></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value><value name=\"HANDLER_DRAG_PARAM_otherSprite\"><block type=\"argument_reporter_custom\"><mutation duplicateondrag=\"true\" typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"otherKind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Help</field></shadow></value><statement name=\"HANDLER\"><block type=\"variables_change\"><field name=\"VAR\" id=\"j2OXe95Q*Z=]LSRAz#Q;\">Power</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><next><block type=\"spritedestroy2\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"effect\">effects.spray</field><value name=\"sprite\"><block type=\"argument_reporter_custom\"><mutation typename=\"Sprite\"></mutation><field name=\"VALUE\">otherSprite</field></block></value><value name=\"duration\"><shadow type=\"timePicker\"><field name=\"ms\">500</field></shadow></value><next><block type=\"hudsetScore\"><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></next></block></statement></block></xml>","main.ts":"","README.md":" ","assets.json":"","_animation.ts":"//////////////////////// animation.ts contents of previous version, just for test.ts here for convenience /////////////////////\n// file contents:\n// directional animations defines for enging_raycasting.ts\n// for convenience, constructed animations as below, which images are builtin in Arcade, \n// in order from easy to complex\n\n// each are 2D Image array, Image[][]: \n// 1st dimension is direction: \n//    length=1 to any, e.g. 1,2,3,4,...,8,..., engine can automatically arange them to 0~360 \n//    order: start from left, then folling with others in CW order\n//    e.g: \n//         2 directions should be [leftAni,RightAni], \n//         4-direction should be [leftAni, frontAni, rightAni, backAni], \n//         8-direction=[l,lf,f,fr,r,rb,b,lb], ...\n//    the reason that directions start from left, is almost all Arcade builtin one side images are facing left, so that would be convient for using.\n// 2nd dimension is animation Images\n//    length=1 to any, e.g. 1,2,3,4,..., engine will automatically loop them by aniInterval(set when create CompactSprite, or use default)\n\n\n//simplest, just one static image, looks the same in all angle of view\nconst texturesDonut = [[sprites.food.smallDonut]]\nconst texturesBigCake = [[sprites.food.bigCake]]\n\n//1-direction, with ani, looks the same Ani in all angle of view\nconst texturesCoin = [[sprites.builtin.coin0, sprites.builtin.coin1, sprites.builtin.coin2, sprites.builtin.coin3, sprites.builtin.coin4, sprites.builtin.coin5]]\n\nconst texturesDog = [[sprites.builtin.dog0, sprites.builtin.dog1, sprites.builtin.dog2]]\nconst texturesDuck = [[sprites.duck.duck1, sprites.duck.duck2, sprites.duck.duck3, sprites.duck.duck4, sprites.duck.duck5, sprites.duck.duck6]]\n\n//2-direction, with ani, looks difference from left or right side\nconst texturesPlane = [[sprites.vehicle.plane0, sprites.vehicle.plane1, sprites.vehicle.plane2, sprites.vehicle.plane3, sprites.vehicle.plane4, sprites.vehicle.plane5],\n[sprites.vehicle.plane0, sprites.vehicle.plane1, sprites.vehicle.plane2, sprites.vehicle.plane3, sprites.vehicle.plane4, sprites.vehicle.plane5]]\n//no right side ani images builtin, so make them from lefts, and then flipX\nimagesFlipX(texturesPlane[1])\n\nconst texturesFish = [[sprites.builtin.angelFish0, sprites.builtin.angelFish1, sprites.builtin.angelFish2, sprites.builtin.angelFish3],\n[sprites.builtin.angelFish0, sprites.builtin.angelFish1, sprites.builtin.angelFish2, sprites.builtin.angelFish3]]\nimagesFlipX(texturesFish[1])\n\n//4-direction\nconst texturesHero = [\n    [sprites.castle.heroWalkSideLeft1, sprites.castle.heroWalkSideLeft2, sprites.castle.heroWalkSideLeft3, sprites.castle.heroWalkSideLeft4],\n    [sprites.castle.heroWalkFront1, sprites.castle.heroWalkFront2, sprites.castle.heroWalkFront3, sprites.castle.heroWalkFront4],\n    [sprites.castle.heroWalkSideRight1, sprites.castle.heroWalkSideRight2, sprites.castle.heroWalkSideRight3, sprites.castle.heroWalkSideRight4],\n    [sprites.castle.heroWalkBack1, sprites.castle.heroWalkBack2, sprites.castle.heroWalkBack3, sprites.castle.heroWalkBack4],\n]\n\nconst texturesPrincess2 = [\n    [sprites.castle.princess2Left1, sprites.castle.princess2Left2],\n    [sprites.castle.princess2WalkFront1, sprites.castle.princess2WalkFront2, sprites.castle.princess2WalkFront3, sprites.castle.princess2WalkFront2],\n    [sprites.castle.princess2Right1, sprites.castle.princess2Right2],\n    [sprites.castle.princess2WalkBack1, sprites.castle.princess2WalkBack2, sprites.castle.princess2WalkBack3, sprites.castle.princess2WalkBack2],\n]\n\n//4-direction, but back side has only 1 image, so no ani when looking from back\nconst texturesSkelly = [\n    [sprites.castle.skellyWalkLeft1, sprites.castle.skellyWalkLeft2],\n    [sprites.castle.skellyWalkFront1, sprites.castle.skellyWalkFront2, sprites.castle.skellyWalkFront3],\n    [sprites.castle.skellyWalkRight1, sprites.castle.skellyWalkRight2],\n    [img`\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ..........ffff..........\n\t        ........ff1111ff........\n\t        .......fb111111bf.......\n\t        .......f11111111f.......\n\t        ......fd11111111df......\n\t        ......fd11111111df......\n\t        ......fd11111111df......\n\t        ......fb11111111bf......\n\t        ......fcd111111dcf......\n\t        .......fb111111bf.......\n\t        .....ffffdb1bdcfff......\n\t        ....fc111cfbfbc111cf....\n\t        ....f11111ffff11111f....\n\t        ....fbfbfbffffffbfbf....\n\t        .........ffffff.........\n\t        ..........fff...........\n\t        ........................\n\t        ........................\n\t        ........................\n\t        ........................\n\t    `],\n]\n\nconst texturesPrincess = [\n    [sprites.castle.princessLeft0, sprites.castle.princessLeft1, sprites.castle.princessLeft0, sprites.castle.princessLeft2],\n    [sprites.castle.princessFront0, sprites.castle.princessFront1, sprites.castle.princessFront0, sprites.castle.princessFront2],\n    [],\n    [sprites.castle.princessBack0, sprites.castle.princessBack1, sprites.castle.princessBack0, sprites.castle.princessBack2],\n]\ntexturesPrincess[0].forEach((v, i) => {\n    texturesPrincess[2].push(v.clone())\n    texturesPrincess[2][i].flipX()\n}\n)\n\nfunction imagesFlipX(ani: Image[]) {\n    ani.forEach((img, i) => {\n        ani[i] = img.clone() //don't worry memery leak or waste, cause old images are still using by left\n        ani[i].flipX()\n    })\n}\n\n//////////////////////// end of animation.ts contents of previous version //////////////\n\n\n","_render_blocks.ts":"enum RCSpriteAttribute {\n    ZOffset,\n    ZPosition,\n    ZVelocity,\n    ZAcceleration\n}\n/**\n * A 2.5D Screen Render, using Raycasting algorithm\n **/\n//% color=#03AA74 weight=1 icon=\"\\uf1b2\" //cube f1b2 , fold f279\n//% groups='[\"Instance\",\"Basic\", \"Dimension Z\", \"Animate\", \"Advanced\"]'\n//% block=\"3D Render\"\nnamespace Render {\n    export enum attribute {\n        dirX,\n        dirY,\n        fov,\n        wallZScale,\n    }\n\n    export class Animations {\n        constructor(public frameInterval: number, public animations: Image[][]) {\n        }\n\n        msLast = 0\n        index = 0\n        iAnimation = 0\n        getFrameByDir(dir: number): Image {\n            if (control.millis() - this.msLast > this.frameInterval) {\n                this.msLast = control.millis()\n                this.index++\n                this.iAnimation = Math.round((dir * this.animations.length)) % this.animations.length\n                if (this.index >= this.animations[this.iAnimation].length)\n                    this.index = 0\n            }\n            return this.animations[this.iAnimation][this.index]\n        }\n    }\n\n    /**\n * Apply a directional image animations on a sprite\n * @param sprite the sprite to animate on\n * @param animations the directional animates\n */\n    //% blockId=set_animation\n    //% block=\"set $sprite=variables_get(mySprite) with animations$animations\"\n    //% animations.shadow=create_animation\n    //% group=\"Animate\"\n    //% weight=100\n    //% help=github:pxt-raycasting/docs/set-sprite-animations\n    export function setSpriteAnimations(sprite: Sprite, animations: Animations) {\n        raycastingRender.spriteAnimations[sprite.id] = animations\n    }\n\n    /**\n * Create a directional image animations, multi animations will applied to one round dirctions averagely, start from the left. \n * The reason that directions start from left, is almost all Arcade out-of-box 1 or 2-dirction images are facing left, so that would be convient for using.\n * @param frameInterval the time between changes, eg: 150\n * @param frames1 animation, if this is the first of multi animation it will be used as left, others will \n * @param frames2 optional, used for 2 or more dirctional\n * @param frames3 optional, used for 3 or more dirctional\n * @param frames4 optional, used for 4 or more dirctional\n */\n    //% blockId=create_animation\n    //% block=\"interval$frameInterval=timePicker animates:$frames1=animation_editor|| $frames2=animation_editor $frames3=animation_editor $frames4=animation_editor\"\n    //% inlineInputMode=inline\n    //% group=\"Animate\"\n    //% weight=100\n    //% help=github:pxt-raycasting/docs/create-animations\n    export function createAnimations(frameInterval: number, frames1: Image[], frames2?: Image[], frames3?: Image[], frames4?: Image[]): Animations {\n        const animationList = [frames1]\n        if (frames2) animationList.push(frames2)\n        if (frames3) animationList.push(frames3)\n        if (frames4) animationList.push(frames4)\n        return new Animations(frameInterval, animationList)\n    }\n\n    /**\n     * Get the Render\n     * @param img the image\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRCRenderInstance block=\"raycasting render\"\n    //% expandableArgumentMode=toggle\n    //% weight=100 \n    //% blockHidden=true\n    //% hidden=1\n    export function getRCRenderInstance(): RayCastingRender {\n        return raycastingRender\n    }\n\n    /**\n     * Get the render Sprite, which create automatically, for physical collisions, and holding the view point.\n     * You can consider it as \"myself\", and operate it like a usual sprite, eg.: position, speed, scale, collision, ...\n     * But properties relative 3D, eg. ZOffset, ZPosition, viewAngle, and etc. are not in the Sprite class.\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRenderSpriteVariable block=\"myself sprite\"\n    //% expandableArgumentMode=toggle\n    //% blockSetVariable=mySprite\n    //% weight=99\n    //% help=github:pxt-raycasting/get-render-sprite-variable\n    export function getRenderSpriteVariable(): Sprite {\n        return raycastingRender.sprSelf\n    }\n\n    /**\n     * Get the render Sprite, which create automatically, for physical collisions, and holding the view point.(but get/set view direction with dirX/dirY, which not in the Sprite class) \n     * You can consider it as \"myself\", and operate it like a usual sprite.\n     * eg: position, speed, scale, collision, ...\n     */\n    //% group=\"Instance\"\n    //% blockId=rcRender_getRenderSpriteInstance block=\"myself sprite\"\n    //% expandableArgumentMode=toggle\n    //% weight=98\n    //% help=github:pxt-raycasting/docs/get-render-sprite-instance\n    export function getRenderSpriteInstance(): Sprite {\n        return raycastingRender.sprSelf\n    }\n\n    /**\n     * Toggle current view mode\n     */\n    //% blockId=rcRender_toggleViewMode block=\"toggle current view mode\"\n    //% group=\"Basic\"\n    //% weight=89\n    //% help=github:pxt-raycasting/docs/toggle-view-mode\n    export function toggleViewMode() {\n        raycastingRender.viewMode = raycastingRender.viewMode == ViewMode.tilemapView ? ViewMode.raycastingView : ViewMode.tilemapView\n    }\n\n    /**\n     * Current view mode is the specific one?\n     * @param viewMode\n     */\n    //% blockId=rcRender_isViewMode block=\"current is $viewMode\"\n    //% group=\"Basic\"\n    //% weight=88\n    //% help=github:pxt-raycasting/docs/is-view-mode\n    export function isViewMode(viewMode: ViewMode): boolean {\n        return viewMode == raycastingRender.viewMode\n    }\n\n    /**\n     * Set view mode\n     * @param viewMode\n     */\n    //% blockId=rcRender_setViewMode block=\"set view mode $viewMode\"\n    //% group=\"Basic\"\n    //% weight=87\n    //% help=github:pxt-raycasting/docs/set-view-mode\n    export function setViewMode(viewMode: ViewMode) {\n        raycastingRender.viewMode = viewMode\n    }\n\n    /**\n     * Get render arribute\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"get %attribute\" \n    //% blockId=rcRender_getAttribute\n    //% weight=83\n    //% help=github:pxt-raycasting/docs/get-attribute\n    export function getAttribute(attr: attribute): number {\n        switch (attr) {\n            case attribute.dirX:\n                return raycastingRender.dirX\n            case attribute.dirY:\n                return raycastingRender.dirY\n            case attribute.fov:\n                return raycastingRender.fov\n            case attribute.wallZScale:\n                return raycastingRender.wallZScale\n            default:\n                return 0\n        }\n    }\n\n    /**\n     * Set render arribute\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"set %attribute = %value\" \n    //% blockId=rcRender_setAttribute\n    //% weight=82\n    //% help=github:pxt-raycasting/docs/set-attribute\n    export function setAttribute(attr: attribute, value: number) {\n        switch (attr) {\n            case attribute.dirX:\n                raycastingRender.dirX = value\n                break\n            case attribute.dirY:\n                raycastingRender.dirY = value\n                break\n            case attribute.fov:\n                if (value < 0) value = 0\n                raycastingRender.fov = value\n                break\n            case attribute.wallZScale:\n                if (value < 0) value = 0\n                raycastingRender.wallZScale = value\n                break\n            default:\n        }\n    }\n\n    /**\n     * Get default FOV (field of view) value\n     * @param viewMode\n     */\n    //% group=\"Basic\"\n    //% block=\"defaultFov\"\n    //% blockId=rcRender_getDefaultFov\n    //% weight=81\n    //% help=github:pxt-raycasting/docs/get-default-fov\n    export function getDefaultFov(): number {\n        return defaultFov\n    }\n\n    /**\n     * Set view angle\n     * @param angle, unit: degree 0~360\n     */\n    //% blockId=rcRender_setViewAngleInDegree block=\"set view angle$angle\"\n    //% angle.min=0 angle.max=360 angle.defl=90\n    //% group=\"Basic\"\n    //% weight=80\n    //% help=github:pxt-raycasting/docs/set-view-angle-in-degree\n    export function setViewAngleInDegree(angle: number) {\n        raycastingRender.viewAngle = angle * Math.PI / 180\n    }\n\n    /**\n     * Set view angle by dirX and dirY\n     * @param dirX\n     * @param dirY\n     */\n    //% blockId=rcRender_setViewAngle block=\"set view angle by dirX%dirX and dirY%dirY\"\n    //% group=\"Basic\"\n    //% weight=79\n    //% help=github:pxt-raycasting/docs/set-view-angle\n    export function setViewAngle(dirX: number, dirY: number) {\n        raycastingRender.viewAngle = Math.atan2(dirY, dirX)\n    }\n\n    /**\n     * Set floating offset height for a sprite at Z direction\n     * @param sprite\n     * @param Zoffset Negative floats down, affirmative goes up\n     * @param duration moving time, 0 for immediately, unit: ms\n     */\n    //% blockId=rcRender_setZOffset block=\"set Sprite %spr=variables_get(mySprite) floating %offset pixels|| duration $duration=timePicker|ms \"\n    //% offset.min=-100 offset.max=100 offset.defl=8\n    //% duration.min=0 duration.max=5000 duration.defl=0\n    //% group=\"Dimension Z\"\n    //% weight=77\n    //% blockHidden\n    //% help=github:pxt-raycasting/docs/set-z-offset\n    export function setZOffset(sprite: Sprite, offset: number, duration?: number) {\n        raycastingRender.setZOffset(sprite, offset, duration)\n    }\n\n    /**\n     * Set arribute of a Sprite\n     * @param spr Sprite\n     * @param attr RCSpriteAttribute\n     */\n    //% group=\"Dimension Z\"\n    //% block=\"set Sprite %spr=variables_get(mySprite) %attribute = %value\"\n    //% blockId=rcRender_setSpriteAttribute\n    //% weight=75\n    //% help=github:pxt-raycasting/docs/set-sprite-attribute\n    export function setSpriteAttribute(spr: Sprite, attr: RCSpriteAttribute, value: number) {\n        switch (attr) {\n            case RCSpriteAttribute.ZOffset:\n                raycastingRender.getMotionZ(spr).offset = value\n                break\n            case RCSpriteAttribute.ZPosition:\n                raycastingRender.getMotionZ(spr).p = value\n                break\n            case RCSpriteAttribute.ZVelocity:\n                raycastingRender.getMotionZ(spr).v = value\n                break\n            case RCSpriteAttribute.ZAcceleration:\n                raycastingRender.getMotionZ(spr).a = value\n                break\n            default:\n        }\n    }\n\n    /**\n     * Get arribute of a Sprite\n     * @param spr Sprite\n     * @param attr RCSpriteAttribute\n     */\n    //% group=\"Dimension Z\"\n    //% block=\"get Sprite %spr=variables_get(mySprite) %attribute\"\n    //% blockId=rcRender_getSpriteAttribute\n    //% weight=74\n    //% help=github:pxt-raycasting/docs/get-sprite-attribute\n    export function getSpriteAttribute(spr: Sprite, attr: RCSpriteAttribute): number {\n        switch (attr) {\n            case RCSpriteAttribute.ZOffset:\n                return raycastingRender.getMotionZ(spr).offset\n            case RCSpriteAttribute.ZPosition:\n                return raycastingRender.getMotionZ(spr).p\n            case RCSpriteAttribute.ZVelocity:\n                return raycastingRender.getMotionZ(spr).v\n            case RCSpriteAttribute.ZAcceleration:\n                return raycastingRender.getMotionZ(spr).a\n            default:\n                return 0\n        }\n    }\n\n    /**\n     * Check if 2 sprites overlaps each another in Z dimension\n     * Best work together with sprites.onOverlap(kind1, kind2)\n     * @param sprite1\n     * @param sprite2\n     */\n    //% blockId=rcRender_isSpritesOverlapZ\n    //% block=\"is sprites $sprite1=variables_get(mySprite) and $sprite2=variables_get(mySprite2) overlaps in Z dimension\"\n    //% group=\"Dimension Z\"\n    //% weight=71\n    //% help=github:pxt-raycasting/docs/is-sprites-overlap-z\n    export function isSpritesOverlapZ(sprite1: Sprite, sprite2: Sprite): boolean {\n        return raycastingRender.isOverlapZ(sprite1, sprite2)\n    }\n\n    /**\n     * Make sprite jump, with specific height and duration\n     * Jump can only happened when sprite is standing, current height = its offset .\n     * @param sprite\n     * @param height jump height in pixel\n     * @param duration hover time span, unit: ms\n     */\n    //% blockId=rcRender_jumpWithHeightAndDuration block=\"Sprite %spr=variables_get(mySprite) jump, with height $height duration $duration=timePicker|ms \"\n    //% height.min=0 height.max=100 height.defl=16\n    //% duration.min=50 duration.max=5000 duration.defl=500\n    //% group=\"Dimension Z\"\n    //% weight=70\n    //% help=github:pxt-raycasting/docs/jump-with-height-and-duration\n    export function jumpWithHeightAndDuration(sprite: Sprite, height: number, duration: number) {\n        raycastingRender.jumpWithHeightAndDuration(sprite, height, duration)\n    }\n\n    /**\n     * Make sprite jump, with specific speed and acceleration\n     * Simular with Move block, but jump can only happened when sprite is standing, current height = its offset.\n     * @param sprite\n     * @param v vetical speed, unit: pixel/s\n     * @param a vetical acceleration, unit: pixel/s\n     */\n    //% blockId=rcRender_jump block=\"Sprite %spr=variables_get(mySprite) jump||, with speed $v=spriteSpeedPicker acceleration $a\"\n    //% v.min=-100 v.max=100 v.defl=60\n    //% a.min=-1000 a.max=1000 a.defl=-250\n    //% group=\"Dimension Z\"\n    //% weight=68\n    //% help=github:pxt-raycasting/docs/jump\n    export function jump(sprite: Sprite, v?: number, a?: number) {\n        raycastingRender.jump(sprite, v, a)\n    }\n\n    /**\n     * Make sprite jump, with specific speed and acceleration\n     * @param sprite\n     * @param v vetical speed, unit: pixel/s\n     * @param a vetical acceleration, unit: pixel/s\n     */\n    //% blockId=rcRender_move block=\"Sprite %spr=variables_get(mySprite) move, with speed $v=spriteSpeedPicker|| acceleration $a\"\n    //% v.min=-200 v.max=200 v.defl=60\n    //% a.min=-1000 a.max=1000 a.defl=-250\n    //% group=\"Dimension Z\"\n    //% weight=66\n    //% help=github:pxt-raycasting/docs/move\n    export function move(sprite: Sprite, v?: number, a?: number) {\n        raycastingRender.move(sprite, v, a)\n    }\n\n    /**\n     * Control the self sprite using the direction buttons from the controller. \n     * To stop controlling self sprite, pass 0 for v and va.\n     *\n     * @param v The velocity used for forward/backword movement when up/down is pressed, in pixel/s\n     * @param va The angle velocity used for turn view direction when left/right is pressed, in radian/s.\n     */\n    //% blockId=\"rcRender_moveWithController\" block=\"move with buttons velocity $v|| turn speed $va camera sway$cameraSway pixels\"\n    //% weight=60\n    //% expandableArgumentMode=\"toggle\"\n    //% v.defl=2 va.defl=3\n    //% group=\"Advanced\"\n    //% v.shadow=\"spriteSpeedPicker\"\n    //% va.shadow=\"spriteSpeedPicker\"\n    //% help=github:pxt-raycasting/docs/move-with-controller\n    export function moveWithController(v: number = 2, va: number = 3, cameraSway?: number) {\n        raycastingRender.velocity = v\n        raycastingRender.velocityAngle = va\n        if (cameraSway != undefined)\n            raycastingRender.cameraSway = cameraSway | 0\n    }\n\n    /**\n     * Render takeover all sprites in current scene\n     * Render will call this automatically, but maybe not in time enough.\n     * If you saw sprite draw at its tilemap position on screen, call this just after created the sprite.\n     */\n    //% blockId=rcRender_takeoverSceneSprites \n    //% block=\"takeover sprites in scene\"\n    //% group=\"Advanced\"\n    //% weight=49\n    //% help=github:pxt-raycasting/docs/takeover-scene-sprites\n    export function takeoverSceneSprites() {\n        raycastingRender.takeoverSceneSprites()\n    }\n\n    /**\n     * Run on sprite dirction updated, present view point to Sprite facing dirction, or which angle you see of the sprite.\n     * Just using with other animation extensions, to set proper Image for sprite.\n     * Not required, if you have used the set animations block provided.\n     * @param dir It is a float number, 0~1 corresponds to 0~360, suggest use Math.round(dir*dirAniTotalCount)%dirAniTotalCount to get index of direction\n     */\n    //% blockId=rcRender_registerOnSpriteDirectionUpdateHandler\n    //% block=\"run code when sprite $spr dirction updated to $dir\"\n    //% draggableParameters\n    //% group=\"Advanced\"\n    //% weight=48\n    //% help=github:pxt-raycasting/docs/register-on-sprite-direction-update-handler\n    export function registerOnSpriteDirectionUpdateHandler(handler: (spr: Sprite, dir: number) => void) {\n        raycastingRender.registerOnSpriteDirectionUpdate(handler)\n    }\n}\n","_render_raycasting.ts":"//% shim=pxt::updateScreen\nfunction updateScreen(img: Image) { }\n\nenum ViewMode {\n    //% block=\"TileMap Mode\"\n    tilemapView,\n    //% block=\"Raycasting Mode\"\n    raycastingView,\n}\n\nnamespace Render {\n    const SH = screen.height, SHHalf = SH / 2\n    const SW = screen.width, SWHalf = SW / 2\n    const fpx = 8\n    const fpx_scale = 2 ** fpx\n    function tofpx(n: number) { return (n * fpx_scale) | 0 }\n    const one = 1 << fpx\n    const one2 = 1 << (fpx + fpx)\n    const FPX_MAX = (1 << fpx) - 1\n\n    class MotionSet1D {\n        p: number\n        v: number = 0\n        a: number = 0\n        constructor(public offset: number) {\n            this.p = offset\n        }\n    }\n\n    export const defaultFov = SW / SH / 2  //Wall just fill screen height when standing 1 tile away\n\n    export class RayCastingRender {\n        private tempScreen: Image = image.create(SW, SH)\n\n        velocityAngle: number = 2\n        velocity: number = 3\n        protected _viewMode = ViewMode.raycastingView\n        protected dirXFpx: number\n        protected dirYFpx: number\n        protected planeX: number\n        protected planeY: number\n        protected _angle: number\n        protected _fov: number\n        protected _wallZScale: number = 1\n        cameraSway = 0\n        protected isWalking = false\n        protected cameraOffsetX = 0\n        protected cameraOffsetZ_fpx = 0\n\n        //sprites & accessories\n        sprSelf: Sprite\n        sprites: Sprite[] = []\n        sprites2D: Sprite[] = []\n        spriteParticles: particles.ParticleSource[] = []\n        spriteLikes: SpriteLike[] = []\n        spriteAnimations: Animations[] = []\n        protected spriteMotionZ: MotionSet1D[] = []\n        protected sayRederers: sprites.BaseSpriteSayRenderer[] = []\n        protected sayEndTimes: number[] = []\n\n        //reference\n        protected tilemapScaleSize = 1 << TileScale.Sixteen\n        map: tiles.TileMapData\n        bg: Image\n        textures: Image[]\n        protected oldRender: scene.Renderable\n        protected myRender: scene.Renderable\n\n        //render\n        protected wallHeightInView: number\n        protected wallWidthInView: number\n        protected dist: number[] = []\n        //render perf const\n        cameraRangeAngle: number\n        viewZPos: number\n        selfXFpx: number\n        selfYFpx: number\n\n        //for drawing sprites\n        protected invDet: number //required for correct matrix multiplication\n        camera: scene.Camera\n        tempSprite: Sprite = sprites.create(img`0`)\n        protected transformX: number[] = []\n        protected transformY: number[] = []\n        protected angleSelfToSpr: number[] = []\n\n        onSpriteDirectionUpdateHandler: (spr: Sprite, dir: number) => void\n\n        get xFpx(): number {\n            return Fx.add(this.sprSelf._x, Fx.div(this.sprSelf._width, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        // set xFpx(v: number) {\n        //     this.sprSelf._x = v * this.tilemapScaleSize as any as Fx8\n        // }\n\n        get yFpx(): number {\n            return Fx.add(this.sprSelf._y, Fx.div(this.sprSelf._height, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        // set yFpx(v: number) {\n        //     this.sprSelf._y = v * this.tilemapScaleSize as any as Fx8\n        // }\n\n        get dirX(): number {\n            return this.dirXFpx / fpx_scale\n        }\n\n        get dirY(): number {\n            return this.dirYFpx / fpx_scale\n        }\n\n        set dirX(v: number) {\n            this.dirXFpx = v * fpx_scale\n        }\n\n        set dirY(v: number) {\n            this.dirYFpx = v * fpx_scale\n        }\n\n        sprXFx8(spr: Sprite) {\n            return Fx.add(spr._x, Fx.div(spr._width, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        sprYFx8(spr: Sprite) {\n            return Fx.add(spr._y, Fx.div(spr._height, Fx.twoFx8)) as any as number / this.tilemapScaleSize\n        }\n\n        get fov(): number {\n            return this._fov\n        }\n\n        set fov(fov: number) {\n            this._fov = fov\n            this.wallHeightInView = (SW << (fpx - 1)) / this._fov\n            this.wallWidthInView = this.wallHeightInView >> fpx // not fpx  // wallSize / this.fov * 4 / 3 * 2\n            this.cameraRangeAngle = Math.atan(this.fov) + .1 //tolerance for spr center just out of camera\n\n            this.setVectors()\n        }\n\n        get viewAngle(): number {\n            return this._angle\n        }\n        set viewAngle(angle: number) {\n            this._angle = angle\n            this.setVectors()\n            this.updateSelfImage()\n        }\n\n        get wallZScale(): number {\n            return this._wallZScale\n        }\n        set wallZScale(v: number) {\n            this._wallZScale = v\n        }\n\n        getMotionZ(spr: Sprite, offsetZ: number = 0) {\n            let motionZ = this.spriteMotionZ[spr.id]\n            if (!motionZ) {\n                motionZ = new MotionSet1D(tofpx(offsetZ))\n                this.spriteMotionZ[spr.id] = motionZ\n            }\n            return motionZ\n        }\n\n        getZOffset(spr: Sprite) {\n            return this.getMotionZ(spr).offset / fpx_scale\n        }\n\n        setZOffset(spr: Sprite, offsetZ: number, duration: number = 500) {\n            const motionZ = this.getMotionZ(spr, offsetZ)\n\n            motionZ.offset = tofpx(offsetZ)\n            if (motionZ.p != motionZ.offset) {\n                if (duration === 0)\n                    motionZ.p = motionZ.offset\n                else if (motionZ.v == 0)\n                    this.move(spr, (motionZ.offset - motionZ.p) / fpx_scale * 1000 / duration, 0)\n            }\n        }\n\n        getMotionZPosition(spr: Sprite) {\n            return this.getMotionZ(spr).p / fpx_scale\n        }\n\n        //todo, use ZHeight(set from sprite.Height when takeover, then sprite.Height will be replace with width)\n        isOverlapZ(sprite1: Sprite, sprite2: Sprite): boolean {\n            const p1 = this.getMotionZPosition(sprite1)\n            const p2 = this.getMotionZPosition(sprite2)\n            if (p1 < p2) {\n                if (p1 + sprite1.height > p2) return true\n            } else {\n                if (p2 + sprite2.height > p1) return true\n            }\n            return false\n        }\n\n        move(spr: Sprite, v: number, a: number) {\n            const motionZ = this.getMotionZ(spr)\n\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        jump(spr: Sprite, v: number, a: number) {\n            const motionZ = this.getMotionZ(spr)\n            if (motionZ.p != motionZ.offset)\n                return\n\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        jumpWithHeightAndDuration(spr: Sprite, height: number, duration: number) {\n            const motionZ = this.getMotionZ(spr)\n            if (motionZ.p != motionZ.offset)\n                return\n\n            // height= -v*v/a/2\n            // duration = -v/a*2 *1000\n            const v = height * 4000 / duration\n            const a = -v * 2000 / duration\n            motionZ.v = tofpx(v)\n            motionZ.a = tofpx(a)\n        }\n\n        get viewMode(): ViewMode {\n            return this._viewMode\n        }\n\n        set viewMode(v: ViewMode) {\n            this._viewMode = v\n        }\n\n        updateViewZPos() {\n            this.viewZPos = this.spriteMotionZ[this.sprSelf.id].p + (this.sprSelf._height as any as number) - (2 << fpx)\n        }\n\n        takeoverSceneSprites() {\n            const sc_allSprites = game.currentScene().allSprites\n            for (let i = 0; i < sc_allSprites.length;) {\n                const spr = sc_allSprites[i]\n                if (spr instanceof Sprite) {\n                    const sprList = (spr.flags & sprites.Flag.RelativeToCamera) ? this.sprites2D : this.sprites\n                    if (sprList.indexOf(spr) < 0) {\n                        sprList.push(spr as Sprite)\n                        this.getMotionZ(spr, 0)\n                        spr.onDestroyed(() => {\n                            this.sprites.removeElement(spr as Sprite)   //can be in one of 2 lists\n                            this.sprites2D.removeElement(spr as Sprite) //can be in one of 2 lists\n                            const sayRenderer = this.sayRederers[spr.id]\n                            if (sayRenderer) {\n                                this.sayRederers.removeElement(sayRenderer)\n                                sayRenderer.destroy()\n                            }\n                        })\n                    }\n                } else if (spr instanceof particles.ParticleSource) {\n                    const particle = (spr as particles.ParticleSource)\n                    if (this.spriteParticles.indexOf(particle) < 0) {\n                        this.spriteParticles[(particle.anchor as Sprite).id] = particle\n                        particle.anchor = this.tempSprite\n                    }\n                } else {\n                    if (this.spriteLikes.indexOf(spr) < 0)\n                        this.spriteLikes.push(spr)\n                }\n                sc_allSprites.removeElement(spr)\n            }\n            this.sprites.forEach((spr) => {\n                if (spr)\n                    this.takeoverSayRenderOfSprite(spr)\n            })\n        }\n        takeoverSayRenderOfSprite(sprite: Sprite) {\n            const sprite_as_any = (sprite as any)\n            if (sprite_as_any.sayRenderer) {\n                this.sayRederers[sprite.id] = sprite_as_any.sayRenderer\n                this.sayEndTimes[sprite.id] = sprite_as_any.sayEndTime;\n                sprite_as_any.sayRenderer = undefined\n                sprite_as_any.sayEndTime = undefined\n            }\n        }\n\n        tilemapLoaded() {\n            const sc = game.currentScene()\n            this.map = sc.tileMap.data\n            this.textures = sc.tileMap.data.getTileset()\n            this.tilemapScaleSize = 1 << sc.tileMap.data.scale\n            this.oldRender = sc.tileMap.renderable\n            this.spriteLikes.removeElement(this.oldRender)\n            sc.allSprites.removeElement(this.oldRender)\n\n            let frameCallback_update = sc.eventContext.registerFrameHandler(scene.PRE_RENDER_UPDATE_PRIORITY + 1, () => {\n                const dt = sc.eventContext.deltaTime;\n                // sc.camera.update();  // already did in scene\n                for (const s of this.sprites)\n                    s.__update(sc.camera, dt);\n                this.sprSelf.__update(sc.camera, dt)\n            })\n\n            let frameCallback_draw = sc.eventContext.registerFrameHandler(scene.RENDER_SPRITES_PRIORITY + 1, () => {\n                if (this._viewMode == ViewMode.tilemapView) {\n                   // screen.drawImage(sc.background.image, 0, 0)\n                    this.oldRender.__drawCore(sc.camera)\n                    this.sprites.forEach(spr => spr.__draw(sc.camera))\n                    this.sprSelf.__draw(sc.camera)\n                } else {\n                 //   this.tempScreen.drawImage(sc.background.image, 0, 0)\n                    //debug\n                    // const ms=control.micros()\n                    this.render()\n                    // info.setScore(control.micros()-ms)\n                    screen.fill(0)\n                }\n                this.sprites2D.forEach(spr => spr.__draw(sc.camera))\n                this.spriteLikes.forEach(spr => spr.__draw(sc.camera))\n                if (this._viewMode == ViewMode.raycastingView)\n                    this.tempScreen.drawTransparentImage(screen, 0, 0)\n            })\n\n            sc.tileMap.addEventListener(tiles.TileMapEvent.Unloaded, data => {\n                sc.eventContext.unregisterFrameHandler(frameCallback_update)\n                sc.eventContext.unregisterFrameHandler(frameCallback_draw)\n            })\n\n            // this.myRender = scene.createRenderable(\n            //     scene.TILE_MAP_Z,\n            //     (t, c) => this.trace(t, c)\n            // )\n\n        }\n\n        constructor() {\n            this._angle = 0\n            this.fov = defaultFov\n            this.camera = new scene.Camera()\n\n            const sc = game.currentScene()\n            if (!sc.tileMap) {\n                sc.tileMap = new tiles.TileMap();\n            } else {\n                this.tilemapLoaded()\n            }\n            game.currentScene().tileMap.addEventListener(tiles.TileMapEvent.Loaded, data => this.tilemapLoaded())\n\n            //self sprite\n            this.sprSelf = sprites.create(image.create(this.tilemapScaleSize >> 1, this.tilemapScaleSize >> 1), SpriteKind.Player)\n            this.takeoverSceneSprites()\n            this.sprites.removeElement(this.sprSelf)\n            this.updateViewZPos()\n            scene.cameraFollowSprite(this.sprSelf)\n            this.updateSelfImage()\n\n            game.onUpdate(function () {\n                this.updateControls()\n            })\n\n            game.onUpdateInterval(400, () => {\n                for (let i = 0; i < this.sprites.length;) {\n                    const spr = this.sprites[i]\n                    if (spr.flags & sprites.Flag.RelativeToCamera) {\n                        this.sprites.removeElement(spr)\n                        this.sprites2D.push(spr)\n                    } else { i++ }\n                }\n                for (let i = 0; i < this.sprites2D.length;) {\n                    const spr = this.sprites2D[i]\n                    if (!(spr.flags & sprites.Flag.RelativeToCamera)) {\n                        this.sprites2D.removeElement(spr)\n                        this.sprites.push(spr)\n                    } else { i++ }\n                }\n                this.takeoverSceneSprites() // in case some one new\n            })\n\n\n            game.onUpdateInterval(25, () => {\n                if (this.cameraSway && this.isWalking) {\n                    this.cameraOffsetX = (Math.sin(control.millis() / 150) * this.cameraSway * 3) | 0\n                    this.cameraOffsetZ_fpx = tofpx(Math.cos(control.millis() / 75) * this.cameraSway) | 0\n                }\n            });\n            control.__screen.setupUpdate(() => {\n                if (this.viewMode == ViewMode.raycastingView)\n                    updateScreen(this.tempScreen)\n                else\n                    updateScreen(screen)\n            })\n\n            game.addScenePushHandler((oldScene) => {\n                control.__screen.setupUpdate(() => { updateScreen(screen) })\n            })\n            game.addScenePopHandler((oldScene) => {\n                control.__screen.setupUpdate(() => {\n                    if (this.viewMode == ViewMode.raycastingView)\n                        updateScreen(this.tempScreen)\n                    else\n                        updateScreen(screen)\n                })\n            })\n        }\n\n        private setVectors() {\n            const sin = Math.sin(this._angle)\n            const cos = Math.cos(this._angle)\n            this.dirXFpx = tofpx(cos)\n            this.dirYFpx = tofpx(sin)\n            this.planeX = tofpx(sin * this._fov)\n            this.planeY = tofpx(cos * -this._fov)\n        }\n\n        //todo, pre-drawn dirctional image\n        public updateSelfImage() {\n            const img = this.sprSelf.image\n            img.fill(6)\n            const arrowLength = img.width / 2\n            img.drawLine(arrowLength, arrowLength, arrowLength + this.dirX * arrowLength, arrowLength + this.dirY * arrowLength, 2)\n            img.fillRect(arrowLength - 1, arrowLength - 1, 2, 2, 2)\n        }\n\n        updateControls() {\n            if (this.velocityAngle !== 0) {\n                const dx = controller.dx(this.velocityAngle)\n                if (dx) {\n                    this.viewAngle += dx\n                }\n            }\n            if (this.velocity !== 0) {\n                this.isWalking = true\n                const dy = controller.dy(this.velocity)\n                if (dy) {\n                    const nx = this.xFpx - Math.round(this.dirXFpx * dy)\n                    const ny = this.yFpx - Math.round(this.dirYFpx * dy)\n                    this.sprSelf.setPosition((nx * this.tilemapScaleSize / fpx_scale), (ny * this.tilemapScaleSize / fpx_scale))\n                } else {\n                    this.isWalking = false\n                }\n            }\n\n            for (const spr of this.sprites) {\n                this.updateMotionZ(spr)\n            }\n            this.updateMotionZ(this.sprSelf)\n        }\n\n        updateMotionZ(spr: Sprite) {\n            const dt = game.eventContext().deltaTime\n            const motionZ = this.spriteMotionZ[spr.id]\n            //if (!motionZ) continue\n\n            if (motionZ.v != 0 || motionZ.p != motionZ.offset) {\n                motionZ.v += motionZ.a * dt, motionZ.p += motionZ.v * dt\n                //landing\n                if ((motionZ.a >= 0 && motionZ.v > 0 && motionZ.p > motionZ.offset) ||\n                    (motionZ.a <= 0 && motionZ.v < 0 && motionZ.p < motionZ.offset)) { motionZ.p = motionZ.offset, motionZ.v = 0 }\n                if (spr === this.sprSelf)\n                    this.updateViewZPos()\n            }\n\n        }\n\n\n        blitRowBreak(screenX: number, screenUp: number, screenDown: number, source: Image, sourceX: number, sourceYBreak: number) {\n\n            let stepY = (sourceYBreak) / (SHHalf - screenUp )\n            let sourceY = sourceYBreak - stepY\n            let y = SHHalf -1\n            if (screenUp < 0)\n                screenUp = 0\n            while (y  >= Math.ceil(screenUp)-1) {\n                if (sourceY < 0) \n                    sourceY = 0\n                const c = source.getPixel(sourceX, sourceY)\n                this.tempScreen.setPixel(screenX, y, c)\n                y--\n                sourceY -= stepY\n            }\n            // from screen half  going down\n            stepY = (source.height - sourceYBreak) / (screenDown - SHHalf)\n            sourceY = sourceYBreak \n            y = SHHalf\n            if (screenDown > SH)\n                screenDown = SH\n            while (y < Math.round(screenDown)) {\n                const c = source.getPixel(sourceX, sourceY)\n                this.tempScreen.setPixel(screenX, y, c)\n                y++\n                sourceY += stepY\n            }\n\n        }\n        \n        render() {\n            // based on https://lodev.org/cgtutor/raycasting.html\n            this.selfXFpx = this.xFpx\n            this.selfYFpx = this.yFpx\n\n            let drawStart = 0\n            let drawHeight = 0\n            let lastDist = -1, lastTexX = -1, lastMapX = -1, lastMapY = -1\n            this.viewZPos = this.spriteMotionZ[this.sprSelf.id].p + (this.sprSelf._height as any as number) - (2 << fpx) + this.cameraOffsetZ_fpx\n            let cameraRangeAngle = Math.atan(this.fov) + .1 //tolerance for spr center just out of camera\n            //debug\n            // const ms=control.millis()\n\n            \n\n\n            const tex = this.textures[1]\n            let rayDirX0 = this.dirXFpx / fpx_scale + (this.planeX / fpx_scale)\n            let rayDirY0 = this.dirYFpx / fpx_scale + (this.planeY / fpx_scale)\n            let rayDirX1 = this.dirXFpx / fpx_scale - (this.planeX / fpx_scale)\n            let rayDirY1 = this.dirYFpx / fpx_scale - (this.planeY / fpx_scale)\n            let fmapX = this.selfXFpx / fpx_scale\n            let fmapY = this.selfYFpx / fpx_scale\n\n            const sc = game.currentScene() \n           // background\n            const speed = 2 // 2: normal speed\n            let backgroundOffset = (this._angle / Math.PI * speed ) % 1  // range -1..1\n            if (backgroundOffset < 0) backgroundOffset++  // range 0..1\n            backgroundOffset *= SW    // range 0..screenwidth\n            \n            //floor\n            for (let y = 60; y < SH; y++) {\n                let p = y - SHHalf\n                let posZ = SH * this.viewZPos / this.tilemapScaleSize / fpx_scale\n                let rowDistance = posZ / p\n                let floorStepX = rowDistance * (rayDirX1 - rayDirX0) / SW\n                let floorStepY = rowDistance * (rayDirY1 - rayDirY0) / SW\n\n\n\n                let floorX = fmapX + rowDistance * rayDirX0\n                let floorY = fmapY + rowDistance * rayDirY0\n                for (let x = 0; x < SW; x++) {\n                      let cellX = Math.floor(floorX)\n                     let cellY = Math.floor(floorY)\n                    let tx =  (16 * (floorX - cellX)) & 15\n                      let ty = (16 * (floorY - cellY)) & (15)\n                    let mapX = Math.round(floorX - 0.5) % 16\n                    let mapY = Math.round(floorY - 0.5) % 16\n                    let tileType = this.map.getTile(mapX, mapY)\n                    let floorTex = this.textures[tileType]\n                    floorX += floorStepX\n                    floorY += floorStepY\n                    let c = floorTex.getPixel(tx, ty)\n                    this.tempScreen.setPixel(x, y, c)\n\n                }\n\n\n\n            }\n            // walls\n\n            for (let x = 0; x < SW; x++) {\n                const cameraX: number = one - Math.idiv(((x + this.cameraOffsetX) << fpx) << 1, SW)\n                let rayDirX = this.dirXFpx + (this.planeX * cameraX >> fpx)\n                let rayDirY = this.dirYFpx + (this.planeY * cameraX >> fpx)\n\n                // avoid division by zero\n                if (rayDirX == 0) rayDirX = 1\n                if (rayDirY == 0) rayDirY = 1\n\n                let mapX = this.selfXFpx >> fpx\n                let mapY = this.selfYFpx >> fpx\n\n                // length of ray from current position to next x or y-side\n                let sideDistX = 0, sideDistY = 0\n\n                // length of ray from one x or y-side to next x or y-side\n                const deltaDistX = Math.abs(Math.idiv(one2, rayDirX));\n                const deltaDistY = Math.abs(Math.idiv(one2, rayDirY));\n\n                let mapStepX = 0, mapStepY = 0\n\n                let sideWallHit = false;\n\n                //calculate step and initial sideDist\n                if (rayDirX < 0) {\n                    mapStepX = -1;\n                    sideDistX = ((this.selfXFpx - (mapX << fpx)) * deltaDistX) >> fpx;\n                } else {\n                    mapStepX = 1;\n                    sideDistX = (((mapX << fpx) + one - this.selfXFpx) * deltaDistX) >> fpx;\n                }\n                if (rayDirY < 0) {\n                    mapStepY = -1;\n                    sideDistY = ((this.selfYFpx - (mapY << fpx)) * deltaDistY) >> fpx;\n                } else {\n                    mapStepY = 1;\n                    sideDistY = (((mapY << fpx) + one - this.selfYFpx) * deltaDistY) >> fpx;\n                }\n\n                let color = 0\n\n                while (true) {\n                    //jump to next map square, OR in x-direction, OR in y-direction\n                    if (sideDistX < sideDistY) {\n                        sideDistX += deltaDistX;\n                        mapX += mapStepX;\n                        sideWallHit = false;\n                    } else {\n                        sideDistY += deltaDistY;\n                        mapY += mapStepY;\n                        sideWallHit = true;\n                    }\n\n                    if (this.map.isOutsideMap(mapX, mapY))\n                        break\n                    color = this.map.getTile(mapX, mapY)\n                    if  (this.map.isWall(mapX, mapY))\n                        break; // hit!\n                }\n\n                if (this.map.isOutsideMap(mapX, mapY))\n                    continue\n\n                let perpWallDist = 0\n                let wallX = 0\n                if (!sideWallHit) {\n                    perpWallDist = Math.idiv(((mapX << fpx) - this.selfXFpx + (1 - mapStepX << fpx - 1)) << fpx, rayDirX)\n                    wallX = this.selfYFpx + (perpWallDist * rayDirY >> fpx);\n                } else {\n                    perpWallDist = Math.idiv(((mapY << fpx) - this.selfYFpx + (1 - mapStepY << fpx - 1)) << fpx, rayDirY)\n                    wallX = this.selfXFpx + (perpWallDist * rayDirX >> fpx);\n                }\n                wallX &= FPX_MAX\n\n                // color = (color - 1) * 2\n                // if (sideWallHit) color++\n\n                const tex = this.textures[color]\n                if (!tex)\n                    continue\n\n                let texX = (wallX * tex.width) >> fpx;\n                // if ((!sideWallHit && rayDirX > 0) || (sideWallHit && rayDirY < 0))\n                //     texX = tex.width - texX - 1;\n\n                const lineHeight = (this.wallHeightInView / perpWallDist)\n                const drawEnd = lineHeight * this.viewZPos / this.tilemapScaleSize / fpx_scale;\n                const horizontBreak = 1 - this.viewZPos / this.tilemapScaleSize / fpx_scale;\n                if (perpWallDist !== lastDist && (texX !== lastTexX || mapX !== lastMapX || mapY !== lastMapY)) {//neighbor line of tex share same parameters\n                     \n                    drawStart = drawEnd - lineHeight * (this._wallZScale) ;\n                    drawHeight = (Math.ceil(drawEnd) - Math.ceil(drawStart) )\n                    drawStart += (SH >> 1)\n\n                    lastDist = perpWallDist\n                    lastTexX = texX\n                    lastMapX = mapX\n                    lastMapY = mapY\n                }\n                //fix start&end points to avoid regmatic between lines\n               \n\n                //if (x < SWHalf)\n                //    this.tempScreen.blitRow(x, drawStart, tex, texX, drawHeight)\n                //else\n                    this.blitRowBreak(x, SHHalf + drawEnd - lineHeight, SHHalf + drawEnd, tex, texX, tex.height * horizontBreak)\n\n                this.dist[x] = perpWallDist\n\n                // background \n                for (let y = 0; y < drawStart; y++ ){\n                    let backX = (backgroundOffset + x) % SW\n                    let c = sc.background.image.getPixel(backX,y)\n                    this.tempScreen.setPixel(x,y,c)\n                }\n            }\n            //debug\n            // info.setScore(control.millis()-ms)\n           // this.tempScreen.print(backgroundOffset.toString(), 0,0,7 )\n           // this.tempScreen.print([Math.roundWithPrecision(this._angle, 3)].join(), 20, 5)\n\n            this.drawSprites()\n        }\n\n        drawSprites() {\n            //debug\n            // let msSprs=control.millis()\n            /////////////////// sprites ///////////////////\n\n            //for sprite\n            const invDet = one2 / (this.planeX * this.dirYFpx - this.dirXFpx * this.planeY); //required for correct matrix multiplication\n\n            this.sprites\n                .filter((spr, i) => {\n                    const spriteX = this.sprXFx8(spr) - this.xFpx // this.selfXFpx\n                    const spriteY = this.sprYFx8(spr) - this.yFpx // this.selfYFpx\n                    this.angleSelfToSpr[spr.id] = Math.atan2(spriteX, spriteY)\n                    this.transformX[spr.id] = invDet * (this.dirYFpx * spriteX - this.dirXFpx * spriteY) >> fpx;\n                    this.transformY[spr.id] = invDet * (-this.planeY * spriteX + this.planeX * spriteY) >> fpx; //this is actually the depth inside the screen, that what Z is in 3D\n                    const angleInCamera = Math.atan2(this.transformX[spr.id] * this.fov, this.transformY[spr.id])\n                    return angleInCamera > -this.cameraRangeAngle && angleInCamera < this.cameraRangeAngle //(this.transformY[spr.id] > 0\n                }).sort((spr1, spr2) => {   // far to near\n                    return (this.transformY[spr2.id] - this.transformY[spr1.id])\n                }).forEach((spr, index) => {\n                    //debug\n                    // this.tempScreen.print([spr.id,Math.roundWithPrecision(angle[spr.id],3)].join(), 0, index * 10 + 10,9)\n                    this.drawSprite(spr, index, this.transformX[spr.id], this.transformY[spr.id], this.angleSelfToSpr[spr.id])\n                })\n\n            //debug\n            // info.setLife(control.millis() - msSprs+1)\n             //this.tempScreen.print([Math.roundWithPrecision(this._angle,3)].join(), 20,  0)\n\n        }\n\n        registerOnSpriteDirectionUpdate(handler: (spr: Sprite, dir: number) => void) {\n            this.onSpriteDirectionUpdateHandler = handler\n        }\n\n        drawSprite(spr: Sprite, index: number, transformX: number, transformY: number, myAngle: number) {\n            const spriteScreenX = Math.ceil((SWHalf) * (1 - transformX / transformY)) - this.cameraOffsetX;\n            const spriteScreenHalfWidth = Math.idiv((spr._width as any as number) / this.tilemapScaleSize / 2 * this.wallWidthInView, transformY)  //origin: (texSpr.width / 2 << fpx) / transformY / this.fov / 3 * 2 * 4\n            const spriteScreenLeft = spriteScreenX - spriteScreenHalfWidth\n            const spriteScreenRight = spriteScreenX + spriteScreenHalfWidth\n\n            //calculate drawing range in X direction\n            //assume there is one range only\n            let blitX = 0, blitWidth = 0\n            for (let sprX = 0; sprX < SW; sprX++) {\n                if (this.dist[sprX] > transformY) {\n                    if (blitWidth == 0)\n                        blitX = sprX\n                    blitWidth++\n                } else if (blitWidth > 0) {\n                    if (blitX <= spriteScreenRight && blitX + blitWidth >= spriteScreenLeft)\n                        break\n                    else\n                        blitX = 0, blitWidth = 0;\n                }\n            }\n            // this.tempScreen.print([this.getxFx8(spr), this.getyFx8(spr)].join(), 0,index*10+10)\n            const blitXSpr = Math.max(blitX, spriteScreenLeft)\n            const blitWidthSpr = Math.min(blitX + blitWidth, spriteScreenRight) - blitXSpr\n            if (blitWidthSpr <= 0)\n                return\n\n            const lineHeight = Math.idiv(this.wallHeightInView, transformY)\n            const drawStart = SHHalf + (lineHeight * ((this.viewZPos - this.spriteMotionZ[spr.id].p - (spr._height as any as number)) / this.tilemapScaleSize) >> fpx)\n\n            //for textures=image[][], abandoned\n            //    const texSpr = spr.getTexture(Math.floor(((Math.atan2(spr.vxFx8, spr.vyFx8) - myAngle) / Math.PI / 2 + 2-.25) * spr.textures.length +.5) % spr.textures.length)\n            //for deal in user code\n            if (this.onSpriteDirectionUpdateHandler)\n                this.onSpriteDirectionUpdateHandler(spr, ((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25))\n            //for CharacterAnimation ext.\n            //     const iTexture = Math.floor(((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25) * 4 + .5) % 4\n            //     const characterAniDirs = [Predicate.MovingLeft,Predicate.MovingDown, Predicate.MovingRight, Predicate.MovingUp]\n            //     character.setCharacterState(spr, character.rule(characterAniDirs[iTexture]))\n            //for this.spriteAnimations\n            const texSpr = !this.spriteAnimations[spr.id] ? spr.image : this.spriteAnimations[spr.id].getFrameByDir(((Math.atan2(spr._vx as any as number, spr._vy as any as number) - myAngle) / Math.PI / 2 + 2 - .25))\n\n            const sprTexRatio = texSpr.width / spriteScreenHalfWidth / 2\n            helpers.imageBlit(\n                this.tempScreen,\n                blitXSpr,\n                drawStart,\n                blitWidthSpr,\n                lineHeight * spr.height / this.tilemapScaleSize,\n                texSpr,\n                (blitXSpr - (spriteScreenX - spriteScreenHalfWidth)) * sprTexRatio\n                ,\n                0,\n                blitWidthSpr * sprTexRatio, texSpr.height, true, false)\n\n            screen.fill(0)\n            const fpx_div_transformy = Math.roundWithPrecision(transformY / 4 / fpx_scale, 2)\n            const height = (SH / fpx_div_transformy)\n            const blitXSaySrc = ((blitX - spriteScreenX) * fpx_div_transformy) + SWHalf\n            const blitWidthSaySrc = (blitWidth * fpx_div_transformy)\n\n            //sprite\n            // screen.drawImage(texSpr, SWHalf-texSpr.width/2, SHHalf)\n            //sayText\n            const sayRender = this.sayRederers[spr.id]\n            if (sayRender) {\n                if (this.sayEndTimes[spr.id] && control.millis() > this.sayEndTimes[spr.id]) {\n                    this.sayRederers[spr.id] = undefined\n                } else {\n                    this.tempSprite.x = SWHalf\n                    this.tempSprite.y = SHHalf + 2\n                    this.camera.drawOffsetX = 0\n                    this.camera.drawOffsetY = 0\n                    sayRender.draw(screen, this.camera, this.tempSprite)\n                }\n            }\n            //particle\n            const particle = this.spriteParticles[spr.id]\n            if (particle) {\n                if (particle.lifespan) {\n                    //debug\n                    // this.tempScreen.print([spr.id].join(), 0,index*10+10)\n                    this.tempSprite.x = SWHalf\n                    this.tempSprite.y = SHHalf + spr.height\n                    this.camera.drawOffsetX = 0//spr.x-SWHalf\n                    this.camera.drawOffsetY = 0//spr.y-SH\n                    particle.__draw(this.camera)\n                } else {\n                    this.spriteParticles[spr.id] = undefined\n                }\n            }\n            //update screen for this spr\n            // const sayTransformY = \n            if (blitXSaySrc <= 0) { //imageBlit considers negative value as 0\n                helpers.imageBlit(\n                    this.tempScreen,\n                    spriteScreenX - SWHalf / fpx_div_transformy, drawStart - height / 2, (blitWidthSaySrc + blitXSaySrc) / fpx_div_transformy, height,\n                    screen,\n                    0, 0, blitWidthSaySrc + blitXSaySrc, SH, true, false)\n            } else {\n                helpers.imageBlit(\n                    this.tempScreen,\n                    // blitX, drawStart - height / 2 , blitWidth, height,\n                    blitX, drawStart - height / 2, blitWidth, height,\n                    screen,\n                    blitXSaySrc, 0, blitWidthSaySrc, SH,\n                    true, false)\n            }\n        }\n    }\n\n    //%fixedinstance\n    export const raycastingRender = new Render.RayCastingRender()\n}\n\n","tilemap.g.jres":"{\n    \"transparency16\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true\n    },\n    \"tile1\": {\n        \"data\": \"hwQQABAAAABBbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfU1tosK9be19TW2iwr1t7X1NbaLCvW3tfQ==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile\"\n    },\n    \"tile2\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile0\"\n    },\n    \"tile3\": {\n        \"data\": \"hwQQABAAAAB34AAAAAAAAACeAAAAAAAAcOcAAAAAAAAA4AAAAAAAAHcHDgAAAAAA4O4AAAAAAAB34OAAAAAAAADu4AAAAAAAcAfuAAAAAAAH5w4AAAAAAHcADgAAAAAAB+fpAAAAAAB3DgAAAAAAAADgAAAAAAAAd+cOAAAAAAAHDgAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile1\"\n    },\n    \"tile5\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALsLAAAAAAAAuwsAAAAAAAC7CwAAAAAAALv7AAAAAAAAu/vd3d3dDQC7+wAAAAAAALsLAAAAAAAAuwsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile3\"\n    },\n    \"tile6\": {\n        \"data\": \"hwQQABAAAAAkL/QiJCIvJP8v8iQiJP//JE/y//8iT0JCL/IiIiRPIiQv8iIkIi8iIi8iIiJCLyQiL/T//yIvQv8vIi8kQv//Qi8i8iIkLyJCT/L//yIvRCIvIiIiQk8iJC/0QiIiLyRCL/IiQkIvQiQv8v//Ii8k/y/yIiJC//8iT/IiJCIvJA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile4\"\n    },\n    \"tile8\": {\n        \"data\": \"hwQQABAAAAAPAAAAAAAPAA/w//8AAA8A/w8AAP//AAAADwAA/wAAMAAPAAAPAAAAAA8AAA//AAAADwAADwAAAPDw//8AAAAADwAAAP////8PAAAA/////wDw//8AAAAAAA8AAA8AAAAADwAADwAAAAAPAAAPAAAAAA8AAA8AAAAA8P//AAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile6\"\n    },\n    \"tile4\": {\n        \"data\": \"hwQQABAAAADGxsbGxsbGxsbGxv//xsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxvbGxs/Gxg==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile2\"\n    },\n    \"tile10\": {\n        \"data\": \"hwQQABAAAAAdERGxu7u7u9Hd3b0dERGx0d3dvdHd3b3R3d290d3dvdHd3b3R3d290d3dvdHd3b3R3d3d0d3dvbu7u+3R3bvbHRERsbu7Ee3R3d29HdHd3dHd3b3R3d290d3dvdHd3b3R3d290d3dvdHd3b3R3d290d3d3dHd3b27u7vtu7u77Q==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile8\"\n    },\n    \"tile11\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile9\"\n    },\n    \"tile7\": {\n        \"data\": \"hwQQABAAAAC/u7u7u7u7+7+7u7u7u7v7/7u7u7u7u///mZmZmZmZ//+qqqqqqqr//5mZmZmZmf//mZmZmZmZ//+Zn//5n5n//5mf//mfmf//mZmZmZmZ//+ZmZmZmZn//6qqqqqqqv//mZmZmZmZ//+7u7u7u7v/v7u7u7u7u/u/u7u7u7u7+w==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile5\"\n    },\n    \"tile9\": {\n        \"data\": \"hwQQABAAAAC8u//P/f+7y7y7+8u7v7vLzLv7y7u/u8zMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMy7u8u7u7vMvLu7y7u7u8u8u7vLvbu7yw==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile7\"\n    },\n    \"tile12\": {\n        \"data\": \"hwQQABAAAADPzP/P/8/M/M/M/Mz8zMz8/8zMzMzMzP//mZmZmZmZ//+qqqqqqqr//5mZmZmZmf//mZmZmZmZ//+Zn//5n5n//5mf//mfmf//mZmZmZmZ//+ZmZmZmZn//6qqqqqqqv//mZmZmZmZ///MzMzMzMz/z8zMzMzMzPzPzMzMzMzM/A==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true,\n        \"displayName\": \"myTile10\"\n    },\n    \"level1\": {\n        \"id\": \"level1\",\n        \"mimeType\": \"application/mkcd-tilemap\",\n        \"data\": \"MTAxMDAwMTAwMDAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMjAyMDIwMTA0MDMwMTAxMDIwMjAyMDIwMjAxMDMwMzAyMDIwMjAxMDEwNTAxMDEwMjAyMDIwMjAyMDEwMzAzMDEwMjAyMDEwNzA2MDEwMTAyMDIwMjAyMDIwMTAzMDMwMzA0MDQwMTAxMDMwMTAxMDIwMjAyMDIwMjAxMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAzMDMwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDMwMzAxMDEwMTAxMDIwMjAyMDIwMjAxMDEwMTAxMDEwMzAzMDEwMTAxMDEwMjAyMDIwMjAyMDEwMjAyMDIwMjAzMDMwMTAxMDEwMTAyMDIwMjAyMDIwMTAyMDIwMjAyMDMwMzAyMDIwMTAxMDIwMjAyMDIwMjAxMDIwMjAyMDIwMzAzMDIwMjAxMDEwMjAyMDIwMjAyMDEwMjAyMDIwMjAzMDMwMjAyMDEwMTAxMDEwMTAxMDEwMTAyMDIwMjAyMDMwMzAyMDIwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDEwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMDMwMzAzMjIyMjIyMjIyMjIyMjIyMjAyMDAyMDAyMDAwMDAwMjAwMjAwMDAwMjAwMDAwMDIwMDIwMDAwMDIwMDAwMDAyMDIyMjIwMDAyMDAwMDAwMjAyMjIyMjIyMjIyMjIyMjIyMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMDIwMDAwMDAwMDAwMDAyMDAyMDAwMDAwMDAwMDAwMjAwMjAwMDAwMDAwMDAwMDIwMjIyMjIyMjIyMjIyMjIyMg==\",\n        \"tileset\": [\n            \"myTiles.transparency16\",\n            \"sprites.dungeon.floorLight0\",\n            \"sprites.dungeon.floorLight1\",\n            \"sprites.dungeon.floorDark0\",\n            \"myTiles.tile7\",\n            \"myTiles.tile4\",\n            \"myTiles.tile9\",\n            \"myTiles.tile10\",\n            \"myTiles.tile12\"\n        ],\n        \"displayName\": \"level\"\n    },\n    \"*\": {\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"dataEncoding\": \"base64\",\n        \"namespace\": \"myTiles\"\n    }\n}","tilemap.g.ts":"","pxt.json":"{\n    \"name\": \"3d floor and background - Copy\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"device\": \"*\",\n        \"sprite-scaling\": \"*\",\n        \"pxt-status-bar\": \"github:jwunderl/pxt-status-bar#v0.4.2\",\n        \"Timers\": \"github:microsoft/arcade-timers#v1.1.0\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"assets.json\",\n        \"_animation.ts\",\n        \"_render_blocks.ts\",\n        \"_render_raycasting.ts\",\n        \"tilemap.g.jres\",\n        \"tilemap.g.ts\"\n    ],\n    \"targetVersions\": {\n        \"branch\": \"v1.10.36\",\n        \"tag\": \"v1.10.36\",\n        \"commits\": \"https://github.com/microsoft/pxt-arcade/commits/3a5a7e13703edf0412c17bdb9b1469e282a5b31b\",\n        \"target\": \"1.10.36\",\n        \"pxt\": \"8.3.9\"\n    },\n    \"preferredEditor\": \"blocksprj\"\n}\n"}}],"shares":[],"lastSaveTime":1763752125480}